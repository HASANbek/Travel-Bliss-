<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Tour Details - Travel Bliss</title>
    <link rel="icon" href="assets/img/fav-icon.svg" type="image/svg+xml">

    <!-- CSS Files -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/css/boxicons.min.css">
    <link rel="stylesheet" href="assets/css/swiper-bundle.min.css">
    <link rel="stylesheet" href="assets/css/slick.css">
    <link rel="stylesheet" href="assets/css/animate.min.css">
    <link rel="stylesheet" href="assets/css/jquery.fancybox.min.css">
    <link rel="stylesheet" href="assets/css/daterangepicker.css">
    <link rel="stylesheet" href="assets/css/jquery-ui.css">
    <link rel="stylesheet" href="assets/css/style.css">

    <style>
        .tour-details-banner {
            height: 500px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .tour-details-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.1" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,122.7C672,117,768,139,864,149.3C960,160,1056,160,1152,138.7C1248,117,1344,75,1392,53.3L1440,32L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') bottom;
            background-size: cover;
        }

        .tour-details-content {
            position: relative;
            z-index: 2;
            text-align: center;
        }

        .tour-badge {
            display: inline-block;
            padding: 8px 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 30px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
        }

        .tour-price {
            font-size: 48px;
            font-weight: 700;
            margin: 20px 0;
        }

        .tour-meta {
            display: flex;
            gap: 30px;
            justify-content: center;
            margin-top: 20px;
        }

        .tour-meta-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .itinerary-item {
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .itinerary-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .day-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            font-weight: bold;
            font-size: 18px;
            margin-right: 15px;
        }

        .included-list, .excluded-list {
            list-style: none;
            padding: 0;
        }

        .included-list li, .excluded-list li {
            padding: 10px 0;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .included-list li:before {
            content: '‚úì';
            color: #10b981;
            font-weight: bold;
            font-size: 18px;
        }

        .excluded-list li:before {
            content: '‚úó';
            color: #ef4444;
            font-weight: bold;
            font-size: 18px;
        }

        .booking-box {
            position: sticky;
            top: 100px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .book-now-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .book-now-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .section-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 30px;
            color: #1f2937;
        }

        .highlight-card {
            background: #f9fafb;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-area header-style-one">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-xl-12">
                        <div class="header-main-wrapper">
                            <div class="logo">
                                <a href="index.html">
                                    <img src="assets/img/travel-bliss-logo.png" alt="Travel Bliss" style="height: 50px;">
                                </a>
                            </div>
                            <div class="main-menu">
                                <ul>
                                    <li><a href="index.html">Home</a></li>
                                    <li><a href="travel-agency-03.html">Tours</a></li>
                                    <li><a href="about.html">About</a></li>
                                    <li><a href="contact.html">Contact</a></li>
                                </ul>
                            </div>
                            <div class="nav-right">
                                <a href="/admin" class="primary-btn1">Admin Panel</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Tour Details Banner -->
    <div class="tour-details-banner" id="tourBanner">
        <div class="tour-details-content">
            <div class="tour-badge" id="tourCategory">Loading...</div>
            <h1 id="tourTitle" style="font-size: 48px; margin: 0;">Loading Tour...</h1>
            <p id="tourLocation" style="font-size: 24px; opacity: 0.9; margin-top: 10px;"></p>
            <div class="tour-price" id="tourPrice">$0</div>
            <div class="tour-meta">
                <div class="tour-meta-item">
                    <i class="bi bi-calendar3" style="font-size: 24px;"></i>
                    <span id="tourDuration">0 Days</span>
                </div>
                <div class="tour-meta-item">
                    <i class="bi bi-people" style="font-size: 24px;"></i>
                    <span id="tourGroupSize">Max 0 People</span>
                </div>
                <div class="tour-meta-item">
                    <i class="bi bi-star-fill" style="font-size: 24px; color: #fbbf24;"></i>
                    <span id="tourRating">0.0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Tour Details Content -->
    <div class="container" style="margin-top: 50px; margin-bottom: 80px;">
        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-8">
                <!-- Overview -->
                <div class="mb-5">
                    <h2 class="section-title">Overview</h2>
                    <p id="tourDescription" style="font-size: 16px; line-height: 1.8; color: #4b5563;">
                        Loading tour description...
                    </p>
                </div>

                <!-- Highlights -->
                <div class="mb-5" id="highlightsSection">
                    <h2 class="section-title">Tour Highlights</h2>
                    <div id="highlightsList"></div>
                </div>

                <!-- Itinerary -->
                <div class="mb-5" id="itinerarySection">
                    <h2 class="section-title">Day by Day Itinerary</h2>
                    <div id="itineraryList"></div>
                </div>

                <!-- Included/Excluded -->
                <div class="mb-5">
                    <div class="row">
                        <div class="col-md-6">
                            <h3 style="font-size: 24px; font-weight: 600; margin-bottom: 20px;">
                                <i class="bi bi-check-circle-fill" style="color: #10b981;"></i> What's Included
                            </h3>
                            <ul class="included-list" id="includedList"></ul>
                        </div>
                        <div class="col-md-6">
                            <h3 style="font-size: 24px; font-weight: 600; margin-bottom: 20px;">
                                <i class="bi bi-x-circle-fill" style="color: #ef4444;"></i> What's Excluded
                            </h3>
                            <ul class="excluded-list" id="excludedList"></ul>
                        </div>
                    </div>
                </div>

                <!-- Additional Info -->
                <div class="mb-5" id="additionalInfoSection">
                    <h2 class="section-title">Additional Information</h2>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <strong>Difficulty Level:</strong>
                            <span id="tourDifficulty" class="ms-2"></span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong>Accommodation:</strong>
                            <span id="tourAccommodation" class="ms-2"></span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong>Meals:</strong>
                            <span id="tourMeals" class="ms-2"></span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong>Transportation:</strong>
                            <span id="tourTransport" class="ms-2"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar - Booking Box -->
            <div class="col-lg-4">
                <div class="booking-box">
                    <h3 style="font-size: 24px; margin-bottom: 25px;">Book This Tour</h3>

                    <div style="background: #f9fafb; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                            <span>Price per person:</span>
                            <strong id="pricePerPerson" style="font-size: 24px; color: #667eea;">$0</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;" id="discountSection">
                            <span>Discount:</span>
                            <strong id="discountPrice" style="color: #10b981;">-$0</strong>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600;">Number of Travelers</label>
                        <select class="form-select" id="travelers" style="padding: 12px; border-radius: 8px;">
                            <option value="1">1 Person</option>
                            <option value="2">2 People</option>
                            <option value="3">3 People</option>
                            <option value="4">4 People</option>
                            <option value="5">5 People</option>
                            <option value="6">6 People</option>
                            <option value="7">7 People</option>
                            <option value="8">8 People</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600;">Select Date</label>
                        <input type="date" class="form-control" id="tourDate" style="padding: 12px; border-radius: 8px;">
                    </div>

                    <div style="background: #f9fafb; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; font-size: 18px;">
                            <strong>Total:</strong>
                            <strong id="totalPrice" style="color: #667eea; font-size: 28px;">$0</strong>
                        </div>
                    </div>

                    <button class="book-now-btn" onclick="bookNow()">
                        <i class="bi bi-calendar-check me-2"></i> Book Now
                    </button>

                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                        <p style="font-size: 14px; color: #6b7280; margin: 0;">
                            <i class="bi bi-shield-check" style="color: #10b981;"></i>
                            Free cancellation up to 24 hours before
                        </p>
                    </div>
                </div>

                <!-- Contact Info -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px; margin-top: 30px;">
                    <h4 style="margin-bottom: 20px;">Need Help?</h4>
                    <p style="margin-bottom: 15px;">
                        <i class="bi bi-telephone-fill"></i> +998 90 123 45 67
                    </p>
                    <p style="margin-bottom: 15px;">
                        <i class="bi bi-envelope-fill"></i> info@travelbliss.uz
                    </p>
                    <a href="contact.html" style="display: inline-block; background: white; color: #667eea; padding: 12px 25px; border-radius: 8px; text-decoration: none; font-weight: 600; margin-top: 10px;">
                        Contact Us
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer-area">
        <div class="container">
            <div class="footer-content" style="text-align: center; padding: 40px 0;">
                <p style="color: #6b7280; margin: 0;">
                    ¬© 2025 Travel Bliss. All rights reserved.
                </p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="assets/js/jquery-3.7.1.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/jquery-ui.js"></script>
    <script src="assets/js/moment.min.js"></script>
    <script src="assets/js/daterangepicker.min.js"></script>

    <script>
        const API_BASE = 'http://localhost:5000';
        let currentTour = null;

        // Get tour ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const tourId = urlParams.get('id');

        // Load tour when page loads
        document.addEventListener('DOMContentLoaded', async function() {
            if (!tourId) {
                alert('Tour ID not found!');
                window.location.href = 'travel-agency-03.html';
                return;
            }

            await loadTour(tourId);
            setupPriceCalculator();
            setMinDate();
        });

        async function loadTour(id) {
            try {
                const response = await fetch(`${API_BASE}/api/tours/${id}`);
                const data = await response.json();

                if (data.success && data.data.tour) {
                    currentTour = data.data.tour;
                    displayTour(currentTour);
                } else {
                    alert('Tour not found!');
                    window.location.href = 'travel-agency-03.html';
                }
            } catch (error) {
                console.error('Error loading tour:', error);
                alert('Error loading tour details');
                window.location.href = 'travel-agency-03.html';
            }
        }

        function displayTour(tour) {
            // Title and Basic Info
            const title = tour.title || tour.name;
            const location = tour.destination || tour.location;

            document.getElementById('pageTitle').textContent = `${title} - Travel Bliss`;
            document.getElementById('tourTitle').textContent = title;
            document.getElementById('tourLocation').textContent = location;

            // Category
            const categories = {
                'cultural': 'üèõÔ∏è Cultural Tour',
                'adventure': '‚õ∞Ô∏è Adventure Tour',
                'hiking': 'ü•æ Hiking Tour',
                'day-trip': 'üåÖ Day Trip'
            };
            document.getElementById('tourCategory').textContent = categories[tour.category] || tour.category;

            // Price
            const price = tour.discountPrice || tour.price;
            document.getElementById('tourPrice').textContent = `$${price}`;
            document.getElementById('pricePerPerson').textContent = `$${price}`;

            // Discount
            if (tour.discountPrice && tour.discountPrice < tour.price) {
                document.getElementById('discountPrice').textContent = `-$${tour.price - tour.discountPrice}`;
            } else {
                document.getElementById('discountSection').style.display = 'none';
            }

            // Meta Info
            document.getElementById('tourDuration').textContent = `${tour.duration} Days${tour.nights ? ' / ' + tour.nights + ' Nights' : ''}`;
            document.getElementById('tourGroupSize').textContent = `Max ${tour.maxGroupSize} People`;
            document.getElementById('tourRating').textContent = (tour.rating || 4.5).toFixed(1);

            // Description
            document.getElementById('tourDescription').textContent = tour.description || tour.summary || 'No description available.';

            // Highlights
            if (tour.highlights && tour.highlights.length > 0) {
                const highlightsList = document.getElementById('highlightsList');
                highlightsList.innerHTML = tour.highlights.map(h =>
                    `<div class="highlight-card">
                        <i class="bi bi-star-fill" style="color: #fbbf24; margin-right: 10px;"></i>
                        ${h}
                    </div>`
                ).join('');
            } else {
                document.getElementById('highlightsSection').style.display = 'none';
            }

            // Itinerary
            if (tour.itinerary && tour.itinerary.length > 0) {
                const itineraryList = document.getElementById('itineraryList');
                itineraryList.innerHTML = tour.itinerary.map((day, index) =>
                    `<div class="itinerary-item">
                        <div style="display: flex; align-items: start;">
                            <div class="day-number">${index + 1}</div>
                            <div style="flex: 1;">
                                <h4 style="font-size: 20px; font-weight: 600; margin-bottom: 10px;">
                                    ${day.title || `Day ${index + 1}`}
                                </h4>
                                <p style="color: #6b7280; line-height: 1.6; margin: 0;">
                                    ${day.description || day.activities || ''}
                                </p>
                            </div>
                        </div>
                    </div>`
                ).join('');
            } else {
                document.getElementById('itinerarySection').style.display = 'none';
            }

            // Included
            const included = tour.includes || tour.included || [];
            if (included.length > 0) {
                document.getElementById('includedList').innerHTML = included.map(item =>
                    `<li>${item}</li>`
                ).join('');
            } else {
                document.getElementById('includedList').innerHTML = '<li>Not specified</li>';
            }

            // Excluded
            const excluded = tour.excludes || tour.excluded || [];
            if (excluded.length > 0) {
                document.getElementById('excludedList').innerHTML = excluded.map(item =>
                    `<li>${item}</li>`
                ).join('');
            } else {
                document.getElementById('excludedList').innerHTML = '<li>Not specified</li>';
            }

            // Additional Info
            document.getElementById('tourDifficulty').textContent = tour.difficulty || 'Moderate';
            document.getElementById('tourAccommodation').textContent = tour.accommodation || 'Not specified';
            document.getElementById('tourMeals').textContent = tour.meals || 'Not specified';
            document.getElementById('tourTransport').textContent = tour.transportation || 'Not specified';
        }

        function setupPriceCalculator() {
            const travelersSelect = document.getElementById('travelers');
            travelersSelect.addEventListener('change', updateTotalPrice);
            updateTotalPrice();
        }

        function updateTotalPrice() {
            if (!currentTour) return;

            const travelers = parseInt(document.getElementById('travelers').value);
            const pricePerPerson = currentTour.discountPrice || currentTour.price;
            const total = pricePerPerson * travelers;

            document.getElementById('totalPrice').textContent = `$${total}`;
        }

        function setMinDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tourDate').setAttribute('min', today);
        }

        function bookNow() {
            if (!currentTour) {
                alert('Tour information not loaded');
                return;
            }

            const travelers = document.getElementById('travelers').value;
            const date = document.getElementById('tourDate').value;

            if (!date) {
                alert('Please select a tour date');
                return;
            }

            const message = `Booking Request:\n\nTour: ${currentTour.title || currentTour.name}\nDate: ${date}\nTravelers: ${travelers}\nTotal: ${document.getElementById('totalPrice').textContent}`;

            alert(message + '\n\nThank you! We will contact you shortly to confirm your booking.');
        }
    </script>
</body>
</html>
