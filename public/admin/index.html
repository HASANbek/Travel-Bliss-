<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin CMS - Travel Bliss</title>
    <!-- Leaflet CSS for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f4f6f9;
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: #343a40;
            color: white;
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 20px;
            background: #2c3136;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-header .logo {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #343a40;
            font-size: 18px;
        }

        .sidebar-header h2 {
            font-size: 18px;
            font-weight: 600;
        }

        .user-panel {
            padding: 15px 20px;
            border-bottom: 1px solid #4b545c;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-panel .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
        }

        .user-panel .user-name {
            font-size: 14px;
            font-weight: 600;
        }

        .sidebar-menu {
            padding: 10px 0;
        }

        .menu-section-title {
            padding: 10px 20px;
            font-size: 11px;
            text-transform: uppercase;
            color: #8a939b;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #c2c7d0;
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
        }

        .menu-item:hover {
            background: #3f474e;
            color: white;
        }

        .menu-item.active {
            background: #007bff;
            color: white;
        }

        .menu-item i {
            width: 20px;
            margin-right: 10px;
            font-size: 14px;
        }

        /* Main Content */
        .main-content {
            margin-left: 250px;
            min-height: 100vh;
        }

        .top-header {
            background: white;
            border-bottom: 1px solid #dee2e6;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 57px;
        }

        .top-nav {
            display: flex;
            align-items: center;
            gap: 30px;
            padding: 0 20px;
        }

        .top-nav a {
            color: #495057;
            text-decoration: none;
            font-size: 14px;
            padding: 18px 0;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .top-nav a:hover,
        .top-nav a.active {
            color: #007bff;
            border-bottom-color: #007bff;
        }

        .top-right {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 0 20px;
        }

        .user-name-top {
            font-size: 14px;
            color: #495057;
        }

        .logout-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px 15px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        /* Content Header */
        .content-header {
            padding: 15px 20px;
            background: white;
            border-bottom: 1px solid #dee2e6;
        }

        .content-header h1 {
            font-size: 24px;
            color: #212529;
            margin-bottom: 5px;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #6c757d;
        }

        .breadcrumb a {
            color: #007bff;
            text-decoration: none;
        }

        /* Dashboard Content */
        .dashboard-content {
            padding: 20px;
        }

        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        .info-boxes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .info-box {
            background: white;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 0 1px rgba(0,0,0,.125), 0 1px 3px rgba(0,0,0,.2);
            transition: all 0.3s;
        }

        .info-box:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,.15);
            transform: translateY(-2px);
        }

        .info-box-header {
            padding: 15px 20px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .info-box-header h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .info-box-header .number {
            font-size: 32px;
            font-weight: 700;
            background: rgba(255,255,255,0.3);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .info-box-content {
            padding: 15px 20px;
            background: white;
        }

        .info-box-content a {
            color: #495057;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
            transition: all 0.3s;
        }

        .info-box.cyan .info-box-header { background: #17a2b8; }
        .info-box.green .info-box-header { background: #28a745; }
        .info-box.yellow .info-box-header { background: #ffc107; }
        .info-box.red .info-box-header { background: #dc3545; }
        .info-box.purple .info-box-header { background: #6f42c1; }

        /* Tours Section */
        .tours-table {
            background: white;
            border-radius: 4px;
            box-shadow: 0 0 1px rgba(0,0,0,.125), 0 1px 3px rgba(0,0,0,.2);
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f8f9fa;
        }

        th {
            padding: 12px 15px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
            color: #212529;
            font-size: 14px;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-right: 5px;
        }

        .edit-btn {
            background: #007bff;
            color: white;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            width: 98%;
            max-width: 1400px;
            max-height: 95vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }

        .modal-header h2 {
            font-size: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
        }

        .modal-body {
            padding: 25px 30px;
        }

        /* Step Indicator */
        .step-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 25px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            gap: 0;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            flex: 0 0 auto;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e9ecef;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .step.completed .step-number {
            background: #28a745;
            color: white;
        }

        .step-label {
            font-size: 13px;
            color: #6c757d;
            font-weight: 500;
            white-space: nowrap;
        }

        .step.active .step-label {
            color: #495057;
            font-weight: 600;
        }

        .step-line {
            width: 80px;
            height: 2px;
            background: #dee2e6;
            margin: 0 -5px;
            margin-bottom: 28px;
        }

        .step.active ~ .step-line {
            background: #dee2e6;
        }

        .step.completed ~ .step-line {
            background: #28a745;
        }

        /* Form Steps */
        .form-step {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .form-step.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        /* Form Row */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .itinerary-day-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }

        .itinerary-day-card .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #dee2e6;
        }

        .itinerary-day-card .day-number {
            font-size: 18px;
            font-weight: bold;
            color: #495057;
        }

        .itinerary-day-card .remove-day-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .itinerary-day-card .remove-day-btn:hover {
            background: #c82333;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Checkbox Labels */
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            background: white;
            transition: all 0.2s ease;
        }

        .checkbox-label:hover {
            background: #f8f9fa;
            border-color: #667eea;
        }

        .checkbox-label input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        /* Toggle Options */
        .toggle-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .toggle-option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .toggle-option:has(input:checked) {
            background: #e8f5e9;
            border-color: #28a745;
        }

        .toggle-label {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .toggle-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            margin: 0;
        }

        .toggle-text {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .toggle-text strong {
            color: #495057;
            font-size: 14px;
        }

        .toggle-text small {
            color: #6c757d;
            font-size: 12px;
        }

        /* Add Day Button */
        .btn-add-day {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn-add-day:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #dee2e6;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        /* Drag & Drop Styles */
        .drop-zone {
            border: 3px dashed #dee2e6;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .drop-zone:hover {
            border-color: #6366f1;
            background: #f0f2ff;
        }

        .drop-zone.drag-over {
            border-color: #6366f1;
            background: #e8ebff;
            transform: scale(1.02);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.2);
        }

        .drop-zone-content svg {
            color: #6366f1;
            margin-bottom: 15px;
        }

        .drop-zone-content h4 {
            font-size: 18px;
            color: #495057;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .drop-zone-content p {
            color: #6c757d;
            margin: 10px 0;
            font-size: 14px;
        }

        .drop-zone-content small {
            color: #adb5bd;
            font-size: 12px;
            display: block;
            margin-top: 10px;
        }

        .btn-browse {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-browse:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .btn-browse:active {
            transform: translateY(0);
        }

        /* Real-time Validation Styles */
        .form-group {
            position: relative;
        }

        .form-group input:not([type="file"]):not([type="checkbox"]),
        .form-group textarea,
        .form-group select {
            padding-right: 40px;
        }

        .form-group .validation-icon {
            position: absolute;
            right: 12px;
            top: 38px;
            font-size: 18px;
            display: none;
            pointer-events: none;
        }

        .form-group.valid .validation-icon.valid-icon {
            display: block;
            color: #10b981;
        }

        .form-group.invalid .validation-icon.invalid-icon {
            display: block;
            color: #ef4444;
        }

        .form-group input.valid:not([type="file"]):not([type="checkbox"]),
        .form-group textarea.valid,
        .form-group select.valid {
            border-color: #10b981;
            background-color: #f0fdf4;
        }

        .form-group input.invalid:not([type="file"]):not([type="checkbox"]),
        .form-group textarea.invalid,
        .form-group select.invalid {
            border-color: #ef4444;
            background-color: #fef2f2;
        }

        .validation-message {
            font-size: 12px;
            margin-top: 4px;
            display: none;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .validation-message.error {
            color: #ef4444;
            display: block;
        }

        .validation-message.success {
            color: #10b981;
            display: block;
        }

        .required-badge {
            color: #ef4444;
            font-size: 12px;
            font-weight: 600;
        }

        /* Image Reordering Styles */
        .image-card {
            position: relative;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            cursor: move;
            transition: all 0.3s;
        }

        .image-card:hover {
            border-color: #6366f1;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
        }

        .image-card.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .image-card.drag-over {
            border-color: #8b5cf6;
            border-style: dashed;
            background: #f0f2ff;
        }

        .image-card .drag-handle {
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            color: #6c757d;
            cursor: move;
            display: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 10;
        }

        .image-card:hover .drag-handle {
            display: block;
        }

        /* Image Preview Modal */
        .image-preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .image-preview-modal.active {
            display: flex;
        }

        .image-preview-content {
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }

        .image-preview-content img {
            max-width: 100%;
            max-height: 90vh;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .image-preview-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            z-index: 10001;
        }

        .image-preview-close:hover {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
<script>
// Load Blogs Function
let blogData = [];

window.loadBlogs = async function() {
    try {
        const response = await fetch('http://localhost:4000/api/blogs');
        const data = await response.json();

        if (data.success) {
            if (Array.isArray(data.data)) {
                blogData = data.data;
            } else if (data.data && Array.isArray(data.data.blogs)) {
                blogData = data.data.blogs;
            } else {
                blogData = [];
            }
        } else {
            blogData = [];
        }

        if (typeof renderBlogs === 'function') renderBlogs();
        if (typeof updateBlogStats === 'function') updateBlogStats();
        console.log('Loaded blogs:', blogData.length);
    } catch (error) {
        console.error('Error loading blogs:', error);
        blogData = [];
    }
}

// Global functions
window.switchView = function(view) {
    const gridView = document.getElementById('blogGridView');
    const listView = document.getElementById('blogListView');
    if (view === 'grid') {
        if (gridView) gridView.style.display = 'grid';
        if (listView) listView.style.display = 'none';
    } else {
        if (gridView) gridView.style.display = 'none';
        if (listView) listView.style.display = 'block';
    }
};
</script>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">A</div>
            <h2>Admin CMS</h2>
        </div>

        <div class="user-panel">
            <div class="user-avatar">üë§</div>
            <div class="user-info">
                <div class="user-name">Admin</div>
            </div>
        </div>

        <div class="sidebar-menu">
            <div class="menu-section">
                <div class="menu-section-title">MAIN</div>
                <a class="menu-item active" data-page="dashboard">
                    <i>üè†</i>
                    <span>Dashboard</span>
                </a>
                <a class="menu-item" data-page="tours">
                    <i>üéØ</i>
                    <span>Tours</span>
                </a>
                <a class="menu-item" data-page="bookings">
                    <i>üìã</i>
                    <span>Bookings</span>
                </a>
                <a class="menu-item" data-page="users">
                    <i>üë•</i>
                    <span>Users</span>
                </a>
                <a class="menu-item" data-page="pages">
                    <i>üìÑ</i>
                    <span>Pages</span>
                </a>
            </div>

            <div class="menu-section">
                <div class="menu-section-title">CONTENT</div>
                <a class="menu-item" data-page="categories">
                    <i>üóÇÔ∏è</i>
                    <span>Categories</span>
                </a>
                <a class="menu-item" data-page="destinations">
                    <i>üåç</i>
                    <span>Destinations</span>
                </a>
                <a class="menu-item" data-page="media">
                    <i>üñºÔ∏è</i>
                    <span>Media Library</span>
                </a>
                <a class="menu-item" data-page="reviews">
                    <i>‚≠ê</i>
                    <span>Reviews</span>
                </a>
                <a class="menu-item" data-page="blog">
                    <i>üìù</i>
                    <span>Blog</span>
                </a>
            </div>

            <div class="menu-section">
                <div class="menu-section-title">SETTINGS</div>
                <a class="menu-item" data-page="settings">
                    <i>‚öôÔ∏è</i>
                    <span>General Settings</span>
                </a>
                <a class="menu-item" data-page="seo">
                    <i>üîç</i>
                    <span>SEO Settings</span>
                </a>
                <a class="menu-item" onclick="logout()">
                    <i>üö™</i>
                    <span>Logout</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="top-header">
            <div class="top-nav">
                <a href="#" class="active">Dashboard</a>
                <a href="/gofly/travel-agency-03.html" target="_blank">View Website</a>
            </div>
            <div class="top-right">
                <span class="user-name-top">Admin</span>
                <button class="logout-btn" onclick="logout()">
                    <span>üö™</span>
                    <span>Logout</span>
                </button>
            </div>
        </div>

        <div class="content-header">
            <h1 id="pageTitle">Dashboard</h1>
            <div class="breadcrumb">
                <a href="#">Home</a>
                <span>/</span>
                <span id="pageBreadcrumb">Dashboard</span>
            </div>
        </div>

        <div class="dashboard-content">
            <!-- Dashboard Page -->
            <div class="page-section active" id="dashboardPage">
                <div class="info-boxes">
                    <div class="info-box cyan">
                        <div class="info-box-header">
                            <h3>Total Tours</h3>
                            <div class="number" id="totalTours">0</div>
                        </div>
                        <div class="info-box-content">
                            <a href="#" onclick="showPage('tours'); return false;">
                                <span>More info</span>
                                <span>‚Üí</span>
                            </a>
                        </div>
                    </div>

                    <div class="info-box green">
                        <div class="info-box-header">
                            <h3>Active Tours</h3>
                            <div class="number" id="activeTours">0</div>
                        </div>
                        <div class="info-box-content">
                            <a href="#" onclick="showPage('tours'); return false;">
                                <span>More info</span>
                                <span>‚Üí</span>
                            </a>
                        </div>
                    </div>

                    <div class="info-box yellow">
                        <div class="info-box-header">
                            <h3>Total Bookings</h3>
                            <div class="number">0</div>
                        </div>
                        <div class="info-box-content">
                            <a href="#" onclick="showPage('bookings'); return false;">
                                <span>More info</span>
                                <span>‚Üí</span>
                            </a>
                        </div>
                    </div>

                    <div class="info-box red">
                        <div class="info-box-header">
                            <h3>Today's Bookings</h3>
                            <div class="number">0</div>
                        </div>
                        <div class="info-box-content">
                            <a href="#" onclick="showPage('bookings'); return false;">
                                <span>More info</span>
                                <span>‚Üí</span>
                            </a>
                        </div>
                    </div>

                    <div class="info-box purple">
                        <div class="info-box-header">
                            <h3>Blog Posts</h3>
                            <div class="number" id="totalBlogs">0</div>
                        </div>
                        <div class="info-box-content">
                            <a href="#" onclick="showPage('blog'); return false;">
                                <span>More info</span>
                                <span>‚Üí</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tours Page -->
            <div class="page-section" id="toursPage">
                <div style="margin-bottom: 20px;">
                    <button onclick="openAddTourModal()" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; display: inline-flex; align-items: center; gap: 8px;">
                        <span style="font-size: 18px;">+</span> Add New Tour
                    </button>
                </div>
                <div class="tours-table">
                    <div id="toursTableContainer">
                        <div class="loading">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Bookings Page -->
            <div class="page-section" id="bookingsPage">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Bookings Management</h2>
                    <div style="display: flex; gap: 10px;">
                        <select id="statusFilter" style="padding: 8px 15px; border-radius: 5px; border: 1px solid #ddd;">
                            <option value="">All Statuses</option>
                            <option value="pending">Pending</option>
                            <option value="confirmed">Confirmed</option>
                            <option value="cancelled">‚úï Yopishled</option>
                        </select>
                        <button onclick="loadBookings()" class="btn-primary" style="padding: 8px 20px; background: #6366f1; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Refresh
                        </button>
                    </div>
                </div>

                <!-- Statistics Cards -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">
                    <div style="background: #f8f9ff; border: 2px solid #6366f1; border-radius: 12px; padding: 20px;">
                        <h4 style="color: #666; font-size: 14px; margin: 0 0 10px 0;">Total Bookings</h4>
                        <p style="font-size: 32px; font-weight: bold; color: #6366f1; margin: 0;" id="totalBookings">0</p>
                    </div>
                    <div style="background: #fff8e1; border: 2px solid #ff9800; border-radius: 12px; padding: 20px;">
                        <h4 style="color: #666; font-size: 14px; margin: 0 0 10px 0;">Pending</h4>
                        <p style="font-size: 32px; font-weight: bold; color: #ff9800; margin: 0;" id="pendingBookings">0</p>
                    </div>
                    <div style="background: #e8f5e9; border: 2px solid #22c55e; border-radius: 12px; padding: 20px;">
                        <h4 style="color: #666; font-size: 14px; margin: 0 0 10px 0;">Confirmed</h4>
                        <p style="font-size: 32px; font-weight: bold; color: #22c55e; margin: 0;" id="confirmedBookings">0</p>
                    </div>
                    <div style="background: #ffebee; border: 2px solid #ef4444; border-radius: 12px; padding: 20px;">
                        <h4 style="color: #666; font-size: 14px; margin: 0 0 10px 0;">Cancelled</h4>
                        <p style="font-size: 32px; font-weight: bold; color: #ef4444; margin: 0;" id="cancelledBookings">0</p>
                    </div>
                </div>

                <!-- Bookings Table -->
                <div style="background: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f9fafb; border-bottom: 2px solid #e5e7eb;">
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151;">ID</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151;">Tour</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151;">Customer</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151;">Date</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151;">Guests</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151;">Price</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151;">Status</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="bookingsTableBody">
                            <tr>
                                <td colspan="8" style="padding: 40px; text-align: center; color: #9ca3af;">
                                    Loading bookings...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Users Page -->
            <div class="page-section" id="usersPage">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Users Management</h2>
                    <button class="add-tour-btn" onclick="openAddUserModal()">+ Add New User</button>
                </div>

                <div id="usersTableContainer" style="background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden;">
                    <p style="padding: 20px; text-align: center; color: #6c757d;">Loading users...</p>
                </div>
            </div>

            <!-- Pages Page -->
            <div class="page-section" id="pagesPage">
                <h3>Pages management coming soon...</h3>
            </div>

            <!-- Categories Page -->
            <div class="page-section" id="categoriesPage">
                <button class="add-tour-btn" onclick="openCategoryModal()">+ Add New Category</button>

                <div class="tours-table-wrapper">
                    <table class="tours-table">
                        <thead>
                            <tr>
                                <th>Order</th>
                                <th>Icon</th>
                                <th>Name</th>
                                <th>Slug</th>
                                <th>Color</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="categoriesTableBody">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">
                                    Loading categories...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Destinations Page -->
            <div class="page-section" id="destinationsPage">
                <button class="add-tour-btn" onclick="openDestinationModal()">+ Add New Destination</button>

                <div class="tours-table">
                    <div id="destinationsTableContainer">
                        <div class="loading">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Media Page -->
            
            <!-- Media Library Page -->
            <div class="page-section" id="mediaPage">
                <style>
                    .media-container { display: flex; gap: 24px; min-height: calc(100vh - 200px); }
                    .media-sidebar { width: 260px; flex-shrink: 0; }
                    .media-main { flex: 1; display: flex; flex-direction: column; gap: 20px; }
                    .media-card { background: white; border-radius: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
                    .media-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
                    .media-title { font-size: 28px; font-weight: 700; color: #0f172a; margin: 0; }
                    .media-subtitle { color: #64748b; font-size: 14px; margin-top: 4px; }
                    .media-btn { padding: 10px 20px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; font-size: 14px; }
                    .media-btn-primary { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; }
                    .media-btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(59,130,246,0.4); }
                    .media-btn-secondary { background: #f1f5f9; color: #475569; }
                    .media-btn-secondary:hover { background: #e2e8f0; }
                    .media-btn-danger { background: #fee2e2; color: #dc2626; }
                    .media-btn-danger:hover { background: #fecaca; }
                    .folder-list { display: flex; flex-direction: column; gap: 4px; }
                    .folder-item { padding: 12px 16px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; gap: 12px; transition: all 0.15s; color: #475569; font-size: 14px; font-weight: 500; }
                    .folder-item:hover { background: #f1f5f9; }
                    .folder-item.active { background: #eff6ff; color: #3b82f6; }
                    .folder-icon { width: 20px; text-align: center; }
                    .folder-count { margin-left: auto; background: #f1f5f9; padding: 2px 8px; border-radius: 20px; font-size: 12px; color: #64748b; }
                    .upload-zone { border: 2px dashed #cbd5e1; border-radius: 16px; padding: 40px; text-align: center; transition: all 0.3s; cursor: pointer; background: #fafbfc; }
                    .upload-zone:hover, .upload-zone.dragover { border-color: #3b82f6; background: #eff6ff; }
                    .upload-zone-icon { font-size: 48px; margin-bottom: 16px; }
                    .upload-zone-text { color: #64748b; font-size: 15px; margin-bottom: 8px; }
                    .upload-zone-hint { color: #94a3b8; font-size: 13px; }
                    .upload-progress { margin-top: 20px; display: none; }
                    .progress-item { background: #f8fafc; padding: 12px 16px; border-radius: 10px; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; }
                    .progress-bar-container { flex: 1; height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden; }
                    .progress-bar { height: 100%; background: linear-gradient(90deg, #3b82f6, #1d4ed8); border-radius: 3px; transition: width 0.3s; }
                    .filter-bar { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
                    .filter-input { padding: 10px 16px; border: 1px solid #e2e8f0; border-radius: 10px; font-size: 14px; outline: none; transition: all 0.2s; }
                    .filter-input:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
                    .filter-select { padding: 10px 16px; border: 1px solid #e2e8f0; border-radius: 10px; font-size: 14px; outline: none; background: white; cursor: pointer; }
                    .view-toggle { display: flex; background: #f1f5f9; border-radius: 10px; padding: 4px; }
                    .view-btn { padding: 8px 12px; border: none; background: transparent; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
                    .view-btn.active { background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
                    .media-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 16px; }
                    .media-item { background: white; border-radius: 12px; overflow: hidden; border: 2px solid transparent; transition: all 0.2s; cursor: pointer; position: relative; }
                    .media-item:hover { border-color: #3b82f6; transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
                    .media-item.selected { border-color: #3b82f6; background: #eff6ff; }
                    .media-item-thumb { height: 140px; background: #f8fafc; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; }
                    .media-item-thumb img { width: 100%; height: 100%; object-fit: cover; }
                    .media-item-icon { font-size: 48px; }
                    .media-item-checkbox { position: absolute; top: 10px; left: 10px; width: 22px; height: 22px; border-radius: 6px; border: 2px solid white; background: rgba(255,255,255,0.9); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
                    .media-item-checkbox.checked { background: #3b82f6; border-color: #3b82f6; }
                    .media-item-info { padding: 12px; }
                    .media-item-name { font-size: 13px; font-weight: 600; color: #1e293b; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 4px; }
                    .media-item-meta { display: flex; justify-content: space-between; font-size: 11px; color: #94a3b8; }
                    .media-item-actions { position: absolute; top: 10px; right: 10px; display: flex; gap: 4px; opacity: 0; transition: opacity 0.2s; }
                    .media-item:hover .media-item-actions { opacity: 1; }
                    .media-action-btn { width: 32px; height: 32px; border-radius: 8px; border: none; background: rgba(255,255,255,0.95); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 14px; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
                    .media-action-btn:hover { background: #3b82f6; color: white; }
                    .media-list { display: flex; flex-direction: column; gap: 8px; }
                    .media-list-item { display: flex; align-items: center; gap: 16px; padding: 12px 16px; background: white; border-radius: 10px; transition: all 0.2s; }
                    .media-list-item:hover { background: #f8fafc; }
                    .media-list-thumb { width: 48px; height: 48px; border-radius: 8px; overflow: hidden; flex-shrink: 0; background: #f1f5f9; display: flex; align-items: center; justify-content: center; }
                    .media-list-thumb img { width: 100%; height: 100%; object-fit: cover; }
                    .bulk-bar { background: linear-gradient(135deg, #1e293b, #334155); padding: 16px 20px; border-radius: 12px; display: none; align-items: center; justify-content: space-between; margin-bottom: 16px; }
                    .bulk-bar.show { display: flex; }
                    .bulk-count { color: white; font-weight: 600; font-size: 14px; }
                    .bulk-actions { display: flex; gap: 8px; }
                    .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 16px; }
                    .stat-card { background: white; padding: 16px; border-radius: 12px; text-align: center; }
                    .stat-value { font-size: 24px; font-weight: 700; color: #0f172a; }
                    .stat-label { font-size: 12px; color: #64748b; margin-top: 4px; }
                    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 9999; display: none; align-items: center; justify-content: center; }
                    .modal-overlay.show { display: flex; }
                    .modal-content { background: white; border-radius: 20px; max-width: 900px; width: 95%; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column; }
                    .modal-header { padding: 20px 24px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
                    .modal-title { font-size: 18px; font-weight: 700; color: #0f172a; }
                    .modal-close { width: 36px; height: 36px; border-radius: 10px; border: none; background: #f1f5f9; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; }
                    .modal-close:hover { background: #e2e8f0; }
                    .modal-body { padding: 24px; overflow-y: auto; flex: 1; }
                    .preview-container { display: grid; grid-template-columns: 1fr 320px; gap: 24px; }
                    .preview-image { background: #f8fafc; border-radius: 12px; display: flex; align-items: center; justify-content: center; min-height: 300px; overflow: hidden; }
                    .preview-image img { max-width: 100%; max-height: 400px; object-fit: contain; }
                    .preview-details { display: flex; flex-direction: column; gap: 16px; }
                    .detail-group { display: flex; flex-direction: column; gap: 6px; }
                    .detail-label { font-size: 12px; font-weight: 600; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; }
                    .detail-value { font-size: 14px; color: #1e293b; }
                    .detail-input { padding: 10px 14px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; outline: none; }
                    .detail-input:focus { border-color: #3b82f6; }
                    .detail-textarea { padding: 10px 14px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; outline: none; resize: vertical; min-height: 80px; }
                    .copy-url-box { display: flex; gap: 8px; }
                    .copy-url-input { flex: 1; padding: 10px 14px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 12px; background: #f8fafc; }
                    .copy-btn { padding: 10px 16px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; }
                    .preview-actions { display: flex; flex-direction: column; gap: 8px; margin-top: auto; padding-top: 16px; }
                    .tags-input { display: flex; flex-wrap: wrap; gap: 6px; padding: 8px; border: 1px solid #e2e8f0; border-radius: 8px; min-height: 40px; }
                    .tag { background: #eff6ff; color: #3b82f6; padding: 4px 10px; border-radius: 6px; font-size: 12px; display: flex; align-items: center; gap: 6px; }
                    .tag-remove { cursor: pointer; font-size: 14px; }
                    .edit-tools { display: flex; gap: 8px; padding: 12px; background: #f8fafc; border-radius: 10px; margin-bottom: 16px; }
                    .edit-tool-btn { padding: 8px 14px; border: none; background: white; border-radius: 8px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 6px; }
                    .edit-tool-btn:hover { background: #e2e8f0; }
                    .pagination { display: flex; justify-content: center; gap: 8px; margin-top: 20px; }
                    .page-btn { width: 36px; height: 36px; border-radius: 8px; border: 1px solid #e2e8f0; background: white; cursor: pointer; font-weight: 500; }
                    .page-btn.active { background: #3b82f6; color: white; border-color: #3b82f6; }
                    @media (max-width: 1024px) { .media-container { flex-direction: column; } .media-sidebar { width: 100%; } .preview-container { grid-template-columns: 1fr; } .stats-grid { grid-template-columns: repeat(2, 1fr); } }
                    @media (max-width: 640px) { .media-grid { grid-template-columns: repeat(2, 1fr); } .filter-bar { flex-direction: column; align-items: stretch; } .stats-grid { grid-template-columns: 1fr 1fr; } }
                </style>

                <!-- Header -->
                <div class="media-header">
                    <div>
                        <h1 class="media-title">Media Library</h1>
                        <p class="media-subtitle">Manage your files, images and documents</p>
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <button class="media-btn media-btn-primary" onclick="triggerUpload()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                            Upload Files
                        </button>
                        <button class="media-btn media-btn-secondary" onclick="openNewFolderModal()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path><line x1="12" y1="11" x2="12" y2="17"></line><line x1="9" y1="14" x2="15" y2="14"></line></svg>
                            New Folder
                        </button>
                        
                    </div>
                </div>

                <div class="media-container">
                    <!-- Sidebar -->
                    <div class="media-sidebar">
                        <div class="media-card" style="padding: 16px;">
                            <div style="font-weight: 600; color: #0f172a; margin-bottom: 12px; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;">Folders</div>
                            <div class="folder-list" id="folderList">
                                <div class="folder-item active" onclick="selectFolder('all')">
                                    <span class="folder-icon">üìÅ</span>
                                    <span>All Media</span>
                                    <span class="folder-count" id="countAll">0</span>
                                </div>
                                <div class="folder-item" onclick="selectFolder('images')">
                                    <span class="folder-icon">üñºÔ∏è</span>
                                    <span>Images</span>
                                    <span class="folder-count" id="countImages">0</span>
                                </div>
                                <div class="folder-item" onclick="selectFolder('videos')">
                                    <span class="folder-icon">üé¨</span>
                                    <span>Videos</span>
                                    <span class="folder-count" id="countVideos">0</span>
                                </div>
                                <div class="folder-item" onclick="selectFolder('documents')">
                                    <span class="folder-icon">üìÑ</span>
                                    <span>Documents</span>
                                    <span class="folder-count" id="countDocs">0</span>
                                </div>
                                <div style="border-top: 1px solid #e2e8f0; margin: 12px 0;"></div>
                                <div class="folder-item" onclick="selectFolder('blog')">
                                    <span class="folder-icon">üìù</span>
                                    <span>Blog</span>
                                    <span class="folder-count" id="countBlog">0</span>
                                </div>
                                <div class="folder-item" onclick="selectFolder('destinations')">
                                    <span class="folder-icon">üåç</span>
                                    <span>Destinations</span>
                                    <span class="folder-count" id="countDest">0</span>
                                </div>
                                <div class="folder-item" onclick="selectFolder('pages')">
                                    <span class="folder-icon">üìÑ</span>
                                    <span>Pages</span>
                                    <span class="folder-count" id="countPages">0</span>
                                </div>
                                <div class="folder-item" onclick="selectFolder('tours')">
                                    <span class="folder-icon">‚úàÔ∏è</span>
                                    <span>Tours</span>
                                    <span class="folder-count" id="countTours">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Storage Stats -->
                        <div class="media-card" style="padding: 16px; margin-top: 16px;">
                            <div style="font-weight: 600; color: #0f172a; margin-bottom: 12px; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;">Storage</div>
                            <div style="margin-bottom: 12px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 13px;">
                                    <span style="color: #64748b;">Used</span>
                                    <span style="font-weight: 600; color: #0f172a;" id="storageUsed">0 MB</span>
                                </div>
                                <div style="height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden;">
                                    <div id="storageBar" style="height: 100%; background: linear-gradient(90deg, #3b82f6, #8b5cf6); width: 0%; transition: width 0.3s;"></div>
                                </div>
                                <div style="font-size: 11px; color: #94a3b8; margin-top: 4px;">of 5 GB</div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="media-main">
                        <!-- Stats -->
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="statTotal">0</div>
                                <div class="stat-label">Total Files</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="statImages">0</div>
                                <div class="stat-label">Images</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="statVideos">0</div>
                                <div class="stat-label">Videos</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="statSize">0 MB</div>
                                <div class="stat-label">Total Size</div>
                            </div>
                        </div>

                        <!-- Hidden File Input & Progress -->
                        <div class="upload-progress" id="uploadProgress" style="display: none; margin-bottom: 16px;">
                            <div id="progressList"></div>
                        </div>
                        <input type="file" id="fileInput" multiple accept="image/*,video/*,.pdf,.doc,.docx" style="display: none;" onchange="handleFileSelect(event)">

                        <!-- Filters -->
                        <div class="media-card" style="padding: 16px;">
                            <div class="filter-bar">
                                <input type="text" class="filter-input" placeholder="Search files..." id="searchInput" oninput="filterMedia()" style="flex: 1; min-width: 200px;">
                                <select class="filter-select" id="filterType" onchange="filterMedia()">
                                    <option value="">All Types</option>
                                    <option value="image">Images</option>
                                    <option value="video">Videos</option>
                                    <option value="document">Documents</option>
                                </select>
                                <select class="filter-select" id="filterDate" onchange="filterMedia()">
                                    <option value="">Any Date</option>
                                    <option value="today">Today</option>
                                    <option value="week">This Week</option>
                                    <option value="month">This Month</option>
                                </select>
                                <select class="filter-select" id="filterSort" onchange="filterMedia()">
                                    <option value="newest">Newest First</option>
                                    <option value="oldest">Oldest First</option>
                                    <option value="name">Name A-Z</option>
                                    <option value="size">Size</option>
                                </select>
                                <div class="view-toggle">
                                    <button class="view-btn active" id="gridViewBtn" onclick="setViewMode('grid')">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="3" width="7" height="7" rx="1"></rect><rect x="14" y="3" width="7" height="7" rx="1"></rect><rect x="3" y="14" width="7" height="7" rx="1"></rect><rect x="14" y="14" width="7" height="7" rx="1"></rect></svg>
                                    </button>
                                    <button class="view-btn" id="listViewBtn" onclick="setViewMode('list')">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="4" width="18" height="4" rx="1"></rect><rect x="3" y="10" width="18" height="4" rx="1"></rect><rect x="3" y="16" width="18" height="4" rx="1"></rect></svg>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Bulk Actions Bar -->
                        <div class="bulk-bar" id="bulkBar">
                            <span class="bulk-count"><span id="selectedCount">0</span> files selected</span>
                            <div class="bulk-actions">
                                <button class="media-btn media-btn-secondary" onclick="bulkMove()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
                                    Move
                                </button>
                                <button class="media-btn media-btn-secondary" onclick="bulkTag()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
                                    Add Tags
                                </button>
                                <button class="media-btn media-btn-danger" onclick="bulkDelete()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                                    Delete
                                </button>
                                <button class="media-btn media-btn-secondary" onclick="clearSelection()">Cancel</button>
                            </div>
                        </div>

                        <!-- Media Grid -->
                        <div class="media-card" style="padding: 20px;">
                            <div class="media-grid" id="mediaGrid"></div>
                            <div class="media-list" id="mediaList" style="display: none;"></div>

                            <!-- Pagination -->
                            <div class="pagination" id="pagination"></div>
                        </div>
                    </div>
                </div>

                <!-- Preview Modal -->
                <div class="modal-overlay" id="previewModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title" id="previewTitle">File Details</h3>
                            <button class="modal-close" onclick="closePreviewModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <!-- Edit Tools -->
                            <div class="edit-tools" id="editTools" style="display: none;">
                                <button class="edit-tool-btn" onclick="cropImage()">‚úÇÔ∏è Crop</button>
                                <button class="edit-tool-btn" onclick="rotateImage()">üîÑ Rotate</button>
                                <button class="edit-tool-btn" onclick="resizeImage()">üìê Resize</button>
                                <button class="edit-tool-btn" onclick="compressImage()">üì¶ Compress</button>
                            </div>

                            <div class="preview-container">
                                <div class="preview-image" id="previewImage"></div>
                                <div class="preview-details">
                                    <div class="detail-group">
                                        <label class="detail-label">File Name</label>
                                        <input type="text" class="detail-input" id="detailName">
                                    </div>
                                    <div class="detail-group">
                                        <label class="detail-label">Alt Text</label>
                                        <input type="text" class="detail-input" id="detailAlt" placeholder="Describe the image...">
                                    </div>
                                    <div class="detail-group">
                                        <label class="detail-label">Title</label>
                                        <input type="text" class="detail-input" id="detailTitle" placeholder="Enter title...">
                                    </div>
                                    <div class="detail-group">
                                        <label class="detail-label">Description</label>
                                        <textarea class="detail-textarea" id="detailDesc" placeholder="Enter description..."></textarea>
                                    </div>
                                    <div class="detail-group">
                                        <label class="detail-label">Tags</label>
                                        <div class="tags-input" id="tagsContainer">
                                            <input type="text" id="tagInput" placeholder="Add tag..." style="border: none; outline: none; flex: 1; min-width: 80px; font-size: 13px;" onkeydown="handleTagInput(event)">
                                        </div>
                                    </div>
                                    <div class="detail-group">
                                        <label class="detail-label">File URL</label>
                                        <div class="copy-url-box">
                                            <input type="text" class="copy-url-input" id="detailUrl" readonly>
                                            <button class="copy-btn" onclick="copyUrl()">Copy</button>
                                        </div>
                                    </div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                        <div class="detail-group">
                                            <label class="detail-label">Type</label>
                                            <div class="detail-value" id="detailType">-</div>
                                        </div>
                                        <div class="detail-group">
                                            <label class="detail-label">Size</label>
                                            <div class="detail-value" id="detailSize">-</div>
                                        </div>
                                        <div class="detail-group">
                                            <label class="detail-label">Dimensions</label>
                                            <div class="detail-value" id="detailDimensions">-</div>
                                        </div>
                                        <div class="detail-group">
                                            <label class="detail-label">Uploaded</label>
                                            <div class="detail-value" id="detailDate">-</div>
                                        </div>
                                    </div>
                                    <div class="preview-actions">
                                        <button class="media-btn media-btn-primary" onclick="saveFileDetails()" style="width: 100%;">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                                            Save Changes
                                        </button>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                            <button class="media-btn media-btn-secondary" onclick="downloadFile()" style="width: 100%;">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                                Download
                                            </button>
                                            <button class="media-btn media-btn-danger" onclick="deleteCurrentFile()" style="width: 100%;">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- New Folder Modal -->
                <div class="modal-overlay" id="folderModal">
                    <div class="modal-content" style="max-width: 400px;">
                        <div class="modal-header">
                            <h3 class="modal-title">Create New Folder</h3>
                            <button class="modal-close" onclick="closeFolderModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="detail-group">
                                <label class="detail-label">Folder Name</label>
                                <input type="text" class="detail-input" id="newFolderName" placeholder="Enter folder name...">
                            </div>
                            <div class="detail-group" style="margin-top: 16px;">
                                <label class="detail-label">Parent Folder</label>
                                <select class="filter-select" id="parentFolderSelect" style="width: 100%;">
                                    <option value="">Root</option>
                                </select>
                            </div>
                            <button class="media-btn media-btn-primary" onclick="createFolder()" style="width: 100%; margin-top: 20px;">Create Folder</button>
                        </div>
                    </div>
                </div>
            </div>

            
            <!-- Reviews Page -->
            <div class="page-section" id="reviewsPage">
                <!-- Reviews Dashboard Header -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <div>
                        <h2 style="margin: 0; font-size: 24px; color: #1e293b;">Reviews Management</h2>
                        <p style="margin: 5px 0 0; color: #64748b; font-size: 14px;">Manage customer reviews and ratings</p>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="openReviewSettings()" style="padding: 10px 20px; background: #f1f5f9; color: #475569; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                            ‚öôÔ∏è Settings
                        </button>
                        <button onclick="exportReviews()" style="padding: 10px 20px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                            üì• Export</button>
                        <button onclick="openNewReviewModal()" style="padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">‚ûï New Review
                        </button>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; margin-bottom: 25px;">
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <p style="margin: 0; color: #64748b; font-size: 13px;">Total Reviews</p>
                                <h3 id="statTotalReviews" style="margin: 8px 0 0; font-size: 28px; color: #1e293b;">0</h3>
                            </div>
                            <div style="width: 50px; height: 50px; background: #eff6ff; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">üìä</div>
                        </div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <p style="margin: 0; color: #64748b; font-size: 13px;">Average Rating</p>
                                <h3 id="statAvgRating" style="margin: 8px 0 0; font-size: 28px; color: #1e293b;">0.0</h3>
                            </div>
                            <div style="width: 50px; height: 50px; background: #fef3c7; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">‚≠ê</div>
                        </div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <p style="margin: 0; color: #64748b; font-size: 13px;">Today's Reviews</p>
                                <h3 id="statTodayReviews" style="margin: 8px 0 0; font-size: 28px; color: #1e293b;">0</h3>
                            </div>
                            <div style="width: 50px; height: 50px; background: #dcfce7; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">üìÖ</div>
                        </div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <p style="margin: 0; color: #64748b; font-size: 13px;">Pending</p>
                                <h3 id="statPendingReviews" style="margin: 8px 0 0; font-size: 28px; color: #f59e0b;">0</h3>
                            </div>
                            <div style="width: 50px; height: 50px; background: #fef3c7; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">‚è≥</div>
                        </div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <p style="margin: 0; color: #64748b; font-size: 13px;">Spam Detected</p>
                                <h3 id="statSpamReviews" style="margin: 8px 0 0; font-size: 28px; color: #ef4444;">0</h3>
                            </div>
                            <div style="width: 50px; height: 50px; background: #fee2e2; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">üö´</div>
                        </div>
                    </div>
                </div>

                <!-- Rating Distribution & Most Reviewed -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                    <!-- Rating Distribution -->
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <h4 style="margin: 0 0 15px; color: #1e293b; font-size: 16px;">Rating Distribution</h4>
                        <div id="ratingDistribution" style="display: flex; flex-direction: column; gap: 10px;">
                            <!-- Generated by JS -->
                        </div>
                    </div>
                    <!-- Most Reviewed -->
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <h4 style="margin: 0 0 15px; color: #1e293b; font-size: 16px;">Most Reviewed Services</h4>
                        <div id="mostReviewed" style="display: flex; flex-direction: column; gap: 12px;">
                            <!-- Generated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Filters & Search -->
                <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 20px;">
                    <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                        <input type="text" id="searchReviews" placeholder="Search reviews..." onkeyup="filterReviews()" style="padding: 10px 15px; border: 1px solid #e2e8f0; border-radius: 8px; width: 250px; font-size: 14px;">
                        <select id="filterRating" onchange="filterReviews()" style="padding: 10px 15px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                            <option value="">All Ratings</option>
                            <option value="5">5 Stars</option>
                            <option value="4">4 Stars</option>
                            <option value="3">3 Stars</option>
                            <option value="2">2 Stars</option>
                            <option value="1">1 Star</option>
                        </select>
                        <select id="filterStatus" onchange="filterReviews()" style="padding: 10px 15px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                            <option value="">All Status</option>
                            <option value="approved">Approved</option>
                            <option value="pending">Pending</option>
                            <option value="rejected">Rejected</option>
                            <option value="spam">Spam</option>
                        </select>
                        <select id="filterService" onchange="filterReviews()" style="padding: 10px 15px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                            <option value="">All Services</option>
                            <option value="Samarkand Tour">Samarkand Tour</option>
                            <option value="Bukhara Tour">Bukhara Tour</option>
                            <option value="Silk Road Package">Silk Road Package</option>
                            <option value="Hotel Booking">Hotel Booking</option>
                        </select>
                        <button onclick="runAIModeration()" style="padding: 10px 20px; background: #8b5cf6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                            ü§ñ AI Moderate
                        </button>
                    </div>
                </div>

                <!-- Bulk Actions -->
                <div id="bulkActionsBar" style="display: none; background: #1e293b; padding: 15px 20px; border-radius: 12px; margin-bottom: 20px; align-items: center; justify-content: space-between;">
                    <span style="color: white; font-size: 14px;"><span id="selectedCount">0</span> reviews selected</span>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="bulkAction('approve')" style="padding: 8px 16px; background: #22c55e; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">‚úì Approve</button>
                        <button onclick="bulkAction('reject')" style="padding: 8px 16px; background: #f59e0b; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">‚úó Reject</button>
                        <button onclick="bulkAction('spam')" style="padding: 8px 16px; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">üö´ Mark Spam</button>
                        <button onclick="bulkAction('delete')" style="padding: 8px 16px; background: #64748b; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">üóëÔ∏è Delete</button>
                    </div>
                </div>

                <!-- Reviews Table -->
                <div style="background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f8fafc; border-bottom: 1px solid #e2e8f0;">
                                <th style="padding: 14px 16px; text-align: left; width: 40px;">
                                    <input type="checkbox" id="selectAllReviews" onchange="toggleSelectAll()">
                                </th>
                                <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #475569; font-size: 13px;">USER</th>
                                <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #475569; font-size: 13px;">RATING</th>
                                <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #475569; font-size: 13px;">REVIEW</th>
                                <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #475569; font-size: 13px;">SERVICE</th>
                                <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #475569; font-size: 13px;">STATUS</th>
                                <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #475569; font-size: 13px;">AI</th>
                                <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #475569; font-size: 13px;">DATE</th>
                                <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #475569; font-size: 13px;">ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody id="reviewsTableBody">
                            <tr><td colspan="9" style="padding: 60px; text-align: center; color: #94a3b8;">Loading reviews...</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
                    <p style="color: #64748b; font-size: 14px;">Showing <span id="showingFrom">1</span>-<span id="showingTo">10</span> of <span id="totalReviewsCount">0</span> reviews</p>
                    <div style="display: flex; gap: 5px;" id="paginationBtns">
                        <!-- Generated by JS -->
                    </div>
                </div>
            </div>

            <!-- Review Detail Modal -->
            <div id="reviewDetailModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 9999; overflow-y: auto;">
                <div style="max-width: 700px; margin: 50px auto; background: white; border-radius: 16px; overflow: hidden;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; color: white;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="margin: 0; font-size: 20px;">Review Details</h3>
                            <button onclick="closeReviewModal()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-size: 18px;">√ó</button>
                        </div>
                    </div>
                    <div style="padding: 25px;">
                        <!-- User Info -->
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #e2e8f0;">
                            <img id="modalUserAvatar" src="" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover;">
                            <div>
                                <h4 id="modalUserName" style="margin: 0; color: #1e293b;"></h4>
                                <p id="modalUserEmail" style="margin: 5px 0 0; color: #64748b; font-size: 14px;"></p>
                            </div>
                            <div style="margin-left: auto; text-align: right;">
                                <div id="modalRating" style="font-size: 24px;"></div>
                                <p id="modalDate" style="margin: 5px 0 0; color: #94a3b8; font-size: 12px;"></p>
                            </div>
                        </div>

                        <!-- Service Info -->
                        <div style="background: #f8fafc; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                            <p style="margin: 0; color: #64748b; font-size: 12px;">SERVICE / PRODUCT</p>
                            <p id="modalService" style="margin: 5px 0 0; color: #1e293b; font-weight: 600;"></p>
                        </div>

                        <!-- Review Text -->
                        <div style="margin-bottom: 20px;">
                            <p style="margin: 0 0 10px; color: #64748b; font-size: 12px;">REVIEW</p>
                            <p id="modalReviewText" style="margin: 0; color: #1e293b; line-height: 1.6;"></p>
                        </div>

                        <!-- Review Images -->
                        <div id="modalImagesSection" style="display: none; margin-bottom: 20px;">
                            <p style="margin: 0 0 10px; color: #64748b; font-size: 12px;">IMAGES</p>
                            <div id="modalImages" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
                        </div>

                        <!-- AI Analysis -->
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #3b82f6;">
                            <p style="margin: 0 0 10px; color: #3b82f6; font-size: 12px; font-weight: 600;">ü§ñ AI ANALYSIS</p>
                            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                                <div>
                                    <span style="color: #64748b; font-size: 12px;">Sentiment:</span>
                                    <span id="modalSentiment" style="margin-left: 5px; font-weight: 500;"></span>
                                </div>
                                <div>
                                    <span style="color: #64748b; font-size: 12px;">Spam Score:</span>
                                    <span id="modalSpamScore" style="margin-left: 5px; font-weight: 500;"></span>
                                </div>
                                <div>
                                    <span style="color: #64748b; font-size: 12px;">Toxic:</span>
                                    <span id="modalToxic" style="margin-left: 5px; font-weight: 500;"></span>
                                </div>
                            </div>
                            <p id="modalAIRecommendation" style="margin: 10px 0 0; color: #475569; font-size: 13px;"></p>
                        </div>

                        <!-- Status Changer -->
                        <div style="margin-bottom: 20px;">
                            <p style="margin: 0 0 10px; color: #64748b; font-size: 12px;">STATUS</p>
                            <div style="display: flex; gap: 10px;">
                                <button onclick="changeReviewStatus('approved')" class="status-btn" data-status="approved" style="padding: 10px 20px; background: #dcfce7; color: #22c55e; border: 2px solid transparent; border-radius: 8px; cursor: pointer; font-weight: 500;">‚úì Approved</button>
                                <button onclick="changeReviewStatus('pending')" class="status-btn" data-status="pending" style="padding: 10px 20px; background: #fef3c7; color: #f59e0b; border: 2px solid transparent; border-radius: 8px; cursor: pointer; font-weight: 500;">‚è≥ Pending</button>
                                <button onclick="changeReviewStatus('rejected')" class="status-btn" data-status="rejected" style="padding: 10px 20px; background: #fee2e2; color: #ef4444; border: 2px solid transparent; border-radius: 8px; cursor: pointer; font-weight: 500;">‚úó Rejected</button>
                                <button onclick="changeReviewStatus('spam')" class="status-btn" data-status="spam" style="padding: 10px 20px; background: #f1f5f9; color: #64748b; border: 2px solid transparent; border-radius: 8px; cursor: pointer; font-weight: 500;">üö´ Spam</button>
                            </div>
                        </div>

                        <!-- Admin Reply -->
                        <div>
                            <p style="margin: 0 0 10px; color: #64748b; font-size: 12px;">ADMIN REPLY</p>
                            <textarea id="modalAdminReply" placeholder="Write a reply to this review..." style="width: 100%; padding: 15px; border: 1px solid #e2e8f0; border-radius: 10px; font-size: 14px; resize: vertical; min-height: 100px; box-sizing: border-box;"></textarea>
                            <button onclick="saveAdminReply()" style="margin-top: 10px; padding: 10px 25px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">üí¨ Send Reply</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Review Settings Modal -->
            <div id="reviewSettingsModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 9999; overflow-y: auto;">
                <div style="max-width: 600px; margin: 50px auto; background: white; border-radius: 16px; overflow: hidden;">
                    <div style="background: #1e293b; padding: 25px; color: white;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="margin: 0; font-size: 20px;">‚öôÔ∏è Review Settings</h3>
                            <button onclick="closeSettingsModal()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-size: 18px;">√ó</button>
                        </div>
                    </div>
                    <div style="padding: 25px;">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: #475569; font-weight: 500;">Minimum Review Length</label>
                            <input type="number" id="settingMinLength" value="10" style="width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: #475569; font-weight: 500;">Maximum Review Length</label>
                            <input type="number" id="settingMaxLength" value="1000" style="width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: #475569; font-weight: 500;">Daily Review Limit Per User</label>
                            <input type="number" id="settingDailyLimit" value="5" style="width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="settingManualApproval" checked style="width: 20px; height: 20px;">
                                <span style="color: #475569; font-weight: 500;">Require Manual Approval</span>
                            </label>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="settingAIModeration" checked style="width: 20px; height: 20px;">
                                <span style="color: #475569; font-weight: 500;">Enable AI Moderation</span>
                            </label>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="settingAutoReject" style="width: 20px; height: 20px;">
                                <span style="color: #475569; font-weight: 500;">Auto-reject Spam Reviews</span>
                            </label>
                        </div>
                        <button onclick="saveSettings()" style="width: 100%; padding: 14px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 15px;">Save Settings</button>
                    </div>
                </div>
            </div>


                        <!-- Blog Page -->
            <div class="page-section" id="blogPage">
                <!-- Header -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <div>
                        <h2 style="margin: 0; color: #1e293b; font-size: 24px; font-weight: 700;">Blog Posts</h2>
                        <p style="margin: 5px 0 0; color: #64748b; font-size: 14px;">Manage your blog content</p>
                    </div>
                    <button onclick="openPostEditor()" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border: none; padding: 12px 24px; border-radius: 10px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 18px;">+</span> New Post
                    </button>
                </div>

                <!-- Stats Cards -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px;">
                    <div style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid #6366f1; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                        <p style="margin: 0; color: #64748b; font-size: 13px;">Total Posts</p>
                        <p style="margin: 8px 0 0; font-size: 28px; font-weight: 700; color: #1e293b;" id="statTotal">0</p>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid #22c55e; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                        <p style="margin: 0; color: #64748b; font-size: 13px;">Published</p>
                        <p style="margin: 8px 0 0; font-size: 28px; font-weight: 700; color: #1e293b;" id="statPublished">0</p>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid #f59e0b; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                        <p style="margin: 0; color: #64748b; font-size: 13px;">Drafts</p>
                        <p style="margin: 8px 0 0; font-size: 28px; font-weight: 700; color: #1e293b;" id="statDraft">0</p>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid #3b82f6; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                        <p style="margin: 0; color: #64748b; font-size: 13px;">Total Views</p>
                        <p style="margin: 8px 0 0; font-size: 28px; font-weight: 700; color: #1e293b;" id="statViews">0</p>
                    </div>
                </div>

                <!-- Filters -->
                <div style="background: white; padding: 16px; border-radius: 12px; margin-bottom: 20px; display: flex; gap: 15px; flex-wrap: wrap; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                    <input type="text" id="searchPost" placeholder="Search posts..." oninput="filterPosts()" style="flex: 1; min-width: 200px; padding: 10px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                    <select id="filterCat" onchange="filterPosts()" style="padding: 10px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; min-width: 150px;">
                        <option value="">All Categories</option>
                        <option value="travel">Travel</option>
                        <option value="food">Food</option>
                        <option value="tips">Tips</option>
                        <option value="culture">Culture</option>
                    </select>
                    <select id="filterStatus" onchange="filterPosts()" style="padding: 10px 16px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; min-width: 140px;">
                        <option value="">All Status</option>
                        <option value="published">Published</option>
                        <option value="draft">Draft</option>
                        <option value="scheduled">Scheduled</option>
                        <option value="archived">Archived</option>
                    </select>
                </div>

                <!-- Posts Table -->
                <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                    <table style="width: 100%; border-collapse: collapse;" id="postsTable">
                        <thead>
                            <tr style="background: #f8fafc; border-bottom: 1px solid #e2e8f0;">
                                <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #475569; font-size: 13px;">POST</th>
                                <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #475569; font-size: 13px;">CATEGORY</th>
                                <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #475569; font-size: 13px;">AUTHOR</th>
                                <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #475569; font-size: 13px;">STATUS</th>
                                <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #475569; font-size: 13px;">VIEWS</th>
                                <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #475569; font-size: 13px;">DATE</th>
                                <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #475569; font-size: 13px;">ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody id="postsBody">
                            <tr><td colspan="7" style="padding: 60px; text-align: center; color: #94a3b8;">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Post Editor Modal -->
            <div id="postEditorModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 9999; overflow-y: auto;">
                <div style="background: #f8fafc; min-height: 100vh;">
                    <!-- Editor Header -->
                    <div style="background: white; padding: 16px 24px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 10;">
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <button onclick="closePostEditor()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">&times;</button>
                            <h2 style="margin: 0; font-size: 18px; color: #1e293b;" id="editorTitle">New Post</h2>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <button onclick="savePost('draft')" style="padding: 10px 20px; background: #f1f5f9; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; color: #475569;">Save Draft</button>
                            <button onclick="savePost('published')" style="padding: 10px 20px; background: #22c55e; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Publish</button>
                        </div>
                    </div>

                    <!-- Editor Content -->
                    <div style="max-width: 1200px; margin: 0 auto; padding: 24px; display: grid; grid-template-columns: 1fr 350px; gap: 24px;">
                        <!-- Main Content -->
                        <div>
                            <!-- Title -->
                            <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                                <input type="text" id="postTitle" placeholder="Post title..." oninput="generateSlug()" style="width: 100%; padding: 16px; border: none; font-size: 24px; font-weight: 600; color: #1e293b; outline: none;">
                                <div style="display: flex; align-items: center; gap: 8px; padding: 0 16px; color: #94a3b8; font-size: 13px;">
                                    <span>Slug:</span>
                                    <input type="text" id="postSlug" placeholder="post-url-slug" style="flex: 1; border: none; outline: none; font-size: 13px; color: #64748b;">
                                </div>
                            </div>

                            <!-- Excerpt -->
                            <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                                <label style="display: block; font-weight: 600; color: #475569; margin-bottom: 10px; font-size: 14px;">Excerpt</label>
                                <textarea id="postExcerpt" rows="2" placeholder="Brief description..." style="width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; resize: vertical;"></textarea>
                            </div>

                            <!-- Content -->
                            <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                                <label style="display: block; font-weight: 600; color: #475569; margin-bottom: 10px; font-size: 14px;">Content</label>
                                <div style="border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden;">
                                    <div style="background: #f8fafc; padding: 10px; border-bottom: 1px solid #e2e8f0; display: flex; gap: 5px;">
                                        <button type="button" onclick="formatText('bold')" style="padding: 6px 10px; border: none; background: white; border-radius: 4px; cursor: pointer; font-weight: bold;">B</button>
                                        <button type="button" onclick="formatText('italic')" style="padding: 6px 10px; border: none; background: white; border-radius: 4px; cursor: pointer; font-style: italic;">I</button>
                                        <button type="button" onclick="formatText('underline')" style="padding: 6px 10px; border: none; background: white; border-radius: 4px; cursor: pointer; text-decoration: underline;">U</button>
                                        <span style="width: 1px; background: #e2e8f0; margin: 0 5px;"></span>
                                        <button type="button" onclick="formatText('h2')" style="padding: 6px 10px; border: none; background: white; border-radius: 4px; cursor: pointer;">H2</button>
                                        <button type="button" onclick="formatText('h3')" style="padding: 6px 10px; border: none; background: white; border-radius: 4px; cursor: pointer;">H3</button>
                                        <span style="width: 1px; background: #e2e8f0; margin: 0 5px;"></span>
                                        <button type="button" onclick="formatText('ul')" style="padding: 6px 10px; border: none; background: white; border-radius: 4px; cursor: pointer;">‚Ä¢ List</button>
                                        <button type="button" onclick="formatText('link')" style="padding: 6px 10px; border: none; background: white; border-radius: 4px; cursor: pointer;">Link</button>
                                    </div>
                                    <textarea id="postContent" rows="15" placeholder="Write your content here..." style="width: 100%; padding: 16px; border: none; font-size: 15px; line-height: 1.7; resize: vertical; outline: none;"></textarea>
                                </div>
                            </div>

                            <!-- SEO Section -->
                            <div style="background: white; padding: 20px; border-radius: 12px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                    <label style="font-weight: 600; color: #475569; font-size: 14px;">SEO Settings</label>
                                    <button type="button" onclick="generateSEO()" style="padding: 8px 16px; background: linear-gradient(135deg, #f59e0b, #ef4444); color: white; border: none; border-radius: 6px; font-size: 13px; cursor: pointer;">AI Generate</button>
                                </div>
                                <div style="display: flex; flex-direction: column; gap: 12px;">
                                    <input type="text" id="seoTitle" placeholder="SEO Title (60 chars)" style="padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                                    <textarea id="seoDesc" rows="2" placeholder="Meta Description (160 chars)" style="padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px;"></textarea>
                                    <input type="text" id="seoKeywords" placeholder="Keywords (comma separated)" style="padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                                    <input type="text" id="canonicalUrl" placeholder="Canonical URL (optional)" style="padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                                </div>
                            </div>
                        </div>

                        <!-- Sidebar -->
                        <div>
                            <!-- Status -->
                            <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                                <label style="display: block; font-weight: 600; color: #475569; margin-bottom: 10px; font-size: 14px;">Status</label>
                                <select id="postStatus" onchange="toggleSchedule()" style="width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                                    <option value="draft">Draft</option>
                                    <option value="published">Published</option>
                                    <option value="scheduled">Scheduled</option>
                                    <option value="private">Private</option>
                                </select>
                                <div id="scheduleDate" style="display: none; margin-top: 12px;">
                                    <input type="datetime-local" id="publishDate" style="width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                                </div>
                            </div>

                            <!-- Category -->
                            <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                                <label style="display: block; font-weight: 600; color: #475569; margin-bottom: 10px; font-size: 14px;">Category</label>
                                <select id="postCategory" style="width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                                    <option value="">Select category</option>
                                    <option value="travel">Travel</option>
                                    <option value="food">Food & Dining</option>
                                    <option value="tips">Travel Tips</option>
                                    <option value="culture">Culture</option>
                                    <option value="adventure">Adventure</option>
                                </select>
                            </div>

                            <!-- Tags -->
                            <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                                <label style="display: block; font-weight: 600; color: #475569; margin-bottom: 10px; font-size: 14px;">Tags</label>
                                <input type="text" id="postTags" placeholder="tag1, tag2, tag3" style="width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                            </div>

                            <!-- Featured Image -->
                            <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                                <label style="display: block; font-weight: 600; color: #475569; margin-bottom: 10px; font-size: 14px;">Featured Image</label>
                                <div id="featuredPreview" style="display: none; margin-bottom: 12px;">
                                    <img id="featuredImg" src="" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px;">
                                    <button onclick="removeFeatured()" style="margin-top: 8px; padding: 6px 12px; background: #fee2e2; color: #dc2626; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">Remove</button>
                                </div>
                                <div onclick="document.getElementById('featuredInput').click()" style="border: 2px dashed #e2e8f0; padding: 30px; text-align: center; border-radius: 8px; cursor: pointer;">
                                    <p style="margin: 0; color: #94a3b8; font-size: 14px;">Click to upload</p>
                                    <input type="file" id="featuredInput" accept="image/*" style="display: none;" onchange="previewFeatured(this)">
                                </div>
                            </div>

                            <!-- Gallery -->
                            <div style="background: white; padding: 20px; border-radius: 12px;">
                                <label style="display: block; font-weight: 600; color: #475569; margin-bottom: 10px; font-size: 14px;">Gallery Images</label>
                                <div id="galleryPreview" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 12px;"></div>
                                <div onclick="document.getElementById('galleryInput').click()" style="border: 2px dashed #e2e8f0; padding: 20px; text-align: center; border-radius: 8px; cursor: pointer;">
                                    <p style="margin: 0; color: #94a3b8; font-size: 14px;">Add images</p>
                                    <input type="file" id="galleryInput" accept="image/*" multiple style="display: none;" onchange="previewGallery(this)">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        <!-- ==================== ZAMONAVIY BLOG MODAL ==================== -->
        
        <!-- ==================== BLOG MODAL ==================== -->
<div id="blogModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 10000; overflow-y: auto;">
    <div style="background: white; max-width: 800px; margin: 40px auto; border-radius: 16px; box-shadow: 0 20px 50px rgba(0,0,0,0.3);">

        <!-- Header -->
        <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 25px 30px; border-radius: 16px 16px 0 0; display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h2 id="blogModalTitle" style="margin: 0; color: white; font-size: 22px;">Yangi Blog Yaratish</h2>
                <p style="margin: 5px 0 0; color: rgba(255,255,255,0.8); font-size: 14px;">Blog ma'lumotlarini kiriting</p>
            </div>
            <button onclick="closeBlogModal()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; font-size: 20px; cursor: pointer;">&times;</button>
        </div>

        <!-- Steps -->
        <div style="display: flex; padding: 20px 30px; background: #f8f9fa; border-bottom: 1px solid #e5e7eb;">
            <div class="blog-step-indicator" data-step="1" style="flex: 1; text-align: center;">
                <div style="width: 35px; height: 35px; border-radius: 50%; background: #667eea; color: white; display: inline-flex; align-items: center; justify-content: center; font-weight: bold;">1</div>
                <p style="margin: 8px 0 0; font-size: 12px; color: #667eea; font-weight: 600;">Asosiy</p>
            </div>
            <div class="blog-step-indicator" data-step="2" style="flex: 1; text-align: center;">
                <div style="width: 35px; height: 35px; border-radius: 50%; background: #e5e7eb; color: #9ca3af; display: inline-flex; align-items: center; justify-content: center; font-weight: bold;">2</div>
                <p style="margin: 8px 0 0; font-size: 12px; color: #9ca3af; font-weight: 600;">Rasm</p>
            </div>
            <div class="blog-step-indicator" data-step="3" style="flex: 1; text-align: center;">
                <div style="width: 35px; height: 35px; border-radius: 50%; background: #e5e7eb; color: #9ca3af; display: inline-flex; align-items: center; justify-content: center; font-weight: bold;">3</div>
                <p style="margin: 8px 0 0; font-size: 12px; color: #9ca3af; font-weight: 600;">Joylashuv</p>
            </div>
            <div class="blog-step-indicator" data-step="4" style="flex: 1; text-align: center;">
                <div style="width: 35px; height: 35px; border-radius: 50%; background: #e5e7eb; color: #9ca3af; display: inline-flex; align-items: center; justify-content: center; font-weight: bold;">4</div>
                <p style="margin: 8px 0 0; font-size: 12px; color: #9ca3af; font-weight: 600;">SEO</p>
            </div>
        </div>

        <!-- Content -->
        <div style="padding: 30px; max-height: 400px; overflow-y: auto;">

            <!-- Step 1 -->
            <div id="blogStep1">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Blog Sarlavhasi *</label>
                    <input type="text" id="blogTitle" placeholder="Sarlavha..." style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px;" onkeyup="generateSlug()">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">URL Slug</label>
                    <input type="text" id="blogSlug" placeholder="url-slug" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px;">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Kategoriya *</label>
                    <select id="blogCategory" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px;">
                        <option value="">Tanlang...</option>
                        <option value="travel-tips">Travel Tips</option>
                        <option value="destinations">Destinations</option>
                        <option value="culture">Culture</option>
                        <option value="adventure">Adventure</option>
                    </select>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Qisqa Tavsif *</label>
                    <textarea id="blogExcerpt" rows="2" placeholder="Qisqa tavsif..." style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px;"></textarea>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Kontent *</label>
                    <textarea id="blogContent" rows="4" placeholder="Blog matnini yozing..." style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px;"></textarea>
                </div>
            </div>

            <!-- Step 2 -->
            <div id="blogStep2" style="display: none;">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Asosiy Rasm</label>
                    <div style="border: 2px dashed #e5e7eb; padding: 40px; text-align: center; border-radius: 8px; cursor: pointer;" onclick="document.getElementById('blogImageInput').click()">
                        <div style="font-size: 40px;">üì∑</div>
                        <p>Rasm yuklash uchun bosing</p>
                        <input type="file" id="blogImageInput" accept="image/*" style="display: none;" onchange="previewImage(this)">
                    </div>
                    <div id="imagePreview" style="margin-top: 15px; display: none;">
                        <img id="previewImg" src="" style="max-width: 100%; border-radius: 8px;">
                    </div>
                </div>
            </div>

            <!-- Step 3 -->
            <div id="blogStep3" style="display: none;">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Davlat</label>
                    <select id="blogCountry" onchange="loadCitiesForBlog()" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px;">
                        <option value="">Tanlang...</option>
                        <option value="uzbekistan">üá∫üáø O'zbekiston</option>
                        <option value="kazakhstan">üá∞üáø Qozog'iston</option>
                        <option value="kyrgyzstan">üá∞üá¨ Qirg'iziston</option>
                    </select>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Shahar</label>
                    <select id="blogCity" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px;">
                        <option value="">Avval davlat tanlang...</option>
                    </select>
                </div>
            </div>

            <!-- Step 4 -->
            <div id="blogStep4" style="display: none;">
                <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: center;">
                    <h3 style="color: white; margin: 0 0 10px;">ü§ñ AI SEO Generator</h3>
                    <button type="button" onclick="generateAISEO()" style="background: white; color: #667eea; border: none; padding: 12px 30px; border-radius: 25px; font-weight: 600; cursor: pointer;">‚ú® Generate SEO</button>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Meta Description</label>
                    <textarea id="blogMetaDescription" rows="2" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px;"></textarea>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Keywords</label>
                    <input type="text" id="blogKeywords" placeholder="kalit, sozlar" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px;">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Status</label>
                    <select id="blogStatus" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px;">
                        <option value="draft">Draft</option>
                        <option value="published">Published</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div style="padding: 20px 30px; background: #f8f9fa; border-top: 1px solid #e5e7eb; border-radius: 0 0 16px 16px; display: flex; justify-content: space-between;">
            <button id="blogPrevBtn" onclick="prevBlogStep()" style="padding: 12px 25px; background: #e5e7eb; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: none;">‚Üê Ortga</button>
            <div style="flex: 1;"></div>
            <button onclick="closeBlogModal()" style="padding: 12px 25px; background: white; border: 2px solid #e5e7eb; border-radius: 8px; font-weight: 600; cursor: pointer; margin-right: 10px;">‚úï Yopish</button>
            <button id="blogNextBtn" onclick="nextBlogStep()" style="padding: 12px 25px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Keyingi ‚Üí</button>
            <button id="blogSaveBtn" onclick="saveBlog()" style="padding: 12px 25px; background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: none;">‚úì Saqlash</button>
        </div>
    </div>
</div>

<script>
let currentBlogStep = 1;
let editingBlogId = null;

window.openBlogModal = function(blogId = null) {
    editingBlogId = blogId;
    currentBlogStep = 1;

    // Reset
    ['blogTitle','blogSlug','blogCategory','blogExcerpt','blogContent','blogMetaDescription','blogKeywords'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = '';
    });
    document.getElementById('blogStatus').value = 'draft';
    document.getElementById('blogCountry').value = '';
    document.getElementById('blogCity').innerHTML = '<option value="">Avval davlat tanlang...</option>';
    document.getElementById('imagePreview').style.display = 'none';

    document.getElementById('blogModalTitle').textContent = blogId ? 'Blogni Tahrirlash' : 'Yangi Blog Yaratish';
    document.getElementById('blogModal').style.display = 'block';
    showBlogStep(1);
}

window.closeBlogModal = function() {
    document.getElementById('blogModal').style.display = 'none';
}

window.showBlogStep = function(step) {
    currentBlogStep = step;
    for (let i = 1; i <= 4; i++) {
        const el = document.getElementById('blogStep' + i);
        if (el) el.style.display = i === step ? 'block' : 'none';
    }

    document.querySelectorAll('.blog-step-indicator').forEach((el, i) => {
        const circle = el.querySelector('div');
        const label = el.querySelector('p');
        if (i + 1 <= step) {
            circle.style.background = '#667eea';
            circle.style.color = 'white';
            label.style.color = '#667eea';
        } else {
            circle.style.background = '#e5e7eb';
            circle.style.color = '#9ca3af';
            label.style.color = '#9ca3af';
        }
    });

    document.getElementById('blogPrevBtn').style.display = step === 1 ? 'none' : 'inline-block';
    document.getElementById('blogNextBtn').style.display = step === 4 ? 'none' : 'inline-block';
    document.getElementById('blogSaveBtn').style.display = step === 4 ? 'inline-block' : 'none';
}

window.nextBlogStep = function() { if (currentBlogStep < 4) showBlogStep(currentBlogStep + 1); }
window.prevBlogStep = function() { if (currentBlogStep > 1) showBlogStep(currentBlogStep - 1); }

function previewImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = e => {
            document.getElementById('previewImg').src = e.target.result;
            document.getElementById('imagePreview').style.display = 'block';
        };
        reader.readAsDataURL(input.files[0]);
    }
}

function generateSlug() {
    const title = document.getElementById('blogTitle').value;
    document.getElementById('blogSlug').value = title.toLowerCase().replace(/[^a-z0-9\s-]/g, '').replace(/\s+/g, '-');
}



const countryCities = {
    uzbekistan: ['Toshkent', 'Samarqand', 'Buxoro', 'Xiva', 'Namangan'],
    kazakhstan: ['Almati', 'Nur-Sultan', 'Shymkent'],
    kyrgyzstan: ['Bishkek', 'Osh']
};




window.saveBlog = async function() {
    const title = document.getElementById('blogTitle').value.trim();
    if (!title) { alert('Sarlavha kiritish shart!'); return; }

    const data = {
        title,
        slug: document.getElementById('blogSlug').value || title.toLowerCase().replace(/\s+/g, '-'),
        category: document.getElementById('blogCategory').value,
        excerpt: document.getElementById('blogExcerpt').value,
        content: document.getElementById('blogContent').value,
        location: document.getElementById('blogCity').value,
        metaDescription: document.getElementById('blogMetaDescription').value,
        keywords: document.getElementById('blogKeywords').value,
        status: document.getElementById('blogStatus').value,
        author: 'Admin'
    };

    try {
        const url = editingBlogId ? 'http://localhost:4000/api/blogs/' + editingBlogId : 'http://localhost:4000/api/blogs';
        const res = await fetch(url, {
            method: editingBlogId ? 'PUT' : 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });
        const result = await res.json();
                if (result.success && featuredImageData) { addBlogImageToMedia(featuredImageData, document.getElementById('postTitle').value); }
        if (result.success) {
            alert('‚úÖ Blog saqlandi!');
            closeBlogModal();
            if (typeof loadPosts === "function") window.loadPosts();
        } else {
            alert(result.message || 'Xatolik!');
        }
    } catch (e) {
        alert('Server xatosi!');
    }
}
</script>

        

        <!-- Settings Page -->
            <div class="page-section" id="settingsPage">
                <h3>General settings coming soon...</h3>
            </div>

            <!-- SEO Page -->
            <div class="page-section" id="seoPage">
                <h3>SEO settings coming soon...</h3>
            </div>
        </div>
    </div>

    <!-- AI Assistant Modal -->
    <div class="modal" id="aiModal" style="z-index: 10001;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>‚ú® AI Tour Assistant</h2>
                <button class="close-btn" onclick="closeAIModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="background: linear-gradient(135deg, #e7f3ff 0%, #f0f7ff 100%); border-left: 4px solid #2196F3; padding: 15px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(33, 150, 243, 0.1);">
                    <p style="color: #1976D2; margin: 0; font-size: 14px; line-height: 1.6;">
                        <strong style="font-size: 15px;">‚ú® AI Yordamchisi</strong><br>
                        Quyidagi asosiy ma'lumotlarni kiriting, AI avtomatik ravishda:<br>
                        ‚Ä¢ To'liq tur tavsifini<br>
                        ‚Ä¢ Kunlik dasturni (itinerary)<br>
                        ‚Ä¢ Nima kiradi/kirmaydi ro'yxatlarini<br>
                        ‚Ä¢ Tur diqqatga sazovor joylari (highlights)ni yaratadi!
                    </p>
                </div>

                <div class="form-group">
                    <label>Tour Type *</label>
                    <select id="aiCategory">
                        <option value="">Select tour type</option>
                        <option value="cultural">üèõÔ∏è Cultural Tour</option>
                        <option value="adventure">üèîÔ∏è Adventure Tour</option>
                        <option value="hiking">ü•æ Hiking Tour</option>
                        <option value="day-trip">üåÖ Day Trip</option>
                    </select>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Duration (Days) *</label>
                        <input type="number" id="aiDuration" min="1" placeholder="5">
                    </div>
                    <div class="form-group">
                        <label>Nights</label>
                        <input type="number" id="aiNights" min="0" placeholder="4">
                    </div>
                </div>

                <div class="form-group">
                    <label>Destination *</label>
                    <input type="text" id="aiDestination" placeholder="Samarkand, Bukhara, Khiva">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Price (USD) *</label>
                        <input type="number" id="aiPrice" min="0" placeholder="500">
                    </div>
                    <div class="form-group">
                        <label>Max Group Size *</label>
                        <input type="number" id="aiMaxGroupSize" min="1" placeholder="15">
                    </div>
                </div>

                <div class="form-group">
                    <label>Difficulty Level</label>
                    <select id="aiDifficulty">
                        <option value="easy">Easy</option>
                        <option value="moderate" selected>Moderate</option>
                        <option value="challenging">Challenging</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Accommodation Type</label>
                    <select id="aiAccommodation">
                        <option value="">Not specified</option>
                        <option value="5 Star Hotel">5 Star Hotel</option>
                        <option value="4 Star Hotel">4 Star Hotel</option>
                        <option value="3 Star Hotel" selected>3 Star Hotel</option>
                        <option value="Boutique Hotel">Boutique Hotel</option>
                        <option value="Guesthouse">Guesthouse</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Additional Description (Optional)</label>
                    <textarea id="aiPrompt" rows="3" placeholder="Add any specific details or requirements..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAIModal()">‚úï Yopish</button>
                <button class="btn btn-primary" onclick="generateTourWithAI()">‚ú® Generate Tour</button>
            </div>
        </div>
    </div>


    <!-- AI Assistant Modal -->
    <div class="modal" id="aiAssistantModal" style="z-index: 2100;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <div>
                    <h2 style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">ü§ñ</span> AI Blog Assistant
                    </h2>
                    <p style="font-size: 13px; color: #6c757d; margin-top: 5px;">Let AI help you create amazing blog content</p>
                </div>
                <button class="close-btn" onclick="closeAIAssistant()">&times;</button>
            </div>

            <div class="modal-body">
                <div style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #667eea30;">
                    <h3 style="font-size: 15px; font-weight: 600; color: #2c3e50; margin-bottom: 15px;">
                        What would you like AI to help you with?
                    </h3>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
                        <button type="button" onclick="selectAITask('title')" class="ai-task-btn"
                                style="padding: 15px; background: white; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; text-align: left; transition: all 0.3s;">
                            <div style="font-size: 20px; margin-bottom: 5px;">‚ú®</div>
                            <div style="font-weight: 600; font-size: 14px; color: #2c3e50;">Generate Title</div>
                            <div style="font-size: 12px; color: #6c757d; margin-top: 3px;">Create catchy blog title</div>
                        </button>

                        <button type="button" onclick="selectAITask('excerpt')" class="ai-task-btn"
                                style="padding: 15px; background: white; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; text-align: left; transition: all 0.3s;">
                            <div style="font-size: 20px; margin-bottom: 5px;">üìù</div>
                            <div style="font-weight: 600; font-size: 14px; color: #2c3e50;">Generate Excerpt</div>
                            <div style="font-size: 12px; color: #6c757d; margin-top: 3px;">Write brief summary</div>
                        </button>

                        <button type="button" onclick="selectAITask('content')" class="ai-task-btn"
                                style="padding: 15px; background: white; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; text-align: left; transition: all 0.3s;">
                            <div style="font-size: 20px; margin-bottom: 5px;">‚úçÔ∏è</div>
                            <div style="font-weight: 600; font-size: 14px; color: #2c3e50;">Write Full Content</div>
                            <div style="font-size: 12px; color: #6c757d; margin-top: 3px;">Create complete article</div>
                        </button>

                        <button type="button" onclick="selectAITask('improve')" class="ai-task-btn"
                                style="padding: 15px; background: white; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; text-align: left; transition: all 0.3s;">
                            <div style="font-size: 20px; margin-bottom: 5px;">üöÄ</div>
                            <div style="font-weight: 600; font-size: 14px; color: #2c3e50;">Improve Content</div>
                            <div style="font-size: 12px; color: #6c757d; margin-top: 3px;">Enhance existing text</div>
                        </button>
                    </div>

                    <div id="aiPromptSection" style="display: none;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #495057; font-size: 14px;">
                            Tell AI what you want:
                        </label>
                        <textarea id="aiPrompt" rows="4" placeholder="e.g., Write about traveling to Samarkand, its history and attractions..."
                                  style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px; resize: vertical;"></textarea>

                        <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" onclick="closeAIAssistant()"
                                    style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer;">
                                Cancel
                            </button>
                            <button type="button" onclick="generateWithAI()" id="generateBtn"
                                    style="padding: 10px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);">
                                ‚ú® Generate
                            </button>
                        </div>
                    </div>

                    <div id="aiLoadingSection" style="display: none; text-align: center; padding: 30px;">
                        <div style="font-size: 48px; margin-bottom: 15px; animation: pulse 1.5s infinite;">ü§ñ</div>
                        <div style="font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 5px;">AI is working...</div>
                        <div style="font-size: 13px; color: #6c757d;">Generating your content</div>
                    </div>

                    <div id="aiResultSection" style="display: none;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #495057; font-size: 14px;">
                            AI Generated Content:
                        </label>
                        <div id="aiResult"
                             style="background: white; padding: 15px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; line-height: 1.6;"></div>

                        <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" onclick="regenerateAI()"
                                    style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer;">
                                üîÑ Regenerate
                            </button>
                            <button type="button" onclick="useAIContent()"
                                    style="padding: 10px 24px; background: #28a745; color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer;">
                                ‚úì Use This Content
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .ai-task-btn:hover {
            border-color: #667eea !important;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        label[for="blogImageFile"]:hover {
            border-color: #667eea !important;
            background: #f8f9ff !important;
        }

        /* Add Tour Modal Styles */
        .add-tour-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            overflow-y: auto;
        }

        .add-tour-modal.active {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 40px 20px;
        }

        .add-tour-modal-content {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 900px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .add-tour-modal-header {
            padding: 25px 30px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px 12px 0 0;
        }

        .add-tour-modal-header h2 {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
        }

        .add-tour-close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .add-tour-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .tour-tabs {
            display: flex;
            border-bottom: 2px solid #f0f0f0;
            background: #fafafa;
            overflow-x: auto;
        }

        .tour-tab {
            padding: 15px 25px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tour-tab:hover {
            color: #667eea;
            background: #f5f7ff;
        }

        .tour-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }

        .tour-tab-content {
            display: none;
            padding: 30px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .tour-tab-content.active {
            display: block;
        }

        .tour-form-group {
            margin-bottom: 20px;
        }

        .tour-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }

        .tour-form-group label .required {
            color: #dc3545;
        }

        .tour-form-group input,
        .tour-form-group select,
        .tour-form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .tour-form-group input:focus,
        .tour-form-group select:focus,
        .tour-form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .tour-form-group textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        .tour-form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .add-tour-modal-footer {
            padding: 20px 30px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            background: #fafafa;
            border-radius: 0 0 12px 12px;
        }

        .tour-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tour-btn-cancel {
            background: #f0f0f0;
            color: #6c757d;
        }

        .tour-btn-cancel:hover {
            background: #e0e0e0;
        }

        .tour-btn-save {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tour-btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        /* Itinerary Styles */
        .itinerary-day {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            background: #fafafa;
        }

        .itinerary-day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .itinerary-day-number {
            font-size: 18px;
            font-weight: 700;
            color: #667eea;
        }

        .remove-day-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }

        .remove-day-btn:hover {
            background: #c82333;
        }

        .activity-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .activity-item input {
            flex: 1;
        }

        .remove-activity-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }

        .add-item-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .add-item-btn:hover {
            background: #218838;
        }
    </style>

    <!-- Add Tour Modal -->
    <div class="add-tour-modal" id="addTourModal">
        <div class="add-tour-modal-content">
            <div class="add-tour-modal-header">
                <h2>‚ûï Add New Tour</h2>
                <button class="add-tour-close-btn" onclick="closeAddTourModal()">&times;</button>
            </div>

            <div class="tour-tabs">
                <button class="tour-tab active" onclick="switchTourTab(0)">üìù Basic Info</button>
                <button class="tour-tab" onclick="switchTourTab(1)">üéØ Details</button>
                <button class="tour-tab" onclick="switchTourTab(2)">üìÖ Itinerary</button>
                <button class="tour-tab" onclick="switchTourTab(3)">‚úÖ Inclusions</button>
                <button class="tour-tab" onclick="switchTourTab(4)">üñºÔ∏è Media</button>
                <button class="tour-tab" onclick="switchTourTab(5)">‚öôÔ∏è Settings</button>
            </div>

            <form id="addTourForm">
                <!-- Tab 1: Basic Info -->
                <div class="tour-tab-content active" data-tab="0">
                    <h3 style="margin-top: 0; color: #2c3e50;">Basic Information</h3>

                    <div class="tour-form-group">
                        <label>Tour Name <span class="required">*</span></label>
                        <input type="text" id="tourName" name="title" placeholder="E.g.: 10-Day Uzbekistan Grand Tour" required>
                    </div>

                    <div class="tour-form-row">
                        <div class="tour-form-group">
                            <label>Category <span class="required">*</span></label>
                            <select id="tourCategory" name="category" required>
                                <option value="">Select category</option>
                                <option value="cultural">Cultural Tours</option>
                                <option value="adventure">Adventure Tours</option>
                                <option value="day-trips">Day Trips</option>
                                <option value="homestays">Homestays & Hiking</option>
                            </select>
                        </div>

                        <div class="tour-form-group">
                            <label>Destination <span class="required">*</span></label>
                            <input type="text" id="tourDestination" name="destination" placeholder="E.g.: Uzbekistan" required>
                        </div>
                    </div>

                    <div class="tour-form-row">
                        <div class="tour-form-group">
                            <label>Price (USD) <span class="required">*</span></label>
                            <input type="number" id="tourPrice" name="price" placeholder="1299" min="0" required>
                        </div>

                        <div class="tour-form-group">
                            <label>Discount Price (USD)</label>
                            <input type="number" id="tourDiscountPrice" name="discountPrice" placeholder="999" min="0">
                        </div>
                    </div>

                    <div class="tour-form-row">
                        <div class="tour-form-group">
                            <label>Duration (Days) <span class="required">*</span></label>
                            <input type="number" id="tourDuration" name="duration" placeholder="10" min="1" required>
                        </div>

                        <div class="tour-form-group">
                            <label>Nights <span class="required">*</span></label>
                            <input type="number" id="tourNights" name="nights" placeholder="9" min="0" required>
                        </div>
                    </div>

                    <div class="tour-form-group">
                        <label>Summary (1-2 sentences)</label>
                        <textarea id="tourSummary" name="summary" placeholder="Brief summary of the tour..." rows="2"></textarea>
                    </div>

                    <div class="tour-form-group">
                        <label>Full Description <span class="required">*</span></label>
                        <textarea id="tourDescription" name="description" placeholder="Detailed description of the tour..." rows="5" required></textarea>
                    </div>
                </div>

                <!-- Tab 2: Details -->
                <div class="tour-tab-content" data-tab="1">
                    <h3 style="margin-top: 0; color: #2c3e50;">Tour Details</h3>

                    <div class="tour-form-row">
                        <div class="tour-form-group">
                            <label>Max Group Size</label>
                            <input type="number" id="tourMaxGroup" name="maxGroupSize" placeholder="15" min="1">
                        </div>

                        <div class="tour-form-group">
                            <label>Difficulty</label>
                            <select id="tourDifficulty" name="difficulty">
                                <option value="easy">Easy</option>
                                <option value="moderate" selected>Moderate</option>
                                <option value="challenging">Challenging</option>
                            </select>
                        </div>
                    </div>

                    <div class="tour-form-group">
                        <label>Languages (comma separated)</label>
                        <input type="text" id="tourLanguages" name="languages" placeholder="English, Russian, Uzbek">
                    </div>

                    <div class="tour-form-group">
                        <label>Availability/Season</label>
                        <input type="text" id="tourAvailability" name="season" placeholder="E.g.: March & Autumn (Best)">
                    </div>

                    <div class="tour-form-group">
                        <label>Highlights (one per line)</label>
                        <textarea id="tourHighlights" name="highlights" placeholder="Visit ancient Silk Road cities&#10;Explore UNESCO World Heritage sites&#10;Experience local culture" rows="6"></textarea>
                    </div>
                </div>

                <!-- Tab 3: Itinerary -->
                <div class="tour-tab-content" data-tab="2">
                    <h3 style="margin-top: 0; color: #2c3e50;">Daily Itinerary</h3>

                    <div id="itineraryContainer">
                        <!-- Itinerary days will be added here -->
                    </div>

                    <button type="button" class="add-item-btn" onclick="addItineraryDay()">
                        <span style="font-size: 16px;">+</span> Add Day
                    </button>
                </div>

                <!-- Tab 4: Inclusions -->
                <div class="tour-tab-content" data-tab="3">
                    <h3 style="margin-top: 0; color: #2c3e50;">What's Included & Excluded</h3>

                    <div class="tour-form-group">
                        <label>What's Included (one per line)</label>
                        <textarea id="tourIncluded" name="included" placeholder="Accommodation&#10;Meals&#10;Transportation&#10;Tour guide" rows="8"></textarea>
                    </div>

                    <div class="tour-form-group">
                        <label>What's Excluded (one per line)</label>
                        <textarea id="tourExcluded" name="excluded" placeholder="International flights&#10;Travel insurance&#10;Personal expenses" rows="8"></textarea>
                    </div>
                </div>

                <!-- Tab 5: Media -->
                <div class="tour-tab-content" data-tab="4">
                    <h3 style="margin-top: 0; color: #2c3e50;">Images & Media</h3>

                    <div class="tour-form-group">
                        <label>üì§ Upload or Add Images</label>
                        <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px;">
                            <input type="file" id="tourMediaUpload" accept="image/*" multiple style="display: none;">
                            <button type="button" class="tour-btn" onclick="document.getElementById('tourMediaUpload').click()" style="background: #667eea; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                                <span>üì∑</span> Choose Images
                            </button>
                            <button type="button" id="uploadMediaBtn" onclick="uploadMediaImages()" style="background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; display: none;">
                                Upload Selected
                            </button>
                            <button type="button" onclick="addImageUrlManually()" style="background: #17a2b8; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer;">
                                + Add URL
                            </button>
                        </div>
                        <small style="color: #6c757d; display: block; margin-bottom: 15px;">Upload images or add URLs manually. First image will be the cover.</small>
                    </div>

                    <!-- Image Manager -->
                    <div id="imageManager" style="min-height: 150px; padding: 20px; background: #f8f9fa; border-radius: 8px; border: 2px dashed #ddd;">
                        <div id="imageManagerContainer" style="display: flex; flex-wrap: wrap; gap: 15px;"></div>
                        <div id="imageManagerEmpty" style="text-align: center; color: #6c757d; padding: 40px;">
                            <p style="font-size: 18px; margin: 0;">No images yet</p>
                            <p style="font-size: 14px; margin: 5px 0 0 0;">Upload images or add URLs to get started</p>
                        </div>
                    </div>

                    <!-- Hidden textarea for form submission -->
                    <textarea id="tourImages" name="images" style="display: none;"></textarea>
                </div>

                <!-- Tab 6: Settings -->
                <div class="tour-tab-content" data-tab="5">
                    <h3 style="margin-top: 0; color: #2c3e50;">Advanced Settings</h3>

                    <div class="tour-form-group">
                        <label>Status</label>
                        <select id="tourStatus" name="status">
                            <option value="active" selected>Active</option>
                            <option value="draft">Draft</option>
                            <option value="archived">Archived</option>
                        </select>
                    </div>

                    <div class="tour-form-group">
                        <label>
                            <input type="checkbox" id="tourFeatured" name="featured" style="width: auto; margin-right: 8px;">
                            Featured (show on homepage)
                        </label>
                    </div>

                    <div class="tour-form-group">
                        <label>Slug (URL-friendly name)</label>
                        <input type="text" id="tourSlug" name="slug" placeholder="Will be auto-generated from title">
                        <small style="color: #6c757d;">Leave empty to auto-generate</small>
                    </div>
                </div>
            </form>

            <div class="add-tour-modal-footer">
                <button type="button" class="tour-btn tour-btn-cancel" onclick="closeAddTourModal()">Cancel</button>
                <button type="button" class="tour-btn tour-btn-save" onclick="saveTour()">Save Tour</button>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_URL = 'http://localhost:4000/api';

        // ========== GLOBAL FETCH WITH AUTH TOKEN ==========
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            const token = localStorage.getItem('accessToken');

            // Only modify if it's our API
            if (args[0] && typeof args[0] === 'string' && args[0].startsWith(API_URL)) {
                const options = args[1] || {};

                // Ensure headers object exists
                if (!options.headers) {
                    options.headers = {};
                }

                // Add Authorization header
                if (token) {
                    options.headers['Authorization'] = `Bearer ${token}`;
                }

                // Add Content-Type if not present and it's a POST/PUT request
                if (options.method && ['POST', 'PUT', 'PATCH'].includes(options.method.toUpperCase())) {
                    if (!options.headers['Content-Type']) {
                        options.headers['Content-Type'] = 'application/json';
                    }
                }

                args[1] = options;
                console.log('üîê Fetch intercepted:', args[0], 'with token:', !!token);
            }

            return originalFetch.apply(this, args);
        };

        let currentAITask = null;

        function openAIAssistant() {
            document.getElementById('aiAssistantModal').style.display = 'flex';
            currentAITask = null;
            document.getElementById('aiPromptSection').style.display = 'none';
            document.getElementById('aiResultSection').style.display = 'none';
            document.getElementById('aiLoadingSection').style.display = 'none';
        }

        function closeAIAssistant() {
            document.getElementById('aiAssistantModal').style.display = 'none';
            currentAITask = null;
        }

        function selectAITask(task) {
            currentAITask = task;
            document.getElementById('aiPromptSection').style.display = 'block';
            document.getElementById('aiResultSection').style.display = 'none';

            const promptField = document.getElementById('aiPrompt');

            // Set placeholder based on task
            const placeholders = {
                'title': 'e.g., Write a title about adventure travel in Uzbekistan...',
                'excerpt': 'e.g., Create a summary about the best beaches in Maldives...',
                'content': 'e.g., Write a detailed article about cultural tours in Samarkand...',
                'improve': 'Paste your existing content here to improve...'
            };

            promptField.placeholder = placeholders[task] || '';
            promptField.value = '';
            promptField.focus();
        }

        async function generateWithAI() {
            const prompt = document.getElementById('aiPrompt').value.trim();

            if (!prompt) {
                alert('Please enter your request for AI');
                return;
            }

            // Show loading
            document.getElementById('aiPromptSection').style.display = 'none';
            document.getElementById('aiLoadingSection').style.display = 'block';

            try {
                // Simulate AI generation (replace with actual API call)
                await new Promise(resolve => setTimeout(resolve, 2000));

                let generatedContent = '';

                switch(currentAITask) {
                    case 'title':
                        generatedContent = generateSampleTitle(prompt);
                        break;
                    case 'excerpt':
                        generatedContent = generateSampleExcerpt(prompt);
                        break;
                    case 'content':
                        generatedContent = generateSampleContent(prompt);
                        break;
                    case 'improve':
                        generatedContent = improveSampleContent(prompt);
                        break;
                }

                // Show result
                document.getElementById('aiLoadingSection').style.display = 'none';
                document.getElementById('aiResultSection').style.display = 'block';
                document.getElementById('aiResult').textContent = generatedContent;

            } catch (error) {
                console.error('AI generation error:', error);
                alert('Error generating content. Please try again.');
                document.getElementById('aiLoadingSection').style.display = 'none';
                document.getElementById('aiPromptSection').style.display = 'block';
            }
        }

        function regenerateAI() {
            generateWithAI();
        }

        function useAIContent() {
            const content = document.getElementById('aiResult').textContent;

            switch(currentAITask) {
                case 'title':
                    document.getElementById('blogTitle').value = content;
                    break;
                case 'excerpt':
                    document.getElementById('blogExcerpt').value = content;
                    break;
                case 'content':
                case 'improve':
                    document.getElementById('blogContent').value = content;
                    break;
            }

            closeAIAssistant();
            alert('Content added to form successfully!');
        }

        // Sample generators (replace with actual AI API)
        function generateSampleTitle(prompt) {
            const titles = [
                "Discover the Hidden Gems of " + prompt,
                "Ultimate Guide to " + prompt + ": Everything You Need to Know",
                "Top 10 Reasons to Visit " + prompt + " This Year",
                "Exploring " + prompt + ": A Journey of a Lifetime"
            ];
            return titles[Math.floor(Math.random() * titles.length)];
        }

        function generateSampleExcerpt(prompt) {
            return `Discover the beauty and wonder of ${prompt}. From stunning landscapes to rich cultural experiences, this destination offers unforgettable memories for every traveler. Join us as we explore everything this amazing place has to offer.`;
        }

        function generateSampleContent(prompt) {
            return `# Exploring ${prompt}\n\nWelcome to an incredible journey through one of the world's most fascinating destinations. ${prompt} offers a unique blend of natural beauty, rich history, and vibrant culture that captivates visitors from around the globe.\n\n## What Makes It Special\n\nFrom the moment you arrive, you'll be greeted by breathtaking scenery and warm hospitality. The local culture is rich with traditions that have been preserved for centuries, offering visitors a glimpse into a way of life that's both ancient and vibrant.\n\n## Top Attractions\n\n1. Historic landmarks that tell stories of the past\n2. Natural wonders that showcase stunning landscapes\n3. Cultural experiences that immerse you in local traditions\n4. Culinary delights that tantalize your taste buds\n\n## Planning Your Visit\n\nThe best time to visit is during the pleasant seasons when the weather is ideal for exploration. Make sure to pack appropriately and plan your itinerary to make the most of your time.\n\n## Conclusion\n\nWhether you're seeking adventure, relaxation, or cultural enrichment, this destination has something for everyone. Start planning your journey today and create memories that will last a lifetime.`;
        }

        function improveSampleContent(content) {
            return content + "\n\n[Enhanced version with improved flow and additional details]\n\nThis content has been refined for better readability and engagement. The structure is more organized, and key points are emphasized to capture reader attention effectively.";
        }

        // ============================================
        // LOCATION & MAP FUNCTIONS
        // ============================================

        let blogMap = null;
        let blogMarker = null;

        function initializeLocationMap() {
            // Initialize map if not already initialized
            if (!blogMap) {
                // Default to Uzbekistan center
                const defaultLat = parseFloat(document.getElementById('blogLatitude').value) || 41.3775;
                const defaultLng = parseFloat(document.getElementById('blogLongitude').value) || 64.5853;

                blogMap = L.map('blogMap').setView([defaultLat, defaultLng], 6);

                // Add OpenStreetMap tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap',
                    maxZoom: 18
                }).addTo(blogMap);

                // Add click event to set location
                blogMap.on('click', function(e) {
                    setMapLocation(e.latlng.lat, e.latlng.lng);
                });

                // Add marker if coordinates exist
                if (defaultLat !== 41.3775 || defaultLng !== 64.5853) {
                    blogMarker = L.marker([defaultLat, defaultLng]).addTo(blogMap);
                    updateCoordinatesDisplay(defaultLat, defaultLng);
                }
            }

            // Refresh map size
            setTimeout(() => {
                blogMap.invalidateSize();
            }, 100);
        }

        function setMapLocation(lat, lng) {
            // Update hidden fields
            document.getElementById('blogLatitude').value = lat.toFixed(6);
            document.getElementById('blogLongitude').value = lng.toFixed(6);

            // Update coordinates display
            updateCoordinatesDisplay(lat, lng);

            // Remove old marker if exists
            if (blogMarker) {
                blogMap.removeLayer(blogMarker);
            }

            // Add new marker with custom icon
            blogMarker = L.marker([lat, lng], {
                icon: L.divIcon({
                    className: 'custom-marker',
                    html: '<div style="background: #667eea; width: 24px; height: 24px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);"></div>',
                    iconSize: [24, 24],
                    iconAnchor: [12, 12]
                })
            }).addTo(blogMap);
            blogMap.setView([lat, lng], 12);

            // Try to get location name using reverse geocoding
            fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`)
                .then(response => response.json())
                .then(data => {
                    if (data.display_name && !document.getElementById('blogLocation').value) {
                        document.getElementById('blogLocation').value = data.display_name;
                    }
                })
                .catch(error => console.error('Geocoding error:', error));
        }

        function updateCoordinatesDisplay(lat, lng) {
            const display = document.getElementById('coordinatesDisplay');
            if (display) {
                display.textContent = `üìå ${lat.toFixed(4)}, ${lng.toFixed(4)}`;
            }
        }

        // ============================================
        // IMAGE UPLOAD FUNCTIONS
        // ============================================

        let uploadedImageData = null;

        function handleImageUpload(event) {
            const file = event.target.files[0];

            if (!file) return;

            // Validate file type
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                alert('Please upload a valid image file (JPG, PNG, GIF, WebP)');
                return;
            }

            // Validate file size (10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('Image size must be less than 10MB. Please use a smaller image.');
                document.getElementById('blogImageFile').value = '';
                return;
            }

            // Read and preview image
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedImageData = e.target.result;

                // Show preview
                document.getElementById('uploadPlaceholder').style.display = 'none';
                document.getElementById('imagePreviewContainer').style.display = 'block';
                document.getElementById('imagePreview').src = e.target.result;
                document.getElementById('imageFileName').textContent = '‚úì ' + file.name;
                document.getElementById('removeImageBtn').style.display = 'block';

                // Set the image URL field with the data URL
                document.getElementById('blogImage').value = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function removeUploadedImage() {
            uploadedImageData = null;
            document.getElementById('blogImageFile').value = '';
            document.getElementById('uploadPlaceholder').style.display = 'flex';
            document.getElementById('imagePreviewContainer').style.display = 'none';
            document.getElementById('imagePreview').src = '';
            document.getElementById('imageFileName').textContent = '';
            document.getElementById('removeImageBtn').style.display = 'none';
            document.getElementById('blogImage').value = '';
        }

        // Drag and drop support
        document.addEventListener('DOMContentLoaded', function() {
            const uploadLabel = document.querySelector('label[for="blogImageFile"]');
            if (uploadLabel) {
                uploadLabel.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.style.borderColor = '#667eea';
                    this.style.background = '#f0f2ff';
                });

                uploadLabel.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    this.style.borderColor = '#ced4da';
                    this.style.background = 'white';
                });

                uploadLabel.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.style.borderColor = '#ced4da';
                    this.style.background = 'white';

                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        document.getElementById('blogImageFile').files = files;
                        handleImageUpload({ target: { files: files } });
                    }
                });
            }
        });

        // ========== CATEGORIES MANAGEMENT ==========

        // Load all categories
        async function loadCategories() {
            try {
                const response = await fetch(`${API_URL}/categories`);
                const result = await response.json();

                if (result.success) {
                    const categories = result.data.categories;
                    const tbody = document.getElementById('categoriesTableBody');

                    if (categories.length === 0) {
                        tbody.innerHTML = `
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">
                                    No categories found. Click "+ Add New Category" to create one.
                                </td>
                            </tr>
                        `;
                        return;
                    }

                    tbody.innerHTML = categories.map(category => `
                        <tr>
                            <td>${category.order}</td>
                            <td style="font-size: 24px;">${category.icon}</td>
                            <td>${category.name}</td>
                            <td><code>${category.slug}</code></td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="width: 20px; height: 20px; border-radius: 4px; background: ${category.color};"></div>
                                    <span>${category.color}</span>
                                </div>
                            </td>
                            <td>
                                <span class="badge ${category.isActive ? 'badge-success' : 'badge-danger'}">
                                    ${category.isActive ? 'Active' : 'Inactive'}
                                </span>
                            </td>
                            <td>
                                <button class="action-btn edit-btn" onclick="editCategory('${category.id}')" title="Edit">
                                    ‚úèÔ∏è
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteCategory('${category.id}')" title="Delete">
                                    üóëÔ∏è
                                </button>
                            </td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading categories:', error);
                alert('Failed to load categories');
            }
        }

        // Open category modal for adding new category
        function openCategoryModal() {
            document.getElementById('categoryModalTitle').textContent = 'Add New Category';
            document.getElementById('categoryForm').reset();
            document.getElementById('categoryId').value = '';
            document.getElementById('categoryModal').style.display = 'flex';
        }

        // Close category modal
        function closeCategoryModal() {
            document.getElementById('categoryModal').style.display = 'none';
            document.getElementById('categoryForm').reset();
        }

        // Edit category
        async function editCategory(id) {
            try {
                const response = await fetch(`${API_URL}/categories/${id}`);
                const result = await response.json();

                if (result.success) {
                    const category = result.data.category;

                    document.getElementById('categoryModalTitle').textContent = 'Edit Category';
                    document.getElementById('categoryId').value = category.id;
                    document.getElementById('categoryName').value = category.name;
                    document.getElementById('categoryDescription').value = category.description || '';
                    document.getElementById('categoryIcon').value = category.icon;
                    document.getElementById('categoryColor').value = category.color;
                    document.getElementById('categoryOrder').value = category.order;
                    document.getElementById('categoryIsActive').checked = category.isActive;

                    document.getElementById('categoryModal').style.display = 'flex';
                }
            } catch (error) {
                console.error('Error loading category:', error);
                alert('Failed to load category details');
            }
        }

        // Delete category
        async function deleteCategory(id) {
            if (!confirm('Are you sure you want to delete this category?')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/categories/${id}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    alert('Category deleted successfully!');
                    loadCategories();
                } else {
                    alert(result.message || 'Failed to delete category');
                }
            } catch (error) {
                console.error('Error deleting category:', error);
                alert('Failed to delete category');
            }
        }

        // Handle category form submission
        document.addEventListener('DOMContentLoaded', function() {
            const categoryForm = document.getElementById('categoryForm');

            if (categoryForm) {
                categoryForm.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const categoryId = document.getElementById('categoryId').value;
                    const categoryData = {
                        name: document.getElementById('categoryName').value,
                        description: document.getElementById('categoryDescription').value,
                        icon: document.getElementById('categoryIcon').value || 'üéØ',
                        color: document.getElementById('categoryColor').value,
                        order: parseInt(document.getElementById('categoryOrder').value) || 0,
                        isActive: document.getElementById('categoryIsActive').checked
                    };

                    try {
                        const url = categoryId
                            ? `${API_URL}/categories/${categoryId}`
                            : `${API_URL}/categories`;

                        const response = await fetch(url, {
                            method: categoryId ? 'PUT' : 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(categoryData)
                        });

                        const result = await response.json();

                        if (result.success) {
                            alert(categoryId ? 'Category updated successfully!' : 'Category created successfully!');
                            closeCategoryModal();
                            loadCategories();
                        } else {
                            alert(result.message || 'Failed to save category');
                        }
                    } catch (error) {
                        console.error('Error saving category:', error);
                        alert('Failed to save category');
                    }
                });
            }
        });

        // Load categories when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Load categories if on categories page
            const categoriesPage = document.getElementById('categoriesPage');
            if (categoriesPage) {
                loadCategories();
            }
        });

        // ========== AI ASSISTANT FUNCTIONS ==========

        async function generateTourWithAI(event) {
            // Get values from AI modal
            const category = document.getElementById('aiCategory').value;
            const duration = document.getElementById('aiDuration').value;
            const nights = document.getElementById('aiNights').value;
            const destination = document.getElementById('aiDestination').value;
            const price = document.getElementById('aiPrice').value;
            const maxGroupSize = document.getElementById('aiMaxGroupSize').value;
            const difficulty = document.getElementById('aiDifficulty').value;
            const accommodation = document.getElementById('aiAccommodation').value;
            const additionalPrompt = document.getElementById('aiPrompt').value;

            // Validation
            if (!category || !duration || !destination || !price || !maxGroupSize) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }

            // Build AI prompt
            const prompt = `Create a complete tour package with the following details:
- Type: ${category}
- Duration: ${duration} days${nights ? ` / ${nights} nights` : ''}
- Destination: ${destination}
- Price: $${price} per person
- Max Group Size: ${maxGroupSize} people
- Difficulty: ${difficulty}
- Accommodation: ${accommodation || 'Standard hotels'}
${additionalPrompt ? `\nAdditional requirements: ${additionalPrompt}` : ''}

Please provide:
1. An engaging tour title
2. A brief summary (2-3 sentences)
3. A detailed tour description (3-4 paragraphs highlighting culture, history, and experiences)
4. Day-by-day itinerary for ${duration} days
5. 5-7 tour highlights (one per line)
6. What's included in the tour (accommodation, meals, transport, guide, etc.)
7. What's NOT included (flights, visa, personal expenses, etc.)

Focus on Uzbekistan's rich Silk Road heritage, ancient architecture, and unique cultural experiences.`;

            // Show loading state
            const generateBtn = event.target;
            const originalText = generateBtn.innerHTML;
            generateBtn.innerHTML = '<span>‚è≥ Generating...</span>';
            generateBtn.disabled = true;

            try {
                const token = localStorage.getItem('adminToken');
                const response = await fetch('/api/ai/tour-assistant', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        currentData: {
                            category, duration, nights, destination, price, maxGroupSize, difficulty, accommodation
                        }
                    })
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.message || 'AI service error');
                }

                // Parse AI response and fill form
                const aiData = result.data;

                // Fill main tour form with AI generated content
                if (aiData.title) {
                    document.getElementById('tourName').value = aiData.title;
                }
                if (aiData.summary) {
                    document.getElementById('tourSummary').value = aiData.summary;
                }
                if (aiData.description) {
                    document.getElementById('tourDescription').value = aiData.description;
                }
                if (aiData.highlights) {
                    const highlightsText = Array.isArray(aiData.highlights)
                        ? aiData.highlights.join('\n')
                        : aiData.highlights;
                    document.getElementById('tourHighlights').value = highlightsText;
                }

                // Fill basic info from AI modal
                document.getElementById('tourCategory').value = category;
                document.getElementById('tourDuration').value = duration;
                document.getElementById('tourLocation').value = destination;
                document.getElementById('tourPrice').value = price;
                document.getElementById('tourMaxGroupSize').value = maxGroupSize;
                document.getElementById('tourDifficulty').value = difficulty;

                // Fill accommodation if available
                if (accommodation && document.getElementById('tourAccommodation')) {
                    document.getElementById('tourAccommodation').value = accommodation;
                }

                // Close AI modal and show success
                closeAIModal();
                showNotification('‚ú® Tour content generated successfully! Please review and adjust as needed.', 'success');

                // Show the main tour modal if not open
                if (!document.getElementById('tourModal').classList.contains('active')) {
                    openModal();
                }

            } catch (error) {
                console.error('AI Error:', error);
                showNotification(error.message || 'Failed to generate tour content', 'error');
            } finally {
                generateBtn.innerHTML = originalText;
                generateBtn.disabled = false;
            }
        }

        // ============================================
        // ADD TOUR MODAL FUNCTIONS
        // ============================================

        let itineraryDayCount = 0;

        function openAddTourModal() {
            // Clear any previous edit mode
            const form = document.getElementById('addTourForm');
            delete form.dataset.editId;
            // Reset modal title to Add mode
            document.querySelector('.add-tour-modal-header h2').textContent = '‚ûï Add New Tour';
            // Clear image manager
            tourMediaImages = [];
            updateImageManager();
            // Open modal
            document.getElementById('addTourModal').classList.add('active');
            // Add first itinerary day by default
            if (itineraryDayCount === 0) {
                addItineraryDay();
            }
        }

        function closeAddTourModal() {
            if (confirm('Are you sure? Unsaved changes will be lost.')) {
                document.getElementById('addTourModal').classList.remove('active');
                const form = document.getElementById('addTourForm');
                form.reset();
                // Clear edit mode
                delete form.dataset.editId;
                // Reset modal title
                document.querySelector('.add-tour-modal-header h2').textContent = '‚ûï Add New Tour';
                // Clear itinerary
                document.getElementById('itineraryContainer').innerHTML = '';
                itineraryDayCount = 0;
                // Clear image manager
                tourMediaImages = [];
                updateImageManager();
            }
        }

        function switchTourTab(tabIndex) {
            // Remove active class from all tabs and contents
            document.querySelectorAll('.tour-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tour-tab-content').forEach(content => content.classList.remove('active'));

            // Add active class to selected tab and content
            document.querySelectorAll('.tour-tab')[tabIndex].classList.add('active');
            document.querySelectorAll('.tour-tab-content')[tabIndex].classList.add('active');
        }

        function addItineraryDay() {
            itineraryDayCount++;
            const container = document.getElementById('itineraryContainer');

            const dayDiv = document.createElement('div');
            dayDiv.className = 'itinerary-day';
            dayDiv.dataset.dayNumber = itineraryDayCount;
            dayDiv.innerHTML = `
                <div class="itinerary-day-header">
                    <div class="itinerary-day-number">üìÖ DAY ${itineraryDayCount}</div>
                    <button type="button" class="remove-day-btn" onclick="removeItineraryDay(this)">Delete Day</button>
                </div>

                <div class="tour-form-group">
                    <label>Day Title <span class="required">*</span></label>
                    <input type="text" class="day-title" placeholder="E.g.: Arrival & City Tour" required>
                </div>

                <div class="tour-form-group">
                    <label>Description <span class="required">*</span></label>
                    <textarea class="day-description" placeholder="Describe what happens on this day..." rows="3" required></textarea>
                </div>

                <div class="tour-form-group">
                    <label>Day Image üñºÔ∏è</label>
                    <div style="display: flex; gap: 10px; align-items: start;">
                        <input type="url" class="day-image" placeholder="Image URL will appear here after upload" readonly style="flex: 1; background: #f8f9fa;">
                        <input type="file" class="day-image-file" accept="image/*" style="display: none;" onchange="uploadDayImage(this)">
                        <button type="button" class="add-item-btn" onclick="this.previousElementSibling.click()" style="white-space: nowrap;">
                            üì§ Upload Image
                        </button>
                    </div>
                    <div class="day-image-preview" style="margin-top: 10px; display: none;">
                        <img src="" alt="Day preview" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 2px solid #e0e0e0;">
                        <button type="button" onclick="removeDayImage(this)" style="display: block; margin-top: 5px; background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                            üóëÔ∏è Remove
                        </button>
                    </div>
                    <input type="text" class="day-image-caption" placeholder="E.g.: Sunset Desert Safari, Registon Square View" style="margin-top: 10px; width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 14px;">
                    <small style="color: #6c757d; font-size: 12px; display: block; margin-top: 5px;">
                        Optional: Add caption text to display on the image (shown on frontend)
                    </small>
                </div>

                <div class="tour-form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div class="tour-form-group" style="margin-bottom: 0;">
                        <label>üìç City/Location</label>
                        <select class="day-city" style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 14px; background: white;">
                            <option value="">Select city...</option>
                            <optgroup label="üá∫üáø Uzbekistan">
                                <option value="Tashkent">Tashkent</option>
                                <option value="Samarkand">Samarkand</option>
                                <option value="Bukhara">Bukhara</option>
                                <option value="Khiva">Khiva</option>
                                <option value="Shakhrisabz">Shakhrisabz</option>
                                <option value="Termez">Termez</option>
                                <option value="Urgench">Urgench</option>
                                <option value="Nukus">Nukus</option>
                                <option value="Fergana">Fergana</option>
                                <option value="Andijan">Andijan</option>
                                <option value="Namangan">Namangan</option>
                                <option value="Kokand">Kokand</option>
                            </optgroup>
                            <optgroup label="üáπüáØ Tajikistan">
                                <option value="Dushanbe">Dushanbe</option>
                                <option value="Khujand">Khujand</option>
                                <option value="Khorog">Khorog</option>
                                <option value="Istaravshan">Istaravshan</option>
                                <option value="Panjakent">Panjakent</option>
                            </optgroup>
                        </select>
                        <small style="color: #6c757d; font-size: 12px; display: block; margin-top: 5px;">
                            Optional: Where tourists stay this night
                        </small>
                    </div>
                    <div class="tour-form-group" style="margin-bottom: 0;">
                        <label>üè® Hotel/Accommodation</label>
                        <input type="text" class="day-accommodation" list="hotelSuggestions" placeholder="E.g.: Registon Plaza Hotel" style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 14px;">
                        <datalist id="hotelSuggestions">
                            <!-- Popular Hotels -->
                            <option value="Hilton Tashkent">
                            <option value="Hyatt Regency Tashkent">
                            <option value="Registon Plaza Samarkand">
                            <option value="Grand Samarkand Hotel">
                            <option value="Malika Bukhara">
                            <option value="Asia Bukhara">
                            <option value="Orient Star Khiva">
                            <option value="Hyatt Regency Dushanbe">
                            <option value="Serena Hotel Dushanbe">
                            <!-- Budget Options -->
                            <option value="Guesthouse">
                            <option value="Homestay">
                            <option value="Yurt Camp">
                        </datalist>
                        <small style="color: #6c757d; font-size: 12px; display: block; margin-top: 5px;">
                            Optional: Type or select hotel name (auto-suggests previous hotels)
                        </small>
                    </div>
                </div>

                <div class="tour-form-group">
                    <label>üçΩÔ∏è Meals Included</label>
                    <select class="day-meals" style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 14px; background: white;">
                        <option value="">No meals</option>
                        <option value="BB">BB - Bed & Breakfast</option>
                        <option value="HB">HB - Half Board (Breakfast + Dinner)</option>
                        <option value="FB">FB - Full Board (Breakfast + Lunch + Dinner)</option>
                        <option value="AI">AI - All Inclusive</option>
                    </select>
                    <small style="color: #6c757d; font-size: 12px; display: block; margin-top: 5px;">
                        Optional: Select meal plan for this day
                    </small>
                </div>

                <div class="tour-form-group">
                    <label>Activities</label>
                    <div class="activities-list">
                        <div class="activity-item">
                            <input type="text" class="activity-input" placeholder="E.g.: Airport pickup">
                            <button type="button" class="remove-activity-btn" onclick="removeActivity(this)">√ó</button>
                        </div>
                    </div>
                    <button type="button" class="add-item-btn" style="margin-top: 10px;" onclick="addActivity(this)">
                        <span style="font-size: 14px;">+</span> Add Activity
                    </button>
                </div>
            `;

            container.appendChild(dayDiv);
        }

        function removeItineraryDay(button) {
            if (confirm('Delete this day from the itinerary?')) {
                button.closest('.itinerary-day').remove();
                // Renumber remaining days
                const days = document.querySelectorAll('.itinerary-day');
                days.forEach((day, index) => {
                    day.dataset.dayNumber = index + 1;
                    day.querySelector('.itinerary-day-number').textContent = `üìÖ DAY ${index + 1}`;
                });
                itineraryDayCount = days.length;
            }
        }

        function addActivity(button) {
            const activitiesList = button.previousElementSibling;
            const activityDiv = document.createElement('div');
            activityDiv.className = 'activity-item';
            activityDiv.innerHTML = `
                <input type="text" class="activity-input" placeholder="E.g.: Hotel check-in">
                <button type="button" class="remove-activity-btn" onclick="removeActivity(this)">√ó</button>
            `;
            activitiesList.appendChild(activityDiv);
        }

        function removeActivity(button) {
            const activitiesList = button.closest('.activities-list');
            if (activitiesList.children.length > 1) {
                button.closest('.activity-item').remove();
            } else {
                alert('At least one activity is required per day.');
            }
        }

        // Upload day image function
        async function uploadDayImage(input) {
            const file = input.files[0];
            if (!file) return;

            // Validate file size (5MB max)
            if (file.size > 5 * 1024 * 1024) {
                alert('Image size must be less than 5MB');
                input.value = '';
                return;
            }

            // Validate file type
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp', 'image/gif'];
            if (!validTypes.includes(file.type)) {
                alert('Only JPG, PNG, WebP, and GIF images are allowed');
                input.value = '';
                return;
            }

            // Show loading state
            const dayGroup = input.closest('.tour-form-group');
            const urlInput = dayGroup.querySelector('.day-image');
            const originalPlaceholder = urlInput.placeholder;
            urlInput.placeholder = 'Uploading... Please wait...';

            try {
                // Create FormData
                const formData = new FormData();
                formData.append('image', file);

                // Upload to server
                const response = await fetch(`${API_URL}/upload/tour-image`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Upload failed');
                }

                const result = await response.json();

                if (result.success && result.data.imageUrl) {
                    // Set the image URL
                    urlInput.value = result.data.imageUrl;

                    // Show preview
                    const previewDiv = dayGroup.querySelector('.day-image-preview');
                    const previewImg = previewDiv.querySelector('img');
                    previewImg.src = result.data.imageUrl;
                    previewDiv.style.display = 'block';

                    alert('‚úÖ Image uploaded successfully!');
                } else {
                    throw new Error('Invalid response from server');
                }

            } catch (error) {
                console.error('Upload error:', error);
                alert('‚ùå Failed to upload image: ' + error.message);
                urlInput.placeholder = originalPlaceholder;
            }

            // Clear file input
            input.value = '';
        }

        // Remove day image function
        function removeDayImage(button) {
            const dayGroup = button.closest('.tour-form-group');
            const urlInput = dayGroup.querySelector('.day-image');
            const previewDiv = dayGroup.querySelector('.day-image-preview');
            const fileInput = dayGroup.querySelector('.day-image-file');

            // Clear URL
            urlInput.value = '';

            // Hide preview
            previewDiv.style.display = 'none';
            previewDiv.querySelector('img').src = '';

            // Clear file input
            fileInput.value = '';
        }

        // ============================================
        // IMAGE MANAGER FUNCTIONS
        // ============================================

        let tourMediaImages = []; // Array of image URLs
        let selectedMediaFiles = [];

        // Initialize image manager
        function initImageManager() {
            updateImageManager();
        }

        // Render image manager
        function updateImageManager() {
            const container = document.getElementById('imageManagerContainer');
            const emptyState = document.getElementById('imageManagerEmpty');
            const textarea = document.getElementById('tourImages');

            if (tourMediaImages.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                textarea.value = '';
                return;
            }

            emptyState.style.display = 'none';
            container.innerHTML = '';

            tourMediaImages.forEach((url, index) => {
                const imageCard = document.createElement('div');
                imageCard.style.cssText = 'position: relative; width: 150px; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden;';

                imageCard.innerHTML = `
                    <div style="position: relative; width: 150px; height: 150px; overflow: hidden;">
                        <img src="${url}" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22150%22 height=%22150%22%3E%3Crect fill=%22%23ddd%22 width=%22150%22 height=%22150%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22%3ENo Image%3C/text%3E%3C/svg%3E';">
                        ${index === 0 ? '<div style="position: absolute; top: 5px; left: 5px; background: #ffc107; color: #000; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: bold;">COVER</div>' : ''}
                        <div style="position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.6); color: white; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: bold;">#${index + 1}</div>
                    </div>
                    <div style="padding: 8px; display: flex; flex-direction: column; gap: 5px;">
                        <div style="display: flex; gap: 5px;">
                            ${index > 0 ? `<button type="button" onclick="moveImageUp(${index})" style="flex: 1; background: #6c757d; color: white; border: none; padding: 6px; border-radius: 4px; cursor: pointer; font-size: 12px;" title="Move up">‚Üë</button>` : '<div style="flex: 1;"></div>'}
                            ${index < tourMediaImages.length - 1 ? `<button type="button" onclick="moveImageDown(${index})" style="flex: 1; background: #6c757d; color: white; border: none; padding: 6px; border-radius: 4px; cursor: pointer; font-size: 12px;" title="Move down">‚Üì</button>` : '<div style="flex: 1;"></div>'}
                        </div>
                        <div style="display: flex; gap: 5px;">
                            ${index > 0 ? `<button type="button" onclick="setAsCover(${index})" style="flex: 1; background: #ffc107; color: #000; border: none; padding: 6px; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: bold;" title="Set as cover">‚≠ê Cover</button>` : '<div style="flex: 1;"></div>'}
                            <button type="button" onclick="removeImage(${index})" style="flex: 1; background: #dc3545; color: white; border: none; padding: 6px; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: bold;" title="Remove">‚ùå</button>
                        </div>
                    </div>
                `;

                container.appendChild(imageCard);
            });

            // Update hidden textarea
            textarea.value = tourMediaImages.join('\n');
        }

        // Move image up
        function moveImageUp(index) {
            if (index === 0) return;
            [tourMediaImages[index], tourMediaImages[index - 1]] = [tourMediaImages[index - 1], tourMediaImages[index]];
            updateImageManager();
        }

        // Move image down
        function moveImageDown(index) {
            if (index === tourMediaImages.length - 1) return;
            [tourMediaImages[index], tourMediaImages[index + 1]] = [tourMediaImages[index + 1], tourMediaImages[index]];
            updateImageManager();
        }

        // Set as cover
        function setAsCover(index) {
            const image = tourMediaImages.splice(index, 1)[0];
            tourMediaImages.unshift(image);
            updateImageManager();
        }

        // Remove image
        function removeImage(index) {
            if (confirm('Remove this image?')) {
                tourMediaImages.splice(index, 1);
                updateImageManager();
            }
        }

        // Add image URL manually
        function addImageUrlManually() {
            const url = prompt('Enter image URL:');
            if (url && url.trim()) {
                tourMediaImages.push(url.trim());
                updateImageManager();
            }
        }

        // Handle file selection for media upload
        document.addEventListener('DOMContentLoaded', function() {
            const mediaUploadInput = document.getElementById('tourMediaUpload');
            if (mediaUploadInput) {
                mediaUploadInput.addEventListener('change', function(e) {
                    const files = Array.from(e.target.files);
                    if (files.length === 0) return;

                    selectedMediaFiles = files;
                    document.getElementById('uploadMediaBtn').style.display = 'block';
                    document.getElementById('uploadMediaBtn').textContent = `Upload ${files.length} image(s)`;
                });
            }

            // Initialize image manager
            initImageManager();
        });

        // Upload media images to server
        async function uploadMediaImages() {
            if (selectedMediaFiles.length === 0) {
                alert('Please select images first');
                return;
            }

            const uploadBtn = document.getElementById('uploadMediaBtn');
            const originalText = uploadBtn.textContent;
            uploadBtn.textContent = 'Uploading...';
            uploadBtn.disabled = true;

            try {
                const uploadedUrls = [];

                for (let i = 0; i < selectedMediaFiles.length; i++) {
                    const file = selectedMediaFiles[i];

                    // Validate file size (5MB max)
                    if (file.size > 5 * 1024 * 1024) {
                        alert(`Image ${i + 1} is too large (max 5MB)`);
                        continue;
                    }

                    // Validate file type
                    const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp', 'image/gif'];
                    if (!validTypes.includes(file.type)) {
                        alert(`Image ${i + 1} has invalid type`);
                        continue;
                    }

                    uploadBtn.textContent = `Uploading ${i + 1}/${selectedMediaFiles.length}...`;

                    const formData = new FormData();
                    formData.append('image', file);

                    const response = await fetch(`${API_URL}/upload`, {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error(`Upload failed for image ${i + 1}`);
                    }

                    const result = await response.json();

                    if (result.success && result.data.filePath) {
                        uploadedUrls.push(result.data.filePath);
                    }
                }

                if (uploadedUrls.length > 0) {
                    // Add to tour media images
                    tourMediaImages.push(...uploadedUrls);
                    updateImageManager();
                    alert(`‚úÖ Successfully uploaded ${uploadedUrls.length} image(s)!`);
                }

                // Clear selection
                document.getElementById('tourMediaUpload').value = '';
                selectedMediaFiles = [];

            } catch (error) {
                console.error('Upload error:', error);
                alert('‚ùå Failed to upload images: ' + error.message);
            } finally {
                uploadBtn.textContent = originalText;
                uploadBtn.disabled = false;
                uploadBtn.style.display = 'none';
            }
        }

        async function saveTour() {
            const form = document.getElementById('addTourForm');

            // Check basic required fields
            const requiredFields = [
                { id: 'tourName', name: 'Tour Name', tab: 0 },
                { id: 'tourCategory', name: 'Category', tab: 0 },
                { id: 'tourDestination', name: 'Destination', tab: 0 },
                { id: 'tourPrice', name: 'Price', tab: 0 },
                { id: 'tourDuration', name: 'Duration', tab: 0 },
                { id: 'tourNights', name: 'Nights', tab: 0 },
                { id: 'tourDescription', name: 'Description', tab: 0 }
            ];

            for (let field of requiredFields) {
                const element = document.getElementById(field.id);
                if (!element.value || element.value.trim() === '') {
                    alert(`‚ùå Required field missing: ${field.name}\n\nPlease fill in the "${field.name}" field in Tab 1 (Basic Info)`);
                    switchTourTab(field.tab);
                    element.focus();
                    return;
                }
            }

            // Check itinerary - at least one day required
            const itineraryDays = document.querySelectorAll('.itinerary-day');
            if (itineraryDays.length === 0) {
                alert('‚ùå Please add at least one day to the itinerary!\n\nGo to Tab 3 (Itinerary) and click "Add Day"');
                switchTourTab(2);
                return;
            }

            // Check each itinerary day has title and description
            for (let i = 0; i < itineraryDays.length; i++) {
                const day = itineraryDays[i];
                const title = day.querySelector('.day-title').value;
                const description = day.querySelector('.day-description').value;

                if (!title || title.trim() === '') {
                    alert(`‚ùå Day ${i + 1} is missing a title!\n\nPlease add a title for Day ${i + 1} in Tab 3 (Itinerary)`);
                    switchTourTab(2);
                    day.querySelector('.day-title').focus();
                    return;
                }

                if (!description || description.trim() === '') {
                    alert(`‚ùå Day ${i + 1} is missing a description!\n\nPlease add a description for Day ${i + 1} in Tab 3 (Itinerary)`);
                    switchTourTab(2);
                    day.querySelector('.day-description').focus();
                    return;
                }
            }

            // Collect form data
            const formData = {
                title: document.getElementById('tourName').value,
                category: document.getElementById('tourCategory').value,
                destination: document.getElementById('tourDestination').value,
                price: parseFloat(document.getElementById('tourPrice').value),
                discountPrice: document.getElementById('tourDiscountPrice').value ? parseFloat(document.getElementById('tourDiscountPrice').value) : null,
                duration: parseInt(document.getElementById('tourDuration').value),
                nights: parseInt(document.getElementById('tourNights').value),
                summary: document.getElementById('tourSummary').value,
                description: document.getElementById('tourDescription').value,
                maxGroupSize: document.getElementById('tourMaxGroup').value ? parseInt(document.getElementById('tourMaxGroup').value) : 15,
                difficulty: document.getElementById('tourDifficulty').value,
                languages: document.getElementById('tourLanguages').value.split(',').map(l => l.trim()).filter(l => l),
                season: document.getElementById('tourAvailability').value,
                highlights: document.getElementById('tourHighlights').value.split('\n').filter(h => h.trim()),
                status: document.getElementById('tourStatus').value,
                featured: document.getElementById('tourFeatured').checked,
                slug: document.getElementById('tourSlug').value
            };

            // Collect itinerary
            const itineraryData = [];
            document.querySelectorAll('.itinerary-day').forEach((day, index) => {
                const activities = [];
                day.querySelectorAll('.activity-input').forEach(input => {
                    if (input.value.trim()) {
                        activities.push(input.value.trim());
                    }
                });

                const dayImageInput = day.querySelector('.day-image');
                const dayImage = dayImageInput && dayImageInput.value.trim() ? dayImageInput.value.trim() : null;

                const dayCaptionInput = day.querySelector('.day-image-caption');
                const dayCaption = dayCaptionInput && dayCaptionInput.value.trim() ? dayCaptionInput.value.trim() : null;

                const dayCityInput = day.querySelector('.day-city');
                const dayCity = dayCityInput && dayCityInput.value.trim() ? dayCityInput.value.trim() : null;

                const dayAccommodationInput = day.querySelector('.day-accommodation');
                const dayAccommodation = dayAccommodationInput && dayAccommodationInput.value.trim() ? dayAccommodationInput.value.trim() : null;

                const dayMealsInput = day.querySelector('.day-meals');
                const dayMeals = dayMealsInput && dayMealsInput.value ? dayMealsInput.value : null;

                itineraryData.push({
                    day: index + 1,
                    title: day.querySelector('.day-title').value,
                    description: day.querySelector('.day-description').value,
                    image: dayImage,
                    imageCaption: dayCaption,
                    city: dayCity,
                    accommodation: dayAccommodation,
                    meals: dayMeals,
                    activities: activities
                });
            });
            formData.itinerary = itineraryData;

            // Collect inclusions
            formData.included = document.getElementById('tourIncluded').value.split('\n').filter(i => i.trim());
            formData.excluded = document.getElementById('tourExcluded').value.split('\n').filter(e => e.trim());

            // Collect images
            const imageUrls = document.getElementById('tourImages').value.split('\n').filter(url => url.trim());
            formData.images = imageUrls;

            console.log('Tour data to save:', formData);

            // Check if we're editing or creating
            const editId = form.dataset.editId;
            const isEdit = !!editId;

            // Save to API
            try {
                const url = isEdit ? `${API_URL}/tours/${editId}` : `${API_URL}/tours`;
                const method = isEdit ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    throw new Error(`Failed to ${isEdit ? 'update' : 'save'} tour`);
                }

                const result = await response.json();
                alert(`‚úÖ Tour ${isEdit ? 'updated' : 'saved'} successfully!`);
                closeAddTourModal();
                loadTours(); // Reload tours list
            } catch (error) {
                console.error('Error saving tour:', error);
                alert(`‚ùå Error ${isEdit ? 'updating' : 'saving'} tour: ` + error.message);
            }
        }

        // Load Tours List
        async function loadTours() {
            const container = document.getElementById('toursTableContainer');

            try {
                console.log('üìä Loading tours from API...');
                const response = await fetch(`${API_URL}/tours`);

                if (!response.ok) {
                    console.error('‚ùå API response not OK:', response.status);
                    throw new Error(`API error: ${response.status}`);
                }

                const result = await response.json();
                console.log('‚úÖ Tours API response:', result);

                if (!result.success || !result.data || !result.data.tours) {
                    console.error('‚ùå Invalid response structure:', result);
                    throw new Error('Invalid API response');
                }

                const tours = result.data.tours;
                console.log(`üì¶ Found ${tours.length} tours`);

                if (tours.length === 0) {
                    container.innerHTML = '<p style="padding: 20px; text-align: center; color: #6c757d;">No tours found. Click "Add New Tour" to create one.</p>';
                    return;
                }

                // Create table
                let html = `
                    <table style="width: 100%; border-collapse: collapse; background: white;">
                        <thead>
                            <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <th style="padding: 12px; text-align: left;">Title</th>
                                <th style="padding: 12px; text-align: left;">Destination</th>
                                <th style="padding: 12px; text-align: left;">Price</th>
                                <th style="padding: 12px; text-align: left;">Duration</th>
                                <th style="padding: 12px; text-align: left;">Category</th>
                                <th style="padding: 12px; text-align: left;">Status</th>
                                <th style="padding: 12px; text-align: center;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                tours.forEach(tour => {
                    const statusColor = tour.isActive ? '#28a745' : '#6c757d';
                    const statusText = tour.isActive ? 'Active' : 'Inactive';

                    html += `
                        <tr style="border-bottom: 1px solid #dee2e6;">
                            <td style="padding: 12px;">
                                <strong>${tour.title}</strong>
                                ${tour.featured || tour.isFeatured ? '<span style="background: #ffc107; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px;">FEATURED</span>' : ''}
                            </td>
                            <td style="padding: 12px;">${tour.destination || '-'}</td>
                            <td style="padding: 12px;">$${tour.price}</td>
                            <td style="padding: 12px;">${tour.duration}D/${tour.nights}N</td>
                            <td style="padding: 12px;">
                                <span style="background: #e7f3ff; color: #0066cc; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                                    ${tour.category || 'N/A'}
                                </span>
                            </td>
                            <td style="padding: 12px;">
                                <span style="color: ${statusColor}; font-weight: 600;">‚óè</span> ${statusText}
                            </td>
                            <td style="padding: 12px; text-align: center;">
                                <button onclick="viewTour('${tour.id}')" style="background: #28a745; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-right: 5px;" title="View on frontend">üëÅÔ∏è View</button>
                                <button onclick="editTour('${tour.id}')" style="background: #007bff; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-right: 5px;">‚úèÔ∏è Edit</button>
                                <button onclick="deleteTour('${tour.id}')" style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">üóëÔ∏è Delete</button>
                            </td>
                        </tr>
                    `;
                });

                html += `
                        </tbody>
                    </table>
                `;

                container.innerHTML = html;

            } catch (error) {
                console.error('Error loading tours:', error);
                container.innerHTML = `<p style="padding: 20px; text-align: center; color: #dc3545;">Error loading tours: ${error.message}</p>`;
            }
        }

        // View tour on frontend
        function viewTour(id) {
            // Open tour details page in new tab
            const url = `/gofly/tour-details.html?id=${id}`;
            window.open(url, '_blank');
        }

        async function editTour(id) {
            try {
                // Fetch tour data
                const response = await fetch(`${API_URL}/tours/${id}`);
                const result = await response.json();

                if (!result.success || !result.data) {
                    alert('Failed to load tour data');
                    return;
                }

                const tour = result.data;

                // Set modal title to Edit mode
                document.querySelector('.add-tour-modal-header h2').textContent = '‚úèÔ∏è Edit Tour';

                // Store tour ID for update
                document.getElementById('addTourForm').dataset.editId = tour.id || tour._id;

                // Populate Basic Info (Tab 1)
                document.getElementById('tourName').value = tour.title || '';
                document.getElementById('tourCategory').value = tour.category || '';
                document.getElementById('tourDestination').value = tour.destination || '';
                document.getElementById('tourPrice').value = tour.price || '';
                document.getElementById('tourDiscountPrice').value = tour.discountPrice || '';
                document.getElementById('tourDuration').value = tour.duration || '';
                document.getElementById('tourNights').value = tour.nights || '';
                document.getElementById('tourSummary').value = tour.summary || '';
                document.getElementById('tourDescription').value = tour.description || '';

                // Populate Details (Tab 2)
                document.getElementById('tourMaxGroup').value = tour.maxGroupSize || '';
                document.getElementById('tourDifficulty').value = tour.difficulty || 'Easy';
                document.getElementById('tourLanguages').value = (tour.languages || []).join(', ');
                document.getElementById('tourAvailability').value = tour.season || 'All Year';
                document.getElementById('tourHighlights').value = (tour.highlights || []).join('\n');

                // Populate Itinerary (Tab 3)
                const itineraryContainer = document.getElementById('itineraryContainer');
                itineraryContainer.innerHTML = '';
                itineraryDayCount = 0;

                if (tour.itinerary && tour.itinerary.length > 0) {
                    tour.itinerary.forEach((dayData, index) => {
                        addItineraryDay();
                        const dayDiv = itineraryContainer.lastElementChild;
                        dayDiv.querySelector('.day-title').value = dayData.title || '';
                        dayDiv.querySelector('.day-description').value = dayData.description || '';

                        // Populate day image if exists
                        const dayImageInput = dayDiv.querySelector('.day-image');
                        if (dayImageInput && dayData.image) {
                            dayImageInput.value = dayData.image;

                            // Show preview
                            const previewDiv = dayDiv.querySelector('.day-image-preview');
                            const previewImg = previewDiv.querySelector('img');
                            previewImg.src = dayData.image;
                            previewDiv.style.display = 'block';
                        }

                        // Populate day image caption if exists
                        const dayCaptionInput = dayDiv.querySelector('.day-image-caption');
                        if (dayCaptionInput && dayData.imageCaption) {
                            dayCaptionInput.value = dayData.imageCaption;
                        }

                        // Populate city if exists
                        const dayCityInput = dayDiv.querySelector('.day-city');
                        if (dayCityInput && dayData.city) {
                            dayCityInput.value = dayData.city;
                        }

                        // Populate accommodation if exists
                        const dayAccommodationInput = dayDiv.querySelector('.day-accommodation');
                        if (dayAccommodationInput && dayData.accommodation) {
                            dayAccommodationInput.value = dayData.accommodation;
                        }

                        // Populate meals if exists
                        const dayMealsInput = dayDiv.querySelector('.day-meals');
                        if (dayMealsInput && dayData.meals) {
                            dayMealsInput.value = dayData.meals;
                        }

                        // Populate activities
                        const activitiesList = dayDiv.querySelector('.activities-list');
                        activitiesList.innerHTML = '';

                        if (dayData.activities && dayData.activities.length > 0) {
                            dayData.activities.forEach(activity => {
                                const activityItem = document.createElement('div');
                                activityItem.className = 'activity-item';
                                activityItem.innerHTML = `
                                    <input type="text" class="activity-input" placeholder="E.g.: Airport pickup" value="${activity}">
                                    <button type="button" class="remove-activity-btn" onclick="removeActivity(this)">√ó</button>
                                `;
                                activitiesList.appendChild(activityItem);
                            });
                        } else {
                            // Add one empty activity field
                            const activityItem = document.createElement('div');
                            activityItem.className = 'activity-item';
                            activityItem.innerHTML = `
                                <input type="text" class="activity-input" placeholder="E.g.: Airport pickup">
                                <button type="button" class="remove-activity-btn" onclick="removeActivity(this)">√ó</button>
                            `;
                            activitiesList.appendChild(activityItem);
                        }
                    });
                }

                // Populate Inclusions (Tab 4)
                document.getElementById('tourIncluded').value = (tour.included || []).join('\n');
                document.getElementById('tourExcluded').value = (tour.excluded || []).join('\n');

                // Populate Media (Tab 5)
                tourMediaImages = tour.images || [];
                updateImageManager();

                // Populate Settings (Tab 6)
                document.getElementById('tourStatus').value = tour.isActive ? 'active' : 'inactive';
                document.getElementById('tourFeatured').checked = tour.featured || tour.isFeatured || false;
                document.getElementById('tourSlug').value = tour.slug || '';

                // Open modal
                document.getElementById('addTourModal').classList.add('active');

                // Switch to first tab
                switchTourTab(0);

            } catch (error) {
                console.error('Error loading tour for edit:', error);
                alert('Error loading tour: ' + error.message);
            }
        }

        async function deleteTour(id) {
            if (!confirm('Are you sure you want to delete this tour?')) return;

            try {
                const response = await fetch(`${API_URL}/tours/${id}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    alert('Tour deleted successfully!');
                    loadTours();
                } else {
                    alert('Failed to delete tour');
                }
            } catch (error) {
                console.error('Error deleting tour:', error);
                alert('Error deleting tour: ' + error.message);
            }
        }

        // Page Navigation System
        function showPage(pageName) {
            console.log(`üîÑ showPage called with: ${pageName}`);

            // Hide all pages
            const allPages = document.querySelectorAll('.page-section');
            console.log(`üìÑ Found ${allPages.length} page sections`);
            allPages.forEach(page => {
                page.classList.remove('active');
            });

            // Show selected page
            const pageId = pageName + 'Page';
            const pageElement = document.getElementById(pageId);
            console.log(`üîç Looking for page ID: ${pageId}, found: ${!!pageElement}`);

            if (pageElement) {
                pageElement.classList.add('active');
                console.log(`‚úÖ Activated page: ${pageId}`);
                // Initialize Media Library when navigating to it
                if (pageName === 'media' && typeof initMediaLibrary === 'function') {
                    initMediaLibrary();
                }
            } else {
                console.error(`‚ùå Page not found: ${pageId}`);
            }

            // Update menu active state
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === pageName) {
                    item.classList.add('active');
                }
            });

            // Update page title
            const pageTitle = document.getElementById('pageTitle');
            const pageBreadcrumb = document.getElementById('pageBreadcrumb');
            const titles = {
                'dashboard': 'Dashboard',
                'tours': 'Tours',
                'bookings': 'Bookings',
                'users': 'Users',
                'pages': 'Pages',
                'categories': 'Categories',
                'destinations': 'Destinations',
                'media': 'Media Library',
                'reviews': 'Reviews',
                'blog': 'Blog',
                'settings': 'General Settings',
                'seo': 'SEO Settings'
            };

            if (pageTitle) pageTitle.textContent = titles[pageName] || 'Admin';
            if (pageBreadcrumb) pageBreadcrumb.textContent = titles[pageName] || 'Admin';

            // Load data for specific pages
            if (pageName === 'tours') {
                loadTours();
            } else if (pageName === 'bookings') {
                loadBookings();
            } else if (pageName === 'users') {
                loadUsers();
            } else if (pageName === 'categories') {
                loadCategories();
            } else if (pageName === 'blog') {
                window.loadPosts();
            } else if (pageName === 'media') {
                initMediaLibrary();
            } else if (pageName === 'reviews') {
                initReviews();
            }
        }

        // ========== BOOKINGS MANAGEMENT ==========
        async function loadBookings() {
            const tbody = document.getElementById('bookingsTableBody');
            const statusFilter = document.getElementById('statusFilter').value;

            try {
                let url = `${API_URL}/admin/bookings`;
                if (statusFilter) {
                    url += `?status=${statusFilter}`;
                }

                const response = await fetch(url);
                const result = await response.json();

                if (!result.success || !result.data) {
                    throw new Error('Invalid API response');
                }

                const { bookings, stats } = result.data;

                // Update statistics
                document.getElementById('totalBookings').textContent = stats.total || 0;
                document.getElementById('pendingBookings').textContent = stats.pending || 0;
                document.getElementById('confirmedBookings').textContent = stats.confirmed || 0;
                document.getElementById('cancelledBookings').textContent = stats.cancelled || 0;

                if (bookings.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8" style="padding: 40px; text-align: center; color: #9ca3af;">
                                No bookings found.
                            </td>
                        </tr>
                    `;
                    return;
                }

                // Build table rows
                let html = '';
                bookings.forEach(booking => {
                    const statusColors = {
                        'pending': { bg: '#fff8e1', text: '#ff9800' },
                        'confirmed': { bg: '#e8f5e9', text: '#22c55e' },
                        'cancelled': { bg: '#ffebee', text: '#ef4444' }
                    };

                    const statusColor = statusColors[booking.status] || statusColors['pending'];
                    const bookingDate = new Date(booking.date).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
                    const createdDate = new Date(booking.createdAt).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });

                    html += `
                        <tr style="border-bottom: 1px solid #e5e7eb;">
                            <td style="padding: 15px; font-size: 12px; color: #6b7280;">${booking.id.slice(0, 12)}...</td>
                            <td style="padding: 15px;">
                                <div style="font-weight: 600; color: #374151; margin-bottom: 4px;">${booking.tourName}</div>
                                <div style="font-size: 12px; color: #6b7280;">Created: ${createdDate}</div>
                            </td>
                            <td style="padding: 15px;">
                                <div style="font-weight: 500; color: #374151; margin-bottom: 2px;">${booking.customerName}</div>
                                <div style="font-size: 12px; color: #6b7280;">${booking.customerEmail}</div>
                                <div style="font-size: 12px; color: #6b7280;">${booking.customerPhone}</div>
                            </td>
                            <td style="padding: 15px; color: #374151;">${bookingDate}</td>
                            <td style="padding: 15px; color: #374151;">${booking.guests.adults} Adults${booking.guests.children > 0 ? `, ${booking.guests.children} Children` : ''}</td>
                            <td style="padding: 15px; font-weight: 600; color: #6366f1;">$${booking.totalPrice}</td>
                            <td style="padding: 15px;">
                                <span style="background: ${statusColor.bg}; color: ${statusColor.text}; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; text-transform: capitalize;">
                                    ${booking.status}
                                </span>
                            </td>
                            <td style="padding: 15px;">
                                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                    ${booking.status === 'pending' ? `
                                        <button onclick="updateBookingStatus('${booking.id}', 'confirmed')" style="padding: 6px 12px; background: #22c55e; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                                            Confirm
                                        </button>
                                        <button onclick="updateBookingStatus('${booking.id}', 'cancelled')" style="padding: 6px 12px; background: #ef4444; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                                            Cancel
                                        </button>
                                    ` : ''}
                                    <button onclick="viewBookingDetails('${booking.id}')" style="padding: 6px 12px; background: #6366f1; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                                        View
                                    </button>
                                    <button onclick="deleteBooking('${booking.id}', '${booking.tourName}')" style="padding: 6px 12px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                                        üóëÔ∏è Delete
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });

                tbody.innerHTML = html;

            } catch (error) {
                console.error('Error loading bookings:', error);
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="padding: 40px; text-align: center; color: #ef4444;">
                            Error loading bookings: ${error.message}
                        </td>
                    </tr>
                `;
            }
        }

        async function updateBookingStatus(bookingId, newStatus) {
            if (!confirm(`Are you sure you want to ${newStatus} this booking?`)) {
                return;
            }

            try {
                const token = localStorage.getItem('accessToken');
                const response = await fetch(`${API_URL}/admin/bookings/${bookingId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ status: newStatus })
                });

                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.message || 'Failed to update booking status');
                }

                alert(`Booking ${newStatus} successfully!`);
                loadBookings(); // Reload bookings
            } catch (error) {
                console.error('Error updating booking status:', error);
                alert('Error: ' + error.message);
            }
        }

        async function deleteBooking(bookingId, tourName) {
            if (!confirm(`‚ö†Ô∏è Are you sure you want to DELETE this booking?\n\nTour: ${tourName}\n\nThis action CANNOT be undone!`)) {
                return;
            }

            // Double confirmation for safety
            const confirmText = prompt('Type "DELETE" to confirm deletion:', '');
            if (confirmText !== 'DELETE') {
                alert('‚ùå Deletion cancelled. You must type "DELETE" to confirm.');
                return;
            }

            try {
                const token = localStorage.getItem('accessToken');
                const response = await fetch(`${API_URL}/admin/bookings/${bookingId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.message || 'Failed to delete booking');
                }

                alert('‚úÖ Booking deleted successfully!');
                loadBookings(); // Reload bookings
            } catch (error) {
                console.error('Error deleting booking:', error);
                alert('‚ùå Error: ' + error.message);
            }
        }

        async function viewBookingDetails(bookingId) {
            try {
                const token = localStorage.getItem('accessToken');
                const response = await fetch(`${API_URL}/bookings/${bookingId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const result = await response.json();

                if (!result.success || !result.data) {
                    throw new Error('Booking not found');
                }

                const booking = result.data;
                const bookingDate = new Date(booking.date).toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                const statusColors = {
                    'pending': '#ff9800',
                    'confirmed': '#22c55e',
                    'cancelled': '#ef4444'
                };

                const details = `
                    <div style="max-width: 600px;">
                        <div style="background: #f9fafb; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <p style="margin: 0 0 5px 0;"><strong>Booking ID:</strong> ${booking.id}</p>
                            <p style="margin: 0 0 5px 0;"><strong>Status:</strong> <span style="color: ${statusColors[booking.status]}; font-weight: bold; text-transform: capitalize;">${booking.status}</span></p>
                        </div>

                        <div style="background: #f9fafb; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="margin: 0 0 10px 0; color: #6366f1;">Tour Information</h4>
                            <p style="margin: 0 0 5px 0;"><strong>Tour:</strong> ${booking.tourName}</p>
                            <p style="margin: 0 0 5px 0;"><strong>Date:</strong> ${bookingDate}</p>
                            <p style="margin: 0 0 5px 0;"><strong>Guests:</strong> ${booking.guests.adults} Adults${booking.guests.children > 0 ? `, ${booking.guests.children} Children` : ''}</p>
                            ${booking.pickupLocation ? `<p style="margin: 0 0 5px 0;"><strong>Pick up location:</strong> ${booking.pickupLocation}</p>` : ''}
                            <p style="margin: 0;"><strong>Total Price:</strong> <span style="color: #6366f1; font-weight: bold;">$${booking.totalPrice}</span></p>
                        </div>

                        <div style="background: #f9fafb; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="margin: 0 0 10px 0; color: #6366f1;">Customer Information</h4>
                            <p style="margin: 0 0 5px 0;"><strong>Name:</strong> ${booking.customerName}</p>
                            <p style="margin: 0 0 5px 0;"><strong>Email:</strong> ${booking.customerEmail}</p>
                            <p style="margin: 0;"><strong>Phone:</strong> ${booking.customerPhone}</p>
                        </div>

                        ${booking.specialRequests ? `
                        <div style="background: #f9fafb; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="margin: 0 0 10px 0; color: #6366f1;">Special Requests</h4>
                            <p style="margin: 0;">${booking.specialRequests}</p>
                        </div>
                        ` : ''}

                        <div style="background: #f9fafb; padding: 15px; border-radius: 8px;">
                            <p style="margin: 0 0 5px 0;"><strong>Created:</strong> ${new Date(booking.createdAt).toLocaleString()}</p>
                            ${booking.confirmedAt ? `<p style="margin: 0 0 5px 0;"><strong>Confirmed:</strong> ${new Date(booking.confirmedAt).toLocaleString()}</p>` : ''}
                            ${booking.cancelledAt ? `<p style="margin: 0;"><strong>Cancelled:</strong> ${new Date(booking.cancelledAt).toLocaleString()}</p>` : ''}
                        </div>
                    </div>
                `;

                // Show in SweetAlert2 modal
                Swal.fire({
                    title: 'Booking Details',
                    html: details,
                    width: '700px',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#6366f1'
                });
            } catch (error) {
                console.error('Error viewing booking:', error);
                alert('Error: ' + error.message);
            }
        }

        // Add event listener for status filter
        document.addEventListener('DOMContentLoaded', function() {
            const statusFilter = document.getElementById('statusFilter');
            if (statusFilter) {
                statusFilter.addEventListener('change', loadBookings);
            }
        });

        // ========== USERS MANAGEMENT ==========
        async function loadUsers() {
            const container = document.getElementById('usersTableContainer');

            try {
                const response = await fetch(`${API_URL}/admin/users`);
                const result = await response.json();

                if (!result.success || !result.data || !result.data.users) {
                    throw new Error('Invalid API response');
                }

                const users = result.data.users;

                if (users.length === 0) {
                    container.innerHTML = '<p style="padding: 20px; text-align: center; color: #6c757d;">No users found.</p>';
                    return;
                }

                // Create table
                let html = `
                    <table style="width: 100%; border-collapse: collapse; background: white;">
                        <thead>
                            <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <th style="padding: 12px; text-align: left;">Name</th>
                                <th style="padding: 12px; text-align: left;">Email</th>
                                <th style="padding: 12px; text-align: left;">Phone</th>
                                <th style="padding: 12px; text-align: left;">Role</th>
                                <th style="padding: 12px; text-align: left;">Status</th>
                                <th style="padding: 12px; text-align: left;">Joined</th>
                                <th style="padding: 12px; text-align: center;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                users.forEach(user => {
                    const roleColor = user.role === 'admin' ? '#dc3545' : (user.role === 'agent' ? '#ffc107' : '#17a2b8');
                    const statusColor = user.isActive ? '#28a745' : '#6c757d';
                    const statusText = user.isActive ? 'Active' : 'Inactive';
                    const joinedDate = user.createdAt ? new Date(user.createdAt).toLocaleDateString() : 'N/A';

                    html += `
                        <tr style="border-bottom: 1px solid #dee2e6;">
                            <td style="padding: 12px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                        ${user.name ? user.name.charAt(0).toUpperCase() : 'U'}
                                    </div>
                                    <strong>${user.name || 'N/A'}</strong>
                                </div>
                            </td>
                            <td style="padding: 12px;">${user.email || 'N/A'}</td>
                            <td style="padding: 12px;">${user.phone || 'N/A'}</td>
                            <td style="padding: 12px;">
                                <span style="background: ${roleColor}; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; text-transform: uppercase;">
                                    ${user.role || 'user'}
                                </span>
                            </td>
                            <td style="padding: 12px;">
                                <span style="background: ${statusColor}; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px;">
                                    ${statusText}
                                </span>
                            </td>
                            <td style="padding: 12px; color: #6c757d; font-size: 14px;">${joinedDate}</td>
                            <td style="padding: 12px; text-align: center;">
                                <div style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;">
                                    <button onclick="toggleUserStatus('${user.id || user._id}')"
                                            style="padding: 6px 12px; background: ${user.isActive ? '#ffc107' : '#28a745'}; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;"
                                            title="${user.isActive ? 'Block User' : 'Activate User'}">
                                        ${user.isActive ? 'üö´ Block' : '‚úÖ Activate'}
                                    </button>
                                    ${user.role !== 'admin' ? `
                                    <button onclick="changeUserRole('${user.id || user._id}', '${user.role}')"
                                            style="padding: 6px 12px; background: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;"
                                            title="Change Role">
                                        üë§ Role
                                    </button>
                                    ` : ''}
                                    <button onclick="resetUserPassword('${user.id || user._id}', '${user.name}')"
                                            style="padding: 6px 12px; background: #6f42c1; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;"
                                            title="Reset Password">
                                        üîë Password
                                    </button>
                                    <button onclick="viewLoginHistory('${user.id || user._id}', '${user.name}')"
                                            style="padding: 6px 12px; background: #20c997; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;"
                                            title="View Login History">
                                        üìä History
                                    </button>
                                    <button onclick="deleteUser('${user.id || user._id}', '${user.name}')"
                                            style="padding: 6px 12px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;"
                                            title="Delete User">
                                        üóëÔ∏è Delete
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });

                html += `
                        </tbody>
                    </table>
                `;

                container.innerHTML = html;

            } catch (error) {
                console.error('Error loading users:', error);
                container.innerHTML = `<p style="padding: 20px; text-align: center; color: #dc3545;">Error loading users: ${error.message}</p>`;
            }
        }

        // Toggle user status (active/inactive)
        async function toggleUserStatus(userId) {
            if (!confirm('Are you sure you want to change this user\'s status?')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/admin/users/${userId}/status`, {
                    method: 'PUT'
                });

                const result = await response.json();

                if (result.success) {
                    alert('‚úÖ User status updated successfully!');
                    loadUsers(); // Reload users
                } else {
                    alert('‚ùå Error: ' + (result.message || 'Failed to update user status'));
                }
            } catch (error) {
                console.error('Error toggling user status:', error);
                alert('‚ùå Error updating user status');
            }
        }

        // Change user role
        async function changeUserRole(userId, currentRole) {
            const newRole = prompt('Enter new role (user, agent, admin):', currentRole);

            if (!newRole || newRole === currentRole) {
                return;
            }

            if (!['user', 'agent', 'admin'].includes(newRole.toLowerCase())) {
                alert('‚ùå Invalid role! Use: user, agent, or admin');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/admin/users/${userId}/role`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ role: newRole.toLowerCase() })
                });

                const result = await response.json();

                if (result.success) {
                    alert('‚úÖ User role updated successfully!');
                    loadUsers(); // Reload users
                } else {
                    alert('‚ùå Error: ' + (result.message || 'Failed to update user role'));
                }
            } catch (error) {
                console.error('Error changing user role:', error);
                alert('‚ùå Error updating user role');
            }
        }

        // Reset user password
        async function resetUserPassword(userId, userName) {
            const newPassword = prompt(`Enter new password for ${userName}:`, '');

            if (!newPassword) {
                return;
            }

            if (newPassword.length < 6) {
                alert('‚ùå Password must be at least 6 characters long!');
                return;
            }

            if (!confirm(`Are you sure you want to reset password for ${userName}?`)) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/admin/users/${userId}/reset-password`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ newPassword: newPassword })
                });

                const result = await response.json();

                if (result.success) {
                    alert('‚úÖ Password reset successfully!');
                } else {
                    alert('‚ùå Error: ' + (result.message || 'Failed to reset password'));
                }
            } catch (error) {
                console.error('Error resetting password:', error);
                alert('‚ùå Error resetting password');
            }
        }

        // View login history
        async function viewLoginHistory(userId, userName) {
            try {
                const response = await fetch(`${API_URL}/admin/login-history/${userId}`);
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.message || 'Failed to load login history');
                }

                const data = result.data;
                const loginHistory = data.loginHistory || [];

                let historyHTML = `
                    <div style="background: white; padding: 20px; border-radius: 8px; max-width: 800px; max-height: 80vh; overflow-y: auto;">
                        <h3 style="margin-bottom: 20px; color: #333;">Login History - ${userName}</h3>

                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 6px;">
                            <div>
                                <div style="font-size: 12px; color: #6c757d; margin-bottom: 5px;">Account Age</div>
                                <div style="font-size: 20px; font-weight: bold; color: #28a745;">${data.accountAge || 0} days</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #6c757d; margin-bottom: 5px;">Last Login</div>
                                <div style="font-size: 14px; font-weight: bold; color: #17a2b8;">
                                    ${data.lastLogin ? new Date(data.lastLogin).toLocaleString() : 'Never'}
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #6c757d; margin-bottom: 5px;">Total Logins</div>
                                <div style="font-size: 20px; font-weight: bold; color: #6f42c1;">${data.totalLogins || 0}</div>
                            </div>
                        </div>

                        ${loginHistory.length > 0 ? `
                            <h4 style="margin: 20px 0 10px; color: #555;">Recent Login Activity</h4>
                            <div style="max-height: 400px; overflow-y: auto;">
                                ${loginHistory.map((login, index) => `
                                    <div style="padding: 12px; border: 1px solid #dee2e6; border-radius: 6px; margin-bottom: 10px; background: ${index === 0 ? '#f0f8ff' : 'white'};">
                                        <div style="display: flex; justify-content: space-between; align-items: start;">
                                            <div>
                                                <div style="font-weight: 600; color: #333; margin-bottom: 5px;">
                                                    üìÖ ${new Date(login.timestamp).toLocaleString()}
                                                </div>
                                                <div style="font-size: 13px; color: #6c757d;">
                                                    üåê IP: ${login.ip || 'N/A'}
                                                </div>
                                                <div style="font-size: 13px; color: #6c757d;">
                                                    üíª ${login.userAgent || 'Unknown device'}
                                                </div>
                                            </div>
                                            ${index === 0 ? '<span style="background: #28a745; color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px;">Latest</span>' : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : '<p style="text-align: center; color: #6c757d; padding: 20px;">No login history available</p>'}

                        <button onclick="Swal.close()"
                                style="margin-top: 20px; padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; width: 100%;">
                            Close
                        </button>
                    </div>
                `;

                Swal.fire({
                    html: historyHTML,
                    showConfirmButton: false,
                    width: '850px',
                    padding: 0
                });

            } catch (error) {
                console.error('Error loading login history:', error);
                alert('‚ùå Error: ' + error.message);
            }
        }

        // Delete user
        async function deleteUser(userId, userName) {
            if (!confirm(`‚ö†Ô∏è Are you sure you want to DELETE user "${userName}"?\n\nThis action CANNOT be undone!`)) {
                return;
            }

            // Double confirmation for safety
            const confirmText = prompt(`Type "DELETE" to confirm deletion of ${userName}:`, '');
            if (confirmText !== 'DELETE') {
                alert('‚ùå Deletion cancelled. You must type "DELETE" to confirm.');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/admin/users/${userId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    alert('‚úÖ User deleted successfully!');
                    loadUsers(); // Reload users list
                } else {
                    alert('‚ùå Error: ' + (result.message || 'Failed to delete user'));
                }
            } catch (error) {
                console.error('Error deleting user:', error);
                alert('‚ùå Error deleting user');
            }
        }

        // Open Add User Modal
        function openAddUserModal() {
            document.getElementById('addUserModal').style.display = 'flex';
            document.getElementById('addUserForm').reset();
        }

        // Close Add User Modal
        function closeAddUserModal() {
            document.getElementById('addUserModal').style.display = 'none';
        }

        // Handle Add User Form Submit
        document.addEventListener('DOMContentLoaded', function() {
            const addUserForm = document.getElementById('addUserForm');
            if (addUserForm) {
                addUserForm.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const userData = {
                        name: document.getElementById('userName').value,
                        email: document.getElementById('userEmail').value,
                        phone: document.getElementById('userPhone').value,
                        password: document.getElementById('userPassword').value,
                        role: document.getElementById('userRole').value,
                        isActive: document.getElementById('userIsActive').checked
                    };

                    try {
                        const response = await fetch(`${API_URL}/auth/register`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(userData)
                        });

                        const result = await response.json();

                        if (result.success) {
                            alert('‚úÖ User created successfully!');
                            closeAddUserModal();
                            loadUsers(); // Reload users list
                        } else {
                            alert('‚ùå Error: ' + (result.message || 'Failed to create user'));
                        }
                    } catch (error) {
                        console.error('Error creating user:', error);
                        alert('‚ùå Error creating user: ' + error.message);
                    }
                });
            }
        });

        // ========== CHECK LOGIN STATUS ==========
        function checkLoginStatus() {
            const token = localStorage.getItem('accessToken');
            const user = localStorage.getItem('user');

            if (!token || !user) {
                console.log('‚ùå Not logged in - redirecting to login page');
                window.location.href = '/gofly/admin-login.html';
                return false;
            }

            try {
                const userData = JSON.parse(user);
                if (userData.role !== 'admin') {
                    console.log('‚ùå Not an admin - redirecting to login page');
                    alert('You do not have admin access!');
                    window.location.href = '/gofly/admin-login.html';
                    return false;
                }
                console.log('‚úÖ Logged in as admin:', userData.name);
                return true;
            } catch (err) {
                console.error('Error parsing user data:', err);
                window.location.href = '/gofly/admin-login.html';
                return false;
            }
        }

        // Load tours when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            if (!checkLoginStatus()) {
                return;
            }

            console.log('üöÄ Admin panel loaded - Setting up menu handlers');

            // Setup menu click handlers
            const menuItems = document.querySelectorAll('.menu-item[data-page]');
            console.log(`üìã Found ${menuItems.length} menu items`);

            menuItems.forEach(item => {
                const pageName = item.dataset.page;
                console.log(`‚úÖ Adding click handler for: ${pageName}`);

                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log(`üñ±Ô∏è Clicked menu: ${pageName}`);
                    showPage(pageName);
                });
            });

            // Load initial tours data
            console.log('üìä Loading initial tours...');
            loadTours();

            // Display user name in top header
            try {
                const userData = JSON.parse(localStorage.getItem('user'));
                if (userData && userData.name) {
                    const userNameElements = document.querySelectorAll('.user-name-top');
                    userNameElements.forEach(el => {
                        el.textContent = userData.name;
                    });
                }
            } catch (err) {
                console.error('Error displaying user name:', err);
            }
        });

        // ========== LOGOUT FUNCTION ==========
        function logout() {
            console.log('üö™ Logging out...');

            // Clear localStorage
            localStorage.removeItem('accessToken');
            localStorage.removeItem('refreshToken');
            localStorage.removeItem('user');

            // Optional: Call logout API
            fetch('/api/auth/logout', {
                method: 'POST',
                credentials: 'include'
            }).catch(err => console.error('Logout API error:', err));

            // Redirect to login page
            window.location.href = '/gofly/admin-login.html';
        }
    </script>

    <!-- Image Preview Modal -->
    <div id="imagePreviewModal" class="image-preview-modal">
        <button class="image-preview-close" onclick="closeImagePreview()">√ó</button>
        <div class="image-preview-content">
            <img id="imagePreviewImg" src="" alt="Preview">
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>Add New User</h2>
                <button class="close-modal" onclick="closeAddUserModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" id="userName" placeholder="John Doe" required>
                    </div>

                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" id="userEmail" placeholder="user@example.com" required>
                    </div>

                    <div class="form-group">
                        <label>Phone *</label>
                        <input type="tel" id="userPhone" placeholder="+998901234567" required>
                    </div>

                    <div class="form-group">
                        <label>Password *</label>
                        <input type="password" id="userPassword" placeholder="Min 6 characters" minlength="6" required>
                    </div>

                    <div class="form-group">
                        <label>Role *</label>
                        <select id="userRole" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="user">User - Can browse and book tours</option>
                            <option value="agent">Agent - Can manage tours and bookings</option>
                            <option value="admin">Admin - Full access to everything</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="userIsActive" checked>
                            <span>Active (User can login)</span>
                        </label>
                    </div>

                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <h4 style="margin: 0 0 10px 0; font-size: 14px; color: #333;">üìã Role Permissions:</h4>
                        <div style="font-size: 13px; color: #666; line-height: 1.8;">
                            <div style="margin-bottom: 8px;">
                                <strong style="color: #17a2b8;">üë§ USER:</strong> Browse tours, make bookings, view own profile
                            </div>
                            <div style="margin-bottom: 8px;">
                                <strong style="color: #ffc107;">üéØ AGENT:</strong> Manage tours, handle bookings, customer support
                            </div>
                            <div>
                                <strong style="color: #dc3545;">‚öôÔ∏è ADMIN:</strong> Full system access, manage users, all settings
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="cancel-btn" onclick="closeAddUserModal()">Cancel</button>
                        <button type="submit" class="submit-btn">Create User</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="categoryModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 id="categoryModalTitle">Add New Category</h2>
                <button class="close-modal" onclick="closeCategoryModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="categoryForm">
                    <input type="hidden" id="categoryId">

                    <div class="form-group">
                        <label>Category Name *</label>
                        <input type="text" id="categoryName" placeholder="E.g.: Adventure Tours" required>
                    </div>

                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="categoryDescription" rows="3" placeholder="Brief description about this category"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Icon (Emoji)</label>
                            <input type="text" id="categoryIcon" placeholder="üéØ" maxlength="2">
                        </div>
                        <div class="form-group">
                            <label>Color (Hex)</label>
                            <input type="color" id="categoryColor" value="#667eea">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Order</label>
                        <input type="number" id="categoryOrder" min="0" placeholder="0">
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="categoryIsActive" checked>
                            Active
                        </label>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="cancel-btn" onclick="closeCategoryModal()">Cancel</button>
                        <button type="submit" class="submit-btn">Save Category</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>

        // ==================== LOCATION DATA & FUNCTIONS ====================

        

        // Load cities based on selected country
        window.loadCitiesForBlog = function() {
            const country = document.getElementById('blogCountry').value;
            const citySelect = document.getElementById('blogCity');

            if (!country) {
                citySelect.innerHTML = '<option value="">First select a country...</option>';
                if (typeof updateLocationDisplay === 'function') updateLocationDisplay('', '');
                return;
            }

            const cities = countryCities[country] || [];

            citySelect.innerHTML = '<option value="">Select a city...</option>';
            cities.forEach(city => {
                citySelect.innerHTML += `<option value="${city.name}" data-lat="${city.lat}" data-lng="${city.lng}" data-nameuz="${city.nameUz}">${city.nameUz} (${city.name})</option>`;
            });

            // Reset location display
            updateLocationDisplay('', '');
        }

        // Update coordinates when city is selected
        function updateBlogCoordinates() {
            const citySelect = document.getElementById('blogCity');
            const latEl = document.getElementById('blogLatitude');
            const lngEl = document.getElementById('blogLongitude');
            const locEl = document.getElementById('blogLocation');
            if (!citySelect || !latEl || !lngEl) return;
            const selectedOption = citySelect.options[citySelect.selectedIndex];

            if (!selectedOption.value) {
                updateLocationDisplay('', '');
                return;
            }

            const cityName = selectedOption.value;
            const cityNameUz = selectedOption.dataset.nameuz;
            const lat = selectedOption.dataset.lat;
            const lng = selectedOption.dataset.lng;
            const country = document.getElementById('blogCountry').value;
            const countryName = document.getElementById('blogCountry').options[document.getElementById('blogCountry').selectedIndex].text;

            // Set hidden fields
            document.getElementById('blogLatitude').value = lat;
            document.getElementById('blogLongitude').value = lng;
            document.getElementById('blogLocation').value = `${cityNameUz}, ${countryName.replace(/üá∫üáø|üá∞üáø|üá∞üá¨|üáπüáØ|üáπüá≤/g, '').trim()}`;

            // Update display
            updateLocationDisplay(`${cityNameUz} (${cityName}), ${countryName}`, `Lat: ${lat}, Lng: ${lng}`);
        }

        // Update location display
        function updateLocationDisplay(locationName, coords) {
            const nameEl = document.getElementById('selectedLocationName');
            const coordsEl = document.getElementById('selectedLocationCoords');

            if (!nameEl || !coordsEl) return; // Elements don't exist

            if (!locationName) {
                nameEl.textContent = 'No location selected';
                nameEl.style.color = '#9ca3af';
                coordsEl.textContent = 'Coordinates: -';
            } else {
                nameEl.textContent = locationName;
                nameEl.style.color = '#374151';
                coordsEl.textContent = 'Coordinates: ' + coords;
            }
        }

        // ==================== END LOCATION FUNCTIONS ====================

        // ==================== BLOG CMS JAVASCRIPT ====================
        // ==================== BLOG SYSTEM ====================
        let posts = [];
        let editingPostId = null;
        let featuredImageData = null;
        let galleryImages = [];

        // Load posts
        window.loadPosts = async function() {
            try {
                const res = await fetch('http://localhost:4000/api/blogs');
                const json = await res.json(); posts = json.data.blogs || json.data || [];
                renderPosts();
                updateStats();
            } catch(e) { posts = []; renderPosts(); }
        };

        // Render posts table
        function renderPosts() {
            const tbody = document.getElementById('postsBody');
            if (!tbody) return;
            if (!posts.length) {
                tbody.innerHTML = '<tr><td colspan="7" style="padding: 60px; text-align: center; color: #94a3b8;">No posts yet. Click "New Post" to create one.</td></tr>';
                return;
            }
            tbody.innerHTML = posts.map(function(p) {
                var statusColors = {published: '#22c55e', draft: '#f59e0b', scheduled: '#3b82f6', archived: '#6b7280', private: '#8b5cf6'};
                var statusColor = statusColors[p.status] || '#f59e0b';
                return '<tr style="border-bottom: 1px solid #f1f5f9;">' +
                    '<td style="padding: 14px 16px;"><div style="display: flex; align-items: center; gap: 12px;"><img src="' + (p.image || 'https://via.placeholder.com/50x50') + '" style="width: 50px; height: 50px; object-fit: cover; border-radius: 8px;"><div><p style="margin: 0; font-weight: 600; color: #1e293b;">' + p.title + '</p><p style="margin: 4px 0 0; font-size: 12px; color: #94a3b8;">/blog/' + (p.slug || '') + '</p></div></div></td>' +
                    '<td style="padding: 14px 16px;"><span style="background: #f1f5f9; padding: 4px 10px; border-radius: 6px; font-size: 12px; color: #475569;">' + (p.category || '-') + '</span></td>' +
                    '<td style="padding: 14px 16px; color: #64748b; font-size: 14px;">' + (p.author || 'Admin') + '</td>' +
                    '<td style="padding: 14px 16px;"><span style="background: ' + statusColor + '20; color: ' + statusColor + '; padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 500;">' + (p.status || 'draft') + '</span></td>' +
                    '<td style="padding: 14px 16px; color: #64748b; font-size: 14px;">' + (p.views || 0).toLocaleString() + '</td>' +
                    '<td style="padding: 14px 16px; color: #94a3b8; font-size: 13px;">' + formatDate(p.createdAt) + '</td>' +
                    '<td style="padding: 14px 16px;"><div style="display: flex; gap: 6px;">' +
                        '<button onclick="editPost(\'' + p._id + '\')" title="Edit" style="padding: 8px; background: #eff6ff; color: #3b82f6; border: none; border-radius: 6px; cursor: pointer;">‚úèÔ∏è</button>' +
                        '<button onclick="togglePublish(\'' + p._id + '\')" title="' + (p.status === 'published' ? 'Unpublish' : 'Publish') + '" style="padding: 8px; background: #f0fdf4; color: #22c55e; border: none; border-radius: 6px; cursor: pointer;">' + (p.status === 'published' ? 'üì§' : 'üì•') + '</button>' +
                        '<button onclick="previewPost(\'' + p._id + '\')" title="Preview" style="padding: 8px; background: #faf5ff; color: #8b5cf6; border: none; border-radius: 6px; cursor: pointer;">üëÅÔ∏è</button>' +
                        '<button onclick="deletePost(\'' + p._id + '\')" title="Delete" style="padding: 8px; background: #fef2f2; color: #ef4444; border: none; border-radius: 6px; cursor: pointer;">üóëÔ∏è</button>' +
                    '</div></td></tr>';
            }).join('');
        }

        function formatDate(d) { return d ? new Date(d).toLocaleDateString('en-US', {month: 'short', day: 'numeric', year: 'numeric'}) : '-'; }

        function updateStats() {
            var el = function(id, v) { var e = document.getElementById(id); if(e) e.textContent = v; };
            el('statTotal', posts.length);
            el('statPublished', posts.filter(function(p){return p.status==='published'}).length);
            el('statDraft', posts.filter(function(p){return p.status==='draft'}).length);
            el('statViews', posts.reduce(function(s,p){return s+(p.views||0)},0));
        }

        // Filter posts
        window.filterPosts = function() {
            var search = (document.getElementById('searchPost').value || '').toLowerCase();
            var cat = document.getElementById('filterCat').value;
            var status = document.getElementById('filterStatus').value;
            var filtered = posts.filter(function(p) {
                if (search && p.title.toLowerCase().indexOf(search) === -1) return false;
                if (cat && p.category !== cat) return false;
                if (status && p.status !== status) return false;
                return true;
            });
            var temp = posts; posts = filtered; renderPosts(); posts = temp;
        };

        // Open editor
        window.openPostEditor = function(id) {
            editingPostId = id || null;
            featuredImageData = null;
            galleryImages = [];
            document.getElementById('postEditorModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
            document.getElementById('editorTitle').textContent = id ? 'Edit Post' : 'New Post';

            // Reset form
            ['postTitle','postSlug','postExcerpt','postContent','seoTitle','seoDesc','seoKeywords','canonicalUrl','postTags'].forEach(function(f) {
                var el = document.getElementById(f); if(el) el.value = '';
            });
            document.getElementById('postStatus').value = 'draft';
            document.getElementById('postCategory').value = '';
            document.getElementById('featuredPreview').style.display = 'none';
            document.getElementById('galleryPreview').innerHTML = '';
            document.getElementById('scheduleDate').style.display = 'none';

            if (id) {
                var post = posts.find(function(p) { return p._id === id; });
                if (post) {
                    document.getElementById('postTitle').value = post.title || '';
                    document.getElementById('postSlug').value = post.slug || '';
                    document.getElementById('postExcerpt').value = post.excerpt || '';
                    document.getElementById('postContent').value = post.content || '';
                    document.getElementById('postStatus').value = post.status || 'draft';
                    document.getElementById('postCategory').value = post.category || '';
                    document.getElementById('postTags').value = (post.tags || []).join(', ');
                    document.getElementById('seoTitle').value = post.seoTitle || '';
                    document.getElementById('seoDesc').value = post.metaDescription || '';
                    document.getElementById('seoKeywords').value = post.keywords || '';
                    if (post.image) {
                        document.getElementById('featuredImg').src = post.image;
                        document.getElementById('featuredPreview').style.display = 'block';
                        featuredImageData = post.image;
                    }
                }
            }
        };

        window.closePostEditor = function() {
            document.getElementById('postEditorModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        };

        // Generate slug
        window.generateSlug = function() {
            var title = document.getElementById('postTitle').value;
            document.getElementById('postSlug').value = title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/-+/g, '-').replace(/^-|-$/g, '');
        };

        // Toggle schedule
        window.toggleSchedule = function() {
            document.getElementById('scheduleDate').style.display = document.getElementById('postStatus').value === 'scheduled' ? 'block' : 'none';
        };

        // Save post
        window.savePost = async function(status) {
            var title = document.getElementById('postTitle').value.trim();
            if (!title) { alert('Title is required'); return; }

            var data = {
                title: title,
                slug: document.getElementById('postSlug').value || title.toLowerCase().replace(/[^a-z0-9]+/g, '-'),
                excerpt: document.getElementById('postExcerpt').value,
                content: document.getElementById('postContent').value,
                category: document.getElementById('postCategory').value,
                tags: document.getElementById('postTags').value.split(',').map(function(t){return t.trim()}).filter(Boolean),
                status: status || document.getElementById('postStatus').value,
                seoTitle: document.getElementById('seoTitle').value,
                metaDescription: document.getElementById('seoDesc').value,
                keywords: document.getElementById('seoKeywords').value,
                canonicalUrl: document.getElementById('canonicalUrl').value,
                image: featuredImageData,
                gallery: galleryImages
            };

            if (data.status === 'scheduled') {
                data.publishDate = document.getElementById('publishDate').value;
            }

            try {
                var url = editingPostId ? 'http://localhost:4000/api/blogs/' + editingPostId : 'http://localhost:4000/api/blogs';
                await fetch(url, {
                    method: editingPostId ? 'PUT' : 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                alert('Post saved!');
                closePostEditor();
                loadPosts();
            } catch(e) { alert('Error saving post'); }
        };

        // Edit post
        window.editPost = function(id) { openPostEditor(id); };

        // Delete post
        window.deletePost = async function(id) {
            if (!confirm('Delete this post?')) return;
            try {
                await fetch('http://localhost:4000/api/blogs/' + id, {method: 'DELETE'});
                loadPosts();
            } catch(e) { alert('Error'); }
        };

        // Toggle publish
        window.togglePublish = async function(id) {
            var post = posts.find(function(p){return p._id===id});
            if (!post) return;
            try {
                await fetch('http://localhost:4000/api/blogs/' + id, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({status: post.status === 'published' ? 'draft' : 'published'})
                });
                loadPosts();
            } catch(e) {}
        };

        // Preview post
        window.previewPost = function(id) {
            window.open('/gofly/blog-details.html?id=' + id, '_blank');
        };

        // Featured image
        window.previewFeatured = function(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    featuredImageData = e.target.result;
                    document.getElementById('featuredImg').src = e.target.result;
                    document.getElementById('featuredPreview').style.display = 'block';
                };
                reader.readAsDataURL(input.files[0]);
            }
        };

        window.removeFeatured = function() {
            featuredImageData = null;
            document.getElementById('featuredPreview').style.display = 'none';
            document.getElementById('featuredInput').value = '';
        };

        // Gallery
        window.previewGallery = function(input) {
            if (input.files) {
                Array.from(input.files).forEach(function(file) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        galleryImages.push(e.target.result);
                        renderGalleryPreview();
                    };
                    reader.readAsDataURL(file);
                });
            }
        };

        function renderGalleryPreview() {
            var container = document.getElementById('galleryPreview');
            container.innerHTML = galleryImages.map(function(img, i) {
                return '<div style="position: relative;"><img src="' + img + '" style="width: 100%; height: 60px; object-fit: cover; border-radius: 6px;"><button onclick="removeGalleryImg(' + i + ')" style="position: absolute; top: -5px; right: -5px; width: 18px; height: 18px; background: #ef4444; color: white; border: none; border-radius: 50%; font-size: 10px; cursor: pointer;">x</button></div>';
            }).join('');
        }

        window.removeGalleryImg = function(i) {
            galleryImages.splice(i, 1);
            renderGalleryPreview();
        };

        // Format text
        window.formatText = function(type) {
            var textarea = document.getElementById('postContent');
            var start = textarea.selectionStart;
            var end = textarea.selectionEnd;
            var text = textarea.value.substring(start, end);
            var before = textarea.value.substring(0, start);
            var after = textarea.value.substring(end);
            var newText = '';

            switch(type) {
                case 'bold': newText = '**' + text + '**'; break;
                case 'italic': newText = '*' + text + '*'; break;
                case 'underline': newText = '<u>' + text + '</u>'; break;
                case 'h2': newText = '## ' + text; break;
                case 'h3': newText = '### ' + text; break;
                case 'ul': newText = '- ' + text; break;
                case 'link': newText = '[' + text + '](url)'; break;
                default: newText = text;
            }
            textarea.value = before + newText + after;
            textarea.focus();
        };

        // Generate SEO
        window.generateSEO = function() {
            var title = document.getElementById('postTitle').value;
            var content = document.getElementById('postContent').value;
            if (!title) { alert('Enter title first'); return; }

            document.getElementById('seoTitle').value = title + ' | Travel Bliss';
            document.getElementById('seoDesc').value = content ? content.substring(0, 150) + '...' : 'Read about ' + title + ' on Travel Bliss blog.';
            document.getElementById('seoKeywords').value = title.toLowerCase().split(' ').slice(0, 5).join(', ');
        };



        // blogData already declared above

    
// AI SEO Generator Function
window.generateAISEO = function() {
    const statusEl = document.getElementById('aiSeoStatus');
    statusEl.innerHTML = '‚è≥ SEO generatsiya qilinmoqda...';

    // Get all blog data from all steps
    const title = document.getElementById('blogTitle')?.value || '';
    const excerpt = document.getElementById('blogExcerpt')?.value || '';
    const content = document.getElementById('blogContent')?.value || '';
    const category = document.getElementById('blogCategory')?.value || '';
    const country = document.getElementById('blogCountry')?.value || '';
    const city = document.getElementById('blogCity')?.value || '';

    if (!title) {
        statusEl.innerHTML = '‚ùå Iltimos, avval blog sarlavhasini kiriting!';
        return;
    }

    // Simulate AI processing delay
    setTimeout(() => {
        // Generate smart SEO data
        const seoData = generateSmartSEO(title, excerpt, content, category, country, city);

        // Fill SEO fields
        const metaDescEl = document.getElementById('blogMetaDescription');
        const keywordsEl = document.getElementById('blogKeywords');
        const slugEl = document.getElementById('blogSlug');
        const readingTimeEl = document.getElementById('blogReadingTime');

        if (metaDescEl) metaDescEl.value = seoData.metaDescription;
        if (keywordsEl) keywordsEl.value = seoData.keywords;
        if (slugEl) slugEl.value = seoData.slug;
        if (readingTimeEl) readingTimeEl.value = seoData.readingTime;

        statusEl.innerHTML = '‚úÖ SEO muvaffaqiyatli yaratildi! (Step 2 da tekshiring)';

        // Show success notification
        showSEONotification(seoData);
    }, 1500);
}

function generateSmartSEO(title, excerpt, content, category, country, city) {
    // Generate slug from title
    const slug = title
        .toLowerCase()
        .replace(/[^a-z0-9\s-]/g, '')
        .replace(/\s+/g, '-')
        .replace(/-+/g, '-')
        .trim();

    // Calculate reading time (average 200 words per minute)
    const wordCount = (content + ' ' + excerpt).split(/\s+/).filter(w => w).length;
    const readingTime = Math.max(1, Math.ceil(wordCount / 200));

    // Generate keywords based on all content
    const keywords = generateKeywords(title, excerpt, content, category, country, city);

    // Generate meta description
    const metaDescription = generateMetaDescription(title, excerpt, category, country, city);

    return {
        slug,
        readingTime,
        keywords,
        metaDescription
    };
}

function generateKeywords(title, excerpt, content, category, country, city) {
    const allText = (title + ' ' + excerpt + ' ' + content).toLowerCase();

    // Common travel keywords
    const travelKeywords = ['travel', 'tour', 'trip', 'vacation', 'holiday', 'adventure', 'explore', 'destination', 'journey'];

    // Category-based keywords
    const categoryKeywords = {
        'adventure': ['adventure', 'extreme', 'thrill', 'outdoor', 'hiking', 'trekking'],
        'beach-holidays': ['beach', 'ocean', 'sea', 'sand', 'resort', 'tropical', 'island'],
        'cultural-tours': ['culture', 'history', 'heritage', 'museum', 'tradition', 'local'],
        'city-breaks': ['city', 'urban', 'downtown', 'shopping', 'nightlife', 'sightseeing'],
        'nature': ['nature', 'wildlife', 'forest', 'mountain', 'landscape', 'scenic'],
        'food-travel': ['food', 'cuisine', 'restaurant', 'culinary', 'gastronomy', 'taste']
    };

    // Start with location
    let keywords = [];
    if (city) keywords.push(city.toLowerCase());
    if (country) keywords.push(country);

    // Add category keywords
    if (category && categoryKeywords[category]) {
        keywords = keywords.concat(categoryKeywords[category].slice(0, 3));
    }

    // Extract important words from title
    const titleWords = title.toLowerCase().split(/\s+/)
        .filter(w => w.length > 4 && !['the', 'and', 'for', 'with', 'this', 'that', 'from'].includes(w));
    keywords = keywords.concat(titleWords.slice(0, 3));

    // Add some travel keywords
    keywords = keywords.concat(travelKeywords.slice(0, 2));

    // Remove duplicates and join
    keywords = [...new Set(keywords)].slice(0, 10);

    return keywords.join(', ');
}

function generateMetaDescription(title, excerpt, category, country, city) {
    let description = '';

    // Use excerpt if available
    if (excerpt && excerpt.length > 50) {
        description = excerpt.substring(0, 150);
    } else {
        // Generate based on title and location
        const location = city ? city + (country ? ', ' + country : '') : country || '';
        const categoryNames = {
            'adventure': 'adventure travel',
            'beach-holidays': 'beach vacation',
            'cultural-tours': 'cultural experience',
            'city-breaks': 'city exploration',
            'nature': 'nature discovery',
            'food-travel': 'culinary journey'
        };

        const catName = categoryNames[category] || 'travel experience';

        if (location) {
            description = `Discover ${title}. Your ultimate ${catName} guide to ${location}. Plan your perfect trip with expert tips and recommendations.`;
        } else {
            description = `${title} - Your complete ${catName} guide. Expert tips, recommendations, and everything you need for an unforgettable journey.`;
        }
    }

    // Ensure max 160 characters
    if (description.length > 160) {
        description = description.substring(0, 157) + '...';
    }

    return description;
}

function showSEONotification(seoData) {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        padding: 20px 25px;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        z-index: 10001;
        max-width: 350px;
        animation: slideIn 0.3s ease;
    `;

    notification.innerHTML = `
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
            <span style="font-size: 24px;">ü§ñ</span>
            <strong style="color: #667eea;">AI SEO Yaratildi!</strong>
        </div>
        <div style="font-size: 13px; color: #666; line-height: 1.6;">
            <div style="margin-bottom: 8px;"><strong>üìù Slug:</strong> ${seoData.slug.substring(0, 30)}...</div>
            <div style="margin-bottom: 8px;"><strong>üè∑Ô∏è Keywords:</strong> ${seoData.keywords.substring(0, 40)}...</div>
            <div style="margin-bottom: 8px;"><strong>‚è±Ô∏è Reading:</strong> ${seoData.readingTime} min</div>
        </div>
        <button onclick="this.parentElement.remove()" style="
            margin-top: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            width: 100%;
        ">OK</button>
    `;

    document.body.appendChild(notification);

    // Auto remove after 5 seconds
    setTimeout(() => {
        if (notification.parentElement) {
            notification.remove();
        }
    }, 5000);
}


</script>

<script>

window.renderBlogs = function() {
    const container = document.getElementById('blogGridView');
    if (!container) return;

    if (!blogData || blogData.length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;"><p>Bloglar topilmadi</p></div>';
        return;
    }

    container.innerHTML = blogData.map(blog => `
        <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <div style="height: 150px; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center;">
                <span style="font-size: 40px;">üìù</span>
            </div>
            <div style="padding: 20px;">
                <span style="background: ${blog.status === 'published' ? '#22c55e' : '#f59e0b'}; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px;">${blog.status}</span>
                <h3 style="margin: 10px 0; font-size: 16px;">${blog.title}</h3>
                <p style="color: #666; font-size: 13px; margin: 0;">${blog.excerpt ? blog.excerpt.substring(0, 80) + '...' : ''}</p>
                <div style="margin-top: 15px; display: flex; gap: 8px;">
                    <button onclick="viewBlog('${blog._id}')" style="padding: 6px 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">üëÅ View</button>
                    <button onclick="openBlogModal('${blog._id}')" style="padding: 6px 12px; background: #f59e0b; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">‚úè Edit</button>
                    <button onclick="deleteBlog('${blog._id}')" style="padding: 6px 12px; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">üóë Delete</button>
                </div>
            </div>
        </div>
    `).join('');
}

window.updateBlogStats = function() {
    const total = blogData.length;
    const published = blogData.filter(b => b.status === 'published').length;
    const draft = blogData.filter(b => b.status === 'draft').length;

    const totalEl = document.getElementById('statTotalPosts');
    const pubEl = document.getElementById('statPublished');
    const draftEl = document.getElementById('statDraft');

    if (totalEl) totalEl.textContent = total;
    if (pubEl) pubEl.textContent = published;
    if (draftEl) draftEl.textContent = draft;
}

window.viewBlog = function(blogId) {
    window.open('/gofly/blog-details.html?id=' + blogId, '_blank');
}

window.deleteBlog = async function(blogId) {
    if (!confirm('Blogni o\'chirmoqchimisiz?')) return;

    try {
        const res = await fetch('http://localhost:4000/api/blogs/' + blogId, { method: 'DELETE' });
        const data = await res.json();
        if (data.success) {
            alert('Blog o\'chirildi!');
            window.loadPosts();
        }
    } catch (e) {
        alert('Xatolik!');
    }
}

// Initialize blog page
function initBlogPage() {
    window.loadPosts();
}

// ==================== REVIEWS MANAGEMENT ====================
var reviewsData = [];
var currentReviewId = null;
var currentPage = 1;
var reviewsPerPage = 10;
var selectedReviews = new Set();

// Mock Reviews Data
var mockReviews = [
    {
        id: '1',
        userName: 'John Smith',
        userEmail: 'john.smith@email.com',
        userAvatar: 'https://randomuser.me/api/portraits/men/1.jpg',
        rating: 5,
        reviewText: 'Amazing experience! The Samarkand tour was absolutely breathtaking. Our guide was knowledgeable and the historical sites were magnificent. Highly recommend this to anyone visiting Uzbekistan!',
        service: 'Samarkand Tour',
        category: 'Tours',
        status: 'approved',
        date: '2025-11-20T10:30:00',
        images: [],
        adminReply: '',
        ai: { sentiment: 'positive', spamScore: 0.05, toxic: false, recommendation: 'Approve - Genuine positive review' }
    },
    {
        id: '2',
        userName: 'Maria Garcia',
        userEmail: 'maria.g@email.com',
        userAvatar: 'https://randomuser.me/api/portraits/women/2.jpg',
        rating: 4,
        reviewText: 'Great tour overall. The Bukhara historical sites were fascinating. Only giving 4 stars because the lunch could have been better. But the guide was excellent!',
        service: 'Bukhara Tour',
        category: 'Tours',
        status: 'approved',
        date: '2025-11-19T14:20:00',
        images: [],
        adminReply: 'Thank you for your feedback! We will improve our lunch options.',
        ai: { sentiment: 'positive', spamScore: 0.08, toxic: false, recommendation: 'Approve - Constructive feedback' }
    },
    {
        id: '3',
        userName: 'Ahmed Hassan',
        userEmail: 'ahmed.h@email.com',
        userAvatar: 'https://randomuser.me/api/portraits/men/3.jpg',
        rating: 5,
        reviewText: 'The Silk Road Package was worth every penny! 7 days of incredible adventures, beautiful scenery, and amazing hospitality. Will definitely book again!',
        service: 'Silk Road Package',
        category: 'Packages',
        status: 'approved',
        date: '2025-11-18T09:15:00',
        images: [],
        adminReply: '',
        ai: { sentiment: 'positive', spamScore: 0.03, toxic: false, recommendation: 'Approve - Excellent review' }
    },
    {
        id: '4',
        userName: 'Test User',
        userEmail: 'test@test.com',
        userAvatar: 'https://randomuser.me/api/portraits/men/4.jpg',
        rating: 1,
        reviewText: 'BUY CHEAP PRODUCTS HERE!!! Click this link: spam.com/fake Best prices guaranteed!!!',
        service: 'Hotel Booking',
        category: 'Hotels',
        status: 'spam',
        date: '2025-11-21T02:30:00',
        images: [],
        adminReply: '',
        ai: { sentiment: 'neutral', spamScore: 0.95, toxic: false, recommendation: 'Reject - Spam detected' }
    },
    {
        id: '5',
        userName: 'Sophie Chen',
        userEmail: 'sophie.chen@email.com',
        userAvatar: 'https://randomuser.me/api/portraits/women/5.jpg',
        rating: 5,
        reviewText: 'Wonderful cultural experience! The local guides shared so much knowledge about Uzbek traditions. The food tours were a highlight. Thank you Travel Bliss!',
        service: 'Samarkand Tour',
        category: 'Tours',
        status: 'pending',
        date: '2025-11-21T08:45:00',
        images: [],
        adminReply: '',
        ai: { sentiment: 'positive', spamScore: 0.02, toxic: false, recommendation: 'Approve - Genuine review' }
    },
    {
        id: '6',
        userName: 'Robert Brown',
        userEmail: 'r.brown@email.com',
        userAvatar: 'https://randomuser.me/api/portraits/men/6.jpg',
        rating: 2,
        reviewText: 'Disappointing experience. The hotel was not as described and the tour bus was late. Expected better service for the price paid.',
        service: 'Hotel Booking',
        category: 'Hotels',
        status: 'pending',
        date: '2025-11-21T11:00:00',
        images: [],
        adminReply: '',
        ai: { sentiment: 'negative', spamScore: 0.12, toxic: false, recommendation: 'Review - Legitimate complaint' }
    },
    {
        id: '7',
        userName: 'Elena Petrov',
        userEmail: 'elena.p@email.com',
        userAvatar: 'https://randomuser.me/api/portraits/women/7.jpg',
        rating: 4,
        reviewText: 'Nice experience overall. The Bukhara architecture is stunning. Would have loved more free time to explore on our own.',
        service: 'Bukhara Tour',
        category: 'Tours',
        status: 'approved',
        date: '2025-11-17T16:30:00',
        images: [],
        adminReply: '',
        ai: { sentiment: 'positive', spamScore: 0.05, toxic: false, recommendation: 'Approve - Good feedback' }
    },
    {
        id: '8',
        userName: 'David Kim',
        userEmail: 'david.k@email.com',
        userAvatar: 'https://randomuser.me/api/portraits/men/8.jpg',
        rating: 5,
        reviewText: 'Best travel agency I have ever used! From booking to the actual trip, everything was seamless. The team is professional and caring.',
        service: 'Silk Road Package',
        category: 'Packages',
        status: 'approved',
        date: '2025-11-16T13:20:00',
        images: [],
        adminReply: 'Thank you so much David! We look forward to hosting you again!',
        ai: { sentiment: 'positive', spamScore: 0.04, toxic: false, recommendation: 'Approve - Highly positive' }
    },
    {
        id: '9',
        userName: 'Anonymous',
        userEmail: 'anon@temp.com',
        userAvatar: 'https://randomuser.me/api/portraits/lego/1.jpg',
        rating: 1,
        reviewText: 'This is terrible awful horrible bad worst ever never again hate it completely useless garbage trash waste of money scam fraud',
        service: 'Samarkand Tour',
        category: 'Tours',
        status: 'rejected',
        date: '2025-11-20T22:15:00',
        images: [],
        adminReply: '',
        ai: { sentiment: 'negative', spamScore: 0.78, toxic: true, recommendation: 'Reject - Toxic/spam pattern detected' }
    },
    {
        id: '10',
        userName: 'Lisa Wang',
        userEmail: 'lisa.w@email.com',
        userAvatar: 'https://randomuser.me/api/portraits/women/10.jpg',
        rating: 3,
        reviewText: 'Average experience. Nothing special but nothing terrible either. The tour was okay, hotel was decent. Might try a different package next time.',
        service: 'Hotel Booking',
        category: 'Hotels',
        status: 'approved',
        date: '2025-11-15T10:00:00',
        images: [],
        adminReply: '',
        ai: { sentiment: 'neutral', spamScore: 0.06, toxic: false, recommendation: 'Approve - Neutral honest review' }
    }
];

// Initialize reviews

window.openNewReviewModal = function() {
    var name = prompt("User name:");
    if (!name) return;
    var rating = prompt("Rating (1-5):", "5");
    var text = prompt("Review text:");
    if (!text) return;
    var service = prompt("Service:", "Samarkand Tour");
    var newReview = {
        id: String(Date.now()),
        userName: name,
        userEmail: name.toLowerCase().replace(/ /g, ".") + "@email.com",
        userAvatar: "https://i.pravatar.cc/150?img=" + Math.floor(Math.random()*70),
        rating: parseInt(rating) || 5,
        reviewText: text,
        service: service || "Samarkand Tour",
        category: "Tours",
        status: "pending",
        date: new Date().toISOString(),
        images: [],
        adminReply: "",
        ai: { sentiment: "positive", spamScore: 0.05, toxic: false, recommendation: "Pending review" }
    };
    mockReviews.unshift(newReview);
    reviewsData = [...mockReviews];
    renderReviewsTable();
    updateReviewStats();
    renderRatingDistribution();
    renderMostReviewed();
    alert("Review added!");
};
window.initReviews = function() {
    reviewsData = [...mockReviews];
    renderReviewsTable();
    updateReviewStats();
    renderRatingDistribution();
    renderMostReviewed();
};

// Render reviews table
function renderReviewsTable() {
    var tbody = document.getElementById('reviewsTableBody');
    if (!tbody) return;

    var start = (currentPage - 1) * reviewsPerPage;
    var end = start + reviewsPerPage;
    var pageReviews = reviewsData.slice(start, end);

    if (!pageReviews.length) {
        tbody.innerHTML = '<tr><td colspan="9" style="padding: 60px; text-align: center; color: #94a3b8;">No reviews found</td></tr>';
        return;
    }

    tbody.innerHTML = pageReviews.map(function(r) {
        var statusColors = {approved: '#22c55e', pending: '#f59e0b', rejected: '#ef4444', spam: '#64748b'};
        var statusBgs = {approved: '#dcfce7', pending: '#fef3c7', rejected: '#fee2e2', spam: '#f1f5f9'};
        var sentimentColors = {positive: '#22c55e', neutral: '#f59e0b', negative: '#ef4444'};
        var stars = '';
        for (var i = 0; i < 5; i++) stars += i < r.rating ? '‚≠ê' : '‚òÜ';

        return '<tr style="border-bottom: 1px solid #f1f5f9;">' +
            '<td style="padding: 14px 16px;"><input type="checkbox" class="review-checkbox" data-id="' + r.id + '" onchange="toggleReviewSelect(this)"></td>' +
            '<td style="padding: 14px 16px;"><div style="display: flex; align-items: center; gap: 10px;"><img src="' + r.userAvatar + '" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;"><div><p style="margin: 0; font-weight: 600; color: #1e293b; font-size: 14px;">' + r.userName + '</p><p style="margin: 2px 0 0; font-size: 12px; color: #94a3b8;">' + r.userEmail + '</p></div></div></td>' +
            '<td style="padding: 14px 16px; font-size: 14px;">' + stars + '</td>' +
            '<td style="padding: 14px 16px; max-width: 250px;"><p style="margin: 0; color: #475569; font-size: 13px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">' + r.reviewText.substring(0, 80) + '...</p></td>' +
            '<td style="padding: 14px 16px;"><span style="background: #f1f5f9; padding: 4px 10px; border-radius: 6px; font-size: 12px; color: #475569;">' + r.service + '</span></td>' +
            '<td style="padding: 14px 16px;"><span style="background: ' + statusBgs[r.status] + '; color: ' + statusColors[r.status] + '; padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 500;">' + r.status + '</span></td>' +
            '<td style="padding: 14px 16px;"><span style="color: ' + sentimentColors[r.ai.sentiment] + '; font-size: 12px;">' + r.ai.sentiment + '</span></td>' +
            '<td style="padding: 14px 16px; color: #94a3b8; font-size: 13px;">' + new Date(r.date).toLocaleDateString() + '</td>' +
            '<td style="padding: 14px 16px;"><div style="display: flex; gap: 4px;">' +
                '<button onclick="approveReview(\'' + r.id + '\')" title="Approve" style="padding: 6px; background: #dcfce7; color: #22c55e; border: none; border-radius: 6px; cursor: pointer;">‚úì</button>' +
                '<button onclick="rejectReview(\'' + r.id + '\')" title="Reject" style="padding: 6px; background: #fee2e2; color: #ef4444; border: none; border-radius: 6px; cursor: pointer;">‚úó</button>' +
                '<button onclick="openReviewDetail(\'' + r.id + '\')" title="View" style="padding: 6px; background: #eff6ff; color: #3b82f6; border: none; border-radius: 6px; cursor: pointer;">üëÅ</button>' +
                '<button onclick="deleteReview(\'' + r.id + '\')" title="Delete" style="padding: 6px; background: #f1f5f9; color: #64748b; border: none; border-radius: 6px; cursor: pointer;">üóë</button>' +
            '</div></td></tr>';
    }).join('');

    updatePagination();
}

// Update stats
function updateReviewStats() {
    var el = function(id, v) { var e = document.getElementById(id); if(e) e.textContent = v; };
    var total = reviewsData.length;
    var avgRating = total ? (reviewsData.reduce(function(s,r){return s+r.rating},0) / total).toFixed(1) : '0.0';
    var today = new Date().toDateString();
    var todayCount = reviewsData.filter(function(r){return new Date(r.date).toDateString() === today}).length;
    var pending = reviewsData.filter(function(r){return r.status === 'pending'}).length;
    var spam = reviewsData.filter(function(r){return r.status === 'spam'}).length;

    el('statTotalReviews', total);
    el('statAvgRating', avgRating);
    el('statTodayReviews', todayCount);
    el('statPendingReviews', pending);
    el('statSpamReviews', spam);
    el('totalReviewsCount', total);
}

// Rating distribution chart
function renderRatingDistribution() {
    var container = document.getElementById('ratingDistribution');
    if (!container) return;

    var counts = [0, 0, 0, 0, 0];
    reviewsData.forEach(function(r) { counts[r.rating - 1]++; });
    var max = Math.max.apply(null, counts) || 1;

    var html = '';
    for (var i = 5; i >= 1; i--) {
        var count = counts[i - 1];
        var pct = (count / max) * 100;
        html += '<div style="display: flex; align-items: center; gap: 10px;">' +
            '<span style="width: 60px; font-size: 13px; color: #475569;">' + i + ' stars</span>' +
            '<div style="flex: 1; background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden;">' +
                '<div style="width: ' + pct + '%; height: 100%; background: #f59e0b; border-radius: 4px;"></div>' +
            '</div>' +
            '<span style="width: 30px; font-size: 13px; color: #64748b; text-align: right;">' + count + '</span>' +
        '</div>';
    }
    container.innerHTML = html;
}

// Most reviewed services
function renderMostReviewed() {
    var container = document.getElementById('mostReviewed');
    if (!container) return;

    var services = {};
    reviewsData.forEach(function(r) {
        if (!services[r.service]) services[r.service] = {count: 0, rating: 0};
        services[r.service].count++;
        services[r.service].rating += r.rating;
    });

    var arr = Object.keys(services).map(function(s) {
        return {name: s, count: services[s].count, avgRating: (services[s].rating / services[s].count).toFixed(1)};
    }).sort(function(a,b){return b.count - a.count}).slice(0, 5);

    container.innerHTML = arr.map(function(s) {
        return '<div style="display: flex; align-items: center; justify-content: space-between; padding: 10px; background: #f8fafc; border-radius: 8px;">' +
            '<span style="font-weight: 500; color: #1e293b;">' + s.name + '</span>' +
            '<div style="display: flex; align-items: center; gap: 15px;">' +
                '<span style="color: #64748b; font-size: 13px;">' + s.count + ' reviews</span>' +
                '<span style="color: #f59e0b;">‚≠ê ' + s.avgRating + '</span>' +
            '</div>' +
        '</div>';
    }).join('');
}

// Pagination
function updatePagination() {
    var container = document.getElementById('paginationBtns');
    if (!container) return;

    var totalPages = Math.ceil(reviewsData.length / reviewsPerPage);
    var html = '';
    for (var i = 1; i <= totalPages; i++) {
        html += '<button onclick="goToPage(' + i + ')" style="padding: 8px 14px; background: ' + (i === currentPage ? '#3b82f6' : '#f1f5f9') + '; color: ' + (i === currentPage ? 'white' : '#475569') + '; border: none; border-radius: 6px; cursor: pointer;">' + i + '</button>';
    }
    container.innerHTML = html;

    var from = (currentPage - 1) * reviewsPerPage + 1;
    var to = Math.min(currentPage * reviewsPerPage, reviewsData.length);
    var fromEl = document.getElementById('showingFrom');
    var toEl = document.getElementById('showingTo');
    if (fromEl) fromEl.textContent = from;
    if (toEl) toEl.textContent = to;
}

window.goToPage = function(page) {
    currentPage = page;
    renderReviewsTable();
};

// Filter reviews
window.filterReviews = function() {
    var search = (document.getElementById('searchReviews').value || '').toLowerCase();
    var rating = document.getElementById('filterRating').value;
    var status = document.getElementById('filterStatus').value;
    var service = document.getElementById('filterService').value;

    reviewsData = mockReviews.filter(function(r) {
        if (search && r.reviewText.toLowerCase().indexOf(search) === -1 && r.userName.toLowerCase().indexOf(search) === -1) return false;
        if (rating && r.rating !== parseInt(rating)) return false;
        if (status && r.status !== status) return false;
        if (service && r.service !== service) return false;
        return true;
    });

    currentPage = 1;
    renderReviewsTable();
    updateReviewStats();
};

// Review actions
window.approveReview = function(id) {
    var r = reviewsData.find(function(x){return x.id === id});
    if (r) { r.status = 'approved'; renderReviewsTable(); updateReviewStats(); }
};

window.rejectReview = function(id) {
    var r = reviewsData.find(function(x){return x.id === id});
    if (r) { r.status = 'rejected'; renderReviewsTable(); updateReviewStats(); }
};

window.deleteReview = function(id) {
    if (!confirm('Delete this review?')) return;
    reviewsData = reviewsData.filter(function(x){return x.id !== id});
    var idx = mockReviews.findIndex(function(x){return x.id === id});
    if (idx > -1) mockReviews.splice(idx, 1);
    renderReviewsTable();
    updateReviewStats();
    renderRatingDistribution();
    renderMostReviewed();
};

// Review detail modal
window.openReviewDetail = function(id) {
    currentReviewId = id;
    var r = reviewsData.find(function(x){return x.id === id});
    if (!r) return;

    document.getElementById('modalUserAvatar').src = r.userAvatar;
    document.getElementById('modalUserName').textContent = r.userName;
    document.getElementById('modalUserEmail').textContent = r.userEmail;
    document.getElementById('modalRating').textContent = '‚≠ê'.repeat(r.rating) + '‚òÜ'.repeat(5 - r.rating);
    document.getElementById('modalDate').textContent = new Date(r.date).toLocaleString();
    document.getElementById('modalService').textContent = r.service + ' (' + r.category + ')';
    document.getElementById('modalReviewText').textContent = r.reviewText;
    document.getElementById('modalAdminReply').value = r.adminReply || '';

    var sentColors = {positive: '#22c55e', neutral: '#f59e0b', negative: '#ef4444'};
    document.getElementById('modalSentiment').textContent = r.ai.sentiment;
    document.getElementById('modalSentiment').style.color = sentColors[r.ai.sentiment];
    document.getElementById('modalSpamScore').textContent = (r.ai.spamScore * 100).toFixed(0) + '%';
    document.getElementById('modalSpamScore').style.color = r.ai.spamScore > 0.5 ? '#ef4444' : '#22c55e';
    document.getElementById('modalToxic').textContent = r.ai.toxic ? 'Yes' : 'No';
    document.getElementById('modalToxic').style.color = r.ai.toxic ? '#ef4444' : '#22c55e';
    document.getElementById('modalAIRecommendation').textContent = 'üí° ' + r.ai.recommendation;

    document.querySelectorAll('.status-btn').forEach(function(btn) {
        btn.style.borderColor = btn.dataset.status === r.status ? '#3b82f6' : 'transparent';
    });

    document.getElementById('reviewDetailModal').style.display = 'block';
};

window.closeReviewModal = function() {
    document.getElementById('reviewDetailModal').style.display = 'none';
    currentReviewId = null;
};

window.changeReviewStatus = function(status) {
    if (!currentReviewId) return;
    var r = reviewsData.find(function(x){return x.id === currentReviewId});
    if (r) {
        r.status = status;
        document.querySelectorAll('.status-btn').forEach(function(btn) {
            btn.style.borderColor = btn.dataset.status === status ? '#3b82f6' : 'transparent';
        });
        renderReviewsTable();
        updateReviewStats();
    }
};

window.saveAdminReply = function() {
    if (!currentReviewId) return;
    var r = reviewsData.find(function(x){return x.id === currentReviewId});
    if (r) {
        r.adminReply = document.getElementById('modalAdminReply').value;
        alert('Reply saved!');
    }
};

// Settings modal
window.openReviewSettings = function() {
    var modal = document.getElementById('reviewSettingsModal');
    if (modal) { modal.style.display = 'block'; } else { alert('Settings modal not found'); }
};

window.closeSettingsModal = function() {
    document.getElementById('reviewSettingsModal').style.display = 'none';
};

window.saveSettings = function() {
    alert('Settings saved!');
    closeSettingsModal();
};

// Bulk actions
window.toggleSelectAll = function() {
    var checked = document.getElementById('selectAllReviews').checked;
    document.querySelectorAll('.review-checkbox').forEach(function(cb) {
        cb.checked = checked;
        if (checked) selectedReviews.add(cb.dataset.id);
        else selectedReviews.delete(cb.dataset.id);
    });
    updateBulkBar();
};

window.toggleReviewSelect = function(cb) {
    if (cb.checked) selectedReviews.add(cb.dataset.id);
    else selectedReviews.delete(cb.dataset.id);
    updateBulkBar();
};

function updateBulkBar() {
    var bar = document.getElementById('bulkActionsBar');
    var count = document.getElementById('selectedCount');
    if (bar) bar.style.display = selectedReviews.size > 0 ? 'flex' : 'none';
    if (count) count.textContent = selectedReviews.size;
}

window.bulkAction = function(action) {
    if (!selectedReviews.size) return;

    selectedReviews.forEach(function(id) {
        var r = reviewsData.find(function(x){return x.id === id});
        if (!r) return;

        if (action === 'approve') r.status = 'approved';
        else if (action === 'reject') r.status = 'rejected';
        else if (action === 'spam') r.status = 'spam';
        else if (action === 'delete') {
            reviewsData = reviewsData.filter(function(x){return x.id !== id});
            var idx = mockReviews.findIndex(function(x){return x.id === id});
            if (idx > -1) mockReviews.splice(idx, 1);
        }
    });

    selectedReviews.clear();
    document.getElementById('selectAllReviews').checked = false;
    updateBulkBar();
    renderReviewsTable();
    updateReviewStats();
    renderRatingDistribution();
    renderMostReviewed();
};

// AI Moderation
window.runAIModeration = function() {
    alert('ü§ñ AI Moderation running...\n\nAnalyzing ' + reviewsData.length + ' reviews for spam, toxicity, and sentiment.\n\nResults will be updated automatically.');

    reviewsData.forEach(function(r) {
        if (r.ai.spamScore > 0.7) r.status = 'spam';
        else if (r.ai.toxic) r.status = 'rejected';
    });

    renderReviewsTable();
    updateReviewStats();
};

// Export
window.exportReviews = function() {
    var format = prompt('Export format: pdf, csv, or json', 'pdf');
    if (!format) return;

    if (format === 'pdf') {
        var printWindow = window.open('', '_blank');
        var pdfHtml = '<html><head><title>Reviews Export</title><style>body{font-family:Arial,sans-serif;padding:20px}table{width:100%;border-collapse:collapse;margin-top:20px}th,td{border:1px solid #ddd;padding:10px;text-align:left}th{background:#3b82f6;color:white}.header{text-align:center;margin-bottom:30px}h1{color:#1e293b}.stars{color:#f59e0b}.approved{color:#22c55e}.pending{color:#f59e0b}.rejected{color:#ef4444}.spam{color:#64748b}</style></head><body>';
        pdfHtml += '<div class="header"><h1>Travel Bliss - Reviews Report</h1><p>Generated: ' + new Date().toLocaleString() + '</p></div>';
        pdfHtml += '<table><thead><tr><th>User</th><th>Rating</th><th>Review</th><th>Service</th><th>Status</th><th>Date</th></tr></thead><tbody>';
        reviewsData.forEach(function(r) {
            var stars = '';
            for(var i=0;i<r.rating;i++) stars += '‚òÖ';
            for(var i=r.rating;i<5;i++) stars += '‚òÜ';
            pdfHtml += '<tr><td>' + r.userName + '</td><td class="stars">' + stars + '</td><td>' + r.reviewText.substring(0,100) + '...</td><td>' + r.service + '</td><td class="' + r.status + '">' + r.status + '</td><td>' + new Date(r.date).toLocaleDateString() + '</td></tr>';
        });
        pdfHtml += '</tbody></table><p style="margin-top:30px;text-align:center;color:#64748b">Total: ' + reviewsData.length + ' reviews</p></body></html>';
        printWindow.document.write(pdfHtml);
        printWindow.document.close();
        setTimeout(function() { printWindow.print(); }, 500);
    } else if (format === 'json') {
        var json = JSON.stringify(reviewsData, null, 2);
        downloadFile(json, 'reviews.json', 'application/json');
    } else if (format === 'csv') {
        var csv = 'User,Email,Rating,Review,Service,Status,Date\n';
        reviewsData.forEach(function(r) {
            csv += '"' + r.userName + '","' + r.userEmail + '",' + r.rating + ',"' + r.reviewText.replace(/"/g, '""') + '","' + r.service + '","' + r.status + '","' + r.date + '"\n';
        });
        downloadFile(csv, 'reviews.csv', 'text/csv');
    } else {
        alert('Excel export requires a library. Use CSV instead.');
    }
};

function downloadFile(content, filename, type) {
    var blob = new Blob([content], {type: type});
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
}

        
// Missing functions
function openDestinationModal() {
    alert('Destination modal - coming soon');
}

function closeAIModal() {
    const modal = document.getElementById('aiGeneratorModal');
    if (modal) modal.style.display = 'none';
}

function closeImagePreview() {
    const preview = document.getElementById('imagePreviewModal');
    if (preview) preview.style.display = 'none';
}
        
// ==================== MEDIA LIBRARY ====================
var mediaFiles = [];
var mediaFolders = [];
var currentFolder = null;
var currentFileId = null;
var selectedMedia = new Set();
var viewMode = 'grid';

// Mock Data
var mockFolders = [
    { id: 'f1', name: 'Tours', parent: null, count: 5 },
    { id: 'f2', name: 'Pages', parent: null, count: 3 },
    { id: 'f3', name: 'Destinations', parent: null, count: 8 },
    { id: 'f4', name: 'Blog Images', parent: null, count: 4 },
    { id: 'f5', name: 'Samarkand', parent: 'f3', count: 3 }
];

var mockFiles = [
    { id: 'm1', name: 'samarkand-registan.jpg', type: 'image', size: 2500000, width: 1920, height: 1080, url: 'https://images.unsplash.com/photo-1596484552834-6a58f850e0a1?w=400', folder: 'f3', date: '2025-11-20', alt: 'Registan Square', tags: ['samarkand', 'architecture'] },
    { id: 'm2', name: 'bukhara-minaret.jpg', type: 'image', size: 1800000, width: 1280, height: 720, url: 'https://images.unsplash.com/photo-1565967511849-76a60a516170?w=400', folder: 'f3', date: '2025-11-19', alt: 'Kalon Minaret', tags: ['bukhara'] },
    { id: 'm3', name: 'silk-road-map.png', type: 'image', size: 500000, width: 800, height: 600, url: 'https://images.unsplash.com/photo-1524661135-423995f22d0b?w=400', folder: 'f1', date: '2025-11-18', alt: 'Silk Road Map', tags: ['map'] },
    { id: 'm4', name: 'page-banner.jpg', type: 'image', size: 3200000, width: 1920, height: 1280, url: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?w=400', folder: 'f2', date: '2025-11-17', alt: 'Page Banner', tags: ['hotel'] },
    { id: 'm5', name: 'tour-guide.mp4', type: 'video', size: 15000000, width: 1920, height: 1080, url: '', folder: 'f1', date: '2025-11-16', alt: '', tags: ['video'] },
    { id: 'm6', name: 'brochure.pdf', type: 'document', size: 800000, width: 0, height: 0, url: '', folder: null, date: '2025-11-15', alt: '', tags: ['pdf'] },
    { id: 'm7', name: 'khiva-walls.jpg', type: 'image', size: 2100000, width: 1600, height: 900, url: 'https://images.unsplash.com/photo-1580237072617-771c3ecc4a24?w=400', folder: 'f3', date: '2025-11-14', alt: 'Khiva Old City', tags: ['khiva'] },
    { id: 'm8', name: 'travel-blog-cover.jpg', type: 'image', size: 1500000, width: 1200, height: 800, url: 'https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=400', folder: 'f4', date: '2025-11-13', alt: 'Travel Blog', tags: ['blog'] },
    { id: 'm9', name: 'uzbek-food.jpg', type: 'image', size: 900000, width: 1000, height: 667, url: 'https://images.unsplash.com/photo-1547496502-affa22d38842?w=400', folder: 'f4', date: '2025-11-12', alt: 'Uzbek Cuisine', tags: ['food'] },
    { id: 'm10', name: 'desert-tour.jpg', type: 'image', size: 2800000, width: 1920, height: 1080, url: 'https://images.unsplash.com/photo-1473580044384-7ba9967e16a0?w=400', folder: 'f1', date: '2025-11-11', alt: 'Desert Tour', tags: ['desert', 'tour'] }
];

// Initialize




    function addDestinationImageToMedia(imageData, title) {
        var newFile = {
            id: "file" + Date.now(),
            name: title.replace(/[^a-zA-Z0-9]/g, "-").toLowerCase() + ".jpg",
            type: "image",
            size: "Auto",
            folder: "f3",
            url: imageData,
            uploadDate: new Date().toISOString().split("T")[0],
            dimensions: "Auto"
        };
        mockFiles.push(newFile);
        var folder = mockFolders.find(function(f) { return f.id === "f3"; });
        if (folder) folder.count++;
        console.log("Destination image added to Media Library:", title);
    }
    function addPageImageToMedia(imageData, title) {
    if (!imageData || typeof mockFiles === "undefined") return;
    var newFile = {
        id: "page_" + Date.now(),
        name: title.replace(/[^a-zA-Z0-9]/g, "-").toLowerCase() + ".jpg",
        type: "image",
        size: Math.floor(imageData.length * 0.75),
        width: 1920,
        height: 1080,
        url: imageData,
        folder: "f2",
        date: new Date().toISOString().split("T")[0],
        alt: title,
        tags: ["page"]
    };
    mockFiles.unshift(newFile);
    if (typeof mediaFiles !== "undefined") mediaFiles.unshift(newFile);
    console.log("Page image added to Media Library: " + title);
}
function addTourImageToMedia(imageData, title) {
    if (!imageData || typeof mockFiles === "undefined") return;
    var newFile = {
        id: "tour_" + Date.now(),
        name: title.replace(/[^a-zA-Z0-9]/g, "-").toLowerCase() + ".jpg",
        type: "image",
        size: Math.floor(imageData.length * 0.75),
        width: 1920,
        height: 1080,
        url: imageData,
        folder: "f1",
        date: new Date().toISOString().split("T")[0],
        alt: title,
        tags: ["tour"]
    };
    mockFiles.unshift(newFile);
    if (typeof mediaFiles !== "undefined") mediaFiles.unshift(newFile);
    console.log("Tour image added to Media Library: " + title);
}
function addBlogImageToMedia(imageData, title) {
    if (!imageData || typeof mockFiles === "undefined") return;
    var newFile = {
        id: "blog_" + Date.now(),
        name: title.replace(/[^a-zA-Z0-9]/g, "-").toLowerCase() + ".jpg",
        type: "image",
        size: Math.floor(imageData.length * 0.75),
        width: 1200,
        height: 800,
        url: imageData,
        folder: "f4",
        date: new Date().toISOString().split("T")[0],
        alt: title,
        tags: ["blog"]
    };
    mockFiles.unshift(newFile);
    if (typeof mediaFiles !== "undefined") mediaFiles.unshift(newFile);
    console.log("Blog image added to Media Library: " + title);
}
window.initMediaLibrary = function() {
    mediaFolders = [...mockFolders];
    mediaFiles = [...mockFiles];
    renderFolders();
    renderMediaGrid();
    updateMediaStats();
    populateFolderSelects();
};

// Format file size
function formatSize(bytes) {
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
    return (bytes / 1048576).toFixed(1) + ' MB';
}

// Render folders
function renderFolders() {
    var container = document.getElementById('foldersList');
    if (!container) return;

    var html = '<div onclick="selectFolder(null)" style="padding: 12px 15px; cursor: pointer; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #f1f5f9; ' + (currentFolder === null ? 'background: #eff6ff; color: #3b82f6;' : '') + '">' +
        '<span>üìÇ</span><span>All Media</span><span style="margin-left: auto; background: #e2e8f0; padding: 2px 8px; border-radius: 10px; font-size: 11px;">' + mediaFiles.length + '</span></div>';

    html += '<div onclick="selectFolder(\'ungrouped\')" style="padding: 12px 15px; cursor: pointer; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #f1f5f9; ' + (currentFolder === 'ungrouped' ? 'background: #eff6ff; color: #3b82f6;' : '') + '">' +
        '<span>üìÅ</span><span>Ungrouped</span><span style="margin-left: auto; background: #e2e8f0; padding: 2px 8px; border-radius: 10px; font-size: 11px;">' + mediaFiles.filter(function(f){return !f.folder}).length + '</span></div>';

    mediaFolders.filter(function(f){return !f.parent}).forEach(function(folder) {
        var count = mediaFiles.filter(function(f){return f.folder === folder.id}).length;
        var subfolders = mediaFolders.filter(function(f){return f.parent === folder.id});

        html += '<div onclick="selectFolder(\'' + folder.id + '\')" style="padding: 12px 15px; cursor: pointer; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #f1f5f9; ' + (currentFolder === folder.id ? 'background: #eff6ff; color: #3b82f6;' : '') + '">' +
            '<span>üìÅ</span><span>' + folder.name + '</span><span style="margin-left: auto; background: #e2e8f0; padding: 2px 8px; border-radius: 10px; font-size: 11px;">' + count + '</span></div>';

        subfolders.forEach(function(sub) {
            var subCount = mediaFiles.filter(function(f){return f.folder === sub.id}).length;
            html += '<div onclick="selectFolder(\'' + sub.id + '\')" style="padding: 12px 15px 12px 35px; cursor: pointer; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #f1f5f9; ' + (currentFolder === sub.id ? 'background: #eff6ff; color: #3b82f6;' : '') + '">' +
                '<span>üìÑ</span><span>' + sub.name + '</span><span style="margin-left: auto; background: #e2e8f0; padding: 2px 8px; border-radius: 10px; font-size: 11px;">' + subCount + '</span></div>';
        });
    });

    container.innerHTML = html;
}

// Select folder
window.selectFolder = function(folderId) {
    currentFolder = folderId;
    renderFolders();
    renderMediaGrid();
};

// Render media grid
function renderMediaGrid() {
    var container = document.getElementById('mediaGrid');
    if (!container) return;

    var files = mediaFiles;
    if (currentFolder === 'ungrouped') files = files.filter(function(f){return !f.folder});
    else if (currentFolder) files = files.filter(function(f){return f.folder === currentFolder});

    var search = (document.getElementById('searchMedia')?.value || '').toLowerCase();
    var typeFilter = document.getElementById('filterType')?.value || '';

    if (search) files = files.filter(function(f){return f.name.toLowerCase().includes(search) || (f.alt && f.alt.toLowerCase().includes(search))});
    if (typeFilter) files = files.filter(function(f){return f.type === typeFilter});

    if (!files.length) {
        container.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 60px; color: #94a3b8;">No files found</div>';
        return;
    }

    if (viewMode === 'grid') {
        container.style.display = 'grid';
        container.innerHTML = files.map(function(file) {
            var thumb = file.type === 'image' ? file.url : (file.type === 'video' ? 'üé¨' : (file.type === 'document' ? 'üìÑ' : 'üéµ'));
            var isImg = file.type === 'image';
            return '<div class="media-item" data-id="' + file.id + '" style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); cursor: pointer; position: relative;" onclick="openFileDetail(\'' + file.id + '\')">' +
                '<div style="position: absolute; top: 10px; left: 10px; z-index: 10;"><input type="checkbox" class="media-checkbox" data-id="' + file.id + '" onclick="event.stopPropagation(); toggleMediaSelect(this)" style="width: 18px; height: 18px;"></div>' +
                '<div style="height: 140px; background: #f8fafc; display: flex; align-items: center; justify-content: center; overflow: hidden;">' +
                    (isImg ? '<img src="' + thumb + '" style="width: 100%; height: 100%; object-fit: cover;">' : '<span style="font-size: 48px;">' + thumb + '</span>') +
                '</div>' +
                '<div style="padding: 12px;">' +
                    '<p style="margin: 0; font-size: 13px; color: #1e293b; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="' + file.name + '">' + file.name + '</p>' +
                    '<div style="display: flex; justify-content: space-between; margin-top: 6px;">' +
                        '<span style="font-size: 11px; color: #94a3b8;">' + formatSize(file.size) + '</span>' +
                        '<span style="font-size: 11px; color: #94a3b8;">' + (file.width ? file.width + 'x' + file.height : file.type) + '</span>' +
                    '</div>' +
                '</div>' +
            '</div>';
        }).join('');
    } else {
        container.style.display = 'block';
        container.innerHTML = '<table style="width: 100%; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);"><thead><tr style="background: #f8fafc;"><th style="padding: 12px; text-align: left; width: 40px;"><input type="checkbox" id="selectAllMedia" onchange="toggleSelectAllMedia()"></th><th style="padding: 12px; text-align: left;">File</th><th style="padding: 12px; text-align: left;">Type</th><th style="padding: 12px; text-align: left;">Size</th><th style="padding: 12px; text-align: left;">Date</th><th style="padding: 12px; text-align: left;">Actions</th></tr></thead><tbody>' +
            files.map(function(file) {
                return '<tr style="border-bottom: 1px solid #f1f5f9; cursor: pointer;" onclick="openFileDetail(\'' + file.id + '\')">' +
                    '<td style="padding: 12px;" onclick="event.stopPropagation()"><input type="checkbox" class="media-checkbox" data-id="' + file.id + '" onchange="toggleMediaSelect(this)"></td>' +
                    '<td style="padding: 12px;"><div style="display: flex; align-items: center; gap: 10px;">' + (file.type === 'image' ? '<img src="' + file.url + '" style="width: 40px; height: 40px; object-fit: cover; border-radius: 6px;">' : '<span style="font-size: 24px;">' + (file.type === 'video' ? 'üé¨' : 'üìÑ') + '</span>') + '<span>' + file.name + '</span></div></td>' +
                    '<td style="padding: 12px; color: #64748b;">' + file.type + '</td>' +
                    '<td style="padding: 12px; color: #64748b;">' + formatSize(file.size) + '</td>' +
                    '<td style="padding: 12px; color: #64748b;">' + file.date + '</td>' +
                    '<td style="padding: 12px;" onclick="event.stopPropagation()"><button onclick="openFileDetail(\'' + file.id + '\')" style="padding: 6px 12px; background: #dbeafe; color: #3b82f6; border: none; border-radius: 6px; cursor: pointer; margin-right: 5px;">View</button><button onclick="editMediaFile(\'' + file.id + '\')" style="padding: 6px 12px; background: #fef3c7; color: #f59e0b; border: none; border-radius: 6px; cursor: pointer; margin-right: 5px;">Edit</button><button onclick="deleteMediaFile(\'' + file.id + '\')" style="padding: 6px 12px; background: #fee2e2; color: #ef4444; border: none; border-radius: 6px; cursor: pointer;">Delete</button></td>' +
                '</tr>';
            }).join('') +
        '</tbody></table>';
    }
}

// Update stats
function updateMediaStats() {
    var el = function(id, v) { var e = document.getElementById(id); if(e) e.textContent = v; };
    el('statTotalFiles', mediaFiles.length);
    el('statImages', mediaFiles.filter(function(f){return f.type === 'image'}).length);
    el('statVideos', mediaFiles.filter(function(f){return f.type === 'video'}).length);
    el('statDocs', mediaFiles.filter(function(f){return f.type === 'document'}).length);
    var totalSize = mediaFiles.reduce(function(s,f){return s + f.size}, 0);
    el('statTotalSize', formatSize(totalSize));
}

// View mode
window.setViewMode = function(mode) {
    viewMode = mode;
    document.getElementById('gridViewBtn').style.background = mode === 'grid' ? '#3b82f6' : '#f1f5f9';
    document.getElementById('gridViewBtn').style.color = mode === 'grid' ? 'white' : '#475569';
    document.getElementById('listViewBtn').style.background = mode === 'list' ? '#3b82f6' : '#f1f5f9';
    document.getElementById('listViewBtn').style.color = mode === 'list' ? 'white' : '#475569';
    renderMediaGrid();
};

// Filter
window.filterMedia = function() { renderMediaGrid(); };

// Selection
window.toggleMediaSelect = function(cb) {
    if (cb.checked) selectedMedia.add(cb.dataset.id);
    else selectedMedia.delete(cb.dataset.id);
    updateMediaBulkBar();
};

window.toggleSelectAllMedia = function() {
    var checked = document.getElementById('selectAllMedia')?.checked;
    document.querySelectorAll('.media-checkbox').forEach(function(cb) {
        cb.checked = checked;
        if (checked) selectedMedia.add(cb.dataset.id);
        else selectedMedia.delete(cb.dataset.id);
    });
    updateMediaBulkBar();
};

function updateMediaBulkBar() {
    var bar = document.getElementById('mediaBulkBar');
    var count = document.getElementById('selectedMediaCount');
    if (bar) bar.style.display = selectedMedia.size > 0 ? 'flex' : 'none';
    if (count) count.textContent = selectedMedia.size;
}

// Bulk actions
window.bulkDeleteMedia = function() {
    if (!confirm('Delete ' + selectedMedia.size + ' files?')) return;
    selectedMedia.forEach(function(id) {
        mediaFiles = mediaFiles.filter(function(f){return f.id !== id});
    });
    selectedMedia.clear();
    updateMediaBulkBar();
    renderMediaGrid();
    renderFolders();
    updateMediaStats();
};

window.bulkMoveMedia = function() {
    var folder = prompt('Enter folder name to move files:');
    if (!folder) return;
    var targetFolder = mediaFolders.find(function(f){return f.name.toLowerCase() === folder.toLowerCase()});
    if (!targetFolder) { alert('Folder not found'); return; }
    selectedMedia.forEach(function(id) {
        var file = mediaFiles.find(function(f){return f.id === id});
        if (file) file.folder = targetFolder.id;
    });
    selectedMedia.clear();
    updateMediaBulkBar();
    renderMediaGrid();
    renderFolders();
};

window.bulkDownloadMedia = function() { alert('Downloading ' + selectedMedia.size + ' files...'); };

// File detail modal
window.openFileDetail = function(id) {
    currentFileId = id;
    var file = mediaFiles.find(function(f){return f.id === id});
    if (!file) return;

    document.getElementById('fileDetailName').textContent = file.name;
    document.getElementById('fileDetailNameInput').value = file.name;
    document.getElementById('fileDetailAlt').value = file.alt || '';
    document.getElementById('fileDetailType').textContent = file.type.toUpperCase();
    document.getElementById('fileDetailSize').textContent = formatSize(file.size);
    document.getElementById('fileDetailRes').textContent = file.width ? file.width + ' x ' + file.height : 'N/A';
    document.getElementById('fileDetailDate').textContent = file.date;
    document.getElementById('fileDetailUrl').value = file.url || '/uploads/' + file.name;

    var preview = document.getElementById('filePreviewImg');
    if (file.type === 'image' && file.url) {
        preview.src = file.url;
        preview.style.display = 'block';
    } else {
        preview.style.display = 'none';
    }

    document.getElementById('fileDetailModal').style.display = 'block';
};

window.closeFileDetailModal = function() {
    document.getElementById('fileDetailModal').style.display = 'none';
    currentFileId = null;
};

window.copyFileUrl = function() {
    var url = document.getElementById('fileDetailUrl');
    url.select();
    document.execCommand('copy');
    alert('URL copied!');
};


window.editCurrentFile = function() {
    if (!currentFileId) return;
    var file = mediaFiles.find(function(f){return f.id === currentFileId});
    if (file) {
        var newName = prompt("Yangi fayl nomini kiriting:", file.name);
        if (newName && newName !== file.name) {
            file.name = newName;
            document.getElementById('fileDetailNameInput').value = newName;
            renderMediaGallery(mediaFiles);
            alert("Fayl nomi o'zgartirildi!");
        }
    }
};

window.saveFileDetails = function() {
    if (!currentFileId) return;
    var file = mediaFiles.find(function(f){return f.id === currentFileId});
    if (file) {
        file.name = document.getElementById('fileDetailNameInput').value;
        file.alt = document.getElementById('fileDetailAlt').value;
        renderMediaGrid();
        alert('Saved!');
    }
};

window.deleteCurrentFile = function() {
    if (!currentFileId || !confirm('Delete this file?')) return;
    mediaFiles = mediaFiles.filter(function(f){return f.id !== currentFileId});
    closeFileDetailModal();
    renderMediaGrid();
    renderFolders();
    updateMediaStats();
};

window.downloadFile = function() { alert('Downloading file...'); };


window.editMediaFile = function(id) {
    var file = mediaFiles.find(function(f) { return f.id === id; });
    if (file) {
        var newName = prompt("Fayl nomini kiriting:", file.name);
        if (newName && newName !== file.name) {
            file.name = newName;
            renderMediaGallery(mediaFiles);
            alert("Fayl nomi o'zgartirildi!");
        }
    }
};

window.deleteMediaFile = function(id) {
    if (!confirm('Delete this file?')) return;
    mediaFiles = mediaFiles.filter(function(f){return f.id !== id});
    renderMediaGrid();
    renderFolders();
    updateMediaStats();
};

// Upload modal
window.openUploadModal = function() {
    document.getElementById('uploadModal').style.display = 'block';
    document.getElementById('uploadedFiles').innerHTML = '';
};

window.closeUploadModal = function() {
    document.getElementById('uploadModal').style.display = 'none';
};

window.handleDragOver = function(e) {
    e.preventDefault();
    document.getElementById('dropZone').style.borderColor = '#3b82f6';
    document.getElementById('dropZone').style.background = '#eff6ff';
};

window.handleDragLeave = function(e) {
    document.getElementById('dropZone').style.borderColor = '#e2e8f0';
    document.getElementById('dropZone').style.background = 'transparent';
};

window.handleDrop = function(e) {
    e.preventDefault();
    handleDragLeave(e);
    var files = e.dataTransfer.files;
    processFiles(files);
};

window.handleFileSelect = function(e) {
    processFiles(e.target.files);
};

function processFiles(files) {
    var container = document.getElementById('uploadedFiles');
    var folder = document.getElementById('uploadFolder')?.value || null;

    for (var i = 0; i < files.length; i++) {
        var file = files[i];
        var type = file.type.startsWith('image') ? 'image' : (file.type.startsWith('video') ? 'video' : 'document');

        var newFile = {
            id: 'm' + Date.now() + i,
            name: file.name,
            type: type,
            size: file.size,
            width: type === 'image' ? 1920 : 0,
            height: type === 'image' ? 1080 : 0,
            url: type === 'image' ? URL.createObjectURL(file) : '',
            folder: folder,
            date: new Date().toISOString().split('T')[0],
            alt: '',
            tags: []
        };

        mediaFiles.unshift(newFile);

        container.innerHTML += '<div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: #f0fdf4; border-radius: 8px; margin-bottom: 8px;"><span style="color: #22c55e;">‚úì</span><span style="flex: 1;">' + file.name + '</span><span style="color: #64748b; font-size: 12px;">' + formatSize(file.size) + '</span></div>';
    }

    renderMediaGrid();
    renderFolders();
    updateMediaStats();
}

// Folder management
window.openCreateFolderModal = function() {
    document.getElementById('createFolderModal').style.display = 'block';
    document.getElementById('newFolderName').value = '';
};

window.closeCreateFolderModal = function() {
    document.getElementById('createFolderModal').style.display = 'none';
};

window.createFolder = function() {
    var name = document.getElementById('newFolderName').value.trim();
    if (!name) { alert('Enter folder name'); return; }
    var parent = document.getElementById('parentFolder')?.value || null;

    mediaFolders.push({
        id: 'f' + Date.now(),
        name: name,
        parent: parent,
        count: 0
    });

    closeCreateFolderModal();
    renderFolders();
    populateFolderSelects();
};

function populateFolderSelects() {
    var options = '<option value="">Root (No folder)</option>' + mediaFolders.map(function(f) {
        return '<option value="' + f.id + '">' + f.name + '</option>';
    }).join('');

    var uploadSelect = document.getElementById('uploadFolder');
    var parentSelect = document.getElementById('parentFolder');
    if (uploadSelect) uploadSelect.innerHTML = options;
    if (parentSelect) parentSelect.innerHTML = options;
}

        
    // ==================== MEDIA LIBRARY 2025 ====================
    var mediaFiles = [
        { id: 'm1', name: 'samarkand-registan.jpg', type: 'image', size: 2457600, url: 'https://images.unsplash.com/photo-1596484552834-6a58f850e0a1?w=800', date: '2025-11-20', folder: 'destinations', width: 1920, height: 1080, alt: 'Registan Square', title: 'Samarkand Registan', description: '', tags: ['samarkand', 'uzbekistan'] },
        { id: 'm2', name: 'bukhara-ark.jpg', type: 'image', size: 1843200, url: 'https://images.unsplash.com/photo-1565008576549-57569a49371d?w=800', date: '2025-11-19', folder: 'destinations', width: 1920, height: 1280, alt: 'Ark Fortress', title: 'Bukhara Ark', description: '', tags: ['bukhara'] },
        { id: 'm3', name: 'silk-road-tour.jpg', type: 'image', size: 3145728, url: 'https://images.unsplash.com/photo-1548013146-72479768bada?w=800', date: '2025-11-18', folder: 'tours', width: 2560, height: 1440, alt: 'Silk Road', title: 'Silk Road Tour', description: '', tags: ['tour', 'silk-road'] },
        { id: 'm4', name: 'hero-banner.jpg', type: 'image', size: 4194304, url: 'https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=800', date: '2025-11-17', folder: 'pages', width: 3840, height: 2160, alt: 'Hero Banner', title: 'Homepage Hero', description: '', tags: ['banner', 'hero'] },
        { id: 'm5', name: 'blog-travel-tips.jpg', type: 'image', size: 1048576, url: 'https://images.unsplash.com/photo-1501785888041-af3ef285b470?w=800', date: '2025-11-16', folder: 'blog', width: 1600, height: 900, alt: 'Travel Tips', title: 'Travel Tips Blog', description: '', tags: ['blog', 'tips'] },
        { id: 'm6', name: 'tour-intro.mp4', type: 'video', size: 52428800, url: '#', date: '2025-11-15', folder: 'tours', width: 1920, height: 1080, alt: '', title: 'Tour Introduction', description: '', tags: ['video', 'tour'] },
        { id: 'm7', name: 'brochure.pdf', type: 'document', size: 5242880, url: '#', date: '2025-11-14', folder: 'documents', width: 0, height: 0, alt: '', title: 'Travel Brochure', description: '', tags: ['pdf', 'brochure'] },
        { id: 'm8', name: 'khiva-walls.jpg', type: 'image', size: 2097152, url: 'https://images.unsplash.com/photo-1580654842837-5d4b54eb1ca0?w=800', date: '2025-11-13', folder: 'destinations', width: 1920, height: 1280, alt: 'Khiva Walls', title: 'Khiva Ancient Walls', description: '', tags: ['khiva'] }
    ];

    var currentFolder = 'all';
    var viewMode = 'grid';
    var selectedFiles = [];
    var currentFile = null;
    var currentPage = 1;
    var itemsPerPage = 12;

    // Initialize Media Library
    function initMediaLibrary() {
        setupDragDrop();
        renderMedia();
        updateStats();
        updateFolderCounts();
    }

    // Drag & Drop Setup
    function setupDragDrop() {
        var zone = document.getElementById('uploadZone');
        if (!zone) return;

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(function(evt) {
            zone.addEventListener(evt, function(e) {
                e.preventDefault();
                e.stopPropagation();
            });
        });

        ['dragenter', 'dragover'].forEach(function(evt) {
            zone.addEventListener(evt, function() { zone.classList.add('dragover'); });
        });

        ['dragleave', 'drop'].forEach(function(evt) {
            zone.addEventListener(evt, function() { zone.classList.remove('dragover'); });
        });

        zone.addEventListener('drop', function(e) {
            var files = e.dataTransfer.files;
            handleFiles(files);
        });
    }

    // Trigger file input
    window.triggerUpload = function() {
        document.getElementById('fileInput').click();
    };

    // Handle file selection
    window.handleFileSelect = function(e) {
        handleFiles(e.target.files);
    };

    // Process uploaded files
    function handleFiles(files) {
        var progressContainer = document.getElementById('uploadProgress');
        var progressList = document.getElementById('progressList');
        progressContainer.style.display = 'block';
        progressList.innerHTML = '';

        Array.from(files).forEach(function(file, index) {
            var fileType = file.type.startsWith('image/') ? 'image' : (file.type.startsWith('video/') ? 'video' : 'document');

            var progressItem = document.createElement('div');
            progressItem.className = 'progress-item';
            progressItem.innerHTML = '<span style="font-size: 20px;">' + (fileType === 'image' ? 'üñºÔ∏è' : (fileType === 'video' ? 'üé¨' : 'üìÑ')) + '</span>' +
                '<div style="flex: 1;"><div style="font-size: 13px; font-weight: 500; margin-bottom: 4px;">' + file.name + '</div>' +
                '<div class="progress-bar-container"><div class="progress-bar" id="progress-' + index + '" style="width: 0%;"></div></div></div>' +
                '<span style="font-size: 12px; color: #64748b;" id="percent-' + index + '">0%</span>';
            progressList.appendChild(progressItem);

            // Simulate upload
            simulateUpload(index, file, fileType);
        });
    }

    function simulateUpload(index, file, fileType) {
        var progress = 0;
        var interval = setInterval(function() {
            progress += Math.random() * 15;
            if (progress >= 100) {
                progress = 100;
                clearInterval(interval);

                // Add file to library
                var newFile = {
                    id: 'm' + Date.now() + index,
                    name: file.name,
                    type: fileType,
                    size: file.size,
                    url: fileType === 'image' ? URL.createObjectURL(file) : '#',
                    date: new Date().toISOString().split('T')[0],
                    folder: currentFolder === 'all' ? 'uploads' : currentFolder,
                    width: 1920,
                    height: 1080,
                    alt: '',
                    title: file.name.split('.')[0],
                    description: '',
                    tags: []
                };
                mediaFiles.unshift(newFile);

                setTimeout(function() {
                    renderMedia();
                    updateStats();
                    updateFolderCounts();
                }, 500);
            }

            var bar = document.getElementById('progress-' + index);
            var percent = document.getElementById('percent-' + index);
            if (bar) bar.style.width = progress + '%';
            if (percent) percent.textContent = Math.round(progress) + '%';
        }, 100);
    }

    // Format file size
    function formatSize(bytes) {
        if (bytes === 0) return '0 B';
        var k = 1024;
        var sizes = ['B', 'KB', 'MB', 'GB'];
        var i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
    }

    // Select folder
    window.selectFolder = function(folder) {
        currentFolder = folder;
        currentPage = 1;

        document.querySelectorAll('.folder-item').forEach(function(item) {
            item.classList.remove('active');
        });
        event.target.closest('.folder-item').classList.add('active');

        renderMedia();
    };

    // Filter media
    window.filterMedia = function() {
        currentPage = 1;
        renderMedia();
    };

    // Get filtered files
    function getFilteredFiles() {
        var search = document.getElementById('searchInput').value.toLowerCase();
        var type = document.getElementById('filterType').value;
        var dateFilter = document.getElementById('filterDate').value;
        var sort = document.getElementById('filterSort').value;

        var filtered = mediaFiles.filter(function(file) {
            // Folder filter
            if (currentFolder !== 'all') {
                if (currentFolder === 'images' && file.type !== 'image') return false;
                if (currentFolder === 'videos' && file.type !== 'video') return false;
                if (currentFolder === 'documents' && file.type !== 'document') return false;
                if (['blog', 'destinations', 'banners', 'tours'].indexOf(currentFolder) > -1 && file.folder !== currentFolder) return false;
            }

            // Search filter
            if (search && file.name.toLowerCase().indexOf(search) === -1) return false;

            // Type filter
            if (type && file.type !== type) return false;

            // Date filter
            if (dateFilter) {
                var fileDate = new Date(file.date);
                var today = new Date();
                if (dateFilter === 'today' && fileDate.toDateString() !== today.toDateString()) return false;
                if (dateFilter === 'week') {
                    var weekAgo = new Date(today - 7 * 24 * 60 * 60 * 1000);
                    if (fileDate < weekAgo) return false;
                }
                if (dateFilter === 'month') {
                    var monthAgo = new Date(today - 30 * 24 * 60 * 60 * 1000);
                    if (fileDate < monthAgo) return false;
                }
            }

            return true;
        });

        // Sort
        filtered.sort(function(a, b) {
            if (sort === 'newest') return new Date(b.date) - new Date(a.date);
            if (sort === 'oldest') return new Date(a.date) - new Date(b.date);
            if (sort === 'name') return a.name.localeCompare(b.name);
            if (sort === 'size') return b.size - a.size;
            return 0;
        });

        return filtered;
    }

    // Render media
    function renderMedia() {
        var filtered = getFilteredFiles();
        var start = (currentPage - 1) * itemsPerPage;
        var paged = filtered.slice(start, start + itemsPerPage);

        var gridHtml = '';
        var listHtml = '';

        paged.forEach(function(file) {
            var isSelected = selectedFiles.indexOf(file.id) > -1;
            var thumb = file.type === 'image' ? '<img src="' + file.url + '" alt="' + file.alt + '">' :
                       '<span class="media-item-icon">' + (file.type === 'video' ? 'üé¨' : 'üìÑ') + '</span>';

            gridHtml += '<div class="media-item' + (isSelected ? ' selected' : '') + '" data-id="' + file.id + '" onclick="openPreview(\'' + file.id + '\')">' +
                '<div class="media-item-checkbox' + (isSelected ? ' checked' : '') + '" onclick="event.stopPropagation(); toggleSelect(\'' + file.id + '\')">' + (isSelected ? '‚úì' : '') + '</div>' +
                '<div class="media-item-actions">' +
                    '<button class="media-action-btn" onclick="event.stopPropagation(); openPreview(\'' + file.id + '\')" title="Preview">üëÅ</button>' +
                    '<button class="media-action-btn" onclick="event.stopPropagation(); quickDelete(\'' + file.id + '\')" title="Delete">üóë</button>' +
                '</div>' +
                '<div class="media-item-thumb">' + thumb + '</div>' +
                '<div class="media-item-info">' +
                    '<div class="media-item-name" title="' + file.name + '">' + file.name + '</div>' +
                    '<div class="media-item-meta"><span>' + formatSize(file.size) + '</span><span>' + file.date + '</span></div>' +
                '</div>' +
            '</div>';

            listHtml += '<div class="media-list-item' + (isSelected ? ' selected' : '') + '" onclick="openPreview(\'' + file.id + '\')">' +
                '<input type="checkbox" ' + (isSelected ? 'checked' : '') + ' onclick="event.stopPropagation(); toggleSelect(\'' + file.id + '\')" style="width: 18px; height: 18px;">' +
                '<div class="media-list-thumb">' + thumb + '</div>' +
                '<div style="flex: 1;"><div style="font-weight: 600; color: #1e293b;">' + file.name + '</div><div style="font-size: 12px; color: #64748b;">' + file.folder + '</div></div>' +
                '<div style="color: #64748b; font-size: 13px;">' + file.type + '</div>' +
                '<div style="color: #64748b; font-size: 13px;">' + formatSize(file.size) + '</div>' +
                '<div style="color: #64748b; font-size: 13px;">' + file.date + '</div>' +
                '<div style="display: flex; gap: 4px;">' +
                    '<button class="media-action-btn" onclick="event.stopPropagation(); openPreview(\'' + file.id + '\')">üëÅ</button>' +
                    '<button class="media-action-btn" onclick="event.stopPropagation(); quickDelete(\'' + file.id + '\')">üóë</button>' +
                '</div>' +
            '</div>';
        });

        document.getElementById('mediaGrid').innerHTML = gridHtml;
        document.getElementById('mediaList').innerHTML = listHtml;

        // Pagination
        var totalPages = Math.ceil(filtered.length / itemsPerPage);
        var paginationHtml = '';
        for (var i = 1; i <= totalPages; i++) {
            paginationHtml += '<button class="page-btn' + (i === currentPage ? ' active' : '') + '" onclick="goToPage(' + i + ')">' + i + '</button>';
        }
        document.getElementById('pagination').innerHTML = paginationHtml;
    }

    window.goToPage = function(page) {
        currentPage = page;
        renderMedia();
    };

    // View mode
    window.setViewMode = function(mode) {
        viewMode = mode;
        document.getElementById('gridViewBtn').classList.toggle('active', mode === 'grid');
        document.getElementById('listViewBtn').classList.toggle('active', mode === 'list');
        document.getElementById('mediaGrid').style.display = mode === 'grid' ? 'grid' : 'none';
        document.getElementById('mediaList').style.display = mode === 'list' ? 'flex' : 'none';
    };

    // Toggle selection
    window.toggleSelect = function(id) {
        var idx = selectedFiles.indexOf(id);
        if (idx > -1) {
            selectedFiles.splice(idx, 1);
        } else {
            selectedFiles.push(id);
        }
        updateBulkBar();
        renderMedia();
    };

    function updateBulkBar() {
        var bar = document.getElementById('bulkBar');
        var count = document.getElementById('selectedCount');
        if (selectedFiles.length > 0) {
            bar.classList.add('show');
            count.textContent = selectedFiles.length;
        } else {
            bar.classList.remove('show');
        }
    }

    window.clearSelection = function() {
        selectedFiles = [];
        updateBulkBar();
        renderMedia();
    };

    // Bulk actions
    window.bulkDelete = function() {
        if (confirm('Delete ' + selectedFiles.length + ' files?')) {
            mediaFiles = mediaFiles.filter(function(f) { return selectedFiles.indexOf(f.id) === -1; });
            selectedFiles = [];
            updateBulkBar();
            renderMedia();
            updateStats();
            updateFolderCounts();
        }
    };

    window.bulkMove = function() {
        var folder = prompt('Move to folder (blog, destinations, banners, tours):');
        if (folder) {
            mediaFiles.forEach(function(f) {
                if (selectedFiles.indexOf(f.id) > -1) f.folder = folder;
            });
            selectedFiles = [];
            updateBulkBar();
            renderMedia();
            updateFolderCounts();
        }
    };

    window.bulkTag = function() {
        var tag = prompt('Add tag:');
        if (tag) {
            mediaFiles.forEach(function(f) {
                if (selectedFiles.indexOf(f.id) > -1 && f.tags.indexOf(tag) === -1) f.tags.push(tag);
            });
            alert('Tag added to ' + selectedFiles.length + ' files');
        }
    };

    // Quick delete
    window.quickDelete = function(id) {
        if (confirm('Delete this file?')) {
            mediaFiles = mediaFiles.filter(function(f) { return f.id !== id; });
            renderMedia();
            updateStats();
            updateFolderCounts();
        }
    };

    // Open preview modal
    window.openPreview = function(id) {
        currentFile = mediaFiles.find(function(f) { return f.id === id; });
        if (!currentFile) return;

        document.getElementById('previewTitle').textContent = currentFile.name;
        document.getElementById('previewImage').innerHTML = currentFile.type === 'image' ?
            '<img src="' + currentFile.url + '" alt="' + currentFile.alt + '">' :
            '<span style="font-size: 120px;">' + (currentFile.type === 'video' ? 'üé¨' : 'üìÑ') + '</span>';

        document.getElementById('detailName').value = currentFile.name;
        document.getElementById('detailAlt').value = currentFile.alt || '';
        document.getElementById('detailTitle').value = currentFile.title || '';
        document.getElementById('detailDesc').value = currentFile.description || '';
        document.getElementById('detailUrl').value = currentFile.url;
        document.getElementById('detailType').textContent = currentFile.type.toUpperCase();
        document.getElementById('detailSize').textContent = formatSize(currentFile.size);
        document.getElementById('detailDimensions').textContent = currentFile.width ? currentFile.width + ' x ' + currentFile.height + ' px' : '-';
        document.getElementById('detailDate').textContent = currentFile.date;

        // Tags
        renderTags();

        // Show edit tools for images
        document.getElementById('editTools').style.display = currentFile.type === 'image' ? 'flex' : 'none';

        document.getElementById('previewModal').classList.add('show');
    };

    function renderTags() {
        var container = document.getElementById('tagsContainer');
        var input = document.getElementById('tagInput');
        container.innerHTML = '';
        if (currentFile && currentFile.tags) {
            currentFile.tags.forEach(function(tag) {
                var tagEl = document.createElement('span');
                tagEl.className = 'tag';
                tagEl.innerHTML = tag + '<span class="tag-remove" onclick="removeTag(\'' + tag + '\')">&times;</span>';
                container.appendChild(tagEl);
            });
        }
        container.appendChild(input);
    }

    window.removeTag = function(tag) {
        if (currentFile) {
            currentFile.tags = currentFile.tags.filter(function(t) { return t !== tag; });
            renderTags();
        }
    };

    window.handleTagInput = function(e) {
        if (e.key === 'Enter' && e.target.value.trim()) {
            if (currentFile && currentFile.tags.indexOf(e.target.value.trim()) === -1) {
                currentFile.tags.push(e.target.value.trim());
                e.target.value = '';
                renderTags();
            }
        }
    };

    window.closePreviewModal = function() {
        document.getElementById('previewModal').classList.remove('show');
        currentFile = null;
    };

    window.saveFileDetails = function() {
        if (!currentFile) return;
        currentFile.name = document.getElementById('detailName').value;
        currentFile.alt = document.getElementById('detailAlt').value;
        currentFile.title = document.getElementById('detailTitle').value;
        currentFile.description = document.getElementById('detailDesc').value;
        renderMedia();
        alert('Changes saved!');
    };

    window.copyUrl = function() {
        var input = document.getElementById('detailUrl');
        input.select();
        document.execCommand('copy');
        alert('URL copied!');
    };

    window.downloadFile = function() {
        if (currentFile && currentFile.url !== '#') {
            var a = document.createElement('a');
            a.href = currentFile.url;
            a.download = currentFile.name;
            a.click();
        }
    };

    window.deleteCurrentFile = function() {
        if (currentFile && confirm('Delete this file?')) {
            mediaFiles = mediaFiles.filter(function(f) { return f.id !== currentFile.id; });
            closePreviewModal();
            renderMedia();
            updateStats();
            updateFolderCounts();
        }
    };

    // Edit tools
    window.cropImage = function() {
        if (!currentFile || currentFile.type !== 'image') return;
        var cropType = prompt('Crop qilish turini tanlang:\n1 - Square (1:1)\n2 - Landscape (16:9)\n3 - Portrait (9:16)\n4 - Custom', '1');
        if (cropType) {
            var ratios = { '1': '1:1', '2': '16:9', '3': '9:16', '4': 'Custom' };
            alert('Rasm ' + (ratios[cropType] || '1:1') + ' formatida crop qilindi!');
            currentFile.cropped = true;
        }
    };

    window.rotateImage = function() {
        if (!currentFile || currentFile.type !== 'image') return;
        var degrees = prompt('Necha gradusga aylantirish kerak? (90, 180, 270)', '90');
        if (degrees) {
            var img = document.querySelector('#previewImage img');
            if (img) {
                var currentRotation = img.dataset.rotation ? parseInt(img.dataset.rotation) : 0;
                var newRotation = (currentRotation + parseInt(degrees)) % 360;
                img.style.transform = 'rotate(' + newRotation + 'deg)';
                img.dataset.rotation = newRotation;
                currentFile.rotation = newRotation;
            }
        }
    };

    window.resizeImage = function() {
        if (!currentFile || currentFile.type !== 'image') return;
        var newWidth = prompt('Yangi kenglik (px):', currentFile.width || 1920);
        if (newWidth) {
            var newHeight = prompt('Yangi balandlik (px):', currentFile.height || 1080);
            if (newHeight) {
                currentFile.width = parseInt(newWidth);
                currentFile.height = parseInt(newHeight);
                document.getElementById('detailDimensions').textContent = newWidth + ' x ' + newHeight + ' px';
                alert('Rasm o\'lchami o\'zgartirildi: ' + newWidth + 'x' + newHeight);
            }
        }
    };

    window.compressImage = function() {
        if (!currentFile || currentFile.type !== 'image') return;
        var quality = prompt('Siqish darajasi (1-100, past = kichik fayl):', '80');
        if (quality) {
            var oldSize = currentFile.size;
            var compression = parseInt(quality) / 100;
            currentFile.size = Math.floor(oldSize * compression);
            document.getElementById('detailSize').textContent = formatSize(currentFile.size);
            alert('Rasm siqildi! Yangi hajm: ' + formatSize(currentFile.size));
        }
    };

    // Folder modal
    window.openNewFolderModal = function() {
        document.getElementById('folderModal').classList.add('show');
    };

    window.closeFolderModal = function() {
        document.getElementById('folderModal').classList.remove('show');
    };

    window.createFolder = function() {
        var name = document.getElementById('newFolderName').value.trim();
        if (name) {
            alert('Folder "' + name + '" created!');
            closeFolderModal();
        }
    };

    // Update stats
    function updateStats() {
        document.getElementById('statTotal').textContent = mediaFiles.length;
        document.getElementById('statImages').textContent = mediaFiles.filter(function(f) { return f.type === 'image'; }).length;
        document.getElementById('statVideos').textContent = mediaFiles.filter(function(f) { return f.type === 'video'; }).length;

        var totalSize = mediaFiles.reduce(function(sum, f) { return sum + f.size; }, 0);
        document.getElementById('statSize').textContent = formatSize(totalSize);
        document.getElementById('storageUsed').textContent = formatSize(totalSize);
        document.getElementById('storageBar').style.width = Math.min((totalSize / (5 * 1024 * 1024 * 1024)) * 100, 100) + '%';
    }

    // Update folder counts
    function updateFolderCounts() {
        document.getElementById('countAll').textContent = mediaFiles.length;
        document.getElementById('countImages').textContent = mediaFiles.filter(function(f) { return f.type === 'image'; }).length;
        document.getElementById('countVideos').textContent = mediaFiles.filter(function(f) { return f.type === 'video'; }).length;
        document.getElementById('countDocs').textContent = mediaFiles.filter(function(f) { return f.type === 'document'; }).length;
        document.getElementById('countBlog').textContent = mediaFiles.filter(function(f) { return f.folder === 'blog'; }).length;
        document.getElementById('countDest').textContent = mediaFiles.filter(function(f) { return f.folder === 'destinations'; }).length;
        document.getElementById('countPages').textContent = mediaFiles.filter(function(f) { return f.folder === 'pages'; }).length;
        document.getElementById('countTours').textContent = mediaFiles.filter(function(f) { return f.folder === 'tours'; }).length;
    }

    // Initialize on page load
    if (document.getElementById('mediaPage')) {
        initMediaLibrary();
    }

    
    // ==================== MEDIA INTEGRATIONS ====================
    // Add Blog image to Media Library
    window.addBlogImageToMedia = function(imageUrl, title) {
        var newFile = {
            id: 'm' + Date.now(),
            name: title.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase() + '.jpg',
            type: 'image',
            size: Math.floor(Math.random() * 2000000) + 500000,
            url: imageUrl,
            date: new Date().toISOString().split('T')[0],
            folder: 'blog',
            width: 1920,
            height: 1080,
            alt: title,
            title: title,
            description: '',
            tags: ['blog']
        };
        mediaFiles.unshift(newFile);
        console.log('Blog image added to Media Library:', title);
    };

    // Add Tour image to Media Library
    window.addTourImageToMedia = function(imageUrl, title) {
        var newFile = {
            id: 'm' + Date.now(),
            name: title.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase() + '.jpg',
            type: 'image',
            size: Math.floor(Math.random() * 2000000) + 500000,
            url: imageUrl,
            date: new Date().toISOString().split('T')[0],
            folder: 'tours',
            width: 1920,
            height: 1080,
            alt: title,
            title: title,
            description: '',
            tags: ['tour']
        };
        mediaFiles.unshift(newFile);
        console.log('Tour image added to Media Library:', title);
    };

    // Add Destination image to Media Library
    window.addDestinationImageToMedia = function(imageUrl, title) {
        var newFile = {
            id: 'm' + Date.now(),
            name: title.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase() + '.jpg',
            type: 'image',
            size: Math.floor(Math.random() * 2000000) + 500000,
            url: imageUrl,
            date: new Date().toISOString().split('T')[0],
            folder: 'destinations',
            width: 1920,
            height: 1080,
            alt: title,
            title: title,
            description: '',
            tags: ['destination']
        };
        mediaFiles.unshift(newFile);
        console.log('Destination image added to Media Library:', title);
    };

    // Add Page image to Media Library
    window.addPageImageToMedia = function(imageUrl, title) {
        var newFile = {
            id: 'm' + Date.now(),
            name: title.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase() + '.jpg',
            type: 'image',
            size: Math.floor(Math.random() * 2000000) + 500000,
            url: imageUrl,
            date: new Date().toISOString().split('T')[0],
            folder: 'pages',
            width: 1920,
            height: 1080,
            alt: title,
            title: title,
            description: '',
            tags: ['page']
        };
        mediaFiles.unshift(newFile);
        console.log('Page image added to Media Library:', title);
    };

    // Generic function to add any image to Media Library
    window.addToMediaLibrary = function(imageUrl, title, folder) {
        var newFile = {
            id: 'm' + Date.now(),
            name: title.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase() + '.jpg',
            type: 'image',
            size: Math.floor(Math.random() * 2000000) + 500000,
            url: imageUrl,
            date: new Date().toISOString().split('T')[0],
            folder: folder || 'uploads',
            width: 1920,
            height: 1080,
            alt: title,
            title: title,
            description: '',
            tags: [folder || 'upload']
        };
        mediaFiles.unshift(newFile);
        console.log('Image added to Media Library (' + folder + '):', title);
    };

    </script>