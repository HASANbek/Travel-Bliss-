<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin CMS - Travel Bliss</title>
    <!-- Leaflet CSS for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f4f6f9;
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: #343a40;
            color: white;
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 20px;
            background: #2c3136;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-header .logo {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #343a40;
            font-size: 18px;
        }

        .sidebar-header h2 {
            font-size: 18px;
            font-weight: 600;
        }

        .user-panel {
            padding: 15px 20px;
            border-bottom: 1px solid #4b545c;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-panel .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
        }

        .user-panel .user-name {
            font-size: 14px;
            font-weight: 600;
        }

        .sidebar-menu {
            padding: 10px 0;
        }

        .menu-section-title {
            padding: 10px 20px;
            font-size: 11px;
            text-transform: uppercase;
            color: #8a939b;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #c2c7d0;
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
        }

        .menu-item:hover {
            background: #3f474e;
            color: white;
        }

        .menu-item.active {
            background: #007bff;
            color: white;
        }

        .menu-item i {
            width: 20px;
            margin-right: 10px;
            font-size: 14px;
        }

        /* Main Content */
        .main-content {
            margin-left: 250px;
            min-height: 100vh;
        }

        .top-header {
            background: white;
            border-bottom: 1px solid #dee2e6;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 57px;
        }

        .top-nav {
            display: flex;
            align-items: center;
            gap: 30px;
            padding: 0 20px;
        }

        .top-nav a {
            color: #495057;
            text-decoration: none;
            font-size: 14px;
            padding: 18px 0;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .top-nav a:hover,
        .top-nav a.active {
            color: #007bff;
            border-bottom-color: #007bff;
        }

        .top-right {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 0 20px;
        }

        .user-name-top {
            font-size: 14px;
            color: #495057;
        }

        .logout-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px 15px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        /* Content Header */
        .content-header {
            padding: 15px 20px;
            background: white;
            border-bottom: 1px solid #dee2e6;
        }

        .content-header h1 {
            font-size: 24px;
            color: #212529;
            margin-bottom: 5px;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #6c757d;
        }

        .breadcrumb a {
            color: #007bff;
            text-decoration: none;
        }

        /* Dashboard Content */
        .dashboard-content {
            padding: 20px;
        }

        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        .info-boxes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .info-box {
            background: white;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 0 1px rgba(0,0,0,.125), 0 1px 3px rgba(0,0,0,.2);
            transition: all 0.3s;
        }

        .info-box:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,.15);
            transform: translateY(-2px);
        }

        .info-box-header {
            padding: 15px 20px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .info-box-header h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .info-box-header .number {
            font-size: 32px;
            font-weight: 700;
            background: rgba(255,255,255,0.3);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .info-box-content {
            padding: 15px 20px;
            background: white;
        }

        .info-box-content a {
            color: #495057;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
            transition: all 0.3s;
        }

        .info-box.cyan .info-box-header { background: #17a2b8; }
        .info-box.green .info-box-header { background: #28a745; }
        .info-box.yellow .info-box-header { background: #ffc107; }
        .info-box.red .info-box-header { background: #dc3545; }
        .info-box.purple .info-box-header { background: #6f42c1; }

        /* Tours Section */
        .tours-table {
            background: white;
            border-radius: 4px;
            box-shadow: 0 0 1px rgba(0,0,0,.125), 0 1px 3px rgba(0,0,0,.2);
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f8f9fa;
        }

        th {
            padding: 12px 15px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
            color: #212529;
            font-size: 14px;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-right: 5px;
        }

        .edit-btn {
            background: #007bff;
            color: white;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            width: 98%;
            max-width: 1400px;
            max-height: 95vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }

        .modal-header h2 {
            font-size: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
        }

        .modal-body {
            padding: 25px 30px;
        }

        /* Step Indicator */
        .step-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 25px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            gap: 0;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            flex: 0 0 auto;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e9ecef;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .step.completed .step-number {
            background: #28a745;
            color: white;
        }

        .step-label {
            font-size: 13px;
            color: #6c757d;
            font-weight: 500;
            white-space: nowrap;
        }

        .step.active .step-label {
            color: #495057;
            font-weight: 600;
        }

        .step-line {
            width: 80px;
            height: 2px;
            background: #dee2e6;
            margin: 0 -5px;
            margin-bottom: 28px;
        }

        .step.active ~ .step-line {
            background: #dee2e6;
        }

        .step.completed ~ .step-line {
            background: #28a745;
        }

        /* Form Steps */
        .form-step {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .form-step.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        /* Form Row */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .itinerary-day-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }

        .itinerary-day-card .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #dee2e6;
        }

        .itinerary-day-card .day-number {
            font-size: 18px;
            font-weight: bold;
            color: #495057;
        }

        .itinerary-day-card .remove-day-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .itinerary-day-card .remove-day-btn:hover {
            background: #c82333;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Checkbox Labels */
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            background: white;
            transition: all 0.2s ease;
        }

        .checkbox-label:hover {
            background: #f8f9fa;
            border-color: #667eea;
        }

        .checkbox-label input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        /* Toggle Options */
        .toggle-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .toggle-option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .toggle-option:has(input:checked) {
            background: #e8f5e9;
            border-color: #28a745;
        }

        .toggle-label {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .toggle-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            margin: 0;
        }

        .toggle-text {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .toggle-text strong {
            color: #495057;
            font-size: 14px;
        }

        .toggle-text small {
            color: #6c757d;
            font-size: 12px;
        }

        /* Add Day Button */
        .btn-add-day {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn-add-day:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #dee2e6;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        /* Drag & Drop Styles */
        .drop-zone {
            border: 3px dashed #dee2e6;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .drop-zone:hover {
            border-color: #6366f1;
            background: #f0f2ff;
        }

        .drop-zone.drag-over {
            border-color: #6366f1;
            background: #e8ebff;
            transform: scale(1.02);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.2);
        }

        .drop-zone-content svg {
            color: #6366f1;
            margin-bottom: 15px;
        }

        .drop-zone-content h4 {
            font-size: 18px;
            color: #495057;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .drop-zone-content p {
            color: #6c757d;
            margin: 10px 0;
            font-size: 14px;
        }

        .drop-zone-content small {
            color: #adb5bd;
            font-size: 12px;
            display: block;
            margin-top: 10px;
        }

        .btn-browse {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-browse:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .btn-browse:active {
            transform: translateY(0);
        }

        /* Real-time Validation Styles */
        .form-group {
            position: relative;
        }

        .form-group input:not([type="file"]):not([type="checkbox"]),
        .form-group textarea,
        .form-group select {
            padding-right: 40px;
        }

        .form-group .validation-icon {
            position: absolute;
            right: 12px;
            top: 38px;
            font-size: 18px;
            display: none;
            pointer-events: none;
        }

        .form-group.valid .validation-icon.valid-icon {
            display: block;
            color: #10b981;
        }

        .form-group.invalid .validation-icon.invalid-icon {
            display: block;
            color: #ef4444;
        }

        .form-group input.valid:not([type="file"]):not([type="checkbox"]),
        .form-group textarea.valid,
        .form-group select.valid {
            border-color: #10b981;
            background-color: #f0fdf4;
        }

        .form-group input.invalid:not([type="file"]):not([type="checkbox"]),
        .form-group textarea.invalid,
        .form-group select.invalid {
            border-color: #ef4444;
            background-color: #fef2f2;
        }

        .validation-message {
            font-size: 12px;
            margin-top: 4px;
            display: none;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .validation-message.error {
            color: #ef4444;
            display: block;
        }

        .validation-message.success {
            color: #10b981;
            display: block;
        }

        .required-badge {
            color: #ef4444;
            font-size: 12px;
            font-weight: 600;
        }

        /* Image Reordering Styles */
        .image-card {
            position: relative;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            cursor: move;
            transition: all 0.3s;
        }

        .image-card:hover {
            border-color: #6366f1;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
        }

        .image-card.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .image-card.drag-over {
            border-color: #8b5cf6;
            border-style: dashed;
            background: #f0f2ff;
        }

        .image-card .drag-handle {
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            color: #6c757d;
            cursor: move;
            display: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 10;
        }

        .image-card:hover .drag-handle {
            display: block;
        }

        /* Image Preview Modal */
        .image-preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .image-preview-modal.active {
            display: flex;
        }

        .image-preview-content {
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }

        .image-preview-content img {
            max-width: 100%;
            max-height: 90vh;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .image-preview-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            z-index: 10001;
        }

        .image-preview-close:hover {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">A</div>
            <h2>Admin CMS</h2>
        </div>

        <div class="user-panel">
            <div class="user-avatar">üë§</div>
            <div class="user-info">
                <div class="user-name">Admin</div>
            </div>
        </div>

        <div class="sidebar-menu">
            <div class="menu-section">
                <div class="menu-section-title">MAIN</div>
                <a class="menu-item active" data-page="dashboard">
                    <i>üè†</i>
                    <span>Dashboard</span>
                </a>
                <a class="menu-item" data-page="tours">
                    <i>üéØ</i>
                    <span>Tours</span>
                </a>
                <a class="menu-item" data-page="bookings">
                    <i>üìã</i>
                    <span>Bookings</span>
                </a>
                <a class="menu-item" data-page="users">
                    <i>üë•</i>
                    <span>Users</span>
                </a>
                <a class="menu-item" data-page="pages">
                    <i>üìÑ</i>
                    <span>Pages</span>
                </a>
            </div>

            <div class="menu-section">
                <div class="menu-section-title">CONTENT</div>
                <a class="menu-item" data-page="categories">
                    <i>üóÇÔ∏è</i>
                    <span>Categories</span>
                </a>
                <a class="menu-item" data-page="destinations">
                    <i>üåç</i>
                    <span>Destinations</span>
                </a>
                <a class="menu-item" data-page="media">
                    <i>üñºÔ∏è</i>
                    <span>Media Library</span>
                </a>
                <a class="menu-item" data-page="reviews">
                    <i>‚≠ê</i>
                    <span>Reviews</span>
                </a>
                <a class="menu-item" data-page="blog">
                    <i>üìù</i>
                    <span>Blog</span>
                </a>
            </div>

            <div class="menu-section">
                <div class="menu-section-title">SETTINGS</div>
                <a class="menu-item" data-page="settings">
                    <i>‚öôÔ∏è</i>
                    <span>General Settings</span>
                </a>
                <a class="menu-item" data-page="seo">
                    <i>üîç</i>
                    <span>SEO Settings</span>
                </a>
                <a class="menu-item" onclick="logout()">
                    <i>üö™</i>
                    <span>Logout</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="top-header">
            <div class="top-nav">
                <a href="#" class="active">Dashboard</a>
                <a href="/gofly/travel-agency-03.html" target="_blank">View Website</a>
            </div>
            <div class="top-right">
                <span class="user-name-top">Admin</span>
                <button class="logout-btn" onclick="logout()">
                    <span>üö™</span>
                    <span>Logout</span>
                </button>
            </div>
        </div>

        <div class="content-header">
            <h1 id="pageTitle">Dashboard</h1>
            <div class="breadcrumb">
                <a href="#">Home</a>
                <span>/</span>
                <span id="pageBreadcrumb">Dashboard</span>
            </div>
        </div>

        <div class="dashboard-content">
            <!-- Dashboard Page -->
            <div class="page-section active" id="dashboardPage">
                <div class="info-boxes">
                    <div class="info-box cyan">
                        <div class="info-box-header">
                            <h3>Total Tours</h3>
                            <div class="number" id="totalTours">0</div>
                        </div>
                        <div class="info-box-content">
                            <a href="#" onclick="showPage('tours'); return false;">
                                <span>More info</span>
                                <span>‚Üí</span>
                            </a>
                        </div>
                    </div>

                    <div class="info-box green">
                        <div class="info-box-header">
                            <h3>Active Tours</h3>
                            <div class="number" id="activeTours">0</div>
                        </div>
                        <div class="info-box-content">
                            <a href="#" onclick="showPage('tours'); return false;">
                                <span>More info</span>
                                <span>‚Üí</span>
                            </a>
                        </div>
                    </div>

                    <div class="info-box yellow">
                        <div class="info-box-header">
                            <h3>Total Bookings</h3>
                            <div class="number">0</div>
                        </div>
                        <div class="info-box-content">
                            <a href="#" onclick="showPage('bookings'); return false;">
                                <span>More info</span>
                                <span>‚Üí</span>
                            </a>
                        </div>
                    </div>

                    <div class="info-box red">
                        <div class="info-box-header">
                            <h3>Today's Bookings</h3>
                            <div class="number">0</div>
                        </div>
                        <div class="info-box-content">
                            <a href="#" onclick="showPage('bookings'); return false;">
                                <span>More info</span>
                                <span>‚Üí</span>
                            </a>
                        </div>
                    </div>

                    <div class="info-box purple">
                        <div class="info-box-header">
                            <h3>Blog Posts</h3>
                            <div class="number" id="totalBlogs">0</div>
                        </div>
                        <div class="info-box-content">
                            <a href="#" onclick="showPage('blog'); return false;">
                                <span>More info</span>
                                <span>‚Üí</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tours Page -->
            <div class="page-section" id="toursPage">
                <div style="margin-bottom: 20px;">
                    <button onclick="openAddTourModal()" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; display: inline-flex; align-items: center; gap: 8px;">
                        <span style="font-size: 18px;">+</span> Add New Tour
                    </button>
                </div>
                <div class="tours-table">
                    <div id="toursTableContainer">
                        <div class="loading">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Bookings Page -->
            <div class="page-section" id="bookingsPage">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Bookings Management</h2>
                    <div style="display: flex; gap: 10px;">
                        <select id="statusFilter" style="padding: 8px 15px; border-radius: 5px; border: 1px solid #ddd;">
                            <option value="">All Statuses</option>
                            <option value="pending">Pending</option>
                            <option value="confirmed">Confirmed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                        <button onclick="loadBookings()" class="btn-primary" style="padding: 8px 20px; background: #6366f1; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Refresh
                        </button>
                    </div>
                </div>

                <!-- Statistics Cards -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">
                    <div style="background: #f8f9ff; border: 2px solid #6366f1; border-radius: 12px; padding: 20px;">
                        <h4 style="color: #666; font-size: 14px; margin: 0 0 10px 0;">Total Bookings</h4>
                        <p style="font-size: 32px; font-weight: bold; color: #6366f1; margin: 0;" id="totalBookings">0</p>
                    </div>
                    <div style="background: #fff8e1; border: 2px solid #ff9800; border-radius: 12px; padding: 20px;">
                        <h4 style="color: #666; font-size: 14px; margin: 0 0 10px 0;">Pending</h4>
                        <p style="font-size: 32px; font-weight: bold; color: #ff9800; margin: 0;" id="pendingBookings">0</p>
                    </div>
                    <div style="background: #e8f5e9; border: 2px solid #22c55e; border-radius: 12px; padding: 20px;">
                        <h4 style="color: #666; font-size: 14px; margin: 0 0 10px 0;">Confirmed</h4>
                        <p style="font-size: 32px; font-weight: bold; color: #22c55e; margin: 0;" id="confirmedBookings">0</p>
                    </div>
                    <div style="background: #ffebee; border: 2px solid #ef4444; border-radius: 12px; padding: 20px;">
                        <h4 style="color: #666; font-size: 14px; margin: 0 0 10px 0;">Cancelled</h4>
                        <p style="font-size: 32px; font-weight: bold; color: #ef4444; margin: 0;" id="cancelledBookings">0</p>
                    </div>
                </div>

                <!-- Bookings Table -->
                <div style="background: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f9fafb; border-bottom: 2px solid #e5e7eb;">
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151;">ID</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151;">Tour</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151;">Customer</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151;">Date</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151;">Guests</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151;">Price</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151;">Status</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="bookingsTableBody">
                            <tr>
                                <td colspan="8" style="padding: 40px; text-align: center; color: #9ca3af;">
                                    Loading bookings...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Users Page -->
            <div class="page-section" id="usersPage">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Users Management</h2>
                    <button class="add-tour-btn" onclick="openAddUserModal()">+ Add New User</button>
                </div>

                <div id="usersTableContainer" style="background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden;">
                    <p style="padding: 20px; text-align: center; color: #6c757d;">Loading users...</p>
                </div>
            </div>

            <!-- Pages Page -->
            <div class="page-section" id="pagesPage">
                <h3>Pages management coming soon...</h3>
            </div>

            <!-- Categories Page -->
            <div class="page-section" id="categoriesPage">
                <button class="add-tour-btn" onclick="openCategoryModal()">+ Add New Category</button>

                <div class="tours-table-wrapper">
                    <table class="tours-table">
                        <thead>
                            <tr>
                                <th>Order</th>
                                <th>Icon</th>
                                <th>Name</th>
                                <th>Slug</th>
                                <th>Color</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="categoriesTableBody">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">
                                    Loading categories...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Destinations Page -->
            <div class="page-section" id="destinationsPage">
                <button class="add-tour-btn" onclick="openDestinationModal()">+ Add New Destination</button>

                <div class="tours-table">
                    <div id="destinationsTableContainer">
                        <div class="loading">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Media Page -->
            <div class="page-section" id="mediaPage">
                <h3>Media library coming soon...</h3>
            </div>

            <!-- Reviews Page -->
            <div class="page-section" id="reviewsPage">
                <h3>Reviews management coming soon...</h3>
            </div>

            <!-- Blog Page -->
            <div class="page-section" id="blogPage">
                <button class="add-tour-btn" onclick="openBlogModal()">+ Add New Blog Post</button>

                <div class="tours-table">
                    <div id="blogTableContainer">
                        <table>
                            <thead>
                                <tr>
                                    <th>Image</th>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Author</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="blogTableBody">
                                <tr>
                                    <td colspan="7" class="loading">Loading blog posts...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div class="page-section" id="settingsPage">
                <h3>General settings coming soon...</h3>
            </div>

            <!-- SEO Page -->
            <div class="page-section" id="seoPage">
                <h3>SEO settings coming soon...</h3>
            </div>
        </div>
    </div>

    <!-- AI Assistant Modal -->
    <div class="modal" id="aiModal" style="z-index: 10001;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>‚ú® AI Tour Assistant</h2>
                <button class="close-btn" onclick="closeAIModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="background: linear-gradient(135deg, #e7f3ff 0%, #f0f7ff 100%); border-left: 4px solid #2196F3; padding: 15px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(33, 150, 243, 0.1);">
                    <p style="color: #1976D2; margin: 0; font-size: 14px; line-height: 1.6;">
                        <strong style="font-size: 15px;">‚ú® AI Yordamchisi</strong><br>
                        Quyidagi asosiy ma'lumotlarni kiriting, AI avtomatik ravishda:<br>
                        ‚Ä¢ To'liq tur tavsifini<br>
                        ‚Ä¢ Kunlik dasturni (itinerary)<br>
                        ‚Ä¢ Nima kiradi/kirmaydi ro'yxatlarini<br>
                        ‚Ä¢ Tur diqqatga sazovor joylari (highlights)ni yaratadi!
                    </p>
                </div>

                <div class="form-group">
                    <label>Tour Type *</label>
                    <select id="aiCategory">
                        <option value="">Select tour type</option>
                        <option value="cultural">üèõÔ∏è Cultural Tour</option>
                        <option value="adventure">üèîÔ∏è Adventure Tour</option>
                        <option value="hiking">ü•æ Hiking Tour</option>
                        <option value="day-trip">üåÖ Day Trip</option>
                    </select>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Duration (Days) *</label>
                        <input type="number" id="aiDuration" min="1" placeholder="5">
                    </div>
                    <div class="form-group">
                        <label>Nights</label>
                        <input type="number" id="aiNights" min="0" placeholder="4">
                    </div>
                </div>

                <div class="form-group">
                    <label>Destination *</label>
                    <input type="text" id="aiDestination" placeholder="Samarkand, Bukhara, Khiva">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Price (USD) *</label>
                        <input type="number" id="aiPrice" min="0" placeholder="500">
                    </div>
                    <div class="form-group">
                        <label>Max Group Size *</label>
                        <input type="number" id="aiMaxGroupSize" min="1" placeholder="15">
                    </div>
                </div>

                <div class="form-group">
                    <label>Difficulty Level</label>
                    <select id="aiDifficulty">
                        <option value="easy">Easy</option>
                        <option value="moderate" selected>Moderate</option>
                        <option value="challenging">Challenging</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Accommodation Type</label>
                    <select id="aiAccommodation">
                        <option value="">Not specified</option>
                        <option value="5 Star Hotel">5 Star Hotel</option>
                        <option value="4 Star Hotel">4 Star Hotel</option>
                        <option value="3 Star Hotel" selected>3 Star Hotel</option>
                        <option value="Boutique Hotel">Boutique Hotel</option>
                        <option value="Guesthouse">Guesthouse</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Additional Description (Optional)</label>
                    <textarea id="aiPrompt" rows="3" placeholder="Add any specific details or requirements..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAIModal()">Cancel</button>
                <button class="btn btn-primary" onclick="generateTourWithAI()">‚ú® Generate Tour</button>
            </div>
        </div>
    </div>


    <!-- AI Assistant Modal -->
    <div class="modal" id="aiAssistantModal" style="z-index: 2100;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <div>
                    <h2 style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">ü§ñ</span> AI Blog Assistant
                    </h2>
                    <p style="font-size: 13px; color: #6c757d; margin-top: 5px;">Let AI help you create amazing blog content</p>
                </div>
                <button class="close-btn" onclick="closeAIAssistant()">&times;</button>
            </div>

            <div class="modal-body">
                <div style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #667eea30;">
                    <h3 style="font-size: 15px; font-weight: 600; color: #2c3e50; margin-bottom: 15px;">
                        What would you like AI to help you with?
                    </h3>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
                        <button type="button" onclick="selectAITask('title')" class="ai-task-btn"
                                style="padding: 15px; background: white; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; text-align: left; transition: all 0.3s;">
                            <div style="font-size: 20px; margin-bottom: 5px;">‚ú®</div>
                            <div style="font-weight: 600; font-size: 14px; color: #2c3e50;">Generate Title</div>
                            <div style="font-size: 12px; color: #6c757d; margin-top: 3px;">Create catchy blog title</div>
                        </button>

                        <button type="button" onclick="selectAITask('excerpt')" class="ai-task-btn"
                                style="padding: 15px; background: white; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; text-align: left; transition: all 0.3s;">
                            <div style="font-size: 20px; margin-bottom: 5px;">üìù</div>
                            <div style="font-weight: 600; font-size: 14px; color: #2c3e50;">Generate Excerpt</div>
                            <div style="font-size: 12px; color: #6c757d; margin-top: 3px;">Write brief summary</div>
                        </button>

                        <button type="button" onclick="selectAITask('content')" class="ai-task-btn"
                                style="padding: 15px; background: white; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; text-align: left; transition: all 0.3s;">
                            <div style="font-size: 20px; margin-bottom: 5px;">‚úçÔ∏è</div>
                            <div style="font-weight: 600; font-size: 14px; color: #2c3e50;">Write Full Content</div>
                            <div style="font-size: 12px; color: #6c757d; margin-top: 3px;">Create complete article</div>
                        </button>

                        <button type="button" onclick="selectAITask('improve')" class="ai-task-btn"
                                style="padding: 15px; background: white; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; text-align: left; transition: all 0.3s;">
                            <div style="font-size: 20px; margin-bottom: 5px;">üöÄ</div>
                            <div style="font-weight: 600; font-size: 14px; color: #2c3e50;">Improve Content</div>
                            <div style="font-size: 12px; color: #6c757d; margin-top: 3px;">Enhance existing text</div>
                        </button>
                    </div>

                    <div id="aiPromptSection" style="display: none;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #495057; font-size: 14px;">
                            Tell AI what you want:
                        </label>
                        <textarea id="aiPrompt" rows="4" placeholder="e.g., Write about traveling to Samarkand, its history and attractions..."
                                  style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px; resize: vertical;"></textarea>

                        <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" onclick="closeAIAssistant()"
                                    style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer;">
                                Cancel
                            </button>
                            <button type="button" onclick="generateWithAI()" id="generateBtn"
                                    style="padding: 10px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);">
                                ‚ú® Generate
                            </button>
                        </div>
                    </div>

                    <div id="aiLoadingSection" style="display: none; text-align: center; padding: 30px;">
                        <div style="font-size: 48px; margin-bottom: 15px; animation: pulse 1.5s infinite;">ü§ñ</div>
                        <div style="font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 5px;">AI is working...</div>
                        <div style="font-size: 13px; color: #6c757d;">Generating your content</div>
                    </div>

                    <div id="aiResultSection" style="display: none;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #495057; font-size: 14px;">
                            AI Generated Content:
                        </label>
                        <div id="aiResult"
                             style="background: white; padding: 15px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; line-height: 1.6;"></div>

                        <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" onclick="regenerateAI()"
                                    style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer;">
                                üîÑ Regenerate
                            </button>
                            <button type="button" onclick="useAIContent()"
                                    style="padding: 10px 24px; background: #28a745; color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer;">
                                ‚úì Use This Content
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .ai-task-btn:hover {
            border-color: #667eea !important;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        label[for="blogImageFile"]:hover {
            border-color: #667eea !important;
            background: #f8f9ff !important;
        }

        /* Add Tour Modal Styles */
        .add-tour-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            overflow-y: auto;
        }

        .add-tour-modal.active {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 40px 20px;
        }

        .add-tour-modal-content {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 900px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .add-tour-modal-header {
            padding: 25px 30px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px 12px 0 0;
        }

        .add-tour-modal-header h2 {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
        }

        .add-tour-close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .add-tour-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .tour-tabs {
            display: flex;
            border-bottom: 2px solid #f0f0f0;
            background: #fafafa;
            overflow-x: auto;
        }

        .tour-tab {
            padding: 15px 25px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tour-tab:hover {
            color: #667eea;
            background: #f5f7ff;
        }

        .tour-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }

        .tour-tab-content {
            display: none;
            padding: 30px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .tour-tab-content.active {
            display: block;
        }

        .tour-form-group {
            margin-bottom: 20px;
        }

        .tour-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }

        .tour-form-group label .required {
            color: #dc3545;
        }

        .tour-form-group input,
        .tour-form-group select,
        .tour-form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .tour-form-group input:focus,
        .tour-form-group select:focus,
        .tour-form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .tour-form-group textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        .tour-form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .add-tour-modal-footer {
            padding: 20px 30px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            background: #fafafa;
            border-radius: 0 0 12px 12px;
        }

        .tour-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tour-btn-cancel {
            background: #f0f0f0;
            color: #6c757d;
        }

        .tour-btn-cancel:hover {
            background: #e0e0e0;
        }

        .tour-btn-save {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tour-btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        /* Itinerary Styles */
        .itinerary-day {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            background: #fafafa;
        }

        .itinerary-day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .itinerary-day-number {
            font-size: 18px;
            font-weight: 700;
            color: #667eea;
        }

        .remove-day-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }

        .remove-day-btn:hover {
            background: #c82333;
        }

        .activity-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .activity-item input {
            flex: 1;
        }

        .remove-activity-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }

        .add-item-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .add-item-btn:hover {
            background: #218838;
        }
    </style>

    <!-- Add Tour Modal -->
    <div class="add-tour-modal" id="addTourModal">
        <div class="add-tour-modal-content">
            <div class="add-tour-modal-header">
                <h2>‚ûï Add New Tour</h2>
                <button class="add-tour-close-btn" onclick="closeAddTourModal()">&times;</button>
            </div>

            <div class="tour-tabs">
                <button type="button" class="tour-tab active" onclick="switchTourTab(0)">üìù Basic Info</button>
                <button type="button" class="tour-tab" onclick="switchTourTab(1)">üéØ Details</button>
                <button type="button" class="tour-tab" onclick="switchTourTab(2)">üìÖ Itinerary</button>
                <button type="button" class="tour-tab" onclick="switchTourTab(3)">‚úÖ Inclusions</button>
                <button type="button" class="tour-tab" onclick="switchTourTab(4)">üñºÔ∏è Media</button>
                <button type="button" class="tour-tab" onclick="switchTourTab(5)">‚öôÔ∏è Settings</button>
            </div>

            <form id="addTourForm">
                <!-- Tab 1: Basic Info -->
                <div class="tour-tab-content active" data-tab="0">
                    <h3 style="margin-top: 0; color: #2c3e50;">Basic Information</h3>

                    <div class="tour-form-group">
                        <label>Tour Name <span class="required">*</span></label>
                        <input type="text" id="tourName" name="title" placeholder="E.g.: 10-Day Uzbekistan Grand Tour" required>
                    </div>

                    <div class="tour-form-row">
                        <div class="tour-form-group">
                            <label>Category <span class="required">*</span></label>
                            <select id="tourCategory" name="category" required>
                                <option value="">Select category</option>
                                <option value="cultural">Cultural Tours</option>
                                <option value="adventure">Adventure Tours</option>
                                <option value="day-trips">Day Trips</option>
                                <option value="homestays">Homestays & Hiking</option>
                            </select>
                        </div>

                        <div class="tour-form-group">
                            <label>Destination <span class="required">*</span></label>
                            <input type="text" id="tourDestination" name="destination" placeholder="E.g.: Uzbekistan" required>
                        </div>
                    </div>

                    <div class="tour-form-row">
                        <div class="tour-form-group">
                            <label>Price (USD) <span class="required">*</span></label>
                            <input type="number" id="tourPrice" name="price" placeholder="1299" min="0" required>
                        </div>

                        <div class="tour-form-group">
                            <label>Discount Price (USD)</label>
                            <input type="number" id="tourDiscountPrice" name="discountPrice" placeholder="999" min="0">
                        </div>
                    </div>

                    <div class="tour-form-row">
                        <div class="tour-form-group">
                            <label>Duration (Days) <span class="required">*</span></label>
                            <input type="number" id="tourDuration" name="duration" placeholder="10" min="1" required>
                        </div>

                        <div class="tour-form-group">
                            <label>Nights <span class="required">*</span></label>
                            <input type="number" id="tourNights" name="nights" placeholder="9" min="0" required>
                        </div>
                    </div>

                    <div class="tour-form-group">
                        <label>Summary (1-2 sentences)</label>
                        <textarea id="tourSummary" name="summary" placeholder="Brief summary of the tour..." rows="2"></textarea>
                    </div>

                    <div class="tour-form-group">
                        <label>Full Description <span class="required">*</span></label>
                        <textarea id="tourDescription" name="description" placeholder="Detailed description of the tour..." rows="5" required></textarea>
                    </div>
                </div>

                <!-- Tab 2: Details -->
                <div class="tour-tab-content" data-tab="1">
                    <h3 style="margin-top: 0; color: #2c3e50;">Tour Details</h3>

                    <div class="tour-form-row">
                        <div class="tour-form-group">
                            <label>Max Group Size</label>
                            <input type="number" id="tourMaxGroup" name="maxGroupSize" placeholder="15" min="1">
                        </div>

                        <div class="tour-form-group">
                            <label>Difficulty</label>
                            <select id="tourDifficulty" name="difficulty">
                                <option value="easy">Easy</option>
                                <option value="moderate" selected>Moderate</option>
                                <option value="challenging">Challenging</option>
                            </select>
                        </div>
                    </div>

                    <div class="tour-form-group">
                        <label>Languages (comma separated)</label>
                        <input type="text" id="tourLanguages" name="languages" placeholder="English, Russian, Uzbek">
                    </div>

                    <div class="tour-form-group">
                        <label>Availability/Season</label>
                        <input type="text" id="tourAvailability" name="season" placeholder="E.g.: March & Autumn (Best)">
                    </div>

                    <div class="tour-form-group">
                        <label>Highlights (one per line)</label>
                        <textarea id="tourHighlights" name="highlights" placeholder="Visit ancient Silk Road cities&#10;Explore UNESCO World Heritage sites&#10;Experience local culture" rows="6"></textarea>
                    </div>
                </div>

                <!-- Tab 3: Itinerary -->
                <div class="tour-tab-content" data-tab="2">
                    <h3 style="margin-top: 0; color: #2c3e50;">Daily Itinerary</h3>

                    <div id="itineraryContainer">
                        <!-- Itinerary days will be added here -->
                    </div>

                    <button type="button" class="add-item-btn" onclick="addItineraryDay()">
                        <span style="font-size: 16px;">+</span> Add Day
                    </button>
                </div>

                <!-- Tab 4: Inclusions -->
                <div class="tour-tab-content" data-tab="3">
                    <h3 style="margin-top: 0; color: #2c3e50;">What's Included & Excluded</h3>

                    <div class="tour-form-group">
                        <label>What's Included (one per line)</label>
                        <textarea id="tourIncluded" name="included" placeholder="Accommodation&#10;Meals&#10;Transportation&#10;Tour guide" rows="8"></textarea>
                    </div>

                    <div class="tour-form-group">
                        <label>What's Excluded (one per line)</label>
                        <textarea id="tourExcluded" name="excluded" placeholder="International flights&#10;Travel insurance&#10;Personal expenses" rows="8"></textarea>
                    </div>
                </div>

                <!-- Tab 5: Media -->
                <div class="tour-tab-content" data-tab="4">
                    <h3 style="margin-top: 0; color: #2c3e50;">Images & Media</h3>

                    <div class="tour-form-group">
                        <label>üì§ Upload or Add Images</label>
                        <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px;">
                            <input type="file" id="tourMediaUpload" accept="image/*" multiple style="display: none;">
                            <button type="button" class="tour-btn" onclick="document.getElementById('tourMediaUpload').click()" style="background: #667eea; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                                <span>üì∑</span> Choose Images
                            </button>
                            <button type="button" id="uploadMediaBtn" onclick="uploadMediaImages()" style="background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; display: none;">
                                Upload Selected
                            </button>
                            <button type="button" onclick="addImageUrlManually()" style="background: #17a2b8; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer;">
                                + Add URL
                            </button>
                        </div>
                        <small style="color: #6c757d; display: block; margin-bottom: 15px;">Upload images or add URLs manually. First image will be the cover.</small>
                    </div>

                    <!-- Image Manager -->
                    <div id="imageManager" style="min-height: 150px; padding: 20px; background: #f8f9fa; border-radius: 8px; border: 2px dashed #ddd;">
                        <div id="imageManagerContainer" style="display: flex; flex-wrap: wrap; gap: 15px;"></div>
                        <div id="imageManagerEmpty" style="text-align: center; color: #6c757d; padding: 40px;">
                            <p style="font-size: 18px; margin: 0;">No images yet</p>
                            <p style="font-size: 14px; margin: 5px 0 0 0;">Upload images or add URLs to get started</p>
                        </div>
                    </div>

                    <!-- Hidden textarea for form submission -->
                    <textarea id="tourImages" name="images" style="display: none;"></textarea>
                </div>

                <!-- Tab 6: Settings -->
                <div class="tour-tab-content" data-tab="5">
                    <h3 style="margin-top: 0; color: #2c3e50;">Advanced Settings</h3>

                    <div class="tour-form-group">
                        <label>Status</label>
                        <select id="tourStatus" name="status">
                            <option value="active" selected>Active</option>
                            <option value="draft">Draft</option>
                            <option value="archived">Archived</option>
                        </select>
                    </div>

                    <div class="tour-form-group">
                        <label>
                            <input type="checkbox" id="tourFeatured" name="featured" style="width: auto; margin-right: 8px;">
                            Featured (show on homepage)
                        </label>
                    </div>

                    <div class="tour-form-group">
                        <label>Slug (URL-friendly name)</label>
                        <input type="text" id="tourSlug" name="slug" placeholder="Will be auto-generated from title">
                        <small style="color: #6c757d;">Leave empty to auto-generate</small>
                    </div>
                </div>
            </form>

            <div class="add-tour-modal-footer">
                <button type="button" class="tour-btn tour-btn-cancel" onclick="closeAddTourModal()">Cancel</button>
                <button type="button" class="tour-btn tour-btn-save" onclick="saveTour()">Save Tour</button>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_URL = 'http://localhost:4000/api';

        // ========== GLOBAL FETCH WITH AUTH TOKEN ==========
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            const token = localStorage.getItem('accessToken');

            // Only modify if it's our API
            if (args[0] && typeof args[0] === 'string' && args[0].startsWith(API_URL)) {
                const options = args[1] || {};

                // Ensure headers object exists
                if (!options.headers) {
                    options.headers = {};
                }

                // Add Authorization header
                if (token) {
                    options.headers['Authorization'] = `Bearer ${token}`;
                }

                // Add Content-Type if not present and it's a POST/PUT request
                // BUT skip if body is FormData (for file uploads - browser sets correct Content-Type)
                if (options.method && ['POST', 'PUT', 'PATCH'].includes(options.method.toUpperCase())) {
                    if (!options.headers['Content-Type'] && !(options.body instanceof FormData)) {
                        options.headers['Content-Type'] = 'application/json';
                    }
                }

                args[1] = options;
                console.log('üîê Fetch intercepted:', args[0], 'with token:', !!token);
            }

            return originalFetch.apply(this, args);
        };

        let currentAITask = null;

        function openAIAssistant() {
            document.getElementById('aiAssistantModal').style.display = 'flex';
            currentAITask = null;
            document.getElementById('aiPromptSection').style.display = 'none';
            document.getElementById('aiResultSection').style.display = 'none';
            document.getElementById('aiLoadingSection').style.display = 'none';
        }

        function closeAIAssistant() {
            document.getElementById('aiAssistantModal').style.display = 'none';
            currentAITask = null;
        }

        function selectAITask(task) {
            currentAITask = task;
            document.getElementById('aiPromptSection').style.display = 'block';
            document.getElementById('aiResultSection').style.display = 'none';

            const promptField = document.getElementById('aiPrompt');

            // Set placeholder based on task
            const placeholders = {
                'title': 'e.g., Write a title about adventure travel in Uzbekistan...',
                'excerpt': 'e.g., Create a summary about the best beaches in Maldives...',
                'content': 'e.g., Write a detailed article about cultural tours in Samarkand...',
                'improve': 'Paste your existing content here to improve...'
            };

            promptField.placeholder = placeholders[task] || '';
            promptField.value = '';
            promptField.focus();
        }

        async function generateWithAI() {
            const prompt = document.getElementById('aiPrompt').value.trim();

            if (!prompt) {
                alert('Please enter your request for AI');
                return;
            }

            // Show loading
            document.getElementById('aiPromptSection').style.display = 'none';
            document.getElementById('aiLoadingSection').style.display = 'block';

            try {
                // Simulate AI generation (replace with actual API call)
                await new Promise(resolve => setTimeout(resolve, 2000));

                let generatedContent = '';

                switch(currentAITask) {
                    case 'title':
                        generatedContent = generateSampleTitle(prompt);
                        break;
                    case 'excerpt':
                        generatedContent = generateSampleExcerpt(prompt);
                        break;
                    case 'content':
                        generatedContent = generateSampleContent(prompt);
                        break;
                    case 'improve':
                        generatedContent = improveSampleContent(prompt);
                        break;
                }

                // Show result
                document.getElementById('aiLoadingSection').style.display = 'none';
                document.getElementById('aiResultSection').style.display = 'block';
                document.getElementById('aiResult').textContent = generatedContent;

            } catch (error) {
                console.error('AI generation error:', error);
                alert('Error generating content. Please try again.');
                document.getElementById('aiLoadingSection').style.display = 'none';
                document.getElementById('aiPromptSection').style.display = 'block';
            }
        }

        function regenerateAI() {
            generateWithAI();
        }

        function useAIContent() {
            const content = document.getElementById('aiResult').textContent;

            switch(currentAITask) {
                case 'title':
                    document.getElementById('blogTitle').value = content;
                    break;
                case 'excerpt':
                    document.getElementById('blogExcerpt').value = content;
                    break;
                case 'content':
                case 'improve':
                    document.getElementById('blogContent').value = content;
                    break;
            }

            closeAIAssistant();
            alert('Content added to form successfully!');
        }

        // Sample generators (replace with actual AI API)
        function generateSampleTitle(prompt) {
            const titles = [
                "Discover the Hidden Gems of " + prompt,
                "Ultimate Guide to " + prompt + ": Everything You Need to Know",
                "Top 10 Reasons to Visit " + prompt + " This Year",
                "Exploring " + prompt + ": A Journey of a Lifetime"
            ];
            return titles[Math.floor(Math.random() * titles.length)];
        }

        function generateSampleExcerpt(prompt) {
            return `Discover the beauty and wonder of ${prompt}. From stunning landscapes to rich cultural experiences, this destination offers unforgettable memories for every traveler. Join us as we explore everything this amazing place has to offer.`;
        }

        function generateSampleContent(prompt) {
            return `# Exploring ${prompt}\n\nWelcome to an incredible journey through one of the world's most fascinating destinations. ${prompt} offers a unique blend of natural beauty, rich history, and vibrant culture that captivates visitors from around the globe.\n\n## What Makes It Special\n\nFrom the moment you arrive, you'll be greeted by breathtaking scenery and warm hospitality. The local culture is rich with traditions that have been preserved for centuries, offering visitors a glimpse into a way of life that's both ancient and vibrant.\n\n## Top Attractions\n\n1. Historic landmarks that tell stories of the past\n2. Natural wonders that showcase stunning landscapes\n3. Cultural experiences that immerse you in local traditions\n4. Culinary delights that tantalize your taste buds\n\n## Planning Your Visit\n\nThe best time to visit is during the pleasant seasons when the weather is ideal for exploration. Make sure to pack appropriately and plan your itinerary to make the most of your time.\n\n## Conclusion\n\nWhether you're seeking adventure, relaxation, or cultural enrichment, this destination has something for everyone. Start planning your journey today and create memories that will last a lifetime.`;
        }

        function improveSampleContent(content) {
            return content + "\n\n[Enhanced version with improved flow and additional details]\n\nThis content has been refined for better readability and engagement. The structure is more organized, and key points are emphasized to capture reader attention effectively.";
        }

        // ============================================
        // LOCATION & MAP FUNCTIONS
        // ============================================

        let blogMap = null;
        let blogMarker = null;

        function initializeLocationMap() {
            // Initialize map if not already initialized
            if (!blogMap) {
                // Default to Uzbekistan center
                const defaultLat = parseFloat(document.getElementById('blogLatitude').value) || 41.3775;
                const defaultLng = parseFloat(document.getElementById('blogLongitude').value) || 64.5853;

                blogMap = L.map('blogMap').setView([defaultLat, defaultLng], 6);

                // Add OpenStreetMap tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap',
                    maxZoom: 18
                }).addTo(blogMap);

                // Add click event to set location
                blogMap.on('click', function(e) {
                    setMapLocation(e.latlng.lat, e.latlng.lng);
                });

                // Add marker if coordinates exist
                if (defaultLat !== 41.3775 || defaultLng !== 64.5853) {
                    blogMarker = L.marker([defaultLat, defaultLng]).addTo(blogMap);
                    updateCoordinatesDisplay(defaultLat, defaultLng);
                }
            }

            // Refresh map size
            setTimeout(() => {
                blogMap.invalidateSize();
            }, 100);
        }

        function setMapLocation(lat, lng) {
            // Update hidden fields
            document.getElementById('blogLatitude').value = lat.toFixed(6);
            document.getElementById('blogLongitude').value = lng.toFixed(6);

            // Update coordinates display
            updateCoordinatesDisplay(lat, lng);

            // Remove old marker if exists
            if (blogMarker) {
                blogMap.removeLayer(blogMarker);
            }

            // Add new marker with custom icon
            blogMarker = L.marker([lat, lng], {
                icon: L.divIcon({
                    className: 'custom-marker',
                    html: '<div style="background: #667eea; width: 24px; height: 24px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);"></div>',
                    iconSize: [24, 24],
                    iconAnchor: [12, 12]
                })
            }).addTo(blogMap);
            blogMap.setView([lat, lng], 12);

            // Try to get location name using reverse geocoding
            fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`)
                .then(response => response.json())
                .then(data => {
                    if (data.display_name && !document.getElementById('blogLocation').value) {
                        document.getElementById('blogLocation').value = data.display_name;
                    }
                })
                .catch(error => console.error('Geocoding error:', error));
        }

        function updateCoordinatesDisplay(lat, lng) {
            const display = document.getElementById('coordinatesDisplay');
            if (display) {
                display.textContent = `üìå ${lat.toFixed(4)}, ${lng.toFixed(4)}`;
            }
        }

        // ============================================
        // IMAGE UPLOAD FUNCTIONS
        // ============================================

        let uploadedImageData = null;

        function handleImageUpload(event) {
            const file = event.target.files[0];

            if (!file) return;

            // Validate file type
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                alert('Please upload a valid image file (JPG, PNG, GIF, WebP)');
                return;
            }

            // Validate file size (10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('Image size must be less than 10MB. Please use a smaller image.');
                document.getElementById('blogImageFile').value = '';
                return;
            }

            // Read and preview image
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedImageData = e.target.result;

                // Show preview
                document.getElementById('uploadPlaceholder').style.display = 'none';
                document.getElementById('imagePreviewContainer').style.display = 'block';
                document.getElementById('imagePreview').src = e.target.result;
                document.getElementById('imageFileName').textContent = '‚úì ' + file.name;
                document.getElementById('removeImageBtn').style.display = 'block';

                // Set the image URL field with the data URL
                document.getElementById('blogImage').value = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function removeUploadedImage() {
            uploadedImageData = null;
            document.getElementById('blogImageFile').value = '';
            document.getElementById('uploadPlaceholder').style.display = 'flex';
            document.getElementById('imagePreviewContainer').style.display = 'none';
            document.getElementById('imagePreview').src = '';
            document.getElementById('imageFileName').textContent = '';
            document.getElementById('removeImageBtn').style.display = 'none';
            document.getElementById('blogImage').value = '';
        }

        // Drag and drop support
        document.addEventListener('DOMContentLoaded', function() {
            const uploadLabel = document.querySelector('label[for="blogImageFile"]');
            if (uploadLabel) {
                uploadLabel.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.style.borderColor = '#667eea';
                    this.style.background = '#f0f2ff';
                });

                uploadLabel.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    this.style.borderColor = '#ced4da';
                    this.style.background = 'white';
                });

                uploadLabel.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.style.borderColor = '#ced4da';
                    this.style.background = 'white';

                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        document.getElementById('blogImageFile').files = files;
                        handleImageUpload({ target: { files: files } });
                    }
                });
            }
        });

        // ========== CATEGORIES MANAGEMENT ==========

        // Load all categories
        async function loadCategories() {
            try {
                const response = await fetch(`${API_URL}/categories`);
                const result = await response.json();

                if (result.success) {
                    const categories = result.data.categories;
                    const tbody = document.getElementById('categoriesTableBody');

                    if (categories.length === 0) {
                        tbody.innerHTML = `
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">
                                    No categories found. Click "+ Add New Category" to create one.
                                </td>
                            </tr>
                        `;
                        return;
                    }

                    tbody.innerHTML = categories.map(category => `
                        <tr>
                            <td>${category.order}</td>
                            <td style="font-size: 24px;">${category.icon}</td>
                            <td>${category.name}</td>
                            <td><code>${category.slug}</code></td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="width: 20px; height: 20px; border-radius: 4px; background: ${category.color};"></div>
                                    <span>${category.color}</span>
                                </div>
                            </td>
                            <td>
                                <span class="badge ${category.isActive ? 'badge-success' : 'badge-danger'}">
                                    ${category.isActive ? 'Active' : 'Inactive'}
                                </span>
                            </td>
                            <td>
                                <button class="action-btn edit-btn" onclick="editCategory('${category.id}')" title="Edit">
                                    ‚úèÔ∏è
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteCategory('${category.id}')" title="Delete">
                                    üóëÔ∏è
                                </button>
                            </td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading categories:', error);
                alert('Failed to load categories');
            }
        }

        // Open category modal for adding new category
        function openCategoryModal() {
            document.getElementById('categoryModalTitle').textContent = 'Add New Category';
            document.getElementById('categoryForm').reset();
            document.getElementById('categoryId').value = '';
            document.getElementById('categoryModal').style.display = 'flex';
        }

        // Close category modal
        function closeCategoryModal() {
            document.getElementById('categoryModal').style.display = 'none';
            document.getElementById('categoryForm').reset();
        }

        // Edit category
        async function editCategory(id) {
            try {
                const response = await fetch(`${API_URL}/categories/${id}`);
                const result = await response.json();

                if (result.success) {
                    const category = result.data.category;

                    document.getElementById('categoryModalTitle').textContent = 'Edit Category';
                    document.getElementById('categoryId').value = category.id;
                    document.getElementById('categoryName').value = category.name;
                    document.getElementById('categoryDescription').value = category.description || '';
                    document.getElementById('categoryIcon').value = category.icon;
                    document.getElementById('categoryColor').value = category.color;
                    document.getElementById('categoryOrder').value = category.order;
                    document.getElementById('categoryIsActive').checked = category.isActive;

                    document.getElementById('categoryModal').style.display = 'flex';
                }
            } catch (error) {
                console.error('Error loading category:', error);
                alert('Failed to load category details');
            }
        }

        // Delete category
        async function deleteCategory(id) {
            if (!confirm('Are you sure you want to delete this category?')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/categories/${id}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    alert('Category deleted successfully!');
                    loadCategories();
                } else {
                    alert(result.message || 'Failed to delete category');
                }
            } catch (error) {
                console.error('Error deleting category:', error);
                alert('Failed to delete category');
            }
        }

        // Handle category form submission
        document.addEventListener('DOMContentLoaded', function() {
            const categoryForm = document.getElementById('categoryForm');

            if (categoryForm) {
                categoryForm.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const categoryId = document.getElementById('categoryId').value;
                    const categoryData = {
                        name: document.getElementById('categoryName').value,
                        description: document.getElementById('categoryDescription').value,
                        icon: document.getElementById('categoryIcon').value || 'üéØ',
                        color: document.getElementById('categoryColor').value,
                        order: parseInt(document.getElementById('categoryOrder').value) || 0,
                        isActive: document.getElementById('categoryIsActive').checked
                    };

                    try {
                        const url = categoryId
                            ? `${API_URL}/categories/${categoryId}`
                            : `${API_URL}/categories`;

                        const response = await fetch(url, {
                            method: categoryId ? 'PUT' : 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(categoryData)
                        });

                        const result = await response.json();

                        if (result.success) {
                            alert(categoryId ? 'Category updated successfully!' : 'Category created successfully!');
                            closeCategoryModal();
                            loadCategories();
                        } else {
                            alert(result.message || 'Failed to save category');
                        }
                    } catch (error) {
                        console.error('Error saving category:', error);
                        alert('Failed to save category');
                    }
                });
            }
        });

        // Load categories when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Load categories if on categories page
            const categoriesPage = document.getElementById('categoriesPage');
            if (categoriesPage) {
                loadCategories();
            }
        });

        // ========== AI ASSISTANT FUNCTIONS ==========

        async function generateTourWithAI(event) {
            // Get values from AI modal
            const category = document.getElementById('aiCategory').value;
            const duration = document.getElementById('aiDuration').value;
            const nights = document.getElementById('aiNights').value;
            const destination = document.getElementById('aiDestination').value;
            const price = document.getElementById('aiPrice').value;
            const maxGroupSize = document.getElementById('aiMaxGroupSize').value;
            const difficulty = document.getElementById('aiDifficulty').value;
            const accommodation = document.getElementById('aiAccommodation').value;
            const additionalPrompt = document.getElementById('aiPrompt').value;

            // Validation
            if (!category || !duration || !destination || !price || !maxGroupSize) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }

            // Build AI prompt
            const prompt = `Create a complete tour package with the following details:
- Type: ${category}
- Duration: ${duration} days${nights ? ` / ${nights} nights` : ''}
- Destination: ${destination}
- Price: $${price} per person
- Max Group Size: ${maxGroupSize} people
- Difficulty: ${difficulty}
- Accommodation: ${accommodation || 'Standard hotels'}
${additionalPrompt ? `\nAdditional requirements: ${additionalPrompt}` : ''}

Please provide:
1. An engaging tour title
2. A brief summary (2-3 sentences)
3. A detailed tour description (3-4 paragraphs highlighting culture, history, and experiences)
4. Day-by-day itinerary for ${duration} days
5. 5-7 tour highlights (one per line)
6. What's included in the tour (accommodation, meals, transport, guide, etc.)
7. What's NOT included (flights, visa, personal expenses, etc.)

Focus on Uzbekistan's rich Silk Road heritage, ancient architecture, and unique cultural experiences.`;

            // Show loading state
            const generateBtn = event.target;
            const originalText = generateBtn.innerHTML;
            generateBtn.innerHTML = '<span>‚è≥ Generating...</span>';
            generateBtn.disabled = true;

            try {
                const token = localStorage.getItem('adminToken');
                const response = await fetch('/api/ai/tour-assistant', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        currentData: {
                            category, duration, nights, destination, price, maxGroupSize, difficulty, accommodation
                        }
                    })
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.message || 'AI service error');
                }

                // Parse AI response and fill form
                const aiData = result.data;

                // Fill main tour form with AI generated content
                if (aiData.title) {
                    document.getElementById('tourName').value = aiData.title;
                }
                if (aiData.summary) {
                    document.getElementById('tourSummary').value = aiData.summary;
                }
                if (aiData.description) {
                    document.getElementById('tourDescription').value = aiData.description;
                }
                if (aiData.highlights) {
                    const highlightsText = Array.isArray(aiData.highlights)
                        ? aiData.highlights.join('\n')
                        : aiData.highlights;
                    document.getElementById('tourHighlights').value = highlightsText;
                }

                // Fill basic info from AI modal
                document.getElementById('tourCategory').value = category;
                document.getElementById('tourDuration').value = duration;
                document.getElementById('tourLocation').value = destination;
                document.getElementById('tourPrice').value = price;
                document.getElementById('tourMaxGroupSize').value = maxGroupSize;
                document.getElementById('tourDifficulty').value = difficulty;

                // Fill accommodation if available
                if (accommodation && document.getElementById('tourAccommodation')) {
                    document.getElementById('tourAccommodation').value = accommodation;
                }

                // Close AI modal and show success
                closeAIModal();
                showNotification('‚ú® Tour content generated successfully! Please review and adjust as needed.', 'success');

                // Show the main tour modal if not open
                if (!document.getElementById('tourModal').classList.contains('active')) {
                    openModal();
                }

            } catch (error) {
                console.error('AI Error:', error);
                showNotification(error.message || 'Failed to generate tour content', 'error');
            } finally {
                generateBtn.innerHTML = originalText;
                generateBtn.disabled = false;
            }
        }

        // ============================================
        // ADD TOUR MODAL FUNCTIONS
        // ============================================

        let itineraryDayCount = 0;

        function openAddTourModal() {
            // Clear any previous edit mode
            const form = document.getElementById('addTourForm');
            delete form.dataset.editId;
            // Reset modal title to Add mode
            document.querySelector('.add-tour-modal-header h2').textContent = '‚ûï Add New Tour';
            // Clear image manager
            tourMediaImages = [];
            updateImageManager();
            // Open modal
            document.getElementById('addTourModal').classList.add('active');
            // Add first itinerary day by default
            if (itineraryDayCount === 0) {
                addItineraryDay();
            }
        }

        function closeAddTourModal() {
            if (confirm('Are you sure? Unsaved changes will be lost.')) {
                document.getElementById('addTourModal').classList.remove('active');
                const form = document.getElementById('addTourForm');
                form.reset();
                // Clear edit mode
                delete form.dataset.editId;
                // Reset modal title
                document.querySelector('.add-tour-modal-header h2').textContent = '‚ûï Add New Tour';
                // Clear itinerary
                document.getElementById('itineraryContainer').innerHTML = '';
                itineraryDayCount = 0;
                // Clear image manager
                tourMediaImages = [];
                updateImageManager();
            }
        }

        function switchTourTab(tabIndex) {
            // Remove active class from all tabs and contents
            document.querySelectorAll('.tour-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tour-tab-content').forEach(content => content.classList.remove('active'));

            // Add active class to selected tab and content
            document.querySelectorAll('.tour-tab')[tabIndex].classList.add('active');
            document.querySelectorAll('.tour-tab-content')[tabIndex].classList.add('active');
        }

        function addItineraryDay() {
            itineraryDayCount++;
            const container = document.getElementById('itineraryContainer');

            const dayDiv = document.createElement('div');
            dayDiv.className = 'itinerary-day';
            dayDiv.dataset.dayNumber = itineraryDayCount;
            dayDiv.innerHTML = `
                <div class="itinerary-day-header">
                    <div class="itinerary-day-number">üìÖ DAY ${itineraryDayCount}</div>
                    <button type="button" class="remove-day-btn" onclick="removeItineraryDay(this)">Delete Day</button>
                </div>

                <div class="tour-form-group">
                    <label>Day Title <span class="required">*</span></label>
                    <input type="text" class="day-title" placeholder="E.g.: Arrival & City Tour" required>
                </div>

                <div class="tour-form-group">
                    <label>Description <span class="required">*</span></label>
                    <textarea class="day-description" placeholder="Describe what happens on this day..." rows="3" required></textarea>
                </div>

                <div class="tour-form-group">
                    <label>Day Image üñºÔ∏è</label>
                    <div style="display: flex; gap: 10px; align-items: start;">
                        <input type="url" class="day-image" placeholder="Image URL will appear here after upload" readonly style="flex: 1; background: #f8f9fa;">
                        <input type="file" class="day-image-file" accept="image/*" style="display: none;" onchange="uploadDayImage(this)">
                        <button type="button" class="add-item-btn" onclick="this.previousElementSibling.click()" style="white-space: nowrap;">
                            üì§ Upload Image
                        </button>
                    </div>
                    <div class="day-image-preview" style="margin-top: 10px; display: none;">
                        <img src="" alt="Day preview" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 2px solid #e0e0e0;">
                        <button type="button" onclick="removeDayImage(this)" style="display: block; margin-top: 5px; background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                            üóëÔ∏è Remove
                        </button>
                    </div>
                    <input type="text" class="day-image-caption" placeholder="E.g.: Sunset Desert Safari, Registon Square View" style="margin-top: 10px; width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 14px;">
                    <small style="color: #6c757d; font-size: 12px; display: block; margin-top: 5px;">
                        Optional: Add caption text to display on the image (shown on frontend)
                    </small>
                </div>

                <div class="tour-form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div class="tour-form-group" style="margin-bottom: 0;">
                        <label>üìç City/Location</label>
                        <select class="day-city" style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 14px; background: white;">
                            <option value="">Select city...</option>
                            <optgroup label="üá∫üáø Uzbekistan">
                                <option value="Tashkent">Tashkent</option>
                                <option value="Samarkand">Samarkand</option>
                                <option value="Bukhara">Bukhara</option>
                                <option value="Khiva">Khiva</option>
                                <option value="Shakhrisabz">Shakhrisabz</option>
                                <option value="Termez">Termez</option>
                                <option value="Urgench">Urgench</option>
                                <option value="Nukus">Nukus</option>
                                <option value="Fergana">Fergana</option>
                                <option value="Andijan">Andijan</option>
                                <option value="Namangan">Namangan</option>
                                <option value="Kokand">Kokand</option>
                            </optgroup>
                            <optgroup label="üáπüáØ Tajikistan">
                                <option value="Dushanbe">Dushanbe</option>
                                <option value="Khujand">Khujand</option>
                                <option value="Khorog">Khorog</option>
                                <option value="Istaravshan">Istaravshan</option>
                                <option value="Panjakent">Panjakent</option>
                            </optgroup>
                        </select>
                        <small style="color: #6c757d; font-size: 12px; display: block; margin-top: 5px;">
                            Optional: Where tourists stay this night
                        </small>
                    </div>
                    <div class="tour-form-group" style="margin-bottom: 0;">
                        <label>üè® Hotel/Accommodation</label>
                        <input type="text" class="day-accommodation" list="hotelSuggestions" placeholder="E.g.: Registon Plaza Hotel" style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 14px;">
                        <datalist id="hotelSuggestions">
                            <!-- Popular Hotels -->
                            <option value="Hilton Tashkent">
                            <option value="Hyatt Regency Tashkent">
                            <option value="Registon Plaza Samarkand">
                            <option value="Grand Samarkand Hotel">
                            <option value="Malika Bukhara">
                            <option value="Asia Bukhara">
                            <option value="Orient Star Khiva">
                            <option value="Hyatt Regency Dushanbe">
                            <option value="Serena Hotel Dushanbe">
                            <!-- Budget Options -->
                            <option value="Guesthouse">
                            <option value="Homestay">
                            <option value="Yurt Camp">
                        </datalist>
                        <small style="color: #6c757d; font-size: 12px; display: block; margin-top: 5px;">
                            Optional: Type or select hotel name (auto-suggests previous hotels)
                        </small>
                    </div>
                </div>

                <div class="tour-form-group">
                    <label>üçΩÔ∏è Meals Included</label>
                    <select class="day-meals" style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 14px; background: white;">
                        <option value="">No meals</option>
                        <option value="BB">BB - Bed & Breakfast</option>
                        <option value="HB">HB - Half Board (Breakfast + Dinner)</option>
                        <option value="FB">FB - Full Board (Breakfast + Lunch + Dinner)</option>
                        <option value="AI">AI - All Inclusive</option>
                    </select>
                    <small style="color: #6c757d; font-size: 12px; display: block; margin-top: 5px;">
                        Optional: Select meal plan for this day
                    </small>
                </div>

                <div class="tour-form-group">
                    <label>Activities</label>
                    <div class="activities-list">
                        <div class="activity-item">
                            <input type="text" class="activity-input" placeholder="E.g.: Airport pickup">
                            <button type="button" class="remove-activity-btn" onclick="removeActivity(this)">√ó</button>
                        </div>
                    </div>
                    <button type="button" class="add-item-btn" style="margin-top: 10px;" onclick="addActivity(this)">
                        <span style="font-size: 14px;">+</span> Add Activity
                    </button>
                </div>
            `;

            container.appendChild(dayDiv);
        }

        function removeItineraryDay(button) {
            if (confirm('Delete this day from the itinerary?')) {
                button.closest('.itinerary-day').remove();
                // Renumber remaining days
                const days = document.querySelectorAll('.itinerary-day');
                days.forEach((day, index) => {
                    day.dataset.dayNumber = index + 1;
                    day.querySelector('.itinerary-day-number').textContent = `üìÖ DAY ${index + 1}`;
                });
                itineraryDayCount = days.length;
            }
        }

        function addActivity(button) {
            const activitiesList = button.previousElementSibling;
            const activityDiv = document.createElement('div');
            activityDiv.className = 'activity-item';
            activityDiv.innerHTML = `
                <input type="text" class="activity-input" placeholder="E.g.: Hotel check-in">
                <button type="button" class="remove-activity-btn" onclick="removeActivity(this)">√ó</button>
            `;
            activitiesList.appendChild(activityDiv);
        }

        function removeActivity(button) {
            const activitiesList = button.closest('.activities-list');
            if (activitiesList.children.length > 1) {
                button.closest('.activity-item').remove();
            } else {
                alert('At least one activity is required per day.');
            }
        }

        // Upload day image function
        async function uploadDayImage(input) {
            const file = input.files[0];
            if (!file) return;

            // Validate file size (5MB max)
            if (file.size > 5 * 1024 * 1024) {
                alert('Image size must be less than 5MB');
                input.value = '';
                return;
            }

            // Validate file type
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp', 'image/gif'];
            if (!validTypes.includes(file.type)) {
                alert('Only JPG, PNG, WebP, and GIF images are allowed');
                input.value = '';
                return;
            }

            // Show loading state
            const dayGroup = input.closest('.tour-form-group');
            const urlInput = dayGroup.querySelector('.day-image');
            const originalPlaceholder = urlInput.placeholder;
            urlInput.placeholder = 'Uploading... Please wait...';

            try {
                // Create FormData
                const formData = new FormData();
                formData.append('image', file);

                // Upload to server
                const response = await fetch(`${API_URL}/upload/tour-image`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Upload failed');
                }

                const result = await response.json();

                if (result.success && result.data.imageUrl) {
                    // Set the image URL
                    urlInput.value = result.data.imageUrl;

                    // Show preview
                    const previewDiv = dayGroup.querySelector('.day-image-preview');
                    const previewImg = previewDiv.querySelector('img');
                    previewImg.src = result.data.imageUrl;
                    previewDiv.style.display = 'block';

                    alert('‚úÖ Image uploaded successfully!');
                } else {
                    throw new Error('Invalid response from server');
                }

            } catch (error) {
                console.error('Upload error:', error);
                alert('‚ùå Failed to upload image: ' + error.message);
                urlInput.placeholder = originalPlaceholder;
            }

            // Clear file input
            input.value = '';
        }

        // Remove day image function
        function removeDayImage(button) {
            const dayGroup = button.closest('.tour-form-group');
            const urlInput = dayGroup.querySelector('.day-image');
            const previewDiv = dayGroup.querySelector('.day-image-preview');
            const fileInput = dayGroup.querySelector('.day-image-file');

            // Clear URL
            urlInput.value = '';

            // Hide preview
            previewDiv.style.display = 'none';
            previewDiv.querySelector('img').src = '';

            // Clear file input
            fileInput.value = '';
        }

        // ============================================
        // IMAGE MANAGER FUNCTIONS
        // ============================================

        let tourMediaImages = []; // Array of image URLs
        let selectedMediaFiles = [];

        // Initialize image manager
        function initImageManager() {
            updateImageManager();
        }

        // Render image manager
        function updateImageManager() {
            const container = document.getElementById('imageManagerContainer');
            const emptyState = document.getElementById('imageManagerEmpty');
            const textarea = document.getElementById('tourImages');

            if (tourMediaImages.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                textarea.value = '';
                return;
            }

            emptyState.style.display = 'none';
            container.innerHTML = '';

            tourMediaImages.forEach((url, index) => {
                const imageCard = document.createElement('div');
                imageCard.style.cssText = 'position: relative; width: 150px; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden;';

                imageCard.innerHTML = `
                    <div style="position: relative; width: 150px; height: 150px; overflow: hidden;">
                        <img src="${url}" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22150%22 height=%22150%22%3E%3Crect fill=%22%23ddd%22 width=%22150%22 height=%22150%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22%3ENo Image%3C/text%3E%3C/svg%3E';">
                        ${index === 0 ? '<div style="position: absolute; top: 5px; left: 5px; background: #ffc107; color: #000; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: bold;">COVER</div>' : ''}
                        <div style="position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.6); color: white; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: bold;">#${index + 1}</div>
                    </div>
                    <div style="padding: 8px; display: flex; flex-direction: column; gap: 5px;">
                        <div style="display: flex; gap: 5px;">
                            ${index > 0 ? `<button type="button" onclick="moveImageUp(${index})" style="flex: 1; background: #6c757d; color: white; border: none; padding: 6px; border-radius: 4px; cursor: pointer; font-size: 12px;" title="Move up">‚Üë</button>` : '<div style="flex: 1;"></div>'}
                            ${index < tourMediaImages.length - 1 ? `<button type="button" onclick="moveImageDown(${index})" style="flex: 1; background: #6c757d; color: white; border: none; padding: 6px; border-radius: 4px; cursor: pointer; font-size: 12px;" title="Move down">‚Üì</button>` : '<div style="flex: 1;"></div>'}
                        </div>
                        <div style="display: flex; gap: 5px;">
                            ${index > 0 ? `<button type="button" onclick="setAsCover(${index})" style="flex: 1; background: #ffc107; color: #000; border: none; padding: 6px; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: bold;" title="Set as cover">‚≠ê Cover</button>` : '<div style="flex: 1;"></div>'}
                            <button type="button" onclick="removeImage(${index})" style="flex: 1; background: #dc3545; color: white; border: none; padding: 6px; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: bold;" title="Remove">‚ùå</button>
                        </div>
                    </div>
                `;

                container.appendChild(imageCard);
            });

            // Update hidden textarea
            textarea.value = tourMediaImages.join('\n');
        }

        // Move image up
        function moveImageUp(index) {
            if (index === 0) return;
            [tourMediaImages[index], tourMediaImages[index - 1]] = [tourMediaImages[index - 1], tourMediaImages[index]];
            updateImageManager();
        }

        // Move image down
        function moveImageDown(index) {
            if (index === tourMediaImages.length - 1) return;
            [tourMediaImages[index], tourMediaImages[index + 1]] = [tourMediaImages[index + 1], tourMediaImages[index]];
            updateImageManager();
        }

        // Set as cover
        function setAsCover(index) {
            const image = tourMediaImages.splice(index, 1)[0];
            tourMediaImages.unshift(image);
            updateImageManager();
        }

        // Remove image
        function removeImage(index) {
            if (confirm('Remove this image?')) {
                tourMediaImages.splice(index, 1);
                updateImageManager();
            }
        }

        // Add image URL manually
        function addImageUrlManually() {
            const url = prompt('Enter image URL:');
            if (url && url.trim()) {
                tourMediaImages.push(url.trim());
                updateImageManager();
            }
        }

        // Handle file selection for media upload
        document.addEventListener('DOMContentLoaded', function() {
            const mediaUploadInput = document.getElementById('tourMediaUpload');
            if (mediaUploadInput) {
                mediaUploadInput.addEventListener('change', function(e) {
                    const files = Array.from(e.target.files);
                    if (files.length === 0) return;

                    selectedMediaFiles = files;
                    document.getElementById('uploadMediaBtn').style.display = 'block';
                    document.getElementById('uploadMediaBtn').textContent = `Upload ${files.length} image(s)`;
                });
            }

            // Initialize image manager
            initImageManager();
        });

        // Upload media images to server
        async function uploadMediaImages() {
            if (selectedMediaFiles.length === 0) {
                alert('Please select images first');
                return;
            }

            const uploadBtn = document.getElementById('uploadMediaBtn');
            const originalText = uploadBtn.textContent;
            uploadBtn.textContent = 'Uploading...';
            uploadBtn.disabled = true;

            try {
                const uploadedUrls = [];

                for (let i = 0; i < selectedMediaFiles.length; i++) {
                    const file = selectedMediaFiles[i];

                    // Validate file size (5MB max)
                    if (file.size > 5 * 1024 * 1024) {
                        alert(`Image ${i + 1} is too large (max 5MB)`);
                        continue;
                    }

                    // Validate file type
                    const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp', 'image/gif'];
                    if (!validTypes.includes(file.type)) {
                        alert(`Image ${i + 1} has invalid type`);
                        continue;
                    }

                    uploadBtn.textContent = `Uploading ${i + 1}/${selectedMediaFiles.length}...`;

                    const formData = new FormData();
                    formData.append('image', file);

                    const response = await fetch(`${API_URL}/upload`, {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error(`Upload failed for image ${i + 1}`);
                    }

                    const result = await response.json();

                    if (result.success && result.data.filePath) {
                        uploadedUrls.push(result.data.filePath);
                    }
                }

                if (uploadedUrls.length > 0) {
                    // Add to tour media images
                    tourMediaImages.push(...uploadedUrls);
                    updateImageManager();
                    alert(`‚úÖ Successfully uploaded ${uploadedUrls.length} image(s)!`);
                }

                // Clear selection
                document.getElementById('tourMediaUpload').value = '';
                selectedMediaFiles = [];

            } catch (error) {
                console.error('Upload error:', error);
                alert('‚ùå Failed to upload images: ' + error.message);
            } finally {
                uploadBtn.textContent = originalText;
                uploadBtn.disabled = false;
                uploadBtn.style.display = 'none';
            }
        }

        async function saveTour() {
            const form = document.getElementById('addTourForm');

            // Check basic required fields
            const requiredFields = [
                { id: 'tourName', name: 'Tour Name', tab: 0 },
                { id: 'tourCategory', name: 'Category', tab: 0 },
                { id: 'tourDestination', name: 'Destination', tab: 0 },
                { id: 'tourPrice', name: 'Price', tab: 0 },
                { id: 'tourDuration', name: 'Duration', tab: 0 },
                { id: 'tourNights', name: 'Nights', tab: 0 },
                { id: 'tourDescription', name: 'Description', tab: 0 }
            ];

            for (let field of requiredFields) {
                const element = document.getElementById(field.id);
                if (!element.value || element.value.trim() === '') {
                    alert(`‚ùå Required field missing: ${field.name}\n\nPlease fill in the "${field.name}" field in Tab 1 (Basic Info)`);
                    switchTourTab(field.tab);
                    element.focus();
                    return;
                }
            }

            // Check itinerary - at least one day required
            const itineraryDays = document.querySelectorAll('.itinerary-day');
            if (itineraryDays.length === 0) {
                alert('‚ùå Please add at least one day to the itinerary!\n\nGo to Tab 3 (Itinerary) and click "Add Day"');
                switchTourTab(2);
                return;
            }

            // Check each itinerary day has title and description
            for (let i = 0; i < itineraryDays.length; i++) {
                const day = itineraryDays[i];
                const title = day.querySelector('.day-title').value;
                const description = day.querySelector('.day-description').value;

                if (!title || title.trim() === '') {
                    alert(`‚ùå Day ${i + 1} is missing a title!\n\nPlease add a title for Day ${i + 1} in Tab 3 (Itinerary)`);
                    switchTourTab(2);
                    day.querySelector('.day-title').focus();
                    return;
                }

                if (!description || description.trim() === '') {
                    alert(`‚ùå Day ${i + 1} is missing a description!\n\nPlease add a description for Day ${i + 1} in Tab 3 (Itinerary)`);
                    switchTourTab(2);
                    day.querySelector('.day-description').focus();
                    return;
                }
            }

            // Collect form data
            const formData = {
                title: document.getElementById('tourName').value,
                category: document.getElementById('tourCategory').value,
                destination: document.getElementById('tourDestination').value,
                price: parseFloat(document.getElementById('tourPrice').value),
                discountPrice: document.getElementById('tourDiscountPrice').value ? parseFloat(document.getElementById('tourDiscountPrice').value) : null,
                duration: parseInt(document.getElementById('tourDuration').value),
                nights: parseInt(document.getElementById('tourNights').value),
                summary: document.getElementById('tourSummary').value,
                description: document.getElementById('tourDescription').value,
                maxGroupSize: document.getElementById('tourMaxGroup').value ? parseInt(document.getElementById('tourMaxGroup').value) : 15,
                difficulty: document.getElementById('tourDifficulty').value,
                languages: document.getElementById('tourLanguages').value.split(',').map(l => l.trim()).filter(l => l),
                season: document.getElementById('tourAvailability').value,
                highlights: document.getElementById('tourHighlights').value.split('\n').filter(h => h.trim()),
                status: document.getElementById('tourStatus').value,
                featured: document.getElementById('tourFeatured').checked,
                slug: document.getElementById('tourSlug').value
            };

            // Collect itinerary
            const itineraryData = [];
            document.querySelectorAll('.itinerary-day').forEach((day, index) => {
                const activities = [];
                day.querySelectorAll('.activity-input').forEach(input => {
                    if (input.value.trim()) {
                        activities.push(input.value.trim());
                    }
                });

                const dayImageInput = day.querySelector('.day-image');
                const dayImage = dayImageInput && dayImageInput.value.trim() ? dayImageInput.value.trim() : null;

                const dayCaptionInput = day.querySelector('.day-image-caption');
                const dayCaption = dayCaptionInput && dayCaptionInput.value.trim() ? dayCaptionInput.value.trim() : null;

                const dayCityInput = day.querySelector('.day-city');
                const dayCity = dayCityInput && dayCityInput.value.trim() ? dayCityInput.value.trim() : null;

                const dayAccommodationInput = day.querySelector('.day-accommodation');
                const dayAccommodation = dayAccommodationInput && dayAccommodationInput.value.trim() ? dayAccommodationInput.value.trim() : null;

                const dayMealsInput = day.querySelector('.day-meals');
                const dayMeals = dayMealsInput && dayMealsInput.value ? dayMealsInput.value : null;

                itineraryData.push({
                    day: index + 1,
                    title: day.querySelector('.day-title').value,
                    description: day.querySelector('.day-description').value,
                    image: dayImage,
                    imageCaption: dayCaption,
                    city: dayCity,
                    accommodation: dayAccommodation,
                    meals: dayMeals,
                    activities: activities
                });
            });
            formData.itinerary = itineraryData;

            // Collect inclusions
            formData.included = document.getElementById('tourIncluded').value.split('\n').filter(i => i.trim());
            formData.excluded = document.getElementById('tourExcluded').value.split('\n').filter(e => e.trim());

            // Collect images
            const imageUrls = document.getElementById('tourImages').value.split('\n').filter(url => url.trim());
            formData.images = imageUrls;

            console.log('üì∏ tourMediaImages:', tourMediaImages);
            console.log('üì∏ textarea value:', document.getElementById('tourImages').value);
            console.log('üì∏ images to save:', imageUrls);
            console.log('Tour data to save:', formData);

            // Check if we're editing or creating
            const editId = form.dataset.editId;
            const isEdit = !!editId;

            // Save to API
            try {
                const url = isEdit ? `${API_URL}/tours/${editId}` : `${API_URL}/tours`;
                const method = isEdit ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    throw new Error(`Failed to ${isEdit ? 'update' : 'save'} tour`);
                }

                const result = await response.json();
                alert(`‚úÖ Tour ${isEdit ? 'updated' : 'saved'} successfully!`);
                closeAddTourModal();
                loadTours(); // Reload tours list
            } catch (error) {
                console.error('Error saving tour:', error);
                alert(`‚ùå Error ${isEdit ? 'updating' : 'saving'} tour: ` + error.message);
            }
        }

        // Load Tours List
        async function loadTours() {
            const container = document.getElementById('toursTableContainer');

            try {
                console.log('üìä Loading tours from API...');
                const response = await fetch(`${API_URL}/tours`);

                if (!response.ok) {
                    console.error('‚ùå API response not OK:', response.status);
                    throw new Error(`API error: ${response.status}`);
                }

                const result = await response.json();
                console.log('‚úÖ Tours API response:', result);

                if (!result.success || !result.data || !result.data.tours) {
                    console.error('‚ùå Invalid response structure:', result);
                    throw new Error('Invalid API response');
                }

                const tours = result.data.tours;
                console.log(`üì¶ Found ${tours.length} tours`);

                if (tours.length === 0) {
                    container.innerHTML = '<p style="padding: 20px; text-align: center; color: #6c757d;">No tours found. Click "Add New Tour" to create one.</p>';
                    return;
                }

                // Create table
                let html = `
                    <table style="width: 100%; border-collapse: collapse; background: white;">
                        <thead>
                            <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <th style="padding: 12px; text-align: left;">Title</th>
                                <th style="padding: 12px; text-align: left;">Destination</th>
                                <th style="padding: 12px; text-align: left;">Price</th>
                                <th style="padding: 12px; text-align: left;">Duration</th>
                                <th style="padding: 12px; text-align: left;">Category</th>
                                <th style="padding: 12px; text-align: center;">SEO</th>
                                <th style="padding: 12px; text-align: left;">Status</th>
                                <th style="padding: 12px; text-align: center;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                tours.forEach(tour => {
                    const statusColor = tour.isActive ? '#28a745' : '#6c757d';
                    const statusText = tour.isActive ? 'Active' : 'Inactive';

                    // SEO Badge - with safe checking
                    let seoBadge = '';
                    try {
                        if (tour.seo && tour.seo.title && tour.seo.title.length > 0) {
                            const tourId = tour.id || tour._id || '';
                            seoBadge = '<span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer;" onclick="viewTourSEO(\'' + tourId + '\')" title="Click to view SEO details">‚úì SEO</span>';
                        } else {
                            seoBadge = '<span style="background: #ffc107; color: #000; padding: 4px 8px; border-radius: 4px; font-size: 11px;">‚ö† No SEO</span>';
                        }
                    } catch (err) {
                        console.error('Error creating SEO badge for tour:', tour.title, err);
                        seoBadge = '<span style="background: #dc3545; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px;">‚úó Error</span>';
                    }

                    html += `
                        <tr style="border-bottom: 1px solid #dee2e6;">
                            <td style="padding: 12px;">
                                <strong>${tour.title}</strong>
                                ${tour.featured || tour.isFeatured ? '<span style="background: #ffc107; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px;">FEATURED</span>' : ''}
                            </td>
                            <td style="padding: 12px;">${tour.destination || '-'}</td>
                            <td style="padding: 12px;">$${tour.price}</td>
                            <td style="padding: 12px;">${tour.duration}D/${tour.nights}N</td>
                            <td style="padding: 12px;">
                                <span style="background: #e7f3ff; color: #0066cc; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                                    ${tour.category || 'N/A'}
                                </span>
                            </td>
                            <td style="padding: 12px; text-align: center;">
                                ${seoBadge}
                            </td>
                            <td style="padding: 12px;">
                                <span style="color: ${statusColor}; font-weight: 600;">‚óè</span> ${statusText}
                            </td>
                            <td style="padding: 12px; text-align: center;">
                                <button onclick="viewTour('${tour.id}')" style="background: #28a745; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-right: 5px;" title="View on frontend">üëÅÔ∏è View</button>
                                <button onclick="editTour('${tour.id}')" style="background: #007bff; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-right: 5px;">‚úèÔ∏è Edit</button>
                                <button onclick="deleteTour('${tour.id}')" style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">üóëÔ∏è Delete</button>
                            </td>
                        </tr>
                    `;
                });

                html += `
                        </tbody>
                    </table>
                `;

                container.innerHTML = html;

            } catch (error) {
                console.error('Error loading tours:', error);
                container.innerHTML = `<p style="padding: 20px; text-align: center; color: #dc3545;">Error loading tours: ${error.message}</p>`;
            }
        }

        // View tour on frontend
        function viewTour(id) {
            // Open tour details page in new tab
            const url = `/gofly/tour-details.html?id=${id}`;
            window.open(url, '_blank');
        }

        async function editTour(id) {
            try {
                // Fetch tour data
                const response = await fetch(`${API_URL}/tours/${id}`);
                const result = await response.json();

                if (!result.success || !result.data) {
                    alert('Failed to load tour data');
                    return;
                }

                // API returns { data: { tour: {...} } } or { data: {...} }
                const tour = result.data.tour || result.data;

                // Set modal title to Edit mode
                document.querySelector('.add-tour-modal-header h2').textContent = '‚úèÔ∏è Edit Tour';

                // Store tour ID for update
                document.getElementById('addTourForm').dataset.editId = tour.id || tour._id;

                // Populate Basic Info (Tab 1)
                document.getElementById('tourName').value = tour.title || '';
                document.getElementById('tourCategory').value = tour.category || '';
                document.getElementById('tourDestination').value = tour.destination || '';
                document.getElementById('tourPrice').value = tour.price || '';
                document.getElementById('tourDiscountPrice').value = tour.discountPrice || '';
                document.getElementById('tourDuration').value = tour.duration || '';
                document.getElementById('tourNights').value = tour.nights || '';
                document.getElementById('tourSummary').value = tour.summary || '';
                document.getElementById('tourDescription').value = tour.description || '';

                // Populate Details (Tab 2)
                document.getElementById('tourMaxGroup').value = tour.maxGroupSize || '';
                document.getElementById('tourDifficulty').value = tour.difficulty || 'Easy';
                document.getElementById('tourLanguages').value = (tour.languages || []).join(', ');
                document.getElementById('tourAvailability').value = tour.season || 'All Year';
                document.getElementById('tourHighlights').value = (tour.highlights || []).join('\n');

                // Populate Itinerary (Tab 3)
                const itineraryContainer = document.getElementById('itineraryContainer');
                itineraryContainer.innerHTML = '';
                itineraryDayCount = 0;

                if (tour.itinerary && tour.itinerary.length > 0) {
                    tour.itinerary.forEach((dayData, index) => {
                        addItineraryDay();
                        const dayDiv = itineraryContainer.lastElementChild;
                        dayDiv.querySelector('.day-title').value = dayData.title || '';
                        dayDiv.querySelector('.day-description').value = dayData.description || '';

                        // Populate day image if exists
                        const dayImageInput = dayDiv.querySelector('.day-image');
                        if (dayImageInput && dayData.image) {
                            dayImageInput.value = dayData.image;

                            // Show preview
                            const previewDiv = dayDiv.querySelector('.day-image-preview');
                            const previewImg = previewDiv.querySelector('img');
                            previewImg.src = dayData.image;
                            previewDiv.style.display = 'block';
                        }

                        // Populate day image caption if exists
                        const dayCaptionInput = dayDiv.querySelector('.day-image-caption');
                        if (dayCaptionInput && dayData.imageCaption) {
                            dayCaptionInput.value = dayData.imageCaption;
                        }

                        // Populate city if exists
                        const dayCityInput = dayDiv.querySelector('.day-city');
                        if (dayCityInput && dayData.city) {
                            dayCityInput.value = dayData.city;
                        }

                        // Populate accommodation if exists
                        const dayAccommodationInput = dayDiv.querySelector('.day-accommodation');
                        if (dayAccommodationInput && dayData.accommodation) {
                            dayAccommodationInput.value = dayData.accommodation;
                        }

                        // Populate meals if exists
                        const dayMealsInput = dayDiv.querySelector('.day-meals');
                        if (dayMealsInput && dayData.meals) {
                            dayMealsInput.value = dayData.meals;
                        }

                        // Populate activities
                        const activitiesList = dayDiv.querySelector('.activities-list');
                        activitiesList.innerHTML = '';

                        if (dayData.activities && dayData.activities.length > 0) {
                            dayData.activities.forEach(activity => {
                                const activityItem = document.createElement('div');
                                activityItem.className = 'activity-item';
                                activityItem.innerHTML = `
                                    <input type="text" class="activity-input" placeholder="E.g.: Airport pickup" value="${activity}">
                                    <button type="button" class="remove-activity-btn" onclick="removeActivity(this)">√ó</button>
                                `;
                                activitiesList.appendChild(activityItem);
                            });
                        } else {
                            // Add one empty activity field
                            const activityItem = document.createElement('div');
                            activityItem.className = 'activity-item';
                            activityItem.innerHTML = `
                                <input type="text" class="activity-input" placeholder="E.g.: Airport pickup">
                                <button type="button" class="remove-activity-btn" onclick="removeActivity(this)">√ó</button>
                            `;
                            activitiesList.appendChild(activityItem);
                        }
                    });
                }

                // Populate Inclusions (Tab 4)
                document.getElementById('tourIncluded').value = (tour.included || []).join('\n');
                document.getElementById('tourExcluded').value = (tour.excluded || []).join('\n');

                // Populate Media (Tab 5)
                tourMediaImages = tour.images || [];
                updateImageManager();

                // Populate Settings (Tab 6)
                document.getElementById('tourStatus').value = tour.isActive ? 'active' : 'inactive';
                document.getElementById('tourFeatured').checked = tour.featured || tour.isFeatured || false;
                document.getElementById('tourSlug').value = tour.slug || '';

                // Open modal
                document.getElementById('addTourModal').classList.add('active');

                // Switch to first tab
                switchTourTab(0);

            } catch (error) {
                console.error('Error loading tour for edit:', error);
                alert('Error loading tour: ' + error.message);
            }
        }

        async function deleteTour(id) {
            if (!confirm('Are you sure you want to delete this tour?')) return;

            try {
                const response = await fetch(`${API_URL}/tours/${id}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    alert('Tour deleted successfully!');
                    loadTours();
                } else {
                    alert('Failed to delete tour');
                }
            } catch (error) {
                console.error('Error deleting tour:', error);
                alert('Error deleting tour: ' + error.message);
            }
        }

        // View Tour SEO Details
        async function viewTourSEO(tourId) {
            try {
                // Fetch tour SEO data
                const response = await fetch(`${API_URL}/tours/${tourId}/seo`);
                const result = await response.json();

                if (!result.success) {
                    alert('Failed to load SEO data');
                    return;
                }

                const { tour, seo } = result.data;

                // Create modal HTML
                const modalHTML = `
                    <div id="seoModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; display: flex; align-items: center; justify-content: center; overflow-y: auto; padding: 20px;">
                        <div style="background: white; border-radius: 15px; max-width: 900px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                            <!-- Header -->
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px 30px; border-radius: 15px 15px 0 0; display: flex; justify-content: space-between; align-items: center;">
                                <h2 style="margin: 0; font-size: 24px;">üîç SEO Details: ${tour.title}</h2>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <button onclick="toggleSEOEditMode('${tourId}')" id="seoEditBtn" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 5px;">‚úèÔ∏è Edit</button>
                                    <button onclick="closeSEOModal()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center;">&times;</button>
                                </div>
                            </div>

                            <!-- Body -->
                            <div style="padding: 30px;">
                                <!-- SEO Score -->
                                ${seo.score ? `
                                <div style="background: ${seo.score.score >= 90 ? '#d4edda' : seo.score.score >= 70 ? '#fff3cd' : '#f8d7da'}; border: 2px solid ${seo.score.score >= 90 ? '#28a745' : seo.score.score >= 70 ? '#ffc107' : '#dc3545'}; border-radius: 10px; padding: 20px; margin-bottom: 25px; text-align: center;">
                                    <h3 style="margin: 0 0 10px 0; font-size: 20px; color: #333;">SEO Score</h3>
                                    <div style="font-size: 48px; font-weight: bold; color: ${seo.score.score >= 90 ? '#28a745' : seo.score.score >= 70 ? '#ffc107' : '#dc3545'}; margin-bottom: 10px;">
                                        ${seo.score.score}/100
                                    </div>
                                    <div style="font-size: 24px; font-weight: 600; color: ${seo.score.score >= 90 ? '#28a745' : seo.score.score >= 70 ? '#ffc107' : '#dc3545'};">
                                        Grade: ${seo.score.grade}
                                    </div>
                                </div>
                                ` : ''}

                                <!-- Google Preview -->
                                <div style="margin-bottom: 25px;">
                                    <h4 style="color: #667eea; font-size: 18px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #667eea;">üîç Google Search Preview</h4>
                                    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: #f9f9f9;">
                                        <h4 style="color: #1a0dab; font-size: 18px; margin: 0 0 5px 0; font-weight: 400;">${seo.meta.title || 'No title'}</h4>
                                        <div style="color: #006621; font-size: 14px; margin-bottom: 5px;">${seo.meta.canonical || ''}</div>
                                        <div style="color: #545454; font-size: 14px; line-height: 1.5;">${seo.meta.description || 'No description'}</div>
                                    </div>
                                </div>

                                <!-- Meta Tags -->
                                <div style="margin-bottom: 25px;">
                                    <h4 style="color: #667eea; font-size: 18px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #667eea;">üè∑Ô∏è Meta Tags</h4>

                                    <div style="margin-bottom: 15px;">
                                        <div style="font-size: 12px; font-weight: 600; color: #666; text-transform: uppercase; margin-bottom: 5px;">Title (${seo.meta.title ? seo.meta.title.length : 0} characters)</div>
                                        <div style="background: #f5f5f5; padding: 10px; border-radius: 5px; font-size: 14px;">${seo.meta.title || 'No title'}</div>
                                    </div>

                                    <div style="margin-bottom: 15px;">
                                        <div style="font-size: 12px; font-weight: 600; color: #666; text-transform: uppercase; margin-bottom: 5px;">Description (${seo.meta.description ? seo.meta.description.length : 0} characters)</div>
                                        <div style="background: #f5f5f5; padding: 10px; border-radius: 5px; font-size: 14px;">${seo.meta.description || 'No description'}</div>
                                    </div>

                                    <div style="margin-bottom: 15px;">
                                        <div style="font-size: 12px; font-weight: 600; color: #666; text-transform: uppercase; margin-bottom: 5px;">URL Slug</div>
                                        <div style="background: #f5f5f5; padding: 10px; border-radius: 5px; font-size: 14px; font-family: monospace;">${tour.slug}</div>
                                    </div>

                                    <div>
                                        <div style="font-size: 12px; font-weight: 600; color: #666; text-transform: uppercase; margin-bottom: 5px;">Keywords (${seo.meta.keywords && Array.isArray(seo.meta.keywords) ? seo.meta.keywords.length : 0})</div>
                                        <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                                            ${seo.meta.keywords && Array.isArray(seo.meta.keywords) ? seo.meta.keywords.map(kw => `<span style="background: #667eea; color: white; padding: 4px 10px; border-radius: 15px; font-size: 11px;">${kw}</span>`).join('') : '<span style="color: #999;">No keywords</span>'}
                                        </div>
                                    </div>
                                </div>

                                <!-- Social Media Preview -->
                                <div style="margin-bottom: 25px;">
                                    <h4 style="color: #667eea; font-size: 18px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #667eea;">üìò Social Media (Open Graph)</h4>
                                    <div style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden; background: white;">
                                        ${tour.mainImage || tour.images?.[0] ? `
                                        <img src="${(() => { const img = tour.mainImage || tour.images[0]; return img.startsWith('http') ? img : 'http://localhost:4000' + img; })()}" alt="${tour.title}" style="width: 100%; height: 200px; object-fit: cover;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                        <div style="display: none; width: 100%; height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); align-items: center; justify-content: center; color: white; font-size: 18px; font-weight: 600;">üì∑ Image not found</div>
                                        ` : `
                                        <div style="width: 100%; height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; font-weight: 600;">
                                            üì∑ ${tour.title}
                                        </div>
                                        `}
                                        <div style="padding: 15px;">
                                            <div style="font-size: 12px; color: #65676b; margin-bottom: 5px;">${seo.meta.canonical ? new URL(seo.meta.canonical).hostname : 'No URL'}</div>
                                            <h4 style="font-size: 16px; margin: 0 0 8px 0;">${seo.meta.ogTitle || 'No title'}</h4>
                                            <div style="font-size: 13px; color: #1c1e21;">${seo.meta.ogDescription || 'No description'}</div>
                                        </div>
                                    </div>
                                </div>

                                ${seo.score && seo.score.checks ? `
                                <!-- SEO Checks -->
                                <div id="seoChecksSection">
                                    <h4 style="color: #667eea; font-size: 18px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #667eea;">‚úì SEO Checklist</h4>
                                    ${seo.score.checks.map(check => `
                                        <div style="display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee;">
                                            <span style="font-size: 14px;">${check.name}</span>
                                            <div>
                                                <span style="background: ${check.status === 'perfect' ? '#28a745' : check.status === 'good' ? '#ffc107' : '#dc3545'}; color: white; padding: 3px 10px; border-radius: 12px; font-size: 11px; margin-right: 10px;">${check.status.toUpperCase()}</span>
                                                <span style="font-weight: 600; color: #667eea;">${check.points} pts</span>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                                ` : ''}

                                <!-- SEO Edit Form (Hidden by default) -->
                                <div id="seoEditForm" style="display: none;">
                                    <h4 style="color: #667eea; font-size: 18px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #667eea;">‚úèÔ∏è Edit SEO</h4>

                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; font-size: 14px; font-weight: 600; color: #333; margin-bottom: 8px;">SEO Title</label>
                                        <input type="text" id="seoEditTitle" value="${(seo.meta.title || '').replace(/"/g, '&quot;')}"
                                            style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; box-sizing: border-box;"
                                            placeholder="Enter SEO title (50-60 characters recommended)">
                                        <div style="font-size: 12px; color: #666; margin-top: 5px;">Characters: <span id="titleCharCount">${seo.meta.title ? seo.meta.title.length : 0}</span>/60</div>
                                    </div>

                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; font-size: 14px; font-weight: 600; color: #333; margin-bottom: 8px;">Meta Description</label>
                                        <textarea id="seoEditDescription" rows="3"
                                            style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; box-sizing: border-box; resize: vertical;"
                                            placeholder="Enter meta description (150-160 characters recommended)">${seo.meta.description || ''}</textarea>
                                        <div style="font-size: 12px; color: #666; margin-top: 5px;">Characters: <span id="descCharCount">${seo.meta.description ? seo.meta.description.length : 0}</span>/160</div>
                                    </div>

                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; font-size: 14px; font-weight: 600; color: #333; margin-bottom: 8px;">URL Slug</label>
                                        <input type="text" id="seoEditSlug" value="${tour.slug || ''}"
                                            style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; box-sizing: border-box; font-family: monospace;"
                                            placeholder="url-friendly-slug">
                                    </div>

                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; font-size: 14px; font-weight: 600; color: #333; margin-bottom: 8px;">Keywords (comma separated)</label>
                                        <input type="text" id="seoEditKeywords" value="${seo.meta.keywords && Array.isArray(seo.meta.keywords) ? seo.meta.keywords.join(', ') : ''}"
                                            style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; box-sizing: border-box;"
                                            placeholder="keyword1, keyword2, keyword3">
                                    </div>

                                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                                        <button onclick="toggleSEOEditMode('${tourId}')" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 14px;">Cancel</button>
                                        <button onclick="saveSEO('${tourId}')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600;">üíæ Save SEO</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Add modal to document
                document.body.insertAdjacentHTML('beforeend', modalHTML);

            } catch (error) {
                console.error('Error loading SEO data:', error);
                alert('Error loading SEO data: ' + error.message);
            }
        }

        // Close SEO Modal
        function closeSEOModal() {
            const modal = document.getElementById('seoModal');
            if (modal) {
                modal.remove();
            }
        }

        // Toggle SEO Edit Mode
        function toggleSEOEditMode(tourId) {
            const editForm = document.getElementById('seoEditForm');
            const editBtn = document.getElementById('seoEditBtn');

            if (editForm.style.display === 'none') {
                editForm.style.display = 'block';
                editBtn.innerHTML = 'üëÅÔ∏è View';

                // Add character count listeners
                const titleInput = document.getElementById('seoEditTitle');
                const descInput = document.getElementById('seoEditDescription');

                titleInput.addEventListener('input', () => {
                    document.getElementById('titleCharCount').textContent = titleInput.value.length;
                });
                descInput.addEventListener('input', () => {
                    document.getElementById('descCharCount').textContent = descInput.value.length;
                });
            } else {
                editForm.style.display = 'none';
                editBtn.innerHTML = '‚úèÔ∏è Edit';
            }
        }

        // Save SEO
        async function saveSEO(tourId) {
            const title = document.getElementById('seoEditTitle').value.trim();
            const description = document.getElementById('seoEditDescription').value.trim();
            const slug = document.getElementById('seoEditSlug').value.trim();
            const keywordsStr = document.getElementById('seoEditKeywords').value.trim();
            const keywords = keywordsStr ? keywordsStr.split(',').map(k => k.trim()).filter(k => k) : [];

            try {
                const response = await fetch(`${API_URL}/tours/${tourId}/seo`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    body: JSON.stringify({
                        seoTitle: title,
                        seoDescription: description,
                        slug: slug,
                        seoKeywords: keywords
                    })
                });

                const result = await response.json();

                if (result.success) {
                    alert('SEO saved successfully!');
                    closeSEOModal();
                    loadTours(); // Refresh tours list
                } else {
                    alert('Failed to save SEO: ' + result.message);
                }
            } catch (error) {
                console.error('Error saving SEO:', error);
                alert('Error saving SEO: ' + error.message);
            }
        }

        // Page Navigation System
        function showPage(pageName) {
            console.log(`üîÑ showPage called with: ${pageName}`);

            // Hide all pages
            const allPages = document.querySelectorAll('.page-section');
            console.log(`üìÑ Found ${allPages.length} page sections`);
            allPages.forEach(page => {
                page.classList.remove('active');
            });

            // Show selected page
            const pageId = pageName + 'Page';
            const pageElement = document.getElementById(pageId);
            console.log(`üîç Looking for page ID: ${pageId}, found: ${!!pageElement}`);

            if (pageElement) {
                pageElement.classList.add('active');
                console.log(`‚úÖ Activated page: ${pageId}`);
            } else {
                console.error(`‚ùå Page not found: ${pageId}`);
            }

            // Update menu active state
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === pageName) {
                    item.classList.add('active');
                }
            });

            // Update page title
            const pageTitle = document.getElementById('pageTitle');
            const pageBreadcrumb = document.getElementById('pageBreadcrumb');
            const titles = {
                'dashboard': 'Dashboard',
                'tours': 'Tours',
                'bookings': 'Bookings',
                'users': 'Users',
                'pages': 'Pages',
                'categories': 'Categories',
                'destinations': 'Destinations',
                'media': 'Media Library',
                'reviews': 'Reviews',
                'blog': 'Blog',
                'settings': 'General Settings',
                'seo': 'SEO Settings'
            };

            if (pageTitle) pageTitle.textContent = titles[pageName] || 'Admin';
            if (pageBreadcrumb) pageBreadcrumb.textContent = titles[pageName] || 'Admin';

            // Load data for specific pages
            if (pageName === 'tours') {
                loadTours();
            } else if (pageName === 'bookings') {
                loadBookings();
            } else if (pageName === 'users') {
                loadUsers();
            } else if (pageName === 'categories') {
                loadCategories();
            } else if (pageName === 'blog') {
                loadBlogs();
            }
        }

        // ========== BOOKINGS MANAGEMENT ==========
        async function loadBookings() {
            const tbody = document.getElementById('bookingsTableBody');
            const statusFilter = document.getElementById('statusFilter').value;

            try {
                let url = `${API_URL}/admin/bookings`;
                if (statusFilter) {
                    url += `?status=${statusFilter}`;
                }

                const response = await fetch(url);
                const result = await response.json();

                if (!result.success || !result.data) {
                    throw new Error('Invalid API response');
                }

                const { bookings, stats } = result.data;

                // Update statistics
                document.getElementById('totalBookings').textContent = stats.total || 0;
                document.getElementById('pendingBookings').textContent = stats.pending || 0;
                document.getElementById('confirmedBookings').textContent = stats.confirmed || 0;
                document.getElementById('cancelledBookings').textContent = stats.cancelled || 0;

                if (bookings.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8" style="padding: 40px; text-align: center; color: #9ca3af;">
                                No bookings found.
                            </td>
                        </tr>
                    `;
                    return;
                }

                // Build table rows
                let html = '';
                bookings.forEach(booking => {
                    const statusColors = {
                        'pending': { bg: '#fff8e1', text: '#ff9800' },
                        'confirmed': { bg: '#e8f5e9', text: '#22c55e' },
                        'cancelled': { bg: '#ffebee', text: '#ef4444' }
                    };

                    const statusColor = statusColors[booking.status] || statusColors['pending'];
                    const bookingDate = new Date(booking.date).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
                    const createdDate = new Date(booking.createdAt).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });

                    html += `
                        <tr style="border-bottom: 1px solid #e5e7eb;">
                            <td style="padding: 15px; font-size: 12px; color: #6b7280;">${booking.id.slice(0, 12)}...</td>
                            <td style="padding: 15px;">
                                <div style="font-weight: 600; color: #374151; margin-bottom: 4px;">${booking.tourName}</div>
                                <div style="font-size: 12px; color: #6b7280;">Created: ${createdDate}</div>
                            </td>
                            <td style="padding: 15px;">
                                <div style="font-weight: 500; color: #374151; margin-bottom: 2px;">${booking.customerName}</div>
                                <div style="font-size: 12px; color: #6b7280;">${booking.customerEmail}</div>
                                <div style="font-size: 12px; color: #6b7280;">${booking.customerPhone}</div>
                            </td>
                            <td style="padding: 15px; color: #374151;">${bookingDate}</td>
                            <td style="padding: 15px; color: #374151;">${booking.guests.adults} Adults${booking.guests.children > 0 ? `, ${booking.guests.children} Children` : ''}</td>
                            <td style="padding: 15px; font-weight: 600; color: #6366f1;">$${booking.totalPrice}</td>
                            <td style="padding: 15px;">
                                <span style="background: ${statusColor.bg}; color: ${statusColor.text}; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; text-transform: capitalize;">
                                    ${booking.status}
                                </span>
                            </td>
                            <td style="padding: 15px;">
                                <div style="display: flex; gap: 8px;">
                                    ${booking.status === 'pending' ? `
                                        <button onclick="updateBookingStatus('${booking.id}', 'confirmed')" style="padding: 6px 12px; background: #22c55e; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                                            Confirm
                                        </button>
                                        <button onclick="updateBookingStatus('${booking.id}', 'cancelled')" style="padding: 6px 12px; background: #ef4444; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                                            Cancel
                                        </button>
                                    ` : ''}
                                    <button onclick="viewBookingDetails('${booking.id}')" style="padding: 6px 12px; background: #6366f1; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                                        View
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });

                tbody.innerHTML = html;

            } catch (error) {
                console.error('Error loading bookings:', error);
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="padding: 40px; text-align: center; color: #ef4444;">
                            Error loading bookings: ${error.message}
                        </td>
                    </tr>
                `;
            }
        }

        async function updateBookingStatus(bookingId, newStatus) {
            if (!confirm(`Are you sure you want to ${newStatus} this booking?`)) {
                return;
            }

            try {
                const token = localStorage.getItem('accessToken');
                const response = await fetch(`${API_URL}/admin/bookings/${bookingId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ status: newStatus })
                });

                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.message || 'Failed to update booking status');
                }

                alert(`Booking ${newStatus} successfully!`);
                loadBookings(); // Reload bookings
            } catch (error) {
                console.error('Error updating booking status:', error);
                alert('Error: ' + error.message);
            }
        }

        async function viewBookingDetails(bookingId) {
            try {
                const token = localStorage.getItem('accessToken');
                const response = await fetch(`${API_URL}/bookings/${bookingId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const result = await response.json();

                if (!result.success || !result.data) {
                    throw new Error('Booking not found');
                }

                const booking = result.data;
                const bookingDate = new Date(booking.date).toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                const statusColors = {
                    'pending': '#ff9800',
                    'confirmed': '#22c55e',
                    'cancelled': '#ef4444'
                };

                const details = `
                    <div style="max-width: 600px;">
                        <div style="background: #f9fafb; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <p style="margin: 0 0 5px 0;"><strong>Booking ID:</strong> ${booking.id}</p>
                            <p style="margin: 0 0 5px 0;"><strong>Status:</strong> <span style="color: ${statusColors[booking.status]}; font-weight: bold; text-transform: capitalize;">${booking.status}</span></p>
                        </div>

                        <div style="background: #f9fafb; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="margin: 0 0 10px 0; color: #6366f1;">Tour Information</h4>
                            <p style="margin: 0 0 5px 0;"><strong>Tour:</strong> ${booking.tourName}</p>
                            <p style="margin: 0 0 5px 0;"><strong>Date:</strong> ${bookingDate}</p>
                            <p style="margin: 0 0 5px 0;"><strong>Guests:</strong> ${booking.guests.adults} Adults${booking.guests.children > 0 ? `, ${booking.guests.children} Children` : ''}</p>
                            ${booking.pickupLocation ? `<p style="margin: 0 0 5px 0;"><strong>Pick up location:</strong> ${booking.pickupLocation}</p>` : ''}
                            <p style="margin: 0;"><strong>Total Price:</strong> <span style="color: #6366f1; font-weight: bold;">$${booking.totalPrice}</span></p>
                        </div>

                        <div style="background: #f9fafb; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="margin: 0 0 10px 0; color: #6366f1;">Customer Information</h4>
                            <p style="margin: 0 0 5px 0;"><strong>Name:</strong> ${booking.customerName}</p>
                            <p style="margin: 0 0 5px 0;"><strong>Email:</strong> ${booking.customerEmail}</p>
                            <p style="margin: 0;"><strong>Phone:</strong> ${booking.customerPhone}</p>
                        </div>

                        ${booking.specialRequests ? `
                        <div style="background: #f9fafb; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="margin: 0 0 10px 0; color: #6366f1;">Special Requests</h4>
                            <p style="margin: 0;">${booking.specialRequests}</p>
                        </div>
                        ` : ''}

                        <div style="background: #f9fafb; padding: 15px; border-radius: 8px;">
                            <p style="margin: 0 0 5px 0;"><strong>Created:</strong> ${new Date(booking.createdAt).toLocaleString()}</p>
                            ${booking.confirmedAt ? `<p style="margin: 0 0 5px 0;"><strong>Confirmed:</strong> ${new Date(booking.confirmedAt).toLocaleString()}</p>` : ''}
                            ${booking.cancelledAt ? `<p style="margin: 0;"><strong>Cancelled:</strong> ${new Date(booking.cancelledAt).toLocaleString()}</p>` : ''}
                        </div>
                    </div>
                `;

                // Show in SweetAlert2 modal
                Swal.fire({
                    title: 'Booking Details',
                    html: details,
                    width: '700px',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#6366f1'
                });
            } catch (error) {
                console.error('Error viewing booking:', error);
                alert('Error: ' + error.message);
            }
        }

        // Add event listener for status filter
        document.addEventListener('DOMContentLoaded', function() {
            const statusFilter = document.getElementById('statusFilter');
            if (statusFilter) {
                statusFilter.addEventListener('change', loadBookings);
            }
        });

        // ========== USERS MANAGEMENT ==========
        async function loadUsers() {
            const container = document.getElementById('usersTableContainer');

            try {
                const response = await fetch(`${API_URL}/admin/users`);
                const result = await response.json();

                if (!result.success || !result.data || !result.data.users) {
                    throw new Error('Invalid API response');
                }

                const users = result.data.users;

                if (users.length === 0) {
                    container.innerHTML = '<p style="padding: 20px; text-align: center; color: #6c757d;">No users found.</p>';
                    return;
                }

                // Create table
                let html = `
                    <table style="width: 100%; border-collapse: collapse; background: white;">
                        <thead>
                            <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <th style="padding: 12px; text-align: left;">Name</th>
                                <th style="padding: 12px; text-align: left;">Email</th>
                                <th style="padding: 12px; text-align: left;">Phone</th>
                                <th style="padding: 12px; text-align: left;">Role</th>
                                <th style="padding: 12px; text-align: left;">Status</th>
                                <th style="padding: 12px; text-align: left;">Joined</th>
                                <th style="padding: 12px; text-align: center;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                users.forEach(user => {
                    const roleColor = user.role === 'admin' ? '#dc3545' : (user.role === 'agent' ? '#ffc107' : '#17a2b8');
                    const statusColor = user.isActive ? '#28a745' : '#6c757d';
                    const statusText = user.isActive ? 'Active' : 'Inactive';
                    const joinedDate = user.createdAt ? new Date(user.createdAt).toLocaleDateString() : 'N/A';

                    html += `
                        <tr style="border-bottom: 1px solid #dee2e6;">
                            <td style="padding: 12px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                        ${user.name ? user.name.charAt(0).toUpperCase() : 'U'}
                                    </div>
                                    <strong>${user.name || 'N/A'}</strong>
                                </div>
                            </td>
                            <td style="padding: 12px;">${user.email || 'N/A'}</td>
                            <td style="padding: 12px;">${user.phone || 'N/A'}</td>
                            <td style="padding: 12px;">
                                <span style="background: ${roleColor}; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; text-transform: uppercase;">
                                    ${user.role || 'user'}
                                </span>
                            </td>
                            <td style="padding: 12px;">
                                <span style="background: ${statusColor}; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px;">
                                    ${statusText}
                                </span>
                            </td>
                            <td style="padding: 12px; color: #6c757d; font-size: 14px;">${joinedDate}</td>
                            <td style="padding: 12px; text-align: center;">
                                <div style="display: flex; gap: 8px; justify-content: center;">
                                    <button onclick="toggleUserStatus('${user.id || user._id}')"
                                            style="padding: 6px 12px; background: ${user.isActive ? '#ffc107' : '#28a745'}; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;"
                                            title="${user.isActive ? 'Block User' : 'Activate User'}">
                                        ${user.isActive ? 'üö´ Block' : '‚úÖ Activate'}
                                    </button>
                                    ${user.role !== 'admin' ? `
                                    <button onclick="changeUserRole('${user.id || user._id}', '${user.role}')"
                                            style="padding: 6px 12px; background: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;"
                                            title="Change Role">
                                        üë§ Role
                                    </button>
                                    ` : ''}
                                </div>
                            </td>
                        </tr>
                    `;
                });

                html += `
                        </tbody>
                    </table>
                `;

                container.innerHTML = html;

            } catch (error) {
                console.error('Error loading users:', error);
                container.innerHTML = `<p style="padding: 20px; text-align: center; color: #dc3545;">Error loading users: ${error.message}</p>`;
            }
        }

        // Toggle user status (active/inactive)
        async function toggleUserStatus(userId) {
            if (!confirm('Are you sure you want to change this user\'s status?')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/admin/users/${userId}/status`, {
                    method: 'PUT'
                });

                const result = await response.json();

                if (result.success) {
                    alert('‚úÖ User status updated successfully!');
                    loadUsers(); // Reload users
                } else {
                    alert('‚ùå Error: ' + (result.message || 'Failed to update user status'));
                }
            } catch (error) {
                console.error('Error toggling user status:', error);
                alert('‚ùå Error updating user status');
            }
        }

        // Change user role
        async function changeUserRole(userId, currentRole) {
            const newRole = prompt('Enter new role (user, agent, admin):', currentRole);

            if (!newRole || newRole === currentRole) {
                return;
            }

            if (!['user', 'agent', 'admin'].includes(newRole.toLowerCase())) {
                alert('‚ùå Invalid role! Use: user, agent, or admin');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/admin/users/${userId}/role`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ role: newRole.toLowerCase() })
                });

                const result = await response.json();

                if (result.success) {
                    alert('‚úÖ User role updated successfully!');
                    loadUsers(); // Reload users
                } else {
                    alert('‚ùå Error: ' + (result.message || 'Failed to update user role'));
                }
            } catch (error) {
                console.error('Error changing user role:', error);
                alert('‚ùå Error updating user role');
            }
        }

        // Open Add User Modal
        function openAddUserModal() {
            document.getElementById('addUserModal').style.display = 'flex';
            document.getElementById('addUserForm').reset();
        }

        // Close Add User Modal
        function closeAddUserModal() {
            document.getElementById('addUserModal').style.display = 'none';
        }

        // Handle Add User Form Submit
        document.addEventListener('DOMContentLoaded', function() {
            const addUserForm = document.getElementById('addUserForm');
            if (addUserForm) {
                addUserForm.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const userData = {
                        name: document.getElementById('userName').value,
                        email: document.getElementById('userEmail').value,
                        phone: document.getElementById('userPhone').value,
                        password: document.getElementById('userPassword').value,
                        role: document.getElementById('userRole').value,
                        isActive: document.getElementById('userIsActive').checked
                    };

                    try {
                        const response = await fetch(`${API_URL}/auth/register`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(userData)
                        });

                        const result = await response.json();

                        if (result.success) {
                            alert('‚úÖ User created successfully!');
                            closeAddUserModal();
                            loadUsers(); // Reload users list
                        } else {
                            alert('‚ùå Error: ' + (result.message || 'Failed to create user'));
                        }
                    } catch (error) {
                        console.error('Error creating user:', error);
                        alert('‚ùå Error creating user: ' + error.message);
                    }
                });
            }
        });

        // ========== CHECK LOGIN STATUS ==========
        function checkLoginStatus() {
            const token = localStorage.getItem('accessToken');
            const user = localStorage.getItem('user');

            if (!token || !user) {
                console.log('‚ùå Not logged in - redirecting to login page');
                window.location.href = '/gofly/admin-login.html';
                return false;
            }

            try {
                const userData = JSON.parse(user);
                if (userData.role !== 'admin') {
                    console.log('‚ùå Not an admin - redirecting to login page');
                    alert('You do not have admin access!');
                    window.location.href = '/gofly/admin-login.html';
                    return false;
                }
                console.log('‚úÖ Logged in as admin:', userData.name);
                return true;
            } catch (err) {
                console.error('Error parsing user data:', err);
                window.location.href = '/gofly/admin-login.html';
                return false;
            }
        }

        // Load tours when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            if (!checkLoginStatus()) {
                return;
            }

            console.log('üöÄ Admin panel loaded - Setting up menu handlers');

            // Setup menu click handlers
            const menuItems = document.querySelectorAll('.menu-item[data-page]');
            console.log(`üìã Found ${menuItems.length} menu items`);

            menuItems.forEach(item => {
                const pageName = item.dataset.page;
                console.log(`‚úÖ Adding click handler for: ${pageName}`);

                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log(`üñ±Ô∏è Clicked menu: ${pageName}`);
                    showPage(pageName);
                });
            });

            // Load initial tours data
            console.log('üìä Loading initial tours...');
            loadTours();

            // Display user name in top header
            try {
                const userData = JSON.parse(localStorage.getItem('user'));
                if (userData && userData.name) {
                    const userNameElements = document.querySelectorAll('.user-name-top');
                    userNameElements.forEach(el => {
                        el.textContent = userData.name;
                    });
                }
            } catch (err) {
                console.error('Error displaying user name:', err);
            }
        });

        // ========== LOGOUT FUNCTION ==========
        function logout() {
            console.log('üö™ Logging out...');

            // Clear localStorage
            localStorage.removeItem('accessToken');
            localStorage.removeItem('refreshToken');
            localStorage.removeItem('user');

            // Optional: Call logout API
            fetch('/api/auth/logout', {
                method: 'POST',
                credentials: 'include'
            }).catch(err => console.error('Logout API error:', err));

            // Redirect to login page
            window.location.href = '/gofly/admin-login.html';
        }
    </script>

    <!-- Image Preview Modal -->
    <div id="imagePreviewModal" class="image-preview-modal">
        <button class="image-preview-close" onclick="closeImagePreview()">√ó</button>
        <div class="image-preview-content">
            <img id="imagePreviewImg" src="" alt="Preview">
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>Add New User</h2>
                <button class="close-modal" onclick="closeAddUserModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" id="userName" placeholder="John Doe" required>
                    </div>

                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" id="userEmail" placeholder="user@example.com" required>
                    </div>

                    <div class="form-group">
                        <label>Phone *</label>
                        <input type="tel" id="userPhone" placeholder="+998901234567" required>
                    </div>

                    <div class="form-group">
                        <label>Password *</label>
                        <input type="password" id="userPassword" placeholder="Min 6 characters" minlength="6" required>
                    </div>

                    <div class="form-group">
                        <label>Role *</label>
                        <select id="userRole" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="user">User - Can browse and book tours</option>
                            <option value="agent">Agent - Can manage tours and bookings</option>
                            <option value="admin">Admin - Full access to everything</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="userIsActive" checked>
                            <span>Active (User can login)</span>
                        </label>
                    </div>

                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <h4 style="margin: 0 0 10px 0; font-size: 14px; color: #333;">üìã Role Permissions:</h4>
                        <div style="font-size: 13px; color: #666; line-height: 1.8;">
                            <div style="margin-bottom: 8px;">
                                <strong style="color: #17a2b8;">üë§ USER:</strong> Browse tours, make bookings, view own profile
                            </div>
                            <div style="margin-bottom: 8px;">
                                <strong style="color: #ffc107;">üéØ AGENT:</strong> Manage tours, handle bookings, customer support
                            </div>
                            <div>
                                <strong style="color: #dc3545;">‚öôÔ∏è ADMIN:</strong> Full system access, manage users, all settings
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="cancel-btn" onclick="closeAddUserModal()">Cancel</button>
                        <button type="submit" class="submit-btn">Create User</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="categoryModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 id="categoryModalTitle">Add New Category</h2>
                <button class="close-modal" onclick="closeCategoryModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="categoryForm">
                    <input type="hidden" id="categoryId">

                    <div class="form-group">
                        <label>Category Name *</label>
                        <input type="text" id="categoryName" placeholder="E.g.: Adventure Tours" required>
                    </div>

                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="categoryDescription" rows="3" placeholder="Brief description about this category"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Icon (Emoji)</label>
                            <input type="text" id="categoryIcon" placeholder="üéØ" maxlength="2">
                        </div>
                        <div class="form-group">
                            <label>Color (Hex)</label>
                            <input type="color" id="categoryColor" value="#667eea">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Order</label>
                        <input type="number" id="categoryOrder" min="0" placeholder="0">
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="categoryIsActive" checked>
                            Active
                        </label>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="cancel-btn" onclick="closeCategoryModal()">Cancel</button>
                        <button type="submit" class="submit-btn">Save Category</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>
</html>
