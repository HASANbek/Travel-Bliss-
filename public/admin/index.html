<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin CMS - Travel Bliss</title>
    <!-- Leaflet CSS for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f4f6f9;
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: #343a40;
            color: white;
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 20px;
            background: #2c3136;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-header .logo {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #343a40;
            font-size: 18px;
        }

        .sidebar-header h2 {
            font-size: 18px;
            font-weight: 600;
        }

        .user-panel {
            padding: 15px 20px;
            border-bottom: 1px solid #4b545c;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-panel .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
        }

        .user-panel .user-name {
            font-size: 14px;
            font-weight: 600;
        }

        .sidebar-menu {
            padding: 10px 0;
        }

        .menu-section-title {
            padding: 10px 20px;
            font-size: 11px;
            text-transform: uppercase;
            color: #8a939b;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #c2c7d0;
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
        }

        .menu-item:hover {
            background: #3f474e;
            color: white;
        }

        .menu-item.active {
            background: #007bff;
            color: white;
        }

        .menu-item i {
            width: 20px;
            margin-right: 10px;
            font-size: 14px;
        }

        /* Main Content */
        .main-content {
            margin-left: 250px;
            min-height: 100vh;
        }

        .top-header {
            background: white;
            border-bottom: 1px solid #dee2e6;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 57px;
        }

        .top-nav {
            display: flex;
            align-items: center;
            gap: 30px;
            padding: 0 20px;
        }

        .top-nav a {
            color: #495057;
            text-decoration: none;
            font-size: 14px;
            padding: 18px 0;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .top-nav a:hover,
        .top-nav a.active {
            color: #007bff;
            border-bottom-color: #007bff;
        }

        .top-right {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 0 20px;
        }

        .user-name-top {
            font-size: 14px;
            color: #495057;
        }

        .logout-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px 15px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        /* Content Header */
        .content-header {
            padding: 15px 20px;
            background: white;
            border-bottom: 1px solid #dee2e6;
        }

        .content-header h1 {
            font-size: 24px;
            color: #212529;
            margin-bottom: 5px;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #6c757d;
        }

        .breadcrumb a {
            color: #007bff;
            text-decoration: none;
        }

        /* Dashboard Content */
        .dashboard-content {
            padding: 20px;
        }

        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        .info-boxes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .info-box {
            background: white;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 0 1px rgba(0,0,0,.125), 0 1px 3px rgba(0,0,0,.2);
            transition: all 0.3s;
        }

        .info-box:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,.15);
            transform: translateY(-2px);
        }

        .info-box-header {
            padding: 15px 20px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .info-box-header h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .info-box-header .number {
            font-size: 32px;
            font-weight: 700;
            background: rgba(255,255,255,0.3);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .info-box-content {
            padding: 15px 20px;
            background: white;
        }

        .info-box-content a {
            color: #495057;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
            transition: all 0.3s;
        }

        .info-box.cyan .info-box-header { background: #17a2b8; }
        .info-box.green .info-box-header { background: #28a745; }
        .info-box.yellow .info-box-header { background: #ffc107; }
        .info-box.red .info-box-header { background: #dc3545; }
        .info-box.purple .info-box-header { background: #6f42c1; }

        /* Tours Section */
        .add-tour-btn {
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .add-tour-btn:hover {
            background: #218838;
        }

        .tours-table {
            background: white;
            border-radius: 4px;
            box-shadow: 0 0 1px rgba(0,0,0,.125), 0 1px 3px rgba(0,0,0,.2);
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f8f9fa;
        }

        th {
            padding: 12px 15px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
            color: #212529;
            font-size: 14px;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-right: 5px;
        }

        .edit-btn {
            background: #007bff;
            color: white;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            width: 98%;
            max-width: 1400px;
            max-height: 95vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }

        .modal-header h2 {
            font-size: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
        }

        .modal-body {
            padding: 25px 30px;
        }

        /* Step Indicator */
        .step-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 25px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            gap: 0;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            flex: 0 0 auto;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e9ecef;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .step.completed .step-number {
            background: #28a745;
            color: white;
        }

        .step-label {
            font-size: 13px;
            color: #6c757d;
            font-weight: 500;
            white-space: nowrap;
        }

        .step.active .step-label {
            color: #495057;
            font-weight: 600;
        }

        .step-line {
            width: 80px;
            height: 2px;
            background: #dee2e6;
            margin: 0 -5px;
            margin-bottom: 28px;
        }

        .step.active ~ .step-line {
            background: #dee2e6;
        }

        .step.completed ~ .step-line {
            background: #28a745;
        }

        /* Form Steps */
        .form-step {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .form-step.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        /* Form Row */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .itinerary-day-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }

        .itinerary-day-card .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #dee2e6;
        }

        .itinerary-day-card .day-number {
            font-size: 18px;
            font-weight: bold;
            color: #495057;
        }

        .itinerary-day-card .remove-day-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .itinerary-day-card .remove-day-btn:hover {
            background: #c82333;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Checkbox Labels */
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            background: white;
            transition: all 0.2s ease;
        }

        .checkbox-label:hover {
            background: #f8f9fa;
            border-color: #667eea;
        }

        .checkbox-label input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        /* Toggle Options */
        .toggle-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .toggle-option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .toggle-option:has(input:checked) {
            background: #e8f5e9;
            border-color: #28a745;
        }

        .toggle-label {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .toggle-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            margin: 0;
        }

        .toggle-text {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .toggle-text strong {
            color: #495057;
            font-size: 14px;
        }

        .toggle-text small {
            color: #6c757d;
            font-size: 12px;
        }

        /* Add Day Button */
        .btn-add-day {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn-add-day:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #dee2e6;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        /* Drag & Drop Styles */
        .drop-zone {
            border: 3px dashed #dee2e6;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .drop-zone:hover {
            border-color: #6366f1;
            background: #f0f2ff;
        }

        .drop-zone.drag-over {
            border-color: #6366f1;
            background: #e8ebff;
            transform: scale(1.02);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.2);
        }

        .drop-zone-content svg {
            color: #6366f1;
            margin-bottom: 15px;
        }

        .drop-zone-content h4 {
            font-size: 18px;
            color: #495057;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .drop-zone-content p {
            color: #6c757d;
            margin: 10px 0;
            font-size: 14px;
        }

        .drop-zone-content small {
            color: #adb5bd;
            font-size: 12px;
            display: block;
            margin-top: 10px;
        }

        .btn-browse {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-browse:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .btn-browse:active {
            transform: translateY(0);
        }

        /* Real-time Validation Styles */
        .form-group {
            position: relative;
        }

        .form-group input:not([type="file"]):not([type="checkbox"]),
        .form-group textarea,
        .form-group select {
            padding-right: 40px;
        }

        .form-group .validation-icon {
            position: absolute;
            right: 12px;
            top: 38px;
            font-size: 18px;
            display: none;
            pointer-events: none;
        }

        .form-group.valid .validation-icon.valid-icon {
            display: block;
            color: #10b981;
        }

        .form-group.invalid .validation-icon.invalid-icon {
            display: block;
            color: #ef4444;
        }

        .form-group input.valid:not([type="file"]):not([type="checkbox"]),
        .form-group textarea.valid,
        .form-group select.valid {
            border-color: #10b981;
            background-color: #f0fdf4;
        }

        .form-group input.invalid:not([type="file"]):not([type="checkbox"]),
        .form-group textarea.invalid,
        .form-group select.invalid {
            border-color: #ef4444;
            background-color: #fef2f2;
        }

        .validation-message {
            font-size: 12px;
            margin-top: 4px;
            display: none;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .validation-message.error {
            color: #ef4444;
            display: block;
        }

        .validation-message.success {
            color: #10b981;
            display: block;
        }

        .required-badge {
            color: #ef4444;
            font-size: 12px;
            font-weight: 600;
        }

        /* Image Reordering Styles */
        .image-card {
            position: relative;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            cursor: move;
            transition: all 0.3s;
        }

        .image-card:hover {
            border-color: #6366f1;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
        }

        .image-card.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .image-card.drag-over {
            border-color: #8b5cf6;
            border-style: dashed;
            background: #f0f2ff;
        }

        .image-card .drag-handle {
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            color: #6c757d;
            cursor: move;
            display: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 10;
        }

        .image-card:hover .drag-handle {
            display: block;
        }

        /* Image Preview Modal */
        .image-preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .image-preview-modal.active {
            display: flex;
        }

        .image-preview-content {
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }

        .image-preview-content img {
            max-width: 100%;
            max-height: 90vh;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .image-preview-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            z-index: 10001;
        }

        .image-preview-close:hover {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">A</div>
            <h2>Admin CMS</h2>
        </div>

        <div class="user-panel">
            <div class="user-avatar">üë§</div>
            <div class="user-info">
                <div class="user-name">Admin</div>
            </div>
        </div>

        <div class="sidebar-menu">
            <div class="menu-section">
                <div class="menu-section-title">MAIN</div>
                <a class="menu-item active" data-page="dashboard">
                    <i>üè†</i>
                    <span>Dashboard</span>
                </a>
                <a class="menu-item" data-page="tours">
                    <i>üéØ</i>
                    <span>Tours</span>
                </a>
                <a class="menu-item" data-page="bookings">
                    <i>üìã</i>
                    <span>Bookings</span>
                </a>
                <a class="menu-item" data-page="users">
                    <i>üë•</i>
                    <span>Users</span>
                </a>
                <a class="menu-item" data-page="pages">
                    <i>üìÑ</i>
                    <span>Pages</span>
                </a>
            </div>

            <div class="menu-section">
                <div class="menu-section-title">CONTENT</div>
                <a class="menu-item" data-page="categories">
                    <i>üóÇÔ∏è</i>
                    <span>Categories</span>
                </a>
                <a class="menu-item" data-page="destinations">
                    <i>üåç</i>
                    <span>Destinations</span>
                </a>
                <a class="menu-item" data-page="media">
                    <i>üñºÔ∏è</i>
                    <span>Media Library</span>
                </a>
                <a class="menu-item" data-page="reviews">
                    <i>‚≠ê</i>
                    <span>Reviews</span>
                </a>
                <a class="menu-item" data-page="blog">
                    <i>üìù</i>
                    <span>Blog</span>
                </a>
            </div>

            <div class="menu-section">
                <div class="menu-section-title">SETTINGS</div>
                <a class="menu-item" data-page="settings">
                    <i>‚öôÔ∏è</i>
                    <span>General Settings</span>
                </a>
                <a class="menu-item" data-page="seo">
                    <i>üîç</i>
                    <span>SEO Settings</span>
                </a>
                <a class="menu-item" onclick="logout()">
                    <i>üö™</i>
                    <span>Logout</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="top-header">
            <div class="top-nav">
                <a href="#" class="active">Dashboard</a>
                <a href="/gofly/travel-agency-03.html" target="_blank">View Website</a>
            </div>
            <div class="top-right">
                <span class="user-name-top">Admin</span>
                <button class="logout-btn" onclick="logout()">
                    <span>üö™</span>
                    <span>Logout</span>
                </button>
            </div>
        </div>

        <div class="content-header">
            <h1 id="pageTitle">Dashboard</h1>
            <div class="breadcrumb">
                <a href="#">Home</a>
                <span>/</span>
                <span id="pageBreadcrumb">Dashboard</span>
            </div>
        </div>

        <div class="dashboard-content">
            <!-- Dashboard Page -->
            <div class="page-section active" id="dashboardPage">
                <div class="info-boxes">
                    <div class="info-box cyan">
                        <div class="info-box-header">
                            <h3>Total Tours</h3>
                            <div class="number" id="totalTours">0</div>
                        </div>
                        <div class="info-box-content">
                            <a href="#" onclick="showPage('tours'); return false;">
                                <span>More info</span>
                                <span>‚Üí</span>
                            </a>
                        </div>
                    </div>

                    <div class="info-box green">
                        <div class="info-box-header">
                            <h3>Active Tours</h3>
                            <div class="number" id="activeTours">0</div>
                        </div>
                        <div class="info-box-content">
                            <a href="#" onclick="showPage('tours'); return false;">
                                <span>More info</span>
                                <span>‚Üí</span>
                            </a>
                        </div>
                    </div>

                    <div class="info-box yellow">
                        <div class="info-box-header">
                            <h3>Total Bookings</h3>
                            <div class="number">0</div>
                        </div>
                        <div class="info-box-content">
                            <a href="#" onclick="showPage('bookings'); return false;">
                                <span>More info</span>
                                <span>‚Üí</span>
                            </a>
                        </div>
                    </div>

                    <div class="info-box red">
                        <div class="info-box-header">
                            <h3>Today's Bookings</h3>
                            <div class="number">0</div>
                        </div>
                        <div class="info-box-content">
                            <a href="#" onclick="showPage('bookings'); return false;">
                                <span>More info</span>
                                <span>‚Üí</span>
                            </a>
                        </div>
                    </div>

                    <div class="info-box purple">
                        <div class="info-box-header">
                            <h3>Blog Posts</h3>
                            <div class="number" id="totalBlogs">0</div>
                        </div>
                        <div class="info-box-content">
                            <a href="#" onclick="showPage('blog'); return false;">
                                <span>More info</span>
                                <span>‚Üí</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tours Page -->
            <div class="page-section" id="toursPage">
                <button class="add-tour-btn" onclick="openModal()">+ Add New Tour</button>

                <div class="tours-table">
                    <div id="toursTableContainer">
                        <div class="loading">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Bookings Page -->
            <div class="page-section" id="bookingsPage">
                <h3>Bookings management coming soon...</h3>
            </div>

            <!-- Users Page -->
            <div class="page-section" id="usersPage">
                <h3>Users management coming soon...</h3>
            </div>

            <!-- Pages Page -->
            <div class="page-section" id="pagesPage">
                <h3>Pages management coming soon...</h3>
            </div>

            <!-- Categories Page -->
            <div class="page-section" id="categoriesPage">
                <button class="add-tour-btn" onclick="openCategoryModal()">+ Add New Category</button>

                <div class="tours-table-wrapper">
                    <table class="tours-table">
                        <thead>
                            <tr>
                                <th>Order</th>
                                <th>Icon</th>
                                <th>Name</th>
                                <th>Slug</th>
                                <th>Color</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="categoriesTableBody">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">
                                    Loading categories...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Destinations Page -->
            <div class="page-section" id="destinationsPage">
                <button class="add-tour-btn" onclick="openDestinationModal()">+ Add New Destination</button>

                <div class="tours-table">
                    <div id="destinationsTableContainer">
                        <div class="loading">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Media Page -->
            <div class="page-section" id="mediaPage">
                <h3>Media library coming soon...</h3>
            </div>

            <!-- Reviews Page -->
            <div class="page-section" id="reviewsPage">
                <h3>Reviews management coming soon...</h3>
            </div>

            <!-- Blog Page -->
            <div class="page-section" id="blogPage">
                <button class="add-tour-btn" onclick="openBlogModal()">+ Add New Blog Post</button>

                <div class="tours-table">
                    <div id="blogTableContainer">
                        <table>
                            <thead>
                                <tr>
                                    <th>Image</th>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Author</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="blogTableBody">
                                <tr>
                                    <td colspan="7" class="loading">Loading blog posts...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div class="page-section" id="settingsPage">
                <h3>General settings coming soon...</h3>
            </div>

            <!-- SEO Page -->
            <div class="page-section" id="seoPage">
                <h3>SEO settings coming soon...</h3>
            </div>
        </div>
    </div>

    <!-- AI Assistant Modal -->
    <div class="modal" id="aiModal" style="z-index: 10001;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>‚ú® AI Tour Assistant</h2>
                <button class="close-btn" onclick="closeAIModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="background: linear-gradient(135deg, #e7f3ff 0%, #f0f7ff 100%); border-left: 4px solid #2196F3; padding: 15px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(33, 150, 243, 0.1);">
                    <p style="color: #1976D2; margin: 0; font-size: 14px; line-height: 1.6;">
                        <strong style="font-size: 15px;">‚ú® AI Yordamchisi</strong><br>
                        Quyidagi asosiy ma'lumotlarni kiriting, AI avtomatik ravishda:<br>
                        ‚Ä¢ To'liq tur tavsifini<br>
                        ‚Ä¢ Kunlik dasturni (itinerary)<br>
                        ‚Ä¢ Nima kiradi/kirmaydi ro'yxatlarini<br>
                        ‚Ä¢ Tur diqqatga sazovor joylari (highlights)ni yaratadi!
                    </p>
                </div>

                <div class="form-group">
                    <label>Tour Type *</label>
                    <select id="aiCategory">
                        <option value="">Select tour type</option>
                        <option value="cultural">üèõÔ∏è Cultural Tour</option>
                        <option value="adventure">üèîÔ∏è Adventure Tour</option>
                        <option value="hiking">ü•æ Hiking Tour</option>
                        <option value="day-trip">üåÖ Day Trip</option>
                    </select>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Duration (Days) *</label>
                        <input type="number" id="aiDuration" min="1" placeholder="5">
                    </div>
                    <div class="form-group">
                        <label>Nights</label>
                        <input type="number" id="aiNights" min="0" placeholder="4">
                    </div>
                </div>

                <div class="form-group">
                    <label>Destination *</label>
                    <input type="text" id="aiDestination" placeholder="Samarkand, Bukhara, Khiva">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Price (USD) *</label>
                        <input type="number" id="aiPrice" min="0" placeholder="500">
                    </div>
                    <div class="form-group">
                        <label>Max Group Size *</label>
                        <input type="number" id="aiMaxGroupSize" min="1" placeholder="15">
                    </div>
                </div>

                <div class="form-group">
                    <label>Difficulty Level</label>
                    <select id="aiDifficulty">
                        <option value="easy">Easy</option>
                        <option value="moderate" selected>Moderate</option>
                        <option value="challenging">Challenging</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Accommodation Type</label>
                    <select id="aiAccommodation">
                        <option value="">Not specified</option>
                        <option value="5 Star Hotel">5 Star Hotel</option>
                        <option value="4 Star Hotel">4 Star Hotel</option>
                        <option value="3 Star Hotel" selected>3 Star Hotel</option>
                        <option value="Boutique Hotel">Boutique Hotel</option>
                        <option value="Guesthouse">Guesthouse</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Additional Description (Optional)</label>
                    <textarea id="aiPrompt" rows="3" placeholder="Add any specific details or requirements..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAIModal()">Cancel</button>
                <button class="btn btn-primary" onclick="generateTourWithAI()">‚ú® Generate Tour</button>
            </div>
        </div>
    </div>

    <!-- Tour Modal -->
    <div class="modal" id="tourModal">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h2 id="modalTitle">Add New Tour</h2>
                    <p style="font-size: 13px; color: #6c757d; margin-top: 5px;">Complete the form step by step</p>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button type="button" onclick="openTourAIAssistant()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 6px;">
                        ‚ú® AI Assistant
                    </button>
                    <button class="close-btn" onclick="closeModal()">&times;</button>
                </div>
            </div>

            <!-- Progress Steps -->
            <div class="step-indicator">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Basic Info</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Details</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">Itinerary</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-label">Media & Finish</div>
                </div>
            </div>

            <div class="modal-body">
                <form id="tourForm">
                    <!-- STEP 1: Basic Information -->
                    <div class="form-step active" data-step="1">
                        <h3 class="step-title">üìù Basic Information</h3>

                        <div class="form-group" id="tourNameGroup">
                            <label>Tour Name *</label>
                            <input type="text" id="tourName" placeholder="E.g.: Samarkand and Bukhara Safari" data-required="true" data-min-length="5">
                            <span class="validation-icon valid-icon">‚úì</span>
                            <span class="validation-icon invalid-icon">‚úó</span>
                            <div class="validation-message" id="tourNameError"></div>
                        </div>

                        <div class="form-group">
                            <label>Summary</label>
                            <textarea id="tourSummary" rows="2" placeholder="Brief summary about the tour in 1-2 sentences"></textarea>
                        </div>

                        <div class="form-group" id="tourDescriptionGroup">
                            <label>Full Description *</label>
                            <textarea id="tourDescription" rows="4" placeholder="Detailed tour description" data-required="true" data-min-length="50"></textarea>
                            <span class="validation-icon valid-icon">‚úì</span>
                            <span class="validation-icon invalid-icon">‚úó</span>
                            <div class="validation-message" id="tourDescriptionError"></div>
                        </div>

                        <div class="form-row">
                            <div class="form-group" id="tourPriceGroup">
                                <label>Price (USD) *</label>
                                <input type="number" id="tourPrice" min="0" placeholder="500" data-required="true" data-min="1">
                                <span class="validation-icon valid-icon">‚úì</span>
                                <span class="validation-icon invalid-icon">‚úó</span>
                                <div class="validation-message" id="tourPriceError"></div>
                            </div>
                            <div class="form-group" id="tourDiscountPriceGroup">
                                <label>Discount Price (USD)</label>
                                <input type="number" id="tourDiscountPrice" min="0" placeholder="450" data-compare-less="tourPrice">
                                <span class="validation-icon valid-icon">‚úì</span>
                                <span class="validation-icon invalid-icon">‚úó</span>
                                <div class="validation-message" id="tourDiscountPriceError"></div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group" id="tourDurationGroup">
                                <label>Duration (days) *</label>
                                <input type="number" id="tourDuration" min="1" placeholder="7" data-required="true" data-min="1">
                                <span class="validation-icon valid-icon">‚úì</span>
                                <span class="validation-icon invalid-icon">‚úó</span>
                                <div class="validation-message" id="tourDurationError"></div>
                            </div>
                            <div class="form-group">
                                <label>Nights</label>
                                <input type="number" id="tourNights" min="0" placeholder="6">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Highlights (one per line)</label>
                            <textarea id="tourHighlights" rows="4" placeholder="Eiffel Tower ‚Äì Skip-the-line access & breathtaking views&#10;Louvre Museum ‚Äì See the Mona Lisa and world-renowned masterpieces&#10;Opera Garnier ‚Äì Visit the stunning opera house"></textarea>
                            <small style="color: #6c757d; font-size: 12px;">Enter each highlight on a new line</small>
                        </div>
                    </div>

                    <!-- STEP 2: Location & Details -->
                    <div class="form-step" data-step="2">
                        <h3 class="step-title">üåç Location & Package Details</h3>

                        <div class="form-group" id="tourLocationGroup">
                            <label>Location *</label>
                            <input type="text" id="tourLocation" placeholder="Samarkand, Bukhara, Khiva" data-required="true" data-min-length="3">
                            <span class="validation-icon valid-icon">‚úì</span>
                            <span class="validation-icon invalid-icon">‚úó</span>
                            <div class="validation-message" id="tourLocationError"></div>
                        </div>

                        <div class="form-row">
                            <div class="form-group" id="tourCategoryGroup">
                                <label>Category *</label>
                                <select id="tourCategory" data-required="true">
                                    <option value="">Select category</option>
                                    <option value="cultural">Cultural Tours</option>
                                    <option value="adventure">Adventure Tours</option>
                                    <option value="hiking">Homestays & Hiking</option>
                                    <option value="day-trip">Day Trips</option>
                                </select>
                                <span class="validation-icon valid-icon">‚úì</span>
                                <span class="validation-icon invalid-icon">‚úó</span>
                                <div class="validation-message" id="tourCategoryError"></div>
                            </div>
                            <div class="form-group">
                                <label>Difficulty Level</label>
                                <select id="tourDifficulty">
                                    <option value="easy">Easy</option>
                                    <option value="moderate" selected>Moderate</option>
                                    <option value="challenging">Challenging</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group" id="tourGroupSizeMinGroup">
                                <label>Min Group Size</label>
                                <input type="number" id="tourGroupSizeMin" min="1" placeholder="5" data-min="1">
                                <span class="validation-icon valid-icon">‚úì</span>
                                <span class="validation-icon invalid-icon">‚úó</span>
                                <div class="validation-message" id="tourGroupSizeMinError"></div>
                            </div>
                            <div class="form-group" id="tourMaxGroupSizeGroup">
                                <label>Max Group Size *</label>
                                <input type="number" id="tourMaxGroupSize" min="1" placeholder="15" data-required="true" data-min="1" data-compare-greater="tourGroupSizeMin">
                                <span class="validation-icon valid-icon">‚úì</span>
                                <span class="validation-icon invalid-icon">‚úó</span>
                                <div class="validation-message" id="tourMaxGroupSizeError"></div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Destinations Count</label>
                            <input type="number" id="tourDestinationsCount" min="1" placeholder="3">
                        </div>

                        <h4 style="margin: 20px 0 15px; color: #495057; font-size: 15px;">Package Includes</h4>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Accommodation Type</label>
                                <select id="tourAccommodation">
                                    <option value="">Not specified</option>
                                    <option value="5 Star Hotel">5 Star Hotel</option>
                                    <option value="4 Star Hotel">4 Star Hotel</option>
                                    <option value="3 Star Hotel">3 Star Hotel</option>
                                    <option value="Boutique Hotel">Boutique Hotel</option>
                                    <option value="Guesthouse">Guesthouse</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Meals Included</label>
                                <select id="tourMeals">
                                    <option value="">Not specified</option>
                                    <option value="Breakfast & Dinner">Breakfast & Dinner</option>
                                    <option value="Breakfast Only">Breakfast Only</option>
                                    <option value="All Meals">All Meals</option>
                                    <option value="No Meals">No Meals</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Transportation</label>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                                <label class="checkbox-label">
                                    <input type="checkbox" class="transport-checkbox" value="Car"> üöó Car
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" class="transport-checkbox" value="Bus"> üöå Bus
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" class="transport-checkbox" value="Flight"> ‚úàÔ∏è Flight
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Guide Languages</label>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                                <label class="checkbox-label">
                                    <input type="checkbox" class="language-checkbox" value="English"> üá¨üáß English
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" class="language-checkbox" value="Russian"> üá∑üá∫ Russian
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" class="language-checkbox" value="Spanish"> üá™üá∏ Spanish
                                </label>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Best Season (Optional)</label>
                                <select id="tourSeason">
                                    <option value="">Any Season</option>
                                    <option value="Spring">Spring</option>
                                    <option value="Summer">Summer</option>
                                    <option value="Fall">Fall</option>
                                    <option value="Winter">Winter</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Rating (1-5)</label>
                                <input type="number" id="tourRating" min="1" max="5" step="0.1" value="4.5">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Age Range (Optional)</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <input type="number" id="tourAgeMin" min="0" placeholder="Min Age (e.g., 18)">
                                    <input type="number" id="tourAgeMax" min="0" placeholder="Max Age (e.g., 45)">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Pet/Animal Policy</label>
                                <input type="text" id="tourAnimal" placeholder="e.g., Cat, Pet only or No Pets Allowed">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Free Cancellation Policy (Optional)</label>
                            <textarea id="tourFreeCancellation" rows="2" placeholder="e.g., Free cancellation up to 24 hours before departure"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Health & Safety Info (Optional)</label>
                            <textarea id="tourHealthSafety" rows="2" placeholder="e.g., COVID-19 regulations, vaccinations, or travel restrictions"></textarea>
                        </div>
                    </div>

                    <!-- STEP 3: Itinerary & Details -->
                    <div class="form-step" data-step="3">
                        <h3 class="step-title">üìÖ Itinerary & Tour Details</h3>

                        <div class="form-group">
                            <label>What's Included (one item per line)</label>
                            <textarea id="tourIncludes" rows="4" placeholder="Accommodation&#10;All meals&#10;Transportation&#10;Professional guide"></textarea>
                        </div>

                        <div class="form-group">
                            <label>What's Not Included</label>
                            <textarea id="tourExcludes" rows="3" placeholder="International flights&#10;Personal expenses&#10;Visa fees"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Highlights of the Tour (one item per line)</label>
                            <textarea id="tourHighlights" rows="4" placeholder="Eiffel Tower ‚Äì Skip-the-line access & breathtaking views&#10;Louvre Museum ‚Äì See the Mona Lisa and masterpieces"></textarea>
                        </div>

                        <div class="form-group">
                            <label style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Itinerary (Optional)</span>
                                <button type="button" onclick="addItineraryDay()" class="btn-add-day">
                                    + Add Day
                                </button>
                            </label>
                            <div id="itineraryDays" style="margin-top: 15px;">
                                <!-- Dynamic itinerary days will be added here -->
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Health & Safety Guidelines (Optional)</label>
                            <textarea id="tourHealthSafety" rows="2" placeholder="COVID-19 regulations, vaccinations, or travel restrictions"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Free Cancellation Policy (Optional)</label>
                            <textarea id="tourFreeCancellation" rows="2" placeholder="Some tours offer free cancellation up to a certain period (e.g., 24-48 hours before departure)"></textarea>
                        </div>
                    </div>

                    <!-- STEP 4: Media & Final Settings -->
                    <div class="form-step" data-step="4">
                        <h3 class="step-title">üñºÔ∏è Media & Final Settings</h3>

                        <div class="form-group">
                            <label>Tour Images *</label>

                            <!-- Drag & Drop Zone -->
                            <div id="dropZone" class="drop-zone">
                                <div class="drop-zone-content">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="17 8 12 3 7 8"></polyline>
                                        <line x1="12" y1="3" x2="12" y2="15"></line>
                                    </svg>
                                    <h4>Drag & Drop rasmlarni bu yerga</h4>
                                    <p>yoki</p>
                                    <button type="button" class="btn-browse" onclick="document.getElementById('tourImageFile').click()">Rasmlarni tanlang</button>
                                    <small>PNG, JPG, WEBP (Max: 5MB har biri)</small>
                                </div>
                                <input type="file" id="tourImageFile" accept="image/*" multiple style="display: none;">
                            </div>

                            <div id="imageGallery" style="margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px;"></div>

                            <input type="hidden" id="tourImage">
                            <input type="hidden" id="tourImages">
                        </div>

                        <div class="form-group">
                            <label>Tags (comma separated)</label>
                            <input type="text" id="tourTags" placeholder="silk road, cultural heritage, history, architecture">
                            <small style="color: #6c757d; display: block; margin-top: 5px;">Enter keywords for better search visibility</small>
                        </div>

                        <div class="form-group">
                            <label>Explore Locations (JSON format - Optional)</label>
                            <textarea id="tourLocations" rows="3" placeholder='[{"name": "Southern France", "image": "location1.jpg", "days": "01 Days"}]'></textarea>
                            <small style="color: #6c757d;">Format: [{"name": "Location Name", "image": "image.jpg", "days": "02 Days"}]</small>
                        </div>

                        <div class="form-group">
                            <label>FAQ (JSON format - Optional)</label>
                            <textarea id="tourFAQ" rows="3" placeholder='[{"question": "What are the must-visit places?", "answer": "Top destinations include..."}]'></textarea>
                            <small style="color: #6c757d;">Format: [{"question": "Question here?", "answer": "Answer here"}]</small>
                        </div>

                        <h4 style="margin: 25px 0 15px; color: #495057; font-size: 15px; padding-top: 20px; border-top: 1px solid #e9ecef;">Tour Status & Visibility</h4>

                        <div class="toggle-options">
                            <div class="toggle-option">
                                <label class="toggle-label">
                                    <input type="checkbox" id="tourActive" checked>
                                    <span class="toggle-text">
                                        <strong>‚úì Active Tour</strong>
                                        <small>Make tour visible on website</small>
                                    </span>
                                </label>
                            </div>
                            <div class="toggle-option">
                                <label class="toggle-label">
                                    <input type="checkbox" id="tourFeatured">
                                    <span class="toggle-text">
                                        <strong>‚≠ê Featured Tour</strong>
                                        <small>Show in featured section on homepage</small>
                                    </span>
                                </label>
                            </div>
                            <div class="toggle-option">
                                <label class="toggle-label">
                                    <input type="checkbox" id="tourHotSale">
                                    <span class="toggle-text">
                                        <strong>üî• Hot Sale</strong>
                                        <small>Display special "Hot Sale!" badge</small>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <!-- Age Range and other fields moved to Step 2 -->
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button type="button" class="btn btn-secondary" id="prevBtn" onclick="previousStep()" style="display: none;">‚Üê Previous</button>
                <button type="button" class="btn btn-primary" id="nextBtn" onclick="nextStep()">Next ‚Üí</button>
                <button type="button" class="btn btn-primary" id="saveBtn" onclick="saveTour()" style="display: none;">üíæ Save Tour</button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';
        let currentEditId = null;

        // Load dashboard data on page load
        window.addEventListener('DOMContentLoaded', function() {
            loadDashboardStats();
        });

        // Page Navigation
        function showPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page-section').forEach(page => {
                page.classList.remove('active');
            });

            // Remove active from all menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });

            // Show selected page
            const pageMap = {
                'dashboard': { id: 'dashboardPage', title: 'Dashboard', breadcrumb: 'Dashboard' },
                'tours': { id: 'toursPage', title: 'Tours Management', breadcrumb: 'Tours' },
                'bookings': { id: 'bookingsPage', title: 'Bookings', breadcrumb: 'Bookings' },
                'users': { id: 'usersPage', title: 'Users Management', breadcrumb: 'Users' },
                'pages': { id: 'pagesPage', title: 'Pages Management', breadcrumb: 'Pages' },
                'categories': { id: 'categoriesPage', title: 'Categories Management', breadcrumb: 'Categories' },
                'destinations': { id: 'destinationsPage', title: 'Destinations', breadcrumb: 'Destinations' },
                'media': { id: 'mediaPage', title: 'Media Library', breadcrumb: 'Media' },
                'reviews': { id: 'reviewsPage', title: 'Reviews', breadcrumb: 'Reviews' },
                'blog': { id: 'blogPage', title: 'Blog Management', breadcrumb: 'Blog' },
                'settings': { id: 'settingsPage', title: 'General Settings', breadcrumb: 'Settings' },
                'seo': { id: 'seoPage', title: 'SEO Settings', breadcrumb: 'SEO' }
            };

            const page = pageMap[pageName];
            if (!page) {
                console.error('Page not found:', pageName);
                return;
            }

            document.getElementById(page.id).classList.add('active');
            document.getElementById('pageTitle').textContent = page.title;
            document.getElementById('pageBreadcrumb').textContent = page.breadcrumb;

            // Set active menu item
            document.querySelector(`[data-page="${pageName}"]`)?.classList.add('active');

            // Load page specific data
            if (pageName === 'tours') {
                loadTours();
            } else if (pageName === 'destinations') {
                loadDestinations();
            } else if (pageName === 'blog') {
                loadBlogs();
            }
        }

        // Menu click handlers
        document.querySelectorAll('.menu-item[data-page]').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const page = this.getAttribute('data-page');
                showPage(page);
            });
        });

        // Load dashboard statistics
        async function loadDashboardStats() {
            try {
                // Load tours stats
                const toursResponse = await fetch(`${API_URL}/tours`);
                const toursData = await toursResponse.json();

                if (toursData.success) {
                    const tours = toursData.data.tours;
                    document.getElementById('totalTours').textContent = tours.length;
                    document.getElementById('activeTours').textContent = tours.filter(t => t.isActive).length;
                }

                // Load blogs stats
                const blogsResponse = await fetch(`${API_URL}/admin/blogs`);
                if (blogsResponse.ok) {
                    const blogs = await blogsResponse.json();
                    document.getElementById('totalBlogs').textContent = blogs.length;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load tours
        async function loadTours() {
            try {
                const response = await fetch(`${API_URL}/tours`);
                const data = await response.json();

                if (data.success) {
                    displayTours(data.data.tours);
                }
            } catch (error) {
                console.error('Error loading tours:', error);
            }
        }

        function displayTours(tours) {
            const container = document.getElementById('toursTableContainer');

            if (!tours || tours.length === 0) {
                container.innerHTML = '<div class="loading">No tours found</div>';
                return;
            }

            const tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Location</th>
                            <th>Price</th>
                            <th>Duration</th>
                            <th>Category</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tours.map(tour => `
                            <tr>
                                <td><strong>${tour.title || tour.name || 'No title'}</strong></td>
                                <td>${tour.destination || tour.location || '-'}</td>
                                <td>$${tour.price || 0}</td>
                                <td>${tour.duration || 0} days</td>
                                <td>${getCategoryName(tour.category)}</td>
                                <td>
                                    <span class="badge ${tour.isActive ? 'badge-success' : 'badge-danger'}">
                                        ${tour.isActive ? 'Active' : 'Inactive'}
                                    </span>
                                </td>
                                <td>
                                    <button class="action-btn view-btn" onclick="viewTour('${tour._id || tour.id}')" style="background: #17a2b8; color: white;">üëÅÔ∏è View</button>
                                    <button class="action-btn edit-btn" onclick="editTour('${tour._id || tour.id}')">‚úèÔ∏è Edit</button>
                                    <button class="action-btn delete-btn" onclick="deleteTour('${tour._id || tour.id}')">üóëÔ∏è Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;
        }

        function getCategoryName(category) {
            const categories = {
                'cultural': 'Cultural Tours',
                'adventure': 'Adventure',
                'hiking': 'Hiking',
                'day-trip': 'Day Trip'
            };
            return categories[category] || category;
        }

        function openAddModal() {
            currentEditId = null;
            document.getElementById('modalTitle').textContent = 'Add New Tour';
            document.getElementById('tourForm').reset();
            document.getElementById('imageGallery').innerHTML = '';
            uploadedImages = [];
            coverImageIndex = 0;
            document.getElementById('tourModal').classList.add('active');

            // Setup image upload
            setTimeout(setupImageUpload, 100);
        }

        function closeModal() {
            document.getElementById('tourModal').classList.remove('active');
            currentEditId = null;
        }

        async function editTour(id) {
            try {
                const response = await fetch(`${API_URL}/tours/${id}`);
                const data = await response.json();

                if (data.success) {
                    const tour = data.data.tour;
                    currentEditId = id;

                    // Helper function to convert array to textarea lines
                    const arrayToTextarea = (arr) => {
                        return arr && arr.length > 0 ? arr.join('\n') : '';
                    };

                    // Helper function to convert array to comma-separated string
                    const arrayToCommaSeparated = (arr) => {
                        return arr && arr.length > 0 ? arr.join(', ') : '';
                    };

                    document.getElementById('modalTitle').textContent = 'Edit Tour';
                    document.getElementById('tourName').value = tour.name || tour.title || '';
                    document.getElementById('tourSummary').value = tour.summary || '';
                    document.getElementById('tourDescription').value = tour.description || '';
                    document.getElementById('tourPrice').value = tour.price || '';
                    document.getElementById('tourDiscountPrice').value = tour.discountPrice || '';
                    document.getElementById('tourDuration').value = tour.duration || '';
                    document.getElementById('tourNights').value = tour.nights || '';
                    document.getElementById('tourDestinationsCount').value = tour.destinationsCount || '';
                    document.getElementById('tourGroupSizeMin').value = tour.groupSizeMin || '';
                    document.getElementById('tourMaxGroupSize').value = tour.maxGroupSize || '';
                    document.getElementById('tourLocation').value = tour.location || tour.destination || '';
                    document.getElementById('tourCategory').value = tour.category || '';
                    document.getElementById('tourDifficulty').value = tour.difficulty || 'moderate';

                    // Package Details
                    document.getElementById('tourAccommodation').value = tour.accommodation || '';
                    document.getElementById('tourMeals').value = tour.meals || '';

                    // Set transport checkboxes
                    document.querySelectorAll('.transport-checkbox').forEach(cb => cb.checked = false);
                    if (tour.transportation) {
                        const transportList = tour.transportation.split(',').map(t => t.trim());
                        document.querySelectorAll('.transport-checkbox').forEach(cb => {
                            if (transportList.includes(cb.value)) cb.checked = true;
                        });
                    }

                    // Set language checkboxes
                    document.querySelectorAll('.language-checkbox').forEach(cb => cb.checked = false);
                    if (tour.languages && Array.isArray(tour.languages)) {
                        document.querySelectorAll('.language-checkbox').forEach(cb => {
                            if (tour.languages.includes(cb.value)) cb.checked = true;
                        });
                    }

                    document.getElementById('tourSeason').value = tour.season || '';
                    document.getElementById('tourAgeMin').value = tour.ageRange?.min || '';
                    document.getElementById('tourAgeMax').value = tour.ageRange?.max || '';

                    // Media - Load images into gallery
                    const gallery = document.getElementById('imageGallery');
                    gallery.innerHTML = '';
                    uploadedImages = [];
                    coverImageIndex = 0;

                    // Get images array - handle both uploaded images and legacy asset images
                    let tourImages = [];
                    if (tour.images && Array.isArray(tour.images) && tour.images.length > 0) {
                        tourImages = tour.images;
                    } else if (tour.imageCover || tour.image) {
                        // For legacy tours with only imageCover
                        tourImages = [tour.imageCover || tour.image];
                    }

                    const coverImage = tour.image || tour.imageCover || '';

                    if (tourImages.length > 0) {
                        tourImages.forEach((imageData, index) => {
                            // Handle both old format (string) and new format (object)
                            let imagePath, imageName, imageLocation;
                            if (typeof imageData === 'string') {
                                imagePath = imageData;
                                imageName = '';
                                imageLocation = '';
                            } else {
                                imagePath = imageData.url;
                                imageName = imageData.name || '';
                                imageLocation = imageData.location || '';
                            }

                            uploadedImages.push({ url: imagePath, name: imageName, location: imageLocation });

                            // Determine correct image URL
                            let imageUrl;
                            if (imagePath.startsWith('/uploads/')) {
                                // Uploaded image - Fix: Remove /api from URL
                                imageUrl = `http://localhost:5000${imagePath}`;
                            } else if (imagePath.startsWith('http://') || imagePath.startsWith('https://')) {
                                // External URL
                                imageUrl = imagePath;
                            } else {
                                // Legacy local asset - use relative path
                                imageUrl = `../gofly/assets/img/home1/${imagePath}`;
                            }

                            // Create preview card
                            const card = document.createElement('div');
                            card.style.cssText = `
                                position: relative;
                                border: 3px solid ${imagePath === coverImage ? '#6366f1' : '#e0e0e0'};
                                border-radius: 12px;
                                overflow: hidden;
                                cursor: pointer;
                                transition: all 0.3s;
                            `;
                            card.dataset.imageIndex = index;

                            card.innerHTML = `
                                <div style="position: relative;">
                                    <img src="${imageUrl}" style="width: 100%; height: 100%; object-fit: cover; aspect-ratio: 4/3;" onerror="this.src='../gofly/assets/img/home1/package-card-alpha-1.jpg'">
                                    <div style="position: absolute; top: 8px; right: 8px; background: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.2);" onclick="removeImage(${index}, this.parentElement.parentElement)">
                                        <span style="color: #dc3545; font-size: 18px; font-weight: bold;">√ó</span>
                                    </div>
                                    <div class="cover-badge" style="position: absolute; top: 8px; left: 8px; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; display: ${imagePath === coverImage ? 'block' : 'none'};">
                                        COVER
                                    </div>
                                </div>
                                <div style="padding: 8px;">
                                    <input type="text" placeholder="Location name..." style="width: 100%; padding: 8px; border: 1px solid #e0e0e0; border-radius: 6px; margin-bottom: 6px; font-size: 12px;" onchange="updateImageName(${index}, this.value)" value="${imageName}">
                                    <input type="text" placeholder="Address (e.g., Samarkand, Uzbekistan)..." style="width: 100%; padding: 8px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 12px;" onchange="updateImageLocation(${index}, this.value)" value="${imageLocation}">
                                </div>
                            `;

                            card.onclick = function(e) {
                                // Don't trigger setCoverImage if clicking on input
                                if (e.target.tagName !== 'INPUT') {
                                    setCoverImage(index);
                                }
                            };

                            gallery.appendChild(card);

                            // Set cover index
                            if (imagePath === coverImage) {
                                coverImageIndex = index;
                            }
                        });
                    }

                    // Update hidden inputs with object array format
                    updateHiddenInputs();

                    // Arrays
                    document.getElementById('tourIncludes').value = arrayToTextarea(tour.includes || tour.included);
                    document.getElementById('tourExcludes').value = arrayToTextarea(tour.excludes || tour.excluded);
                    loadItineraryData(tour.itinerary);
                    document.getElementById('tourHighlights').value = arrayToTextarea(tour.highlights);
                    document.getElementById('tourLocations').value = tour.locations ? JSON.stringify(tour.locations, null, 2) : '';
                    document.getElementById('tourFreeCancellation').value = tour.freeCancellation || '';
                    document.getElementById('tourHealthSafety').value = tour.healthSafety || '';
                    document.getElementById('tourFAQ').value = tour.faq ? JSON.stringify(tour.faq, null, 2) : '';
                    document.getElementById('tourTags').value = arrayToCommaSeparated(tour.tags);
                    document.getElementById('tourRating').value = tour.rating || 4.5;

                    // Checkboxes
                    document.getElementById('tourHotSale').checked = tour.hotSale || false;
                    document.getElementById('tourFeatured').checked = tour.isFeatured || false;
                    document.getElementById('tourActive').checked = tour.isActive !== undefined ? tour.isActive : true;

                    // Reset to step 1 when editing
                    currentStep = 1;
                    updateStepIndicator();
                    document.getElementById('tourModal').classList.add('active');

                    // Setup image upload for editing
                    setTimeout(setupImageUpload, 100);
                }
            } catch (error) {
                alert('Error loading tour');
            }
        }

        function viewTour(id) {
            // Open tour details page in new tab
            window.open(`/gofly/tour-details.html?id=${id}`, '_blank');
        }

        async function deleteTour(id) {
            if (!confirm('Are you sure you want to delete this tour?')) return;

            try {
                const response = await fetch(`${API_URL}/tours/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('Tour deleted successfully!');
                    loadTours();
                    loadDashboardStats();
                }
            } catch (error) {
                alert('Error occurred');
            }
        }

        async function saveTour() {
            // Custom validation before saving
            const tourName = document.getElementById('tourName').value.trim();
            const tourDescription = document.getElementById('tourDescription').value.trim();
            const tourLocation = document.getElementById('tourLocation').value.trim();
            const tourPrice = document.getElementById('tourPrice').value;
            const tourDuration = document.getElementById('tourDuration').value;
            const tourMaxGroupSize = document.getElementById('tourMaxGroupSize').value;
            const tourCategory = document.getElementById('tourCategory').value;

            const errors = [];
            if (!tourName || tourName.length < 3) {
                errors.push('‚Ä¢ Tur nomi kamida 3 ta belgidan iborat bo\'lishi kerak');
            }
            if (!tourDescription || tourDescription.length < 10) {
                errors.push('‚Ä¢ Tur tavsifi kamida 10 ta belgidan iborat bo\'lishi kerak');
            }
            if (!tourLocation) {
                errors.push('‚Ä¢ Manzilni kiriting');
            }
            if (!tourPrice || parseFloat(tourPrice) <= 0) {
                errors.push('‚Ä¢ Narxni to\'g\'ri kiriting');
            }
            if (!tourDuration || parseInt(tourDuration) <= 0) {
                errors.push('‚Ä¢ Davomiyligini to\'g\'ri kiriting');
            }
            if (!tourMaxGroupSize || parseInt(tourMaxGroupSize) <= 0) {
                errors.push('‚Ä¢ Maksimal guruh hajmini to\'g\'ri kiriting');
            }
            if (!tourCategory) {
                errors.push('‚Ä¢ Kategoriyani tanlang');
            }

            if (errors.length > 0) {
                alert('‚ùå Quyidagi xatolarni tuzating:\n\n' + errors.join('\n'));
                return;
            }

            // Helper function to convert textarea lines to array
            const textareaToArray = (value) => {
                if (!value || value.trim() === '') return [];
                return value.split('\n').map(item => item.trim()).filter(item => item !== '');
            };

            // Helper function to convert comma-separated string to array
            const commaSeparatedToArray = (value) => {
                if (!value || value.trim() === '') return [];
                return value.split(',').map(item => item.trim()).filter(item => item !== '');
            };

            // Helper function to parse JSON or return empty array/object
            const parseJSONField = (value) => {
                if (!value || value.trim() === '') return undefined;
                try {
                    return JSON.parse(value);
                } catch (e) {
                    return undefined;
                }
            };

            const tourData = {
                name: tourName,
                summary: document.getElementById('tourSummary').value || undefined,
                description: document.getElementById('tourDescription').value,
                price: parseFloat(document.getElementById('tourPrice').value),
                discountPrice: document.getElementById('tourDiscountPrice').value ? parseFloat(document.getElementById('tourDiscountPrice').value) : undefined,
                duration: parseInt(document.getElementById('tourDuration').value),
                nights: document.getElementById('tourNights').value ? parseInt(document.getElementById('tourNights').value) : undefined,
                destinationsCount: document.getElementById('tourDestinationsCount').value ? parseInt(document.getElementById('tourDestinationsCount').value) : undefined,
                groupSizeMin: document.getElementById('tourGroupSizeMin').value ? parseInt(document.getElementById('tourGroupSizeMin').value) : undefined,
                maxGroupSize: parseInt(document.getElementById('tourMaxGroupSize').value),
                location: document.getElementById('tourLocation').value,
                category: document.getElementById('tourCategory').value,
                difficulty: document.getElementById('tourDifficulty').value,
                accommodation: document.getElementById('tourAccommodation').value || undefined,
                meals: document.getElementById('tourMeals').value || undefined,
                transportation: Array.from(document.querySelectorAll('.transport-checkbox:checked')).map(cb => cb.value).join(', ') || undefined,
                languages: Array.from(document.querySelectorAll('.language-checkbox:checked')).map(cb => cb.value),
                ageRange: (document.getElementById('tourAgeMin').value || document.getElementById('tourAgeMax').value) ? {
                    min: parseInt(document.getElementById('tourAgeMin').value) || 0,
                    max: parseInt(document.getElementById('tourAgeMax').value) || 99
                } : undefined,
                season: document.getElementById('tourSeason').value || undefined,
                animal: document.getElementById('tourAnimal').value || undefined,
                image: document.getElementById('tourImage').value || undefined,
                imageCover: document.getElementById('tourImage').value || undefined,
                images: parseJSONField(document.getElementById('tourImages').value) || [],
                includes: textareaToArray(document.getElementById('tourIncludes').value),
                excludes: textareaToArray(document.getElementById('tourExcludes').value),
                itinerary: getItineraryData(),
                highlights: textareaToArray(document.getElementById('tourHighlights').value),
                locations: parseJSONField(document.getElementById('tourLocations').value),
                freeCancellation: document.getElementById('tourFreeCancellation').value || undefined,
                healthSafety: document.getElementById('tourHealthSafety').value || undefined,
                faq: parseJSONField(document.getElementById('tourFAQ').value),
                tags: commaSeparatedToArray(document.getElementById('tourTags').value),
                rating: parseFloat(document.getElementById('tourRating').value) || 4.5,
                hotSale: document.getElementById('tourHotSale').checked,
                isFeatured: document.getElementById('tourFeatured').checked,
                isActive: document.getElementById('tourActive').checked
            };

            try {
                const url = currentEditId
                    ? `${API_URL}/tours/${currentEditId}`
                    : `${API_URL}/tours`;

                const method = currentEditId ? 'PUT' : 'POST';

                console.log('Saving tour:', tourData);

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(tourData)
                });

                const data = await response.json();

                console.log('Response:', data);

                if (data.success) {
                    alert(currentEditId ? 'Tour updated successfully!' : 'New tour added successfully!');
                    closeModal();
                    loadTours();
                    loadDashboardStats();
                } else {
                    alert('Error: ' + (data.message || 'Failed to save tour'));
                }
            } catch (error) {
                console.error('Error saving tour:', error);
                alert('Error occurred: ' + error.message);
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = '/gofly/travel-agency-03.html';
            }
        }

        // Multiple images upload functionality
        // Format: [{url: '/uploads/...', name: 'Location Name'}, ...]
        let uploadedImages = [];
        let coverImageIndex = 0;

        // Attach event listener using event delegation on document
        function setupImageUpload() {
            const tourImageFile = document.getElementById('tourImageFile');
            const dropZone = document.getElementById('dropZone');

            if (!tourImageFile || !dropZone) {
                return;
            }

            // Remove any existing listeners by cloning the element
            const newFileInput = tourImageFile.cloneNode(true);
            tourImageFile.parentNode.replaceChild(newFileInput, tourImageFile);

            // Drag & Drop Event Handlers
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            // Highlight drop zone when item is dragged over it
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, function() {
                    dropZone.classList.add('drag-over');
                }, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, function() {
                    dropZone.classList.remove('drag-over');
                }, false);
            });

            // Handle dropped files
            dropZone.addEventListener('drop', function(e) {
                const dt = e.dataTransfer;
                const files = Array.from(dt.files);
                handleFiles(files);
            }, false);

            // Attach the event listener to the new element
            newFileInput.addEventListener('change', async function(e) {
                const files = Array.from(e.target.files);
                handleFiles(files);
                e.target.value = ''; // Clear file input
            });

            // Extract file handling logic into reusable function
            async function handleFiles(files) {
                if (files.length === 0) {
                    return;
                }

                const gallery = document.getElementById('imageGallery');

                for (let i = 0; i < files.length; i++) {
                    const file = files[i];

                    // Validate file type
                    if (!file.type.startsWith('image/')) {
                        alert(`${file.name} rasm fayli emas!`);
                        continue;
                    }

                    // Validate file size (5MB max)
                    if (file.size > 5 * 1024 * 1024) {
                        alert(`${file.name} juda katta (Max: 5MB)`);
                        continue;
                    }

                    // Create preview card
                    const card = document.createElement('div');
                    card.className = 'image-card';
                    card.draggable = true;

                    // Show loading
                    card.innerHTML = `
                        <div style="aspect-ratio: 4/3; background: #f8f9fa; display: flex; align-items: center; justify-content: center;">
                            <span style="color: #6c757d;">Yuklanmoqda...</span>
                        </div>
                    `;

                    gallery.appendChild(card);

                    // Upload file
                    try {
                        const formData = new FormData();
                        formData.append('image', file);

                        const response = await fetch(`${API_URL}/upload`, {
                            method: 'POST',
                            body: formData
                        });

                        const data = await response.json();

                        console.log('Upload response:', data);

                        if (data.success) {
                            const imagePath = data.data.filePath;
                            console.log('Image path:', imagePath);

                            // Store as object with url, name, and location
                            uploadedImages.push({ url: imagePath, name: '', location: '' });
                            const imageIndex = uploadedImages.length - 1;

                            // Fix: Remove /api from URL for uploads
                            const imageUrl = `http://localhost:5000${imagePath}`;
                            console.log('Final image URL:', imageUrl);

                            // Update preview card with location name and address inputs
                            card.innerHTML = `
                                <div class="drag-handle">‚ãÆ‚ãÆ Tortib oching</div>
                                <div style="position: relative;">
                                    <img src="${imageUrl}" class="card-image" style="width: 100%; height: 100%; object-fit: cover; aspect-ratio: 4/3; cursor: pointer;" onerror="console.error('Failed to load image:', this.src); this.style.background='#f8d7da'; this.alt='Failed to load'" onclick="openImagePreview('${imageUrl}', event)">
                                    <div style="position: absolute; top: 8px; right: 8px; background: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.2); z-index: 20;" onclick="removeImage(${imageIndex}, this.parentElement.parentElement)">
                                        <span style="color: #dc3545; font-size: 18px; font-weight: bold;">√ó</span>
                                    </div>
                                    <div class="cover-badge" style="position: absolute; top: 8px; left: 8px; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; display: ${imageIndex === coverImageIndex ? 'block' : 'none'};">
                                        COVER
                                    </div>
                                </div>
                                <div style="padding: 8px;">
                                    <input type="text" placeholder="Location name..." style="width: 100%; padding: 8px; border: 1px solid #e0e0e0; border-radius: 6px; margin-bottom: 6px; font-size: 12px;" onchange="updateImageName(${imageIndex}, this.value)" value="">
                                    <input type="text" placeholder="Address (e.g., Samarkand, Uzbekistan)..." style="width: 100%; padding: 8px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 12px;" onchange="updateImageLocation(${imageIndex}, this.value)" value="">
                                </div>
                            `;

                            card.onclick = function(e) {
                                // Don't trigger setCoverImage if clicking on input
                                if (e.target.tagName !== 'INPUT') {
                                    setCoverImage(imageIndex);
                                }
                            };

                            card.dataset.imageIndex = imageIndex;

                            // Set as cover if it's the first image
                            if (imageIndex === 0) {
                                setCoverImage(0);
                            }

                            // Update hidden inputs
                            updateHiddenInputs();
                        } else {
                            card.remove();
                            alert('Rasmni yuklashda xatolik: ' + data.message);
                        }
                    } catch (error) {
                        console.error('Error uploading image:', error);
                        card.remove();
                        alert('Rasmni yuklashda xatolik: ' + error.message);
                    }
                }
            }
        }

        // Call setup on page load
        window.addEventListener('DOMContentLoaded', setupImageUpload);

        // Real-time Validation Functions
        function validateField(field) {
            const value = field.value.trim();
            const fieldId = field.id;
            const groupId = fieldId + 'Group';
            const errorId = fieldId + 'Error';
            const group = document.getElementById(groupId);
            const errorMsg = document.getElementById(errorId);

            if (!group || !errorMsg) return true;

            let isValid = true;
            let message = '';

            // Required field validation
            if (field.dataset.required === 'true') {
                if (value === '') {
                    isValid = false;
                    message = 'Bu maydon to\'ldirilishi shart';
                }
            }

            // Min length validation
            if (isValid && field.dataset.minLength && value !== '') {
                const minLength = parseInt(field.dataset.minLength);
                if (value.length < minLength) {
                    isValid = false;
                    message = `Kamida ${minLength} ta belgi kiriting`;
                }
            }

            // Min value validation for numbers
            if (isValid && field.dataset.min && value !== '') {
                const min = parseFloat(field.dataset.min);
                const numValue = parseFloat(value);
                if (numValue < min) {
                    isValid = false;
                    message = `Qiymat ${min} dan kam bo'lmasligi kerak`;
                }
            }

            // Compare less than validation (for discount price)
            if (isValid && field.dataset.compareLess && value !== '') {
                const compareField = document.getElementById(field.dataset.compareLess);
                if (compareField && compareField.value !== '') {
                    const compareValue = parseFloat(compareField.value);
                    const currentValue = parseFloat(value);
                    if (currentValue >= compareValue) {
                        isValid = false;
                        message = 'Chegirma narxi asosiy narxdan kam bo\'lishi kerak';
                    }
                }
            }

            // Compare greater than validation (for max group size)
            if (isValid && field.dataset.compareGreater && value !== '') {
                const compareField = document.getElementById(field.dataset.compareGreater);
                if (compareField && compareField.value !== '') {
                    const compareValue = parseFloat(compareField.value);
                    const currentValue = parseFloat(value);
                    if (currentValue <= compareValue) {
                        isValid = false;
                        message = 'Maksimal o\'lcham minimal o\'lchamdan katta bo\'lishi kerak';
                    }
                }
            }

            // Update UI
            if (value === '' && field.dataset.required !== 'true') {
                // Empty optional field - remove validation state
                group.classList.remove('valid', 'invalid');
                field.classList.remove('valid', 'invalid');
                errorMsg.textContent = '';
                errorMsg.classList.remove('error', 'success');
            } else if (isValid) {
                group.classList.remove('invalid');
                group.classList.add('valid');
                field.classList.remove('invalid');
                field.classList.add('valid');
                errorMsg.textContent = '';
                errorMsg.classList.remove('error');
            } else {
                group.classList.remove('valid');
                group.classList.add('invalid');
                field.classList.remove('valid');
                field.classList.add('invalid');
                errorMsg.textContent = message;
                errorMsg.classList.add('error');
                errorMsg.classList.remove('success');
            }

            return isValid;
        }

        // Setup validation for all fields
        function setupRealTimeValidation() {
            const fieldsToValidate = [
                'tourName',
                'tourDescription',
                'tourPrice',
                'tourDiscountPrice',
                'tourDuration',
                'tourLocation',
                'tourCategory',
                'tourGroupSizeMin',
                'tourMaxGroupSize'
            ];

            fieldsToValidate.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    // Validate on input (as user types)
                    field.addEventListener('input', function() {
                        validateField(this);

                        // Re-validate related fields
                        if (fieldId === 'tourPrice') {
                            const discountField = document.getElementById('tourDiscountPrice');
                            if (discountField && discountField.value !== '') {
                                validateField(discountField);
                            }
                        }
                        if (fieldId === 'tourGroupSizeMin') {
                            const maxField = document.getElementById('tourMaxGroupSize');
                            if (maxField && maxField.value !== '') {
                                validateField(maxField);
                            }
                        }
                    });

                    // Validate on blur (when user leaves field)
                    field.addEventListener('blur', function() {
                        validateField(this);
                    });
                }
            });
        }

        // Call validation setup on page load
        window.addEventListener('DOMContentLoaded', setupRealTimeValidation);

        // Image Preview Functions
        function openImagePreview(imageUrl, event) {
            event.stopPropagation();
            const modal = document.getElementById('imagePreviewModal');
            const img = document.getElementById('imagePreviewImg');
            img.src = imageUrl;
            modal.classList.add('active');
        }

        function closeImagePreview() {
            const modal = document.getElementById('imagePreviewModal');
            modal.classList.remove('active');
        }

        // Close modal on background click
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('imagePreviewModal');
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeImagePreview();
                }
            });
        });

        // Image Reordering with Drag & Drop
        let draggedCard = null;

        function setupImageReordering() {
            const gallery = document.getElementById('imageGallery');

            gallery.addEventListener('dragstart', function(e) {
                if (e.target.classList.contains('image-card')) {
                    draggedCard = e.target;
                    e.target.classList.add('dragging');
                }
            });

            gallery.addEventListener('dragend', function(e) {
                if (e.target.classList.contains('image-card')) {
                    e.target.classList.remove('dragging');
                    draggedCard = null;
                }
            });

            gallery.addEventListener('dragover', function(e) {
                e.preventDefault();
                const afterElement = getDragAfterElement(gallery, e.clientX, e.clientY);
                if (afterElement == null) {
                    gallery.appendChild(draggedCard);
                } else {
                    gallery.insertBefore(draggedCard, afterElement);
                }
            });

            gallery.addEventListener('drop', function(e) {
                e.preventDefault();
                // Reorder uploadedImages array based on new card order
                reorderImagesArray();
            });

            // Add dragover effect to cards
            gallery.addEventListener('dragenter', function(e) {
                if (e.target.classList.contains('image-card') && e.target !== draggedCard) {
                    e.target.classList.add('drag-over');
                }
            });

            gallery.addEventListener('dragleave', function(e) {
                if (e.target.classList.contains('image-card')) {
                    e.target.classList.remove('drag-over');
                }
            });
        }

        function getDragAfterElement(container, x, y) {
            const draggableElements = [...container.querySelectorAll('.image-card:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offsetX = x - box.left - box.width / 2;
                const offsetY = y - box.top - box.height / 2;
                const offset = Math.sqrt(offsetX * offsetX + offsetY * offsetY);

                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function reorderImagesArray() {
            const gallery = document.getElementById('imageGallery');
            const cards = gallery.querySelectorAll('.image-card');
            const newOrder = [];

            cards.forEach(card => {
                const index = parseInt(card.dataset.imageIndex);
                if (uploadedImages[index]) {
                    newOrder.push(uploadedImages[index]);
                }
            });

            // Update uploadedImages with new order
            uploadedImages = newOrder;

            // Update dataset indices
            cards.forEach((card, newIndex) => {
                card.dataset.imageIndex = newIndex;
            });

            // Update cover image index if needed
            if (coverImageIndex >= uploadedImages.length) {
                coverImageIndex = 0;
            }

            updateHiddenInputs();
            console.log('Images reordered:', uploadedImages);
        }

        // Call setup on page load
        window.addEventListener('DOMContentLoaded', setupImageReordering);

        function setCoverImage(index) {
            coverImageIndex = index;

            // Update all cards
            const cards = document.querySelectorAll('#imageGallery > div');
            cards.forEach((card, i) => {
                const badge = card.querySelector('.cover-badge');
                const currentIndex = parseInt(card.dataset.imageIndex);

                if (badge) {
                    badge.style.display = currentIndex === index ? 'block' : 'none';
                }

                // Update border
                card.style.borderColor = currentIndex === index ? '#6366f1' : '#e0e0e0';
                card.style.borderWidth = currentIndex === index ? '3px' : '3px';
            });

            updateHiddenInputs();
        }

        function removeImage(index, cardElement) {
            event.stopPropagation();

            if (confirm('Bu rasmni o\'chirmoqchimisiz?')) {
                uploadedImages[index] = null;
                cardElement.remove();

                // If removed image was cover, set first available as cover
                if (index === coverImageIndex) {
                    for (let i = 0; i < uploadedImages.length; i++) {
                        if (uploadedImages[i] !== null) {
                            setCoverImage(i);
                            break;
                        }
                    }
                }

                updateHiddenInputs();
            }
        }

        function updateHiddenInputs() {
            const validImages = uploadedImages.filter(img => img !== null);

            document.getElementById('tourImages').value = JSON.stringify(validImages);

            // Get cover image directly from uploadedImages using coverImageIndex
            const coverImageData = uploadedImages[coverImageIndex];
            if (coverImageData && coverImageData !== null) {
                document.getElementById('tourImage').value = coverImageData.url;
            } else if (validImages.length > 0) {
                // Fallback: use first valid image as cover
                document.getElementById('tourImage').value = validImages[0].url;
                // Update coverImageIndex to first valid image's index
                coverImageIndex = uploadedImages.findIndex(img => img !== null);
            } else {
                document.getElementById('tourImage').value = '';
            }
        }

        function updateImageName(index, name) {
            if (uploadedImages[index]) {
                uploadedImages[index].name = name;
                updateHiddenInputs();
            }
        }

        function updateImageLocation(index, location) {
            if (uploadedImages[index]) {
                uploadedImages[index].location = location;
                updateHiddenInputs();
            }
        }

        // Close modal and reset form
        function closeModal() {
            document.getElementById('tourModal').classList.remove('active');
            document.getElementById('tourForm').reset();
            document.getElementById('itineraryDays').innerHTML = '';
            document.getElementById('imageGallery').innerHTML = '';
            document.getElementById('modalTitle').textContent = 'Add New Tour';
            currentEditId = null;

            // Reset images
            uploadedImages = [];
            coverImageIndex = 0;
        }

        // Open modal for new tour
        let currentStep = 1;
        const totalSteps = 4;

        function openModal() {
            document.getElementById('tourForm').reset();
            document.getElementById('imageGallery').innerHTML = '';
            document.getElementById('modalTitle').textContent = 'Add New Tour';
            document.getElementById('tourActive').checked = true;
            document.getElementById('tourHotSale').checked = false;
            document.getElementById('tourFeatured').checked = false;

            // Reset images
            uploadedImages = [];
            coverImageIndex = 0;

            // Re-setup image upload
            setTimeout(setupImageUpload, 100);

            // Reset checkboxes
            document.querySelectorAll('.transport-checkbox').forEach(cb => cb.checked = false);
            document.querySelectorAll('.language-checkbox').forEach(cb => cb.checked = false);

            currentEditId = null;
            currentStep = 1;
            document.getElementById('itineraryDays').innerHTML = ''; // Clear itinerary days
            updateStepIndicator();
            document.getElementById('tourModal').classList.add('active');
        }

        function updateStepIndicator() {
            // Update step indicators
            document.querySelectorAll('.step').forEach((step, index) => {
                const stepNum = index + 1;
                if (stepNum < currentStep) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (stepNum === currentStep) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });

            // Update form steps
            document.querySelectorAll('.form-step').forEach((step, index) => {
                if (index + 1 === currentStep) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });

            // Update buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const saveBtn = document.getElementById('saveBtn');

            if (currentStep === 1) {
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'inline-block';
                saveBtn.style.display = 'none';
            } else if (currentStep === totalSteps) {
                prevBtn.style.display = 'inline-block';
                nextBtn.style.display = 'none';
                saveBtn.style.display = 'inline-block';
            } else {
                prevBtn.style.display = 'inline-block';
                nextBtn.style.display = 'inline-block';
                saveBtn.style.display = 'none';
            }
        }

        function nextStep() {
            if (currentStep < totalSteps) {
                currentStep++;
                updateStepIndicator();
                // Scroll to top of modal
                document.querySelector('.modal-body').scrollTop = 0;
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepIndicator();
                // Scroll to top of modal
                document.querySelector('.modal-body').scrollTop = 0;
            }
        }

        // AI Assistant Functions
        function openTourAIAssistant() {
            // Pre-fill AI modal with data from main form if available
            const tourName = document.getElementById('tourName').value;
            const tourLocation = document.getElementById('tourLocation').value;
            const tourPrice = document.getElementById('tourPrice').value;
            const tourDuration = document.getElementById('tourDuration').value;
            const tourCategory = document.getElementById('tourCategory').value;
            const tourMaxGroupSize = document.getElementById('tourMaxGroupSize').value;
            const tourDifficulty = document.getElementById('tourDifficulty').value;

            // Fill AI modal fields if main form has data
            if (tourLocation) document.getElementById('aiDestination').value = tourLocation;
            if (tourPrice) document.getElementById('aiPrice').value = tourPrice;
            if (tourDuration) document.getElementById('aiDuration').value = tourDuration;
            if (tourCategory) document.getElementById('aiCategory').value = tourCategory;
            if (tourMaxGroupSize) document.getElementById('aiMaxGroupSize').value = tourMaxGroupSize;
            if (tourDifficulty) document.getElementById('aiDifficulty').value = tourDifficulty;

            // Set additional prompt from tour name
            if (tourName) {
                document.getElementById('aiPrompt').value = `Create a tour called "${tourName}"`;
            }

            document.getElementById('aiModal').classList.add('active');
        }

        function closeAIModal() {
            document.getElementById('aiModal').classList.remove('active');
            document.getElementById('aiCategory').value = '';
            document.getElementById('aiDuration').value = '';
            document.getElementById('aiNights').value = '';
            document.getElementById('aiDestination').value = '';
            document.getElementById('aiPrice').value = '';
            document.getElementById('aiMaxGroupSize').value = '';
            document.getElementById('aiDifficulty').value = 'moderate';
            document.getElementById('aiAccommodation').value = '';
            document.getElementById('aiPrompt').value = '';
        }

        function generateTourWithAI() {
            // Validate required fields
            const category = document.getElementById('aiCategory').value;
            const durationValue = document.getElementById('aiDuration').value;
            const destination = document.getElementById('aiDestination').value.trim();
            const priceValue = document.getElementById('aiPrice').value;
            const maxGroupSizeValue = document.getElementById('aiMaxGroupSize').value;

            // Check which fields are missing
            const errors = [];
            if (!category) errors.push('Tur turi (Tour Type)');
            if (!durationValue || isNaN(parseInt(durationValue))) errors.push('Davomiyligi (Duration)');
            if (!destination) errors.push('Manzil (Destination)');
            if (!priceValue || isNaN(parseInt(priceValue))) errors.push('Narxi (Price)');
            if (!maxGroupSizeValue || isNaN(parseInt(maxGroupSizeValue))) errors.push('Maksimal guruh hajmi (Max Group Size)');

            if (errors.length > 0) {
                alert('‚ùå Iltimos, quyidagi majburiy maydonlarni to\'ldiring:\n\n' + errors.map(e => '‚Ä¢ ' + e).join('\n') + '\n\nBu maydonlar AI tur yaratish uchun zarur!');
                return;
            }

            const duration = parseInt(durationValue);
            const price = parseInt(priceValue);
            const maxGroupSize = parseInt(maxGroupSizeValue);

            // Get optional fields
            const nights = parseInt(document.getElementById('aiNights').value) || Math.max(duration - 1, 0);
            const difficulty = document.getElementById('aiDifficulty').value;
            const accommodation = document.getElementById('aiAccommodation').value;
            const additionalDesc = document.getElementById('aiPrompt').value.trim();

            // Generate tour name
            const categoryNames = {
                'cultural': 'Cultural Tour',
                'adventure': 'Adventure Tour',
                'hiking': 'Hiking Tour',
                'day-trip': 'Day Trip'
            };
            const tourName = `${duration}-Day ${categoryNames[category]} to ${destination}`;

            // Generate summary
            const summary = `Discover ${destination} with our ${duration}-day ${categoryNames[category].toLowerCase()}. Experience the best attractions and authentic local culture.`;

            // Generate description
            let description = `Join us for an unforgettable ${duration}-day journey through ${destination}. `;
            if (category === 'cultural') {
                description += 'Explore historical monuments, ancient architecture, and rich cultural heritage. Visit iconic landmarks and learn about the fascinating history of the region.';
            } else if (category === 'adventure') {
                description += 'Experience thrilling adventures, outdoor activities, and breathtaking natural landscapes. Perfect for adventure seekers and nature lovers.';
            } else if (category === 'hiking') {
                description += 'Embark on scenic hiking trails, discover pristine nature, and connect with local communities. A perfect blend of outdoor activity and cultural immersion.';
            } else if (category === 'day-trip') {
                description += 'Make the most of your day with our carefully curated itinerary covering the must-see attractions and hidden gems.';
            }
            if (additionalDesc) {
                description += ' ' + additionalDesc;
            }

            // Determine meals based on accommodation
            let meals = 'Breakfast Only';
            if (accommodation && accommodation.includes('5 Star')) {
                meals = 'All Meals';
            } else if (accommodation && (accommodation.includes('4 Star') || accommodation.includes('3 Star'))) {
                meals = 'Breakfast & Dinner';
            }

            // Fill the main form
            console.log('Filling form with AI data:', { tourName, destination, category, difficulty });

            document.getElementById('tourName').value = tourName;
            document.getElementById('tourSummary').value = summary;
            document.getElementById('tourDescription').value = description;
            document.getElementById('tourPrice').value = price;
            document.getElementById('tourDuration').value = duration;
            document.getElementById('tourNights').value = nights;
            document.getElementById('tourMaxGroupSize').value = maxGroupSize;
            document.getElementById('tourLocation').value = destination;
            document.getElementById('tourCategory').value = category;
            document.getElementById('tourDifficulty').value = difficulty;
            document.getElementById('tourAccommodation').value = accommodation || '';
            document.getElementById('tourMeals').value = meals;

            console.log('Form filled. Verification:', {
                name: document.getElementById('tourName').value,
                location: document.getElementById('tourLocation').value,
                category: document.getElementById('tourCategory').value,
                difficulty: document.getElementById('tourDifficulty').value
            });

            // Set default languages - English
            document.querySelectorAll('.language-checkbox').forEach(cb => cb.checked = false);
            const englishCheckbox = Array.from(document.querySelectorAll('.language-checkbox')).find(cb => cb.value === 'English');
            if (englishCheckbox) englishCheckbox.checked = true;

            // Set default transport based on tour type
            document.querySelectorAll('.transport-checkbox').forEach(cb => cb.checked = false);
            if (category === 'cultural' || category === 'adventure') {
                const carCheckbox = Array.from(document.querySelectorAll('.transport-checkbox')).find(cb => cb.value === 'Car');
                if (carCheckbox) carCheckbox.checked = true;
            } else if (category === 'day-trip') {
                const busCheckbox = Array.from(document.querySelectorAll('.transport-checkbox')).find(cb => cb.value === 'Bus');
                if (busCheckbox) busCheckbox.checked = true;
            }

            // Generate itinerary days
            document.getElementById('itineraryDays').innerHTML = '';
            for (let i = 1; i <= duration; i++) {
                addItineraryDay();
                const cards = document.querySelectorAll('.itinerary-day-card');
                const currentCard = cards[cards.length - 1];

                let dayTitle, dayDescription, dayActivities;

                if (i === 1) {
                    dayTitle = `Day ${i} - Arrival & City Orientation`;
                    dayDescription = `Arrive in ${destination}. Transfer to hotel and check-in. Evening orientation walk and welcome dinner.`;
                    dayActivities = 'Airport Transfer, Hotel Check-in, City Walk, Welcome Dinner';
                } else if (i === duration) {
                    dayTitle = `Day ${i} - Departure`;
                    dayDescription = `Final breakfast and hotel check-out. Transfer to airport for departure. End of tour.`;
                    dayActivities = 'Breakfast, Check-out, Airport Transfer';
                } else {
                    dayTitle = `Day ${i} - ${destination} Exploration`;
                    if (category === 'cultural') {
                        dayDescription = `Full day exploring historical sites, monuments, and cultural landmarks. Visit local markets and experience traditional cuisine.`;
                        dayActivities = 'Sightseeing, Historical Sites, Local Market, Cultural Activities';
                    } else if (category === 'adventure') {
                        dayDescription = `Adventure activities including outdoor sports, nature exploration, and scenic viewpoints.`;
                        dayActivities = 'Outdoor Activities, Nature Exploration, Adventure Sports';
                    } else if (category === 'hiking') {
                        dayDescription = `Hiking through scenic trails, visiting local villages, and enjoying natural landscapes.`;
                        dayActivities = 'Hiking, Nature Walk, Village Visit, Photography';
                    } else {
                        dayDescription = `Explore the main attractions and experience local culture and cuisine.`;
                        dayActivities = 'Sightseeing, Local Experiences, Free Time';
                    }
                }

                currentCard.querySelector('.day-title').value = dayTitle;
                currentCard.querySelector('.day-description').value = dayDescription;
                currentCard.querySelector('.day-activities').value = dayActivities;
            }

            closeAIModal();
            alert('‚ú® AI generated tour details! Please review and adjust as needed.');
        }

        // Itinerary management
        let itineraryDayCounter = 0;

        function addItineraryDay() {
            itineraryDayCounter++;
            const dayNumber = document.querySelectorAll('.itinerary-day-card').length + 1;

            const dayCard = document.createElement('div');
            dayCard.className = 'itinerary-day-card';
            dayCard.dataset.dayIndex = itineraryDayCounter;

            dayCard.innerHTML = `
                <div class="day-header">
                    <div class="day-number">üìÖ Day ${dayNumber}</div>
                    <button type="button" class="remove-day-btn" onclick="removeItineraryDay(${itineraryDayCounter})">üóëÔ∏è Remove</button>
                </div>

                <div class="form-group">
                    <label>Title *</label>
                    <input type="text" class="day-title" placeholder="E.g.: Eiffel Tower ‚Äì The symbol of France" required>
                </div>

                <div class="form-group">
                    <label>Description *</label>
                    <textarea class="day-description" rows="3" placeholder="Describe the day's activities and experiences..." required></textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Activities (comma separated)</label>
                        <input type="text" class="day-activities" placeholder="Climb tower, Sunset view, Bike tour">
                    </div>
                    <div class="form-group">
                        <label>Meals</label>
                        <input type="text" class="day-meals" placeholder="Breakfast, Lunch, Snacks">
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Accommodation</label>
                        <input type="text" class="day-accommodation" placeholder="Hotel Name">
                    </div>
                    <div class="form-group">
                        <label>Transport (comma separated)</label>
                        <input type="text" class="day-transport" placeholder="Car, Flight, Boat">
                    </div>
                </div>
            `;

            document.getElementById('itineraryDays').appendChild(dayCard);
        }

        function removeItineraryDay(index) {
            const dayCard = document.querySelector(`[data-day-index="${index}"]`);
            if (dayCard) {
                dayCard.remove();
                updateDayNumbers();
            }
        }

        function updateDayNumbers() {
            const dayCards = document.querySelectorAll('.itinerary-day-card');
            dayCards.forEach((card, index) => {
                card.querySelector('.day-number').textContent = `üìÖ Day ${index + 1}`;
            });
        }

        function getItineraryData() {
            const dayCards = document.querySelectorAll('.itinerary-day-card');
            const itinerary = [];

            dayCards.forEach((card, index) => {
                const title = card.querySelector('.day-title').value;
                const description = card.querySelector('.day-description').value;
                const activities = card.querySelector('.day-activities').value;
                const meals = card.querySelector('.day-meals').value;
                const accommodation = card.querySelector('.day-accommodation').value;
                const transport = card.querySelector('.day-transport').value;

                if (title && description) {
                    itinerary.push({
                        day: index + 1,
                        title: title,
                        description: description,
                        activities: activities ? activities.split(',').map(a => a.trim()) : [],
                        meals: meals || undefined,
                        accommodation: accommodation || undefined,
                        transport: transport ? transport.split(',').map(t => t.trim()) : []
                    });
                }
            });

            return itinerary.length > 0 ? itinerary : undefined;
        }

        function loadItineraryData(itineraryData) {
            document.getElementById('itineraryDays').innerHTML = '';

            if (!itineraryData || !Array.isArray(itineraryData)) return;

            itineraryData.forEach((day) => {
                itineraryDayCounter++;
                const dayCard = document.createElement('div');
                dayCard.className = 'itinerary-day-card';
                dayCard.dataset.dayIndex = itineraryDayCounter;

                dayCard.innerHTML = `
                    <div class="day-header">
                        <div class="day-number">üìÖ Day ${day.day}</div>
                        <button type="button" class="remove-day-btn" onclick="removeItineraryDay(${itineraryDayCounter})">üóëÔ∏è Remove</button>
                    </div>

                    <div class="form-group">
                        <label>Title *</label>
                        <input type="text" class="day-title" value="${day.title || ''}" placeholder="E.g.: Eiffel Tower ‚Äì The symbol of France" required>
                    </div>

                    <div class="form-group">
                        <label>Description *</label>
                        <textarea class="day-description" rows="3" placeholder="Describe the day's activities..." required>${day.description || ''}</textarea>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>Activities (comma separated)</label>
                            <input type="text" class="day-activities" value="${day.activities ? day.activities.join(', ') : ''}" placeholder="Climb tower, Sunset view">
                        </div>
                        <div class="form-group">
                            <label>Meals</label>
                            <input type="text" class="day-meals" value="${day.meals || ''}" placeholder="Breakfast, Lunch, Snacks">
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>Accommodation</label>
                            <input type="text" class="day-accommodation" value="${day.accommodation || ''}" placeholder="Hotel Name">
                        </div>
                        <div class="form-group">
                            <label>Transport (comma separated)</label>
                            <input type="text" class="day-transport" value="${day.transport ? day.transport.join(', ') : ''}" placeholder="Car, Flight, Boat">
                        </div>
                    </div>
                `;

                document.getElementById('itineraryDays').appendChild(dayCard);
            });
        }

        // ============================================
        // BLOG MANAGEMENT FUNCTIONS
        // ============================================

        let currentBlogId = null;

        function openBlogModal(blogId = null) {
            currentBlogId = blogId;
            const modal = document.getElementById('blogModal');
            const title = document.getElementById('blogModalTitle');

            if (blogId) {
                title.textContent = 'Edit Blog Post';
                loadBlogData(blogId);
            } else {
                title.textContent = 'Add New Blog Post';
                document.getElementById('blogForm').reset();
            }

            modal.style.display = 'flex';

            // Initialize map when modal opens
            setTimeout(() => {
                initializeLocationMap();
            }, 300);
        }

        function closeBlogModal() {
            document.getElementById('blogModal').style.display = 'none';
            currentBlogId = null;
            document.getElementById('blogForm').reset();

            // Clear location fields
            document.getElementById('blogLocation').value = '';
            document.getElementById('blogLatitude').value = '';
            document.getElementById('blogLongitude').value = '';
            document.getElementById('coordinatesDisplay').textContent = '';

            // Clear uploaded image
            removeUploadedImage();

            // Clear image preview
            uploadedImageData = null;
            document.getElementById('imagePreview').src = '';
            document.getElementById('uploadPlaceholder').style.display = 'block';
            document.getElementById('imagePreviewContainer').style.display = 'none';

            // Clear map
            if (blogMap) {
                if (blogMarker) {
                    blogMap.removeLayer(blogMarker);
                    blogMarker = null;
                }
                blogMap.remove();
                blogMap = null;
            }
        }

        async function loadBlogData(blogId) {
            try {
                const response = await fetch(`/api/admin/blogs/${blogId}`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    const blog = result.data || result;

                    // Fill form with blog data
                    document.getElementById('blogTitle').value = blog.title || '';
                    document.getElementById('blogCategory').value = blog.category || '';
                    document.getElementById('blogAuthor').value = blog.author || 'Admin';

                    // Support both image and featuredImage fields
                    const imageUrl = blog.featuredImage || blog.image || '';
                    document.getElementById('blogImage').value = imageUrl;

                    // Show image preview if exists
                    if (imageUrl) {
                        uploadedImageData = imageUrl;
                        document.getElementById('imagePreview').src = imageUrl;
                        document.getElementById('uploadPlaceholder').style.display = 'none';
                        document.getElementById('imagePreviewContainer').style.display = 'block';
                    }

                    document.getElementById('blogExcerpt').value = blog.excerpt || '';
                    document.getElementById('blogContent').value = blog.content || '';
                    document.getElementById('blogTags').value = blog.tags || '';
                    document.getElementById('blogStatus').value = blog.status || 'draft';
                    document.getElementById('blogTitle2').value = blog.title2 || '';

                    // Fill location data if exists
                    if (blog.location) {
                        document.getElementById('blogLocation').value = blog.location.name || '';
                        if (blog.location.coordinates) {
                            document.getElementById('blogLatitude').value = blog.location.coordinates.latitude || '';
                            document.getElementById('blogLongitude').value = blog.location.coordinates.longitude || '';

                            // Show map if coordinates exist
                            if (blog.location.coordinates.latitude && blog.location.coordinates.longitude) {
                                setTimeout(() => {
                                    setMapLocation(blog.location.coordinates.latitude, blog.location.coordinates.longitude);
                                }, 500);
                            }
                        }
                    }
                } else {
                    alert('Error loading blog data');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error loading blog data');
            }
        }

        async function saveBlog() {
            const imageValue = document.getElementById('blogImage').value;

            const formData = {
                title: document.getElementById('blogTitle').value,
                category: document.getElementById('blogCategory').value,
                author: document.getElementById('blogAuthor').value,
                image: imageValue,
                featuredImage: imageValue,  // Add featuredImage field
                excerpt: document.getElementById('blogExcerpt').value,
                content: document.getElementById('blogContent').value,
                tags: document.getElementById('blogTags').value,
                status: document.getElementById('blogStatus').value,
                title2: document.getElementById('blogTitle2').value
            };

            // Add location data if provided
            const location = document.getElementById('blogLocation').value;
            const latitude = document.getElementById('blogLatitude').value;
            const longitude = document.getElementById('blogLongitude').value;

            if (location || (latitude && longitude)) {
                formData.location = {
                    name: location || '',
                    coordinates: {
                        latitude: latitude ? parseFloat(latitude) : null,
                        longitude: longitude ? parseFloat(longitude) : null
                    }
                };
            }

            // Validation
            if (!formData.title || !formData.category || !formData.content) {
                alert('Please fill in all required fields');
                return;
            }

            try {
                const url = currentBlogId
                    ? `/api/admin/blogs/${currentBlogId}`
                    : '/api/admin/blogs';
                const method = currentBlogId ? 'PUT' : 'POST';

                console.log('Saving blog with data:', formData);

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();
                console.log('Server response:', result);

                if (response.ok) {
                    alert(currentBlogId ? 'Blog updated successfully!' : 'Blog created successfully!');
                    closeBlogModal();
                    loadBlogs();
                } else {
                    console.error('Error response:', result);
                    alert('Error saving blog: ' + (result.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error saving blog: ' + error.message);
            }
        }

        async function loadBlogs() {
            try {
                const response = await fetch('/api/admin/blogs', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    }
                });

                if (response.ok) {
                    const blogs = await response.json();
                    displayBlogs(blogs);
                    updateBlogStats(blogs);
                } else {
                    document.getElementById('blogTableBody').innerHTML =
                        '<tr><td colspan="7">Error loading blogs</td></tr>';
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('blogTableBody').innerHTML =
                    '<tr><td colspan="7">Error loading blogs</td></tr>';
            }
        }

        function displayBlogs(blogs) {
            const tbody = document.getElementById('blogTableBody');

            if (blogs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px;">No blog posts yet. Create your first one!</td></tr>';
                return;
            }

            // Default placeholder SVG
            const placeholderSvg = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjZTBlMGUwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI4IiBmaWxsPSIjOTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+Tm8gSW1hZ2U8L3RleHQ+PC9zdmc+';

            tbody.innerHTML = blogs.map(blog => {
                // Support both image and featuredImage fields
                const imageUrl = blog.image || blog.featuredImage || placeholderSvg;

                return `
                <tr>
                    <td>
                        <img src="${imageUrl}"
                             alt="${blog.title}"
                             style="width: 60px; height: 40px; object-fit: cover; border-radius: 4px; background: #e0e0e0;"
                             onerror="this.src='${placeholderSvg}'">
                    </td>
                    <td><strong>${blog.title}</strong></td>
                    <td>${blog.category}</td>
                    <td>${blog.author || 'Admin'}</td>
                    <td>${new Date(blog.createdAt).toLocaleDateString()}</td>
                    <td>
                        <span class="status-badge ${blog.status === 'published' ? 'status-active' : 'status-inactive'}">
                            ${blog.status === 'published' ? 'Published' : 'Draft'}
                        </span>
                    </td>
                    <td>
                        <button onclick="viewBlog('${blog._id}')" class="action-btn" style="background: #17a2b8; color: white;">üëÅÔ∏è View</button>
                        <button onclick="openBlogModal('${blog._id}')" class="action-btn edit-btn">‚úèÔ∏è Edit</button>
                        <button onclick="deleteBlog('${blog._id}')" class="action-btn delete-btn">üóëÔ∏è Delete</button>
                    </td>
                </tr>
                `;
            }).join('');
        }

        function updateBlogStats(blogs) {
            const totalBlogs = blogs.length;
            document.getElementById('totalBlogs').textContent = totalBlogs;
        }

        function viewBlog(blogId) {
            // Open blog detail page in new tab
            window.open(`/gofly/travel-inspiration-details.html?id=${blogId}`, '_blank');
        }

        async function deleteBlog(blogId) {
            if (!confirm('Are you sure you want to delete this blog post?')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/blogs/${blogId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    }
                });

                if (response.ok) {
                    alert('Blog deleted successfully!');
                    loadBlogs();
                } else {
                    alert('Error deleting blog');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error deleting blog');
            }
        }

        // Load blogs when blog page is shown
        const originalShowPage = window.showPage;
        window.showPage = function(page) {
            originalShowPage(page);
            if (page === 'blog') {
                loadBlogs();
            }
        };

        // ========== DESTINATIONS MANAGEMENT ==========

        let currentDestinationId = null;

        function openDestinationModal() {
            currentDestinationId = null;
            document.getElementById('destinationModalTitle').textContent = 'Add New Destination';
            document.getElementById('destinationForm').reset();
            document.getElementById('destinationModal').style.display = 'flex';
        }

        function closeDestinationModal() {
            document.getElementById('destinationModal').style.display = 'none';
            currentDestinationId = null;
        }

        async function loadDestinations() {
            try {
                const response = await fetch('/api/destinations');
                const data = await response.json();

                if (data.success) {
                    displayDestinations(data.data.destinations);
                } else {
                    console.error('Error loading destinations:', data.message);
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('destinationsTableContainer').innerHTML =
                    '<div class="error-message">Error loading destinations</div>';
            }
        }

        function displayDestinations(destinations) {
            const container = document.getElementById('destinationsTableContainer');

            if (!destinations || destinations.length === 0) {
                container.innerHTML = '<div class="no-data">No destinations found. Click "Add New Destination" to create one.</div>';
                return;
            }

            let tableHTML = `
                <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <thead style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                        <tr>
                            <th style="padding: 15px; text-align: left;">Name</th>
                            <th style="padding: 15px; text-align: left;">Country</th>
                            <th style="padding: 15px; text-align: left;">Capital</th>
                            <th style="padding: 15px; text-align: left;">Currency</th>
                            <th style="padding: 15px; text-align: center;">Status</th>
                            <th style="padding: 15px; text-align: center;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            destinations.forEach((dest, index) => {
                tableHTML += `
                    <tr style="border-bottom: 1px solid #e9ecef; ${index % 2 === 0 ? 'background: #f8f9fa;' : ''}">
                        <td style="padding: 15px;">
                            <div style="font-weight: 600; color: #2c3e50;">${dest.name}</div>
                            <div style="font-size: 12px; color: #6c757d; margin-top: 4px;">${dest.tagline}</div>
                        </td>
                        <td style="padding: 15px; color: #495057;">${dest.country}</td>
                        <td style="padding: 15px; color: #495057;">${dest.capital}</td>
                        <td style="padding: 15px; color: #495057;">${dest.currency}</td>
                        <td style="padding: 15px; text-align: center;">
                            <span style="padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 600;
                                         background: ${dest.isActive ? '#d4edda' : '#f8d7da'};
                                         color: ${dest.isActive ? '#155724' : '#721c24'};">
                                ${dest.isActive ? 'Active' : 'Inactive'}
                            </span>
                        </td>
                        <td style="padding: 15px; text-align: center;">
                            <button onclick="editDestination('${dest._id}')"
                                    style="padding: 6px 12px; margin-right: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                                Edit
                            </button>
                            <button onclick="deleteDestination('${dest._id}')"
                                    style="padding: 6px 12px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                                Delete
                            </button>
                        </td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;
        }

        // Form submission
        document.getElementById('destinationForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const destinationData = {
                name: document.getElementById('destName').value,
                tagline: document.getElementById('destTagline').value,
                description: document.getElementById('destDescription').value,
                country: document.getElementById('destCountry').value,
                capital: document.getElementById('destCapital').value,
                currency: document.getElementById('destCurrency').value,
                language: document.getElementById('destLanguage').value,
                popularPlaces: [],
                features: [],
                seasons: [],
                faq: []
            };

            try {
                const url = currentDestinationId
                    ? `/api/destinations/${currentDestinationId}`
                    : '/api/destinations';

                const method = currentDestinationId ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(destinationData)
                });

                const data = await response.json();

                if (data.success) {
                    alert(currentDestinationId ? 'Destination updated successfully!' : 'Destination created successfully!');
                    closeDestinationModal();
                    loadDestinations();
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error saving destination');
            }
        });

        async function editDestination(destId) {
            try {
                const response = await fetch(`/api/destinations/${destId}`);
                const data = await response.json();

                if (data.success) {
                    const dest = data.data.destination;
                    currentDestinationId = destId;

                    document.getElementById('destinationModalTitle').textContent = 'Edit Destination';
                    document.getElementById('destName').value = dest.name;
                    document.getElementById('destTagline').value = dest.tagline;
                    document.getElementById('destDescription').value = dest.description;
                    document.getElementById('destCountry').value = dest.country;
                    document.getElementById('destCapital').value = dest.capital;
                    document.getElementById('destCurrency').value = dest.currency;
                    document.getElementById('destLanguage').value = dest.language;

                    document.getElementById('destinationModal').style.display = 'flex';
                } else {
                    alert('Error loading destination');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error loading destination');
            }
        }

        async function deleteDestination(destId) {
            if (!confirm('Are you sure you want to delete this destination?')) {
                return;
            }

            try {
                const response = await fetch(`/api/destinations/${destId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    alert('Destination deleted successfully!');
                    loadDestinations();
                } else {
                    alert('Error deleting destination');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error deleting destination');
            }
        }

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('destinationModal');
            if (event.target === modal) {
                closeDestinationModal();
            }
        });

    </script>

    <!-- Blog Modal -->
    <div class="modal" id="blogModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <div>
                    <h2 id="blogModalTitle">Add New Blog Post</h2>
                    <p style="font-size: 13px; color: #6c757d; margin-top: 5px;">Fill in all the details below</p>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="close-btn" onclick="closeBlogModal()">&times;</button>
                </div>
            </div>

            <div class="modal-body">
                <form id="blogForm">
                    <!-- Basic Information Section -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                        <h3 style="font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                            üìù Basic Information
                        </h3>

                        <div class="form-group">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #495057; font-size: 14px;">
                                Title <span style="color: #dc3545;">*</span>
                            </label>
                            <input type="text" id="blogTitle" placeholder="Enter blog post title" required
                                   style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px;">
                        </div>

                        <div class="form-group">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #495057; font-size: 14px;">
                                Title 2
                            </label>
                            <input type="text" id="blogTitle2" placeholder="Enter secondary heading (optional)"
                                   style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px;">
                            <small style="color: #6c757d; font-size: 12px; margin-top: 5px; display: block;">
                                This will appear below the main title on the blog detail page
                            </small>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #495057; font-size: 14px;">
                                    Category <span style="color: #dc3545;">*</span>
                                </label>
                                <select id="blogCategory" required
                                        style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px;">
                                    <option value="">Select category</option>
                                    <option value="adventure-tours">Adventure Tours</option>
                                    <option value="beach-holidays">Beach Holidays</option>
                                    <option value="cultural-tours">Cultural Tours</option>
                                    <option value="family-vacations">Family Vacations</option>
                                    <option value="cruises">Cruises</option>
                                    <option value="travel-tips">Travel Tips</option>
                                    <option value="destination-guides">Destination Guides</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #495057; font-size: 14px;">
                                    Author
                                </label>
                                <input type="text" id="blogAuthor" placeholder="Author name" value="Admin"
                                       style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px;">
                            </div>
                        </div>

                        <div class="form-group">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #495057; font-size: 14px;">
                                Excerpt
                            </label>
                            <textarea id="blogExcerpt" rows="3" placeholder="Brief summary of the blog post (1-2 sentences)"
                                      style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px; resize: vertical;"></textarea>
                        </div>
                    </div>

                    <!-- Content Section -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                        <h3 style="font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                            ‚úçÔ∏è Content & Media
                        </h3>

                        <div class="form-group">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #495057; font-size: 14px;">
                                Upload Featured Image
                            </label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <label for="blogImageFile" style="flex: 1; padding: 12px; border: 2px dashed #ced4da; border-radius: 6px; text-align: center; cursor: pointer; background: white; transition: all 0.3s;">
                                    <input type="file" id="blogImageFile" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                                    <div id="uploadPlaceholder" style="display: flex; align-items: center; justify-content: center; gap: 8px; color: #6c757d;">
                                        <span style="font-size: 24px;">üì§</span>
                                        <span>Click to upload or drag image here</span>
                                    </div>
                                    <div id="imagePreviewContainer" style="display: none;">
                                        <img id="imagePreview" style="max-width: 100%; max-height: 200px; border-radius: 6px;">
                                        <div style="margin-top: 8px; font-size: 13px; color: #28a745;" id="imageFileName"></div>
                                    </div>
                                </label>
                                <button type="button" id="removeImageBtn" onclick="removeUploadedImage()" style="display: none; padding: 12px; background: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                    üóëÔ∏è
                                </button>
                            </div>
                            <div style="font-size: 12px; color: #6c757d; margin-top: 5px;">
                                <strong>Supported:</strong> JPG, PNG, GIF, WebP (Max 10MB)
                            </div>
                        </div>

                        <div style="text-align: center; color: #6c757d; font-size: 13px; margin: 15px 0; font-weight: 500;">
                            ‚Äî OR ‚Äî
                        </div>

                        <div class="form-group">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #495057; font-size: 14px;">
                                Featured Image URL
                            </label>
                            <input type="url" id="blogImage" placeholder="https://example.com/image.jpg"
                                   style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px;">
                        </div>

                        <div class="form-group">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #495057; font-size: 14px;">
                                Content <span style="color: #dc3545;">*</span>
                            </label>
                            <textarea id="blogContent" rows="8" placeholder="Write your blog post content here..." required
                                      style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px; resize: vertical;"></textarea>
                        </div>
                    </div>

                    <!-- Publishing Settings -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                            üöÄ Publishing Settings
                        </h3>

                        <div class="form-row">
                            <div class="form-group">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #495057; font-size: 14px;">
                                    Tags (comma separated)
                                </label>
                                <input type="text" id="blogTags" placeholder="uzbekistan, travel, culture"
                                       style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px;">
                            </div>
                            <div class="form-group">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #495057; font-size: 14px;">
                                    Status <span style="color: #dc3545;">*</span>
                                </label>
                                <select id="blogStatus" required
                                        style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px;">
                                    <option value="draft">Draft</option>
                                    <option value="published">Published</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Location & Map -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                            üìç Location (Optional)
                        </h3>

                        <div class="form-group">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #495057; font-size: 14px;">
                                Location Name
                            </label>
                            <input type="text" id="blogLocation" list="countriesList" placeholder="e.g., Samarkand, Uzbekistan"
                                   style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px;">
                            <datalist id="countriesList">
                                <option value="Uzbekistan">
                                <option value="Afghanistan">
                                <option value="Kazakhstan">
                                <option value="Kyrgyzstan">
                                <option value="Tajikistan">
                                <option value="Turkmenistan">
                                <option value="China">
                                <option value="Russia">
                                <option value="Turkey">
                                <option value="UAE - Dubai">
                                <option value="Thailand">
                                <option value="Maldives">
                                <option value="Indonesia - Bali">
                                <option value="Malaysia">
                                <option value="Singapore">
                                <option value="Japan">
                                <option value="South Korea">
                                <option value="India">
                                <option value="Egypt">
                                <option value="Morocco">
                                <option value="France">
                                <option value="Italy">
                                <option value="Spain">
                                <option value="United Kingdom">
                                <option value="Germany">
                                <option value="Switzerland">
                                <option value="Austria">
                                <option value="Greece">
                                <option value="United States">
                                <option value="Canada">
                                <option value="Mexico">
                                <option value="Brazil">
                                <option value="Argentina">
                                <option value="Peru">
                                <option value="Australia">
                                <option value="New Zealand">
                                <option value="Samarkand, Uzbekistan">
                                <option value="Bukhara, Uzbekistan">
                                <option value="Khiva, Uzbekistan">
                                <option value="Tashkent, Uzbekistan">
                                <option value="Paris, France">
                                <option value="Rome, Italy">
                                <option value="Barcelona, Spain">
                                <option value="London, United Kingdom">
                                <option value="Dubai, UAE">
                                <option value="Bangkok, Thailand">
                                <option value="Tokyo, Japan">
                                <option value="New York, USA">
                                <option value="Los Angeles, USA">
                            </datalist>
                        </div>

                        <!-- Hidden inputs for coordinates -->
                        <input type="hidden" id="blogLatitude">
                        <input type="hidden" id="blogLongitude">

                        <div style="margin-top: 15px;">
                            <div style="font-size: 13px; color: #495057; margin-bottom: 10px; font-weight: 500; display: flex; align-items: center; gap: 8px;">
                                <span>üìç</span>
                                <span>Click on the map to select location</span>
                                <span id="coordinatesDisplay" style="margin-left: auto; color: #6c757d; font-size: 12px;"></span>
                            </div>
                            <div id="blogMap" style="width: 100%; height: 400px; border-radius: 12px; border: 2px solid #e0e0e0; box-shadow: 0 4px 12px rgba(0,0,0,0.08);"></div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="modal-footer" style="justify-content: space-between; background: white; position: sticky; bottom: 0; padding: 20px; margin: -25px -30px 0; border-top: 2px solid #e9ecef;">
                        <button type="button" class="cancel-btn" onclick="closeBlogModal()"
                                style="padding: 12px 24px; background: #6c757d; color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer;">
                            Cancel
                        </button>
                        <button type="button" class="submit-btn" onclick="saveBlog()"
                                style="padding: 12px 32px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                            üíæ Save Blog Post
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Destination Modal -->
    <div class="modal" id="destinationModal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <div>
                    <h2 id="destinationModalTitle">Add New Destination</h2>
                    <p style="font-size: 13px; color: #6c757d; margin-top: 5px;">Fill in destination details</p>
                </div>
                <button class="close-btn" onclick="closeDestinationModal()">&times;</button>
            </div>

            <div class="modal-body">
                <form id="destinationForm">
                    <!-- Basic Information -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 15px;">üìç Basic Information</h3>

                        <div class="form-group">
                            <label>Name <span style="color: #dc3545;">*</span></label>
                            <input type="text" id="destName" placeholder="e.g., Samarkand, Uzbekistan" required
                                   style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px;">
                        </div>

                        <div class="form-group">
                            <label>Tagline <span style="color: #dc3545;">*</span></label>
                            <input type="text" id="destTagline" placeholder="e.g., The Heart of the Silk Road" required
                                   style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px;">
                        </div>

                        <div class="form-group">
                            <label>Description <span style="color: #dc3545;">*</span></label>
                            <textarea id="destDescription" rows="4" placeholder="Describe the destination..." required
                                      style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px; resize: vertical;"></textarea>
                        </div>

                        <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label>Country <span style="color: #dc3545;">*</span></label>
                                <input type="text" id="destCountry" placeholder="e.g., Uzbekistan" required
                                       style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px;">
                            </div>
                            <div class="form-group">
                                <label>Capital <span style="color: #dc3545;">*</span></label>
                                <input type="text" id="destCapital" placeholder="e.g., Tashkent" required
                                       style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px;">
                            </div>
                        </div>

                        <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label>Currency <span style="color: #dc3545;">*</span></label>
                                <input type="text" id="destCurrency" placeholder="e.g., UZS (Som)" required
                                       style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px;">
                            </div>
                            <div class="form-group">
                                <label>Language <span style="color: #dc3545;">*</span></label>
                                <input type="text" id="destLanguage" placeholder="e.g., Uzbek, Russian" required
                                       style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px;">
                            </div>
                        </div>
                    </div>

                    <!-- Form Buttons -->
                    <div class="form-row" style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 25px;">
                        <button type="button" onclick="closeDestinationModal()"
                                style="padding: 12px 30px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer;">
                            Cancel
                        </button>
                        <button type="submit"
                                style="padding: 12px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; cursor: pointer;">
                            Save Destination
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- AI Assistant Modal -->
    <div class="modal" id="aiAssistantModal" style="z-index: 2100;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <div>
                    <h2 style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">ü§ñ</span> AI Blog Assistant
                    </h2>
                    <p style="font-size: 13px; color: #6c757d; margin-top: 5px;">Let AI help you create amazing blog content</p>
                </div>
                <button class="close-btn" onclick="closeAIAssistant()">&times;</button>
            </div>

            <div class="modal-body">
                <div style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #667eea30;">
                    <h3 style="font-size: 15px; font-weight: 600; color: #2c3e50; margin-bottom: 15px;">
                        What would you like AI to help you with?
                    </h3>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
                        <button type="button" onclick="selectAITask('title')" class="ai-task-btn"
                                style="padding: 15px; background: white; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; text-align: left; transition: all 0.3s;">
                            <div style="font-size: 20px; margin-bottom: 5px;">‚ú®</div>
                            <div style="font-weight: 600; font-size: 14px; color: #2c3e50;">Generate Title</div>
                            <div style="font-size: 12px; color: #6c757d; margin-top: 3px;">Create catchy blog title</div>
                        </button>

                        <button type="button" onclick="selectAITask('excerpt')" class="ai-task-btn"
                                style="padding: 15px; background: white; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; text-align: left; transition: all 0.3s;">
                            <div style="font-size: 20px; margin-bottom: 5px;">üìù</div>
                            <div style="font-weight: 600; font-size: 14px; color: #2c3e50;">Generate Excerpt</div>
                            <div style="font-size: 12px; color: #6c757d; margin-top: 3px;">Write brief summary</div>
                        </button>

                        <button type="button" onclick="selectAITask('content')" class="ai-task-btn"
                                style="padding: 15px; background: white; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; text-align: left; transition: all 0.3s;">
                            <div style="font-size: 20px; margin-bottom: 5px;">‚úçÔ∏è</div>
                            <div style="font-weight: 600; font-size: 14px; color: #2c3e50;">Write Full Content</div>
                            <div style="font-size: 12px; color: #6c757d; margin-top: 3px;">Create complete article</div>
                        </button>

                        <button type="button" onclick="selectAITask('improve')" class="ai-task-btn"
                                style="padding: 15px; background: white; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; text-align: left; transition: all 0.3s;">
                            <div style="font-size: 20px; margin-bottom: 5px;">üöÄ</div>
                            <div style="font-weight: 600; font-size: 14px; color: #2c3e50;">Improve Content</div>
                            <div style="font-size: 12px; color: #6c757d; margin-top: 3px;">Enhance existing text</div>
                        </button>
                    </div>

                    <div id="aiPromptSection" style="display: none;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #495057; font-size: 14px;">
                            Tell AI what you want:
                        </label>
                        <textarea id="aiPrompt" rows="4" placeholder="e.g., Write about traveling to Samarkand, its history and attractions..."
                                  style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px; resize: vertical;"></textarea>

                        <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" onclick="closeAIAssistant()"
                                    style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer;">
                                Cancel
                            </button>
                            <button type="button" onclick="generateWithAI()" id="generateBtn"
                                    style="padding: 10px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);">
                                ‚ú® Generate
                            </button>
                        </div>
                    </div>

                    <div id="aiLoadingSection" style="display: none; text-align: center; padding: 30px;">
                        <div style="font-size: 48px; margin-bottom: 15px; animation: pulse 1.5s infinite;">ü§ñ</div>
                        <div style="font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 5px;">AI is working...</div>
                        <div style="font-size: 13px; color: #6c757d;">Generating your content</div>
                    </div>

                    <div id="aiResultSection" style="display: none;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #495057; font-size: 14px;">
                            AI Generated Content:
                        </label>
                        <div id="aiResult"
                             style="background: white; padding: 15px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; line-height: 1.6;"></div>

                        <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" onclick="regenerateAI()"
                                    style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer;">
                                üîÑ Regenerate
                            </button>
                            <button type="button" onclick="useAIContent()"
                                    style="padding: 10px 24px; background: #28a745; color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer;">
                                ‚úì Use This Content
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .ai-task-btn:hover {
            border-color: #667eea !important;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        label[for="blogImageFile"]:hover {
            border-color: #667eea !important;
            background: #f8f9ff !important;
        }
    </style>

    <script>
        let currentAITask = null;

        function openAIAssistant() {
            document.getElementById('aiAssistantModal').style.display = 'flex';
            currentAITask = null;
            document.getElementById('aiPromptSection').style.display = 'none';
            document.getElementById('aiResultSection').style.display = 'none';
            document.getElementById('aiLoadingSection').style.display = 'none';
        }

        function closeAIAssistant() {
            document.getElementById('aiAssistantModal').style.display = 'none';
            currentAITask = null;
        }

        function selectAITask(task) {
            currentAITask = task;
            document.getElementById('aiPromptSection').style.display = 'block';
            document.getElementById('aiResultSection').style.display = 'none';

            const promptField = document.getElementById('aiPrompt');

            // Set placeholder based on task
            const placeholders = {
                'title': 'e.g., Write a title about adventure travel in Uzbekistan...',
                'excerpt': 'e.g., Create a summary about the best beaches in Maldives...',
                'content': 'e.g., Write a detailed article about cultural tours in Samarkand...',
                'improve': 'Paste your existing content here to improve...'
            };

            promptField.placeholder = placeholders[task] || '';
            promptField.value = '';
            promptField.focus();
        }

        async function generateWithAI() {
            const prompt = document.getElementById('aiPrompt').value.trim();

            if (!prompt) {
                alert('Please enter your request for AI');
                return;
            }

            // Show loading
            document.getElementById('aiPromptSection').style.display = 'none';
            document.getElementById('aiLoadingSection').style.display = 'block';

            try {
                // Simulate AI generation (replace with actual API call)
                await new Promise(resolve => setTimeout(resolve, 2000));

                let generatedContent = '';

                switch(currentAITask) {
                    case 'title':
                        generatedContent = generateSampleTitle(prompt);
                        break;
                    case 'excerpt':
                        generatedContent = generateSampleExcerpt(prompt);
                        break;
                    case 'content':
                        generatedContent = generateSampleContent(prompt);
                        break;
                    case 'improve':
                        generatedContent = improveSampleContent(prompt);
                        break;
                }

                // Show result
                document.getElementById('aiLoadingSection').style.display = 'none';
                document.getElementById('aiResultSection').style.display = 'block';
                document.getElementById('aiResult').textContent = generatedContent;

            } catch (error) {
                console.error('AI generation error:', error);
                alert('Error generating content. Please try again.');
                document.getElementById('aiLoadingSection').style.display = 'none';
                document.getElementById('aiPromptSection').style.display = 'block';
            }
        }

        function regenerateAI() {
            generateWithAI();
        }

        function useAIContent() {
            const content = document.getElementById('aiResult').textContent;

            switch(currentAITask) {
                case 'title':
                    document.getElementById('blogTitle').value = content;
                    break;
                case 'excerpt':
                    document.getElementById('blogExcerpt').value = content;
                    break;
                case 'content':
                case 'improve':
                    document.getElementById('blogContent').value = content;
                    break;
            }

            closeAIAssistant();
            alert('Content added to form successfully!');
        }

        // Sample generators (replace with actual AI API)
        function generateSampleTitle(prompt) {
            const titles = [
                "Discover the Hidden Gems of " + prompt,
                "Ultimate Guide to " + prompt + ": Everything You Need to Know",
                "Top 10 Reasons to Visit " + prompt + " This Year",
                "Exploring " + prompt + ": A Journey of a Lifetime"
            ];
            return titles[Math.floor(Math.random() * titles.length)];
        }

        function generateSampleExcerpt(prompt) {
            return `Discover the beauty and wonder of ${prompt}. From stunning landscapes to rich cultural experiences, this destination offers unforgettable memories for every traveler. Join us as we explore everything this amazing place has to offer.`;
        }

        function generateSampleContent(prompt) {
            return `# Exploring ${prompt}\n\nWelcome to an incredible journey through one of the world's most fascinating destinations. ${prompt} offers a unique blend of natural beauty, rich history, and vibrant culture that captivates visitors from around the globe.\n\n## What Makes It Special\n\nFrom the moment you arrive, you'll be greeted by breathtaking scenery and warm hospitality. The local culture is rich with traditions that have been preserved for centuries, offering visitors a glimpse into a way of life that's both ancient and vibrant.\n\n## Top Attractions\n\n1. Historic landmarks that tell stories of the past\n2. Natural wonders that showcase stunning landscapes\n3. Cultural experiences that immerse you in local traditions\n4. Culinary delights that tantalize your taste buds\n\n## Planning Your Visit\n\nThe best time to visit is during the pleasant seasons when the weather is ideal for exploration. Make sure to pack appropriately and plan your itinerary to make the most of your time.\n\n## Conclusion\n\nWhether you're seeking adventure, relaxation, or cultural enrichment, this destination has something for everyone. Start planning your journey today and create memories that will last a lifetime.`;
        }

        function improveSampleContent(content) {
            return content + "\n\n[Enhanced version with improved flow and additional details]\n\nThis content has been refined for better readability and engagement. The structure is more organized, and key points are emphasized to capture reader attention effectively.";
        }

        // ============================================
        // LOCATION & MAP FUNCTIONS
        // ============================================

        let blogMap = null;
        let blogMarker = null;

        function initializeLocationMap() {
            // Initialize map if not already initialized
            if (!blogMap) {
                // Default to Uzbekistan center
                const defaultLat = parseFloat(document.getElementById('blogLatitude').value) || 41.3775;
                const defaultLng = parseFloat(document.getElementById('blogLongitude').value) || 64.5853;

                blogMap = L.map('blogMap').setView([defaultLat, defaultLng], 6);

                // Add OpenStreetMap tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap',
                    maxZoom: 18
                }).addTo(blogMap);

                // Add click event to set location
                blogMap.on('click', function(e) {
                    setMapLocation(e.latlng.lat, e.latlng.lng);
                });

                // Add marker if coordinates exist
                if (defaultLat !== 41.3775 || defaultLng !== 64.5853) {
                    blogMarker = L.marker([defaultLat, defaultLng]).addTo(blogMap);
                    updateCoordinatesDisplay(defaultLat, defaultLng);
                }
            }

            // Refresh map size
            setTimeout(() => {
                blogMap.invalidateSize();
            }, 100);
        }

        function setMapLocation(lat, lng) {
            // Update hidden fields
            document.getElementById('blogLatitude').value = lat.toFixed(6);
            document.getElementById('blogLongitude').value = lng.toFixed(6);

            // Update coordinates display
            updateCoordinatesDisplay(lat, lng);

            // Remove old marker if exists
            if (blogMarker) {
                blogMap.removeLayer(blogMarker);
            }

            // Add new marker with custom icon
            blogMarker = L.marker([lat, lng], {
                icon: L.divIcon({
                    className: 'custom-marker',
                    html: '<div style="background: #667eea; width: 24px; height: 24px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);"></div>',
                    iconSize: [24, 24],
                    iconAnchor: [12, 12]
                })
            }).addTo(blogMap);
            blogMap.setView([lat, lng], 12);

            // Try to get location name using reverse geocoding
            fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`)
                .then(response => response.json())
                .then(data => {
                    if (data.display_name && !document.getElementById('blogLocation').value) {
                        document.getElementById('blogLocation').value = data.display_name;
                    }
                })
                .catch(error => console.error('Geocoding error:', error));
        }

        function updateCoordinatesDisplay(lat, lng) {
            const display = document.getElementById('coordinatesDisplay');
            if (display) {
                display.textContent = `üìå ${lat.toFixed(4)}, ${lng.toFixed(4)}`;
            }
        }

        // ============================================
        // IMAGE UPLOAD FUNCTIONS
        // ============================================

        let uploadedImageData = null;

        function handleImageUpload(event) {
            const file = event.target.files[0];

            if (!file) return;

            // Validate file type
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                alert('Please upload a valid image file (JPG, PNG, GIF, WebP)');
                return;
            }

            // Validate file size (10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('Image size must be less than 10MB. Please use a smaller image.');
                document.getElementById('blogImageFile').value = '';
                return;
            }

            // Read and preview image
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedImageData = e.target.result;

                // Show preview
                document.getElementById('uploadPlaceholder').style.display = 'none';
                document.getElementById('imagePreviewContainer').style.display = 'block';
                document.getElementById('imagePreview').src = e.target.result;
                document.getElementById('imageFileName').textContent = '‚úì ' + file.name;
                document.getElementById('removeImageBtn').style.display = 'block';

                // Set the image URL field with the data URL
                document.getElementById('blogImage').value = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function removeUploadedImage() {
            uploadedImageData = null;
            document.getElementById('blogImageFile').value = '';
            document.getElementById('uploadPlaceholder').style.display = 'flex';
            document.getElementById('imagePreviewContainer').style.display = 'none';
            document.getElementById('imagePreview').src = '';
            document.getElementById('imageFileName').textContent = '';
            document.getElementById('removeImageBtn').style.display = 'none';
            document.getElementById('blogImage').value = '';
        }

        // Drag and drop support
        document.addEventListener('DOMContentLoaded', function() {
            const uploadLabel = document.querySelector('label[for="blogImageFile"]');
            if (uploadLabel) {
                uploadLabel.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.style.borderColor = '#667eea';
                    this.style.background = '#f0f2ff';
                });

                uploadLabel.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    this.style.borderColor = '#ced4da';
                    this.style.background = 'white';
                });

                uploadLabel.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.style.borderColor = '#ced4da';
                    this.style.background = 'white';

                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        document.getElementById('blogImageFile').files = files;
                        handleImageUpload({ target: { files: files } });
                    }
                });
            }
        });

        // ========== CATEGORIES MANAGEMENT ==========

        // Load all categories
        async function loadCategories() {
            try {
                const response = await fetch(`${API_URL}/categories`);
                const result = await response.json();

                if (result.success) {
                    const categories = result.data.categories;
                    const tbody = document.getElementById('categoriesTableBody');

                    if (categories.length === 0) {
                        tbody.innerHTML = `
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">
                                    No categories found. Click "+ Add New Category" to create one.
                                </td>
                            </tr>
                        `;
                        return;
                    }

                    tbody.innerHTML = categories.map(category => `
                        <tr>
                            <td>${category.order}</td>
                            <td style="font-size: 24px;">${category.icon}</td>
                            <td>${category.name}</td>
                            <td><code>${category.slug}</code></td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="width: 20px; height: 20px; border-radius: 4px; background: ${category.color};"></div>
                                    <span>${category.color}</span>
                                </div>
                            </td>
                            <td>
                                <span class="badge ${category.isActive ? 'badge-success' : 'badge-danger'}">
                                    ${category.isActive ? 'Active' : 'Inactive'}
                                </span>
                            </td>
                            <td>
                                <button class="action-btn edit-btn" onclick="editCategory('${category.id}')" title="Edit">
                                    ‚úèÔ∏è
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteCategory('${category.id}')" title="Delete">
                                    üóëÔ∏è
                                </button>
                            </td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading categories:', error);
                alert('Failed to load categories');
            }
        }

        // Open category modal for adding new category
        function openCategoryModal() {
            document.getElementById('categoryModalTitle').textContent = 'Add New Category';
            document.getElementById('categoryForm').reset();
            document.getElementById('categoryId').value = '';
            document.getElementById('categoryModal').style.display = 'flex';
        }

        // Close category modal
        function closeCategoryModal() {
            document.getElementById('categoryModal').style.display = 'none';
            document.getElementById('categoryForm').reset();
        }

        // Edit category
        async function editCategory(id) {
            try {
                const response = await fetch(`${API_URL}/categories/${id}`);
                const result = await response.json();

                if (result.success) {
                    const category = result.data.category;

                    document.getElementById('categoryModalTitle').textContent = 'Edit Category';
                    document.getElementById('categoryId').value = category.id;
                    document.getElementById('categoryName').value = category.name;
                    document.getElementById('categoryDescription').value = category.description || '';
                    document.getElementById('categoryIcon').value = category.icon;
                    document.getElementById('categoryColor').value = category.color;
                    document.getElementById('categoryOrder').value = category.order;
                    document.getElementById('categoryIsActive').checked = category.isActive;

                    document.getElementById('categoryModal').style.display = 'flex';
                }
            } catch (error) {
                console.error('Error loading category:', error);
                alert('Failed to load category details');
            }
        }

        // Delete category
        async function deleteCategory(id) {
            if (!confirm('Are you sure you want to delete this category?')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/categories/${id}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    alert('Category deleted successfully!');
                    loadCategories();
                } else {
                    alert(result.message || 'Failed to delete category');
                }
            } catch (error) {
                console.error('Error deleting category:', error);
                alert('Failed to delete category');
            }
        }

        // Handle category form submission
        document.addEventListener('DOMContentLoaded', function() {
            const categoryForm = document.getElementById('categoryForm');

            if (categoryForm) {
                categoryForm.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const categoryId = document.getElementById('categoryId').value;
                    const categoryData = {
                        name: document.getElementById('categoryName').value,
                        description: document.getElementById('categoryDescription').value,
                        icon: document.getElementById('categoryIcon').value || 'üéØ',
                        color: document.getElementById('categoryColor').value,
                        order: parseInt(document.getElementById('categoryOrder').value) || 0,
                        isActive: document.getElementById('categoryIsActive').checked
                    };

                    try {
                        const url = categoryId
                            ? `${API_URL}/categories/${categoryId}`
                            : `${API_URL}/categories`;

                        const response = await fetch(url, {
                            method: categoryId ? 'PUT' : 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(categoryData)
                        });

                        const result = await response.json();

                        if (result.success) {
                            alert(categoryId ? 'Category updated successfully!' : 'Category created successfully!');
                            closeCategoryModal();
                            loadCategories();
                        } else {
                            alert(result.message || 'Failed to save category');
                        }
                    } catch (error) {
                        console.error('Error saving category:', error);
                        alert('Failed to save category');
                    }
                });
            }
        });

        // Load categories when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Load categories if on categories page
            const categoriesPage = document.getElementById('categoriesPage');
            if (categoriesPage) {
                loadCategories();
            }
        });

        // ========== AI ASSISTANT FUNCTIONS ==========

        async function generateTourWithAI(event) {
            // Get values from AI modal
            const category = document.getElementById('aiCategory').value;
            const duration = document.getElementById('aiDuration').value;
            const nights = document.getElementById('aiNights').value;
            const destination = document.getElementById('aiDestination').value;
            const price = document.getElementById('aiPrice').value;
            const maxGroupSize = document.getElementById('aiMaxGroupSize').value;
            const difficulty = document.getElementById('aiDifficulty').value;
            const accommodation = document.getElementById('aiAccommodation').value;
            const additionalPrompt = document.getElementById('aiPrompt').value;

            // Validation
            if (!category || !duration || !destination || !price || !maxGroupSize) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }

            // Build AI prompt
            const prompt = `Create a complete tour package with the following details:
- Type: ${category}
- Duration: ${duration} days${nights ? ` / ${nights} nights` : ''}
- Destination: ${destination}
- Price: $${price} per person
- Max Group Size: ${maxGroupSize} people
- Difficulty: ${difficulty}
- Accommodation: ${accommodation || 'Standard hotels'}
${additionalPrompt ? `\nAdditional requirements: ${additionalPrompt}` : ''}

Please provide:
1. An engaging tour title
2. A brief summary (2-3 sentences)
3. A detailed tour description (3-4 paragraphs highlighting culture, history, and experiences)
4. Day-by-day itinerary for ${duration} days
5. 5-7 tour highlights (one per line)
6. What's included in the tour (accommodation, meals, transport, guide, etc.)
7. What's NOT included (flights, visa, personal expenses, etc.)

Focus on Uzbekistan's rich Silk Road heritage, ancient architecture, and unique cultural experiences.`;

            // Show loading state
            const generateBtn = event.target;
            const originalText = generateBtn.innerHTML;
            generateBtn.innerHTML = '<span>‚è≥ Generating...</span>';
            generateBtn.disabled = true;

            try {
                const token = localStorage.getItem('adminToken');
                const response = await fetch('/api/ai/tour-assistant', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        currentData: {
                            category, duration, nights, destination, price, maxGroupSize, difficulty, accommodation
                        }
                    })
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.message || 'AI service error');
                }

                // Parse AI response and fill form
                const aiData = result.data;

                // Fill main tour form with AI generated content
                if (aiData.title) {
                    document.getElementById('tourName').value = aiData.title;
                }
                if (aiData.summary) {
                    document.getElementById('tourSummary').value = aiData.summary;
                }
                if (aiData.description) {
                    document.getElementById('tourDescription').value = aiData.description;
                }
                if (aiData.highlights) {
                    const highlightsText = Array.isArray(aiData.highlights)
                        ? aiData.highlights.join('\n')
                        : aiData.highlights;
                    document.getElementById('tourHighlights').value = highlightsText;
                }

                // Fill basic info from AI modal
                document.getElementById('tourCategory').value = category;
                document.getElementById('tourDuration').value = duration;
                document.getElementById('tourLocation').value = destination;
                document.getElementById('tourPrice').value = price;
                document.getElementById('tourMaxGroupSize').value = maxGroupSize;
                document.getElementById('tourDifficulty').value = difficulty;

                // Fill accommodation if available
                if (accommodation && document.getElementById('tourAccommodation')) {
                    document.getElementById('tourAccommodation').value = accommodation;
                }

                // Close AI modal and show success
                closeAIModal();
                showNotification('‚ú® Tour content generated successfully! Please review and adjust as needed.', 'success');

                // Show the main tour modal if not open
                if (!document.getElementById('tourModal').classList.contains('active')) {
                    openModal();
                }

            } catch (error) {
                console.error('AI Error:', error);
                showNotification(error.message || 'Failed to generate tour content', 'error');
            } finally {
                generateBtn.innerHTML = originalText;
                generateBtn.disabled = false;
            }
        }
    </script>

    <!-- Image Preview Modal -->
    <div id="imagePreviewModal" class="image-preview-modal">
        <button class="image-preview-close" onclick="closeImagePreview()">√ó</button>
        <div class="image-preview-content">
            <img id="imagePreviewImg" src="" alt="Preview">
        </div>
    </div>

    <!-- Category Modal -->
    <div id="categoryModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 id="categoryModalTitle">Add New Category</h2>
                <button class="close-modal" onclick="closeCategoryModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="categoryForm">
                    <input type="hidden" id="categoryId">

                    <div class="form-group">
                        <label>Category Name *</label>
                        <input type="text" id="categoryName" placeholder="E.g.: Adventure Tours" required>
                    </div>

                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="categoryDescription" rows="3" placeholder="Brief description about this category"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Icon (Emoji)</label>
                            <input type="text" id="categoryIcon" placeholder="üéØ" maxlength="2">
                        </div>
                        <div class="form-group">
                            <label>Color (Hex)</label>
                            <input type="color" id="categoryColor" value="#667eea">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Order</label>
                        <input type="number" id="categoryOrder" min="0" placeholder="0">
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="categoryIsActive" checked>
                            Active
                        </label>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="cancel-btn" onclick="closeCategoryModal()">Cancel</button>
                        <button type="submit" class="submit-btn">Save Category</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>
</html>
